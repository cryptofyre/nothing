/**
 * IMPORTANT NOTE:
 *
 * This file is licensed only for the use of Apple developers in providing MusicKit Web Services,
 * and is subject to the Apple Media Services Terms and Conditions and the Apple Developer Program
 * License Agreement. You may not copy, modify, re-host, or create derivative works of this file or the
 * accompanying Documentation, or any part thereof, including any updates, without Apple's written consent.
 *
 * ACKNOWLEDGEMENTS:
 * https://js-cdn.music.apple.com/musickit/v1/acknowledgements.txt
 */

!(function (e, n) {
  "object" == typeof exports && "undefined" != typeof module
    ? n(exports)
    : "function" == typeof define && define.amd
      ? define(["exports"], n)
      : n(
          ((e =
            "undefined" != typeof globalThis
              ? globalThis
              : e || self).MusicKit = {})
        );
})(this, function (e) {
  "use strict";
  var n = void 0 !== typeof self ? self : this;
  function formatArtworkURL(e, n, d) {
    return (
      (n = n || e.height || 100),
      (d = d || e.width || 100),
      window.devicePixelRatio >= 1.5 && ((d *= 2), (n *= 2)),
      e.url
        .replace("{h}", "" + n)
        .replace("{w}", "" + d)
        .replace("{f}", "jpeg")
    );
  }
  const K = () => {},
    asAsync = (e) => {
      e.then(K, K);
    },
    d =
      /\/(?:([a-z]{2})\/)?(album|artist|episode|movie|music-video|playlist|podcast|post|season|show|song|station)\/(?:[^/]*\/)?(?:id)?(\d+|[a-z]{2}\.[a-z0-9-]+|umc.cmc.[a-zA-Z0-9]+)(?:.*(?:[?|&]i=(\d+)).*)?.*$/i;
  function formattedMediaURL(e) {
    const n = (function (e) {
        const n = e.match(d) || [];
        let [, p, h, y, _] = n;
        return (
          "music-video" === h && (h = "musicVideo"),
          -1 !== ["album", "playlist"].indexOf(h) && _
            ? ((h = "song"), (y = _))
            : "podcast" === h && _ && ((h = "episode"), (y = _)),
          { storefrontId: p, kind: h, contentId: y, itemId: _ }
        );
      })(e),
      { storefrontId: p, kind: h, contentId: y } = n;
    if ([p, h, y].some((e) => void 0 === e))
      throw new TypeError("Invalid Media URL: " + e);
    return {
      storefrontId: p,
      kind: h,
      contentId: y,
      isUTS: !!y && y.startsWith("umc."),
    };
  }
  const p =
      /^http(?:s)?\:\/\/(?:itunes|(embed\.)?(music|podcasts|tv))\.apple\.com/i,
    h = [
      "allow-forms",
      "allow-popups",
      "allow-same-origin",
      "allow-scripts",
      "allow-storage-access-by-user-activation",
      "allow-top-navigation-by-user-activation",
    ],
    y = ["autoplay *", "encrypted-media *", "fullscreen *", "clipboard-write"];
  const _ = [
    "contributors",
    "modalities",
    "movie",
    "musicVideo",
    "musicMovie",
    "trailer",
    "tvEpisode",
    "uploadedVideo",
    "uploaded-videos",
    "music-videos",
    "music-movies",
    "tv-episodes",
    "workouts",
  ];
  function isVideo(e) {
    var n;
    return (
      null != e &&
      (!0 === e.isUTS ||
        _.includes(e.type) ||
        "video" ===
          (null === (n = e.attributes) || void 0 === n ? void 0 : n.mediaKind))
    );
  }
  function isLive(e) {
    var n;
    return !!(null == e || null === (n = e.attributes) || void 0 === n
      ? void 0
      : n.isLive);
  }
  function isStream$1(e) {
    var n, d;
    return (
      "stream" ===
      (null == e ||
      null === (d = e.attributes) ||
      void 0 === d ||
      null === (n = d.playParams) ||
      void 0 === n
        ? void 0
        : n.format)
    );
  }
  function isAlgoStation(e) {
    return (function (e) {
      var n, d;
      return (
        "tracks" ===
        (null == e ||
        null === (d = e.attributes) ||
        void 0 === d ||
        null === (n = d.playParams) ||
        void 0 === n
          ? void 0
          : n.format)
      );
    })(e);
  }
  function isRadioStation(e, n) {
    var d, p, h;
    return (
      "radioStation" ===
        (null == e ||
        null === (p = e.attributes) ||
        void 0 === p ||
        null === (d = p.playParams) ||
        void 0 === d
          ? void 0
          : d.kind) &&
      (void 0 === n ||
        (null === (h = e.attributes) || void 0 === h ? void 0 : h.mediaKind) ===
          n)
    );
  }
  function isRadioEpisode(e, n) {
    var d;
    return (
      isRadioStation(e, n) &&
      isStream$1(e) &&
      !isLive(e) &&
      "Episode" ===
        (null == e || null === (d = e.attributes) || void 0 === d
          ? void 0
          : d.streamingRadioSubType)
    );
  }
  function isLiveRadioStation(e, n) {
    return isRadioStation(e, n) && isLive(e) && isStream$1(e);
  }
  function isLiveRadioKind(e, n) {
    return isLiveRadioStation(e, n);
  }
  function isAOD(e, n) {
    var d;
    return (
      isRadioEpisode(e, n) ||
      !!(null == e || null === (d = e.attributes) || void 0 === d
        ? void 0
        : d.isAOD)
    );
  }
  function isBroadcastRadio(e) {
    return (
      isLive(e) &&
      isStream$1(e) &&
      void 0 !== e.attributes.stationProviderName &&
      "Shoutcast" === e.attributes.streamingRadioSubType
    );
  }
  function getFilterFromFlags(e) {
    const n = e.includes("radio-live"),
      d = e.includes("radio-aod"),
      p = e.includes("radio-broadcast");
    return function (e) {
      return (
        (!n || (n && !isLiveRadioStation(e))) &&
        (!d || (d && !isAOD(e))) &&
        (!p || (p && !isBroadcastRadio(e)))
      );
    };
  }
  const m = {};
  function normalizeContentType(e) {
    if (void 0 !== m[e]) return m[e];
    let n = e
      .replace(/[A-Z]/g, function (e, n) {
        const d = e.toLowerCase();
        return 0 !== n ? "-" + d : d;
      })
      .replace(/_+/g, "-")
      .replace(/-+/g, "-")
      .replace(/(^-*)|(-*$)/, "");
    return (
      e.endsWith("y")
        ? (n = n.substring(0, n.length - 1) + "ies")
        : n.endsWith("s") || (n += "s"),
      (m[e] = n),
      n
    );
  }
  function _define_property$2c(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const g = {
      INVALID_ERROR_ID: "INVALID_ERROR_ID",
      INVALID_ERROR_REASON: "INVALID_ERROR_REASON",
      ACCESS_DENIED: "ACCESS_DENIED",
      AGE_GATE: "AGE_GATE",
      AUTHORIZATION_ERROR: "AUTHORIZATION_ERROR",
      BUFFER_STALLED_ERROR: "BUFFER_STALLED_ERROR",
      CONFIGURATION_ERROR: "CONFIGURATION_ERROR",
      CONTENT_EQUIVALENT: "CONTENT_EQUIVALENT",
      CONTENT_RESTRICTED: "CONTENT_RESTRICTED",
      CONTENT_UNAVAILABLE: "CONTENT_UNAVAILABLE",
      CONTENT_UNSUPPORTED: "CONTENT_UNSUPPORTED",
      DEVICE_LIMIT: "DEVICE_LIMIT",
      GEO_BLOCK: "GEO_BLOCK",
      INVALID_ARGUMENTS: "INVALID_ARGUMENTS",
      PLAYREADY_CBC_ENCRYPTION_ERROR: "PLAYREADY_CBC_ENCRYPTION_ERROR",
      MEDIA_CERTIFICATE: "MEDIA_CERTIFICATE",
      MEDIA_DESCRIPTOR: "MEDIA_DESCRIPTOR",
      MEDIA_LICENSE: "MEDIA_LICENSE",
      MEDIA_KEY: "MEDIA_KEY",
      MEDIA_PLAYBACK: "MEDIA_PLAYBACK",
      MEDIA_SESSION: "MEDIA_SESSION",
      NETWORK_ERROR: "NETWORK_ERROR",
      NOT_FOUND: "NOT_FOUND",
      PARSE_ERROR: "PARSE_ERROR",
      PLAY_ACTIVITY: "PLAY_ACTIVITY",
      REQUEST_ERROR: "REQUEST_ERROR",
      QUOTA_EXCEEDED: "QUOTA_EXCEEDED",
      SERVER_ERROR: "SERVER_ERROR",
      SERVICE_UNAVAILABLE: "SERVICE_UNAVAILABLE",
      STREAM_UPSELL: "STREAM_UPSELL",
      SUBSCRIPTION_ERROR: "SUBSCRIPTION_ERROR",
      TOKEN_EXPIRED: "TOKEN_EXPIRED",
      UNAUTHORIZED_ERROR: "UNAUTHORIZED_ERROR",
      UNKNOWN_ERROR: "UNKNOWN_ERROR",
      UNSUPPORTED_ERROR: "UNSUPPORTED_ERROR",
      USER_INTERACTION_REQUIRED: "USER_INTERACTION_REQUIRED",
      INTERNAL_ERROR: "INTERNAL_ERROR",
      OUTPUT_RESTRICTED: "OUTPUT_RESTRICTED",
      WIDEVINE_CDM_EXPIRED: "WIDEVINE_CDM_EXPIRED",
    },
    b = {
      400: g.REQUEST_ERROR,
      401: g.UNAUTHORIZED_ERROR,
      403: g.ACCESS_DENIED,
      404: g.NOT_FOUND,
      405: g.NOT_FOUND,
      413: g.REQUEST_ERROR,
      414: g.REQUEST_ERROR,
      429: g.QUOTA_EXCEEDED,
      500: g.SERVER_ERROR,
      501: g.NOT_FOUND,
      503: g.SERVICE_UNAVAILABLE,
    },
    P = {
      "-1004": g.DEVICE_LIMIT,
      "-1017": g.GEO_BLOCK,
      1010: g.NOT_FOUND,
      2002: g.AUTHORIZATION_ERROR,
      2034: g.TOKEN_EXPIRED,
      3059: g.DEVICE_LIMIT,
      3063: g.SUBSCRIPTION_ERROR,
      3076: g.CONTENT_UNAVAILABLE,
      3082: g.CONTENT_RESTRICTED,
      3084: g.STREAM_UPSELL,
      5002: g.SERVER_ERROR,
      180202: g.PLAYREADY_CBC_ENCRYPTION_ERROR,
      190121: g.WIDEVINE_CDM_EXPIRED,
    },
    S = new Set([
      g.CONTENT_EQUIVALENT,
      g.CONTENT_UNAVAILABLE,
      g.CONTENT_UNSUPPORTED,
      g.SERVER_ERROR,
      g.SUBSCRIPTION_ERROR,
      g.UNSUPPORTED_ERROR,
      g.USER_INTERACTION_REQUIRED,
    ]);
  class MKError extends Error {
    static isMKError(e) {
      return (function (e) {
        return void 0 !== e && e instanceof MKError;
      })(e);
    }
    get errorCode() {
      return this.reason;
    }
    static playActivityError(e) {
      return new this(g.PLAY_ACTIVITY, e);
    }
    static parseError(e) {
      return new this(g.PARSE_ERROR, e);
    }
    static responseError(e) {
      const { status: n, statusText: d } = e,
        p = new this(b[n] || g.NETWORK_ERROR, d || "" + n);
      return (p.data = e), p;
    }
    static serverError(e, n = g.UNKNOWN_ERROR) {
      let {
        status: d,
        dialog: p,
        failureType: h,
        customerMessage: y,
        errorMessage: _,
        message: m,
      } = e;
      p &&
        ((m = p.message || p.customerMessage || p.errorMessage),
        (p.message = m));
      const b = P[h] || P[d] || n,
        S = new this(b, m || y || _);
      return (
        b === g.STREAM_UPSELL &&
          p &&
          p.okButtonAction &&
          p.okButtonAction.url &&
          (p.okButtonAction.url = p.okButtonAction.url.replace(
            /\&(?:challenge|key-system|uri|user-initiated)=[^\&]+/gim,
            ""
          )),
        (S.dialog = p),
        S
      );
    }
    static internalError(e) {
      return new this(g.INTERNAL_ERROR, e);
    }
    constructor(e, n) {
      super(),
        _define_property$2c(this, "isMKError", !0),
        _define_property$2c(this, "reason", g.UNKNOWN_ERROR),
        _define_property$2c(this, "description", void 0),
        _define_property$2c(this, "dialog", void 0),
        _define_property$2c(this, "data", void 0),
        e && S.has(e)
          ? ((this.name = this.reason = e),
            (this.message = this.description = n || e))
          : n || "string" != typeof e
            ? ((this.name = this.reason = e || g.UNKNOWN_ERROR),
              n && (this.message = this.description = n))
            : ((this.name = this.reason = g.UNKNOWN_ERROR),
              (this.message = this.description = e)),
        Error.captureStackTrace && Error.captureStackTrace(this, MKError);
    }
  }
  _define_property$2c(MKError, "Reason", g), Object.assign(MKError, g);
  class GenericStorage {
    get data() {
      return this._data;
    }
    set data(e) {
      this._data = e;
    }
    get length() {
      return this.keys.length;
    }
    get keys() {
      return Object.keys(this.data);
    }
    getItem(e) {
      return this.data[e] || null;
    }
    setItem(e, n) {
      this.data[e] = n;
    }
    removeItem(e) {
      delete this.data[e];
    }
    clear() {
      this.keys.forEach((e) => this.removeItem(e));
    }
    key(e) {
      return this.keys[e] || null;
    }
    constructor(e = {}) {
      var n, d, p;
      (p = void 0),
        (d = "_data") in (n = this)
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p),
        (this.data = e);
    }
  }
  function getCookie(e = "", n = document.cookie) {
    const d = n.match(new RegExp(`(?:^|;\\s*)${e}=([^;]*)`));
    if (d) return d[1];
  }
  function setCookie(e, n, d = "", p = 14, h, y) {
    const _ = new Date();
    h = null != h ? h : window;
    const m =
      (y =
        null != y
          ? y
          : /\./.test(h.location.hostname)
            ? h.location.hostname
            : "").length > 0
        ? `domain=${y}; `
        : "";
    _.setTime(_.getTime() + 24 * p * 60 * 60 * 1e3);
    let g = "";
    "https:" === h.location.protocol && (g = "; secure"),
      (h.document.cookie = `${e}=${n}; expires=${_.toUTCString()}; ${m}path=${d}${g}`);
  }
  function removeCookie(e, n, d) {
    setCookie(e, "", "/", 0, n, d);
  }
  function hasSessionStorage() {
    let e = !1;
    try {
      e = "undefined" != typeof sessionStorage;
    } catch (Yt) {}
    return e;
  }
  function getSessionStorage() {
    let e;
    return hasSessionStorage() && (e = sessionStorage), e;
  }
  function hasLocalStorage() {
    let e = !1;
    try {
      e = "undefined" != typeof localStorage;
    } catch (Yt) {}
    return e;
  }
  function getLocalStorage() {
    let e;
    return hasLocalStorage() && (e = localStorage), e;
  }
  function getJsonFromLocalStorage(e) {
    const n = (function (e) {
      if (!hasLocalStorage()) return;
      const n = getLocalStorage().getItem(e);
      return null !== n ? n : void 0;
    })(e);
    if (n)
      try {
        return JSON.parse(n);
      } catch (Yt) {
        return;
      }
  }
  function _define_property$2a(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class Notifications {
    get shouldStorageDispatch() {
      return (
        "undefined" != typeof window &&
        hasSessionStorage() &&
        this.dispatchNamespace
      );
    }
    addEventListener(e, n) {
      Array.isArray(this._eventRegistry[e]) && this._eventRegistry[e].push(n);
    }
    dispatchEvent(e, n) {
      Array.isArray(this._eventRegistry[e]) &&
        this._eventRegistry[e].forEach((e) => e(n));
    }
    dispatchDistributedEvent(e, n) {
      if ((this.dispatchEvent(e, n), this.shouldStorageDispatch)) {
        var d;
        const p = `${this.dispatchNamespace}:${e}`;
        null === (d = getSessionStorage()) ||
          void 0 === d ||
          d.setItem(p, JSON.stringify(n));
      }
    }
    removeEventListener(e, n) {
      if (Array.isArray(this._eventRegistry[e])) {
        const d = this._eventRegistry[e].indexOf(n);
        this._eventRegistry[e].splice(d, 1);
      }
    }
    _handleGlobalStorageEvent(e) {
      var n;
      if (
        this.dispatchNamespace &&
        (null === (n = e.key) || void 0 === n
          ? void 0
          : n.startsWith(this.dispatchNamespace + ":"))
      ) {
        const n = e.key.substring(this.dispatchNamespace.length + 1);
        this.dispatchEvent(n, JSON.parse(e.newValue));
      }
    }
    constructor(e = [], n) {
      _define_property$2a(this, "dispatchNamespace", void 0),
        _define_property$2a(this, "_eventRegistry", {}),
        e.forEach((e) => {
          this._eventRegistry[e] = [];
        }),
        n &&
          n.namespace &&
          (this.dispatchNamespace = "com.apple." + n.namespace),
        this.shouldStorageDispatch &&
          ((this._handleGlobalStorageEvent =
            this._handleGlobalStorageEvent.bind(this)),
          window.addEventListener("storage", this._handleGlobalStorageEvent));
    }
  }
  var T =
    "undefined" != typeof FastBoot
      ? FastBoot.require("buffer").Buffer
      : "undefined" != typeof process &&
          null !== process.versions &&
          null !== process.versions.node
        ? Buffer
        : window.Buffer;
  function memoize(e) {
    return function (...n) {
      let d = "",
        p = n.length;
      for (e._memoized = e._memoized || {}; p--; ) {
        const e = n[p];
        d += e === Object(e) ? JSON.stringify(e) : e;
      }
      return d in e._memoized ? e._memoized[d] : (e._memoized[d] = e(...n));
    };
  }
  function isObject(e) {
    return !!e && "object" == typeof e && !Array.isArray(e);
  }
  function generateUUID() {
    let e = strRandomizer() + strRandomizer();
    for (; e.length < 16; ) e += strRandomizer();
    return e.slice(0, 16);
  }
  function strRandomizer() {
    return Math.random().toString(16).substring(2);
  }
  const k = memoize((e) => /^[a|i|l|p]{1}\.[a-zA-Z0-9]+$/.test(e)),
    E = memoize((e) => /^(a\.)?[a-zA-Z0-9]+$/.test(e));
  function detectNodeEnvironment() {
    var e, n, d, p;
    return (
      void 0 !==
        (null === (d = globalThis) ||
        void 0 === d ||
        null === (n = d.process) ||
        void 0 === n ||
        null === (e = n.versions) ||
        void 0 === e
          ? void 0
          : e.node) ||
      void 0 !==
        (null === (p = globalThis) || void 0 === p ? void 0 : p.FastBoot)
    );
  }
  function isNodeEnvironment$1() {
    return detectNodeEnvironment();
  }
  const w = memoize(
    detectNodeEnvironment()
      ? (e) => T.from(e, "base64").toString("binary")
      : (e) => window.atob(e)
  );
  memoize(
    detectNodeEnvironment()
      ? (e) => T.from(e).toString("base64")
      : (e) => window.btoa(e)
  );
  const debounce = (e, n = 250, d = { isImmediate: !1 }) => {
      let p;
      return function (...h) {
        const y = this,
          _ = d.isImmediate && void 0 === p;
        void 0 !== p && clearTimeout(p),
          (p = setTimeout(function () {
            (p = void 0), d.isImmediate || e.apply(y, h);
          }, n)),
          _ && e.apply(y, h);
      };
    },
    exceptFields = (e, ...n) => {
      const d = {};
      return (
        Object.keys(e).forEach((p) => {
          n.includes(p) || (d[p] = e[p]);
        }),
        d
      );
    },
    arrayEquals = (e, n) =>
      !!e && !!n && [].every.call(e, (e, d) => e === n[d]);
  function hasOwn(e, n) {
    return Object.prototype.hasOwnProperty.call(Object(e), n);
  }
  function deepClone(e) {
    const n = Object.prototype.toString.call(e).toLowerCase().slice(8, -1);
    switch (n) {
      case "set":
        return new Set([...e].map((e) => deepClone(e)));
      case "map":
        return new Map([...e].map(([e, n]) => [deepClone(e), deepClone(n)]));
      case "date":
        return new Date(e.getTime());
      case "regexp": {
        const n = e,
          d =
            "string" == typeof n.flags
              ? n.flags
              : [
                  n.global ? "g" : void 0,
                  n.ignoreCase ? "i" : void 0,
                  n.multiline ? "m" : void 0,
                  n.sticky ? "y" : void 0,
                  n.unicode ? "u" : void 0,
                ]
                  .filter((e) => void 0 !== e)
                  .join("");
        return RegExp(e.source, d);
      }
      case "arraybuffer": {
        const n = e;
        if ("function" == typeof n.slice) return n.slice(0);
        {
          const d = new e.constructor(n.byteLength);
          return new Uint8Array(d).set(new Uint8Array(n)), d;
        }
      }
      case "dataview":
      case "int8array":
      case "uint8array":
      case "uint8clampedarray":
      case "int16array":
      case "uint16array":
      case "int32array":
      case "uint32array":
      case "float32array":
      case "float64array":
      case "bigint64array":
      case "biguint64array": {
        const d = e;
        return new (0, d.constructor)(
          deepClone(d.buffer),
          d.byteOffset,
          "dataview" === n ? d.byteLength : d.length
        );
      }
      case "array":
      case "object": {
        const n = Array.isArray(e) ? [] : {};
        for (const d in e) hasOwn(e, d) && (n[d] = deepClone(e[d]));
        return n;
      }
      default:
        return e;
    }
  }
  function isEmpty(e) {
    if ("object" != typeof e) throw new TypeError("Source is not an Object");
    for (const n in e) if (hasOwn(e, n)) return !1;
    return !0;
  }
  function transform$a(e, n, d = !1) {
    return (
      d && (e = Object.keys(e).reduce((n, d) => ((n[e[d]] = d), n), {})),
      Object.keys(e).reduce((d, p) => {
        const h = e[p],
          y =
            "function" == typeof h
              ? h()
              : (function (e, n) {
                  return n.split(".").reduce((e, n) => {
                    if (void 0 !== e) return e[n];
                  }, e);
                })(n, h);
        return (
          y &&
            (function (e, n, d) {
              n.split(".").reduce((n, p, h, y) => {
                const _ = h === y.length - 1,
                  m = hasOwn(n, p),
                  g = n[p] instanceof Object,
                  b = null === n[p];
                if (!_ && m && (!g || b))
                  throw new TypeError(
                    `Value at ${y.slice(0, h + 1).join(".")} in keypath is not an Object.`
                  );
                return _ ? ((n[p] = d), e) : m ? n[p] : (n[p] = {});
              }, e);
            })(d, p, y),
          d
        );
      }, {})
    );
  }
  function transformKeys(e, n) {
    return Object.keys(e).reduce((d, p) => ((d[n(p)] = e[p]), d), {});
  }
  const O = {};
  function findOrCreate(e, n) {
    const d = e
      .toLowerCase()
      .replace(/[^a-zA-Z0-9]+(.)/g, (e, n) => n.toUpperCase());
    if (hasOwn(O, d)) {
      const p = O[d];
      if (n !== p.constructor)
        throw new Error(
          `DevFlag ${e} was already registered with a different type (${p.constructor.name})`
        );
      return p;
    }
    const p = new n(e);
    return (
      Object.defineProperty(O, d, {
        configurable: !0,
        enumerable: !0,
        get: function () {
          return p;
        },
        set(e) {
          p.set(e);
        },
      }),
      p
    );
  }
  class LocalStorageDevFlag {
    get value() {
      return this.get();
    }
    get configured() {
      return void 0 !== this.value;
    }
    read() {
      var e, n;
      const d =
        null !==
          (n =
            null === (e = getLocalStorage()) || void 0 === e
              ? void 0
              : e.getItem(this.key)) && void 0 !== n
          ? n
          : null;
      return null !== d ? d : void 0;
    }
    write(e) {
      var n;
      null === (n = getLocalStorage()) ||
        void 0 === n ||
        n.setItem(this.key, e);
    }
    clear() {
      var e;
      null === (e = getLocalStorage()) ||
        void 0 === e ||
        e.removeItem(this.key);
    }
    constructor(e) {
      if (
        ((function (e, n, d) {
          n in e
            ? Object.defineProperty(e, n, {
                value: d,
                enumerable: !0,
                configurable: !0,
                writable: !0,
              })
            : (e[n] = d);
        })(this, "key", void 0),
        "string" != typeof e || "" === e.trim())
      )
        throw new Error("DevFlag requires a non-empty string key");
      this.key = e;
    }
  }
  class StringDevFlag extends LocalStorageDevFlag {
    static register(e) {
      return findOrCreate(e, this);
    }
    static get(e) {
      return this.register(e).get();
    }
    static set(e, n) {
      this.register(e).set(n);
    }
    get() {
      return this.read();
    }
    set(e) {
      "string" != typeof e &&
        console.warn("Value for StringDevFlag should be a string"),
        this.write(e);
    }
  }
  class BooleanDevFlag extends LocalStorageDevFlag {
    static register(e) {
      return findOrCreate(e, this);
    }
    static get(e) {
      return this.register(e).get();
    }
    static set(e, n) {
      this.register(e).set(n);
    }
    get() {
      const e = this.read();
      if (void 0 !== e) return "1" === e || "true" === e.toLowerCase();
    }
    set(e) {
      "boolean" == typeof e
        ? this.write(!0 === e ? "1" : "0")
        : console.warn("Value for BooleanDevFlag should be a boolean");
    }
    get enabled() {
      return !0 === this.get();
    }
    enable() {
      this.set(!0);
    }
    disable() {
      this.set(!1);
    }
    toggle() {
      this.set(!this.get());
    }
  }
  class JsonDevFlag extends LocalStorageDevFlag {
    static register(e) {
      return findOrCreate(e, this);
    }
    static get(e) {
      return this.register(e).get();
    }
    static set(e, n) {
      this.register(e).set(n);
    }
    get() {
      const e = this.read();
      if (void 0 !== e)
        try {
          return JSON.parse(e);
        } catch (q) {
          return;
        }
    }
    set(e) {
      this.write(JSON.stringify(e));
    }
    prop(e) {
      if (void 0 !== this.value) return this.value[e];
    }
  }
  const $ = [
      "contributors",
      "modalities",
      "musicVideo",
      "podcast-episodes",
      "radioStation",
      "song",
      "uploaded-audios",
      "uploadedAudio",
      "uploaded-videos",
      "uploadedVideo",
      "workouts",
      "workout-programs",
    ],
    I = ["Vod", "LiveService", "EbsEvent", "Event"],
    R = {
      mediaItemStateDidChange: "mediaItemStateDidChange",
      mediaItemStateWillChange: "mediaItemStateWillChange",
    },
    A = {
      CRITICAL: 50,
      ERROR: 40,
      WARNING: 30,
      NOTICE: 20,
      INFO: 10,
      DEBUG: 2,
      TRACE: 1,
      NONE: 0,
    };
  const C = {
    OFF: "NONE",
    0: "NONE",
    "+": "INFO",
    "++": "DEBUG",
    V: "DEBUG",
    D: "DEBUG",
    VERBOSE: "DEBUG",
    VV: "TRACE",
    SILLY: "TRACE",
    "*": "TRACE",
  };
  function getLoggingLevel$1(e, n = {}) {
    if ("number" == typeof e)
      return (function (e) {
        return "number" == typeof e && Object.values(A).includes(e);
      })(e)
        ? e
        : void 0;
    let d = e.toUpperCase();
    return (
      n.allowShorthands && void 0 !== C[d] && (d = C[d]),
      (function (e) {
        return "string" == typeof e && void 0 !== A[e.toUpperCase()];
      })(d)
        ? A[d]
        : void 0
    );
  }
  function _define_property$28(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$$(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$28(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$G(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _define_property1$1(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const M = A.ERROR,
    DEFAULT_POLICY$1 = (e, n) => e !== A.NONE && n >= e;
  class Logger$1 {
    get parent() {
      return this._parent;
    }
    get children() {
      return Array.from(this._children.values());
    }
    get namespace() {
      return void 0 === this._parent
        ? this.name
        : this._parent.namespace + "/" + this.name;
    }
    get enabled() {
      return this.level !== A.NONE;
    }
    get level() {
      var e, n, d;
      return null !==
        (d =
          null !== (n = this._level) && void 0 !== n
            ? n
            : null === (e = this.parent) || void 0 === e
              ? void 0
              : e.level) && void 0 !== d
        ? d
        : M;
    }
    get levelName() {
      var e;
      return null !==
        (e = (function (e) {
          for (const [n, d] of Object.entries(A)) if (e === d) return n;
        })(this.level)) && void 0 !== e
        ? e
        : "UNKNOWN";
    }
    get levelPolicy() {
      var e, n, d;
      return null !==
        (d =
          null !== (n = this._levelPolicy) && void 0 !== n
            ? n
            : null === (e = this.parent) || void 0 === e
              ? void 0
              : e.levelPolicy) && void 0 !== d
        ? d
        : DEFAULT_POLICY$1;
    }
    get handlers() {
      var e, n, d;
      return null !==
        (d =
          null !== (n = this._handlers) && void 0 !== n
            ? n
            : null === (e = this.parent) || void 0 === e
              ? void 0
              : e.handlers) && void 0 !== d
        ? d
        : {};
    }
    isEnabledFor(e) {
      return this.levelPolicy(this.level, e);
    }
    setLevel(e) {
      const n = getLoggingLevel$1(e);
      void 0 !== n && (this._level = n);
    }
    clearLevel() {
      this._level = void 0;
    }
    setLevelPolicy(e) {
      this._levelPolicy = e;
    }
    clearLevelPolicy() {
      this._levelPolicy = void 0;
    }
    addHandler(e, n) {
      this._handlers || (this._handlers = {}), (this._handlers[e] = n);
    }
    hasHandler(e) {
      var n;
      return (
        void 0 !==
        (null === (n = this._handlers) || void 0 === n ? void 0 : n[e])
      );
    }
    removeHandler(e) {
      void 0 !== this._handlers &&
        (delete this._handlers[e],
        0 === Object.keys(this._handlers).length && this.clearHandlers());
    }
    clearHandlers() {
      this._handlers = void 0;
    }
    createChild(e, n) {
      const d = this._children.get(e);
      return void 0 !== d
        ? d
        : new Logger$1(
            e,
            _object_spread_props$G(_object_spread$$({}, n), { parent: this })
          );
    }
    linkChild(e) {
      if (void 0 !== e.parent && e.parent !== this)
        throw new Error(
          `Logger '${e.name}' is already a child of a different parent ('${e.parent.name}')`
        );
      const n = this._children.get(e.name);
      if (void 0 !== n && n !== e)
        throw new Error(`A child with name '${e.name}' is already registered`);
      return (
        void 0 === n && (this._children.set(e.name, e), e.linkParent(this)), e
      );
    }
    unlinkChild(e) {
      const n = this._children.get(e.name);
      return n === e && (this._children.delete(e.name), n.unlinkParent()), e;
    }
    getByName(e) {
      return this._children.get(e);
    }
    getByNamespace(e) {
      return (function (e, n, d = "/") {
        if ("" === (n = n.trim()) || "*" === n) return e;
        const p = n.split(d);
        p[0].trim() === e.name && p.shift();
        if (0 === p.length) return e;
        let h = e;
        for (; void 0 !== h && p.length > 0; ) {
          const e = p.shift();
          h = h.getByName(e.trim());
        }
        return h;
      })(this, e);
    }
    linkParent(e) {
      return (
        this.parent !== e &&
          (this.unlinkParent(), (this._parent = e), e.linkChild(this)),
        this
      );
    }
    unlinkParent() {
      return (
        void 0 !== this._parent &&
          (this._parent.unlinkChild(this), (this._parent = void 0)),
        this
      );
    }
    log(e, n, ...d) {
      const p = getLoggingLevel$1(e);
      void 0 !== p &&
        this.logRecord({
          time: Date.now(),
          namespace: this.namespace,
          level: p,
          message: n,
          args: d,
        });
    }
    logRecord(e) {
      if (!this.levelPolicy(this.level, e.level)) return;
      const n = _object_spread$$({ namespace: this.namespace }, e);
      for (const d of Object.values(this.handlers)) d.process(n);
    }
    error(e, ...n) {
      this.log(A.ERROR, e, ...n);
    }
    warning(e, ...n) {
      this.log(A.WARNING, e, ...n);
    }
    warn(e, ...n) {
      this.warning(e, ...n);
    }
    info(e, ...n) {
      this.log(A.INFO, e, ...n);
    }
    debug(e, ...n) {
      this.log(A.DEBUG, e, ...n);
    }
    trace(e, ...n) {
      this.log(A.TRACE, e, ...n);
    }
    constructor(e, n) {
      _define_property1$1(this, "name", void 0),
        _define_property1$1(this, "_parent", void 0),
        _define_property1$1(this, "_children", new Map()),
        _define_property1$1(this, "_level", void 0),
        _define_property1$1(this, "_levelPolicy", void 0),
        _define_property1$1(this, "_handlers", void 0),
        (this.name = e),
        (this._levelPolicy = null == n ? void 0 : n.levelPolicy),
        (this._handlers = null == n ? void 0 : n.handlers),
        void 0 !== (null == n ? void 0 : n.parent) && this.linkParent(n.parent),
        void 0 !== (null == n ? void 0 : n.level) && this.setLevel(n.level);
    }
  }
  new Map([
    [A.CRITICAL, "error"],
    [A.ERROR, "error"],
    [A.WARNING, "warn"],
    [A.NOTICE, "warn"],
    [A.INFO, "log"],
    [A.DEBUG, "debug"],
  ]);
  const D = new Logger$1("media-item");
  var j, x;
  (e.PlaybackType = void 0),
    ((j = e.PlaybackType || (e.PlaybackType = {}))[(j.none = 0)] = "none"),
    (j[(j.preview = 1)] = "preview"),
    (j[(j.unencryptedFull = 2)] = "unencryptedFull"),
    (j[(j.encryptedFull = 3)] = "encryptedFull"),
    (function (e) {
      (e[(e.none = 0)] = "none"),
        (e[(e.loading = 1)] = "loading"),
        (e[(e.ready = 2)] = "ready"),
        (e[(e.playing = 3)] = "playing"),
        (e[(e.ended = 4)] = "ended"),
        (e[(e.unavailable = 5)] = "unavailable"),
        (e[(e.restricted = 6)] = "restricted"),
        (e[(e.error = 7)] = "error"),
        (e[(e.unsupported = 8)] = "unsupported");
    })(x || (x = {}));
  const {
      none: L,
      loading: N,
      ready: U,
      playing: B,
      ended: F,
      unavailable: G,
      restricted: V,
      error: q,
      unsupported: H,
    } = x,
    W = {
      [L]: { allowed: [N], unknown: [F, G, V, q, H] },
      [N]: { allowed: [U, V, q, H], unknown: [] },
      [U]: { allowed: [B], unknown: [q] },
      [B]: { allowed: [F, q], unknown: [G, V, H] },
      [F]: { allowed: [], unknown: [] },
      [G]: { allowed: [], unknown: [] },
      [V]: { allowed: [], unknown: [] },
      [q]: { allowed: [], unknown: [] },
      [H]: { allowed: [], unknown: [] },
    },
    toName = (e) => x[e],
    createMediaItemStateGuard = (e = L) => {
      const n = {
        current: e,
        set(e) {
          const { current: d } = n;
          if (!((e, n) => W[e].allowed.includes(n))(d, e)) {
            const n = ((e, n) => W[e].unknown.includes(n))(d, e);
            D.debug(
              `MediaItem.state was changed from ${toName(d)} to ${toName(e)}`,
              n
                ? "but it is unknown whether it should be allowed or not."
                : "and it should not be happening"
            );
          }
          n.current = e;
        },
      };
      return n;
    };
  function isStringNotEmpty(e) {
    return !(function (e) {
      return void 0 === e || "" === e.trim();
    })(e);
  }
  function transform$9(e) {
    return transform$a(
      {
        "attributes.albumName": "metadata.playlistName",
        "attributes.artistName": "metadata.artistName",
        "attributes.artwork"() {
          const n = null == e ? void 0 : e.artworkURL;
          if (n)
            return (function (e) {
              const n = e.split("/").pop(),
                [d, p] = (!!n && n.match(/\d+/g)) || ["100", "100"];
              return {
                width: parseInt(d, 10),
                height: parseInt(p, 10),
                url: e.replace(`${d}x${p}`, "{w}x{h}"),
              };
            })(n);
        },
        "attributes.composerName": "metadata.composerName",
        "attributes.contentRating"() {
          var n;
          if (
            1 ===
            (null == e || null === (n = e.metadata) || void 0 === n
              ? void 0
              : n.explicit)
          )
            return "explicit";
        },
        "attributes.discNumber"() {
          var n;
          return (
            (null == e || null === (n = e.metadata) || void 0 === n
              ? void 0
              : n.discNumber) || 1
          );
        },
        "attributes.durationInMillis": "metadata.duration",
        "attributes.genreNames"() {
          var n;
          return [
            null == e || null === (n = e.metadata) || void 0 === n
              ? void 0
              : n.genre,
          ];
        },
        "attributes.isrc"() {
          var n;
          const d =
            null == e || null === (n = e.metadata) || void 0 === n
              ? void 0
              : n.xid;
          if (d) return d.replace(/^([^:]+):isrc:/, "$1");
        },
        "attributes.name": "metadata.itemName",
        "attributes.playParams.id": "metadata.itemId",
        "attributes.playParams.kind": "metadata.kind",
        "attributes.previews": () => [
          { url: null == e ? void 0 : e.previewURL },
        ],
        "attributes.releaseDate": "metadata.releaseDate",
        "attributes.trackNumber": "metadata.trackNumber",
        assetURL: "URL",
        cloudId: "metadata.cloud-id",
        id() {
          var n;
          return (
            "" +
            (null == e || null === (n = e.metadata) || void 0 === n
              ? void 0
              : n.itemId)
          );
        },
        flavor: "flavor",
        type: "metadata.kind",
      },
      e
    );
  }
  function _define_property$27(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const { mediaItemStateDidChange: Y, mediaItemStateWillChange: z } = R,
    Q = BooleanDevFlag.register("mk-music-movie-playback");
  class MediaItem extends Notifications {
    get ageGatePolicy() {
      var e;
      return null === (e = this.defaultPlayable) || void 0 === e
        ? void 0
        : e.ageGatePolicy;
    }
    get albumInfo() {
      const { albumName: e, artistName: n } = this,
        d = [];
      return n && d.push(n), e && d.push(e), d.join(" - ");
    }
    get albumName() {
      return this.attributes.albumName;
    }
    get artistName() {
      return this.attributes.genreNames &&
        this.attributes.genreNames.indexOf("Classical") > -1 &&
        this.attributes.composerName
        ? this.attributes.composerName
        : this.attributes.artistName;
    }
    get artwork() {
      var e, n;
      return null !== (n = this.attributes.artwork) && void 0 !== n
        ? n
        : null === (e = this.attributes.images) || void 0 === e
          ? void 0
          : e.coverArt16X9;
    }
    get artworkURL() {
      if (this.artwork && this.artwork.url) return this.artwork.url;
    }
    get assets() {
      return this._assets;
    }
    get canPlay() {
      return this.isPlayable && this.isReady;
    }
    get container() {
      return this._container;
    }
    set container(e) {
      this._container = e;
    }
    get contentRating() {
      return this.attributes.contentRating;
    }
    get context() {
      return this._context;
    }
    set context(e) {
      this._context = e;
    }
    get defaultPlayable() {
      var e;
      return null === (e = this.playables) || void 0 === e ? void 0 : e[0];
    }
    get discNumber() {
      return this.attributes.discNumber;
    }
    get hasContainerArtwork() {
      return (
        this.container &&
        this.container.attributes &&
        this.container.attributes.artwork &&
        this.container.attributes.artwork.url
      );
    }
    get hasPlaylistContainer() {
      return (
        this.container &&
        "playlists" === this.container.type &&
        this.container.attributes
      );
    }
    get supportsLinearScrubbing() {
      var e, n, d;
      return (
        this.isLinearStream &&
        !0 ===
          (null === (d = this.defaultPlayable) ||
          void 0 === d ||
          null === (n = d.assets) ||
          void 0 === n ||
          null === (e = n.streamCapability) ||
          void 0 === e
            ? void 0
            : e.supportsLinearScrubbing)
      );
    }
    get isAssetScrubbingDisabled() {
      return !!this.isLinearStream && !this.supportsLinearScrubbing;
    }
    get isLinearStream() {
      return (
        "LiveService" === (null == (e = this) ? void 0 : e.type) ||
        "Event" ===
          (null == e || null === (n = e.defaultPlayable) || void 0 === n
            ? void 0
            : n.type) ||
        "EbsEvent" ===
          (null == e || null === (d = e.defaultPlayable) || void 0 === d
            ? void 0
            : d.type)
      );
      var e, n, d;
    }
    get isAlgoStation() {
      return isAlgoStation(this);
    }
    get isRadioStation() {
      return isRadioStation(this);
    }
    get isRadioEpisode() {
      return isRadioEpisode(this);
    }
    get isLiveRadioStation() {
      return isLiveRadioStation(this);
    }
    get isLiveAudioStation() {
      return isLiveRadioStation(this, "audio");
    }
    get isLiveVideoStation() {
      return isLiveRadioStation(this, "video");
    }
    get isAOD() {
      return isAOD(this);
    }
    get isSong() {
      return "song" === this.type;
    }
    get info() {
      return `${this.title} - ${this.albumInfo}`;
    }
    get isCloudItem() {
      return (this.playParams && this.playParams.isLibrary) || k(this.id);
    }
    get isCloudUpload() {
      return -1 === this._songId;
    }
    get isExplicitItem() {
      return "explicit" === this.contentRating;
    }
    get isLoading() {
      return this.state === x.loading;
    }
    get isPlayableMediaType() {
      return (
        !("musicMovie" !== this.type || !Q.enabled) ||
        this.isUTS ||
        -1 !== $.indexOf(this.type)
      );
    }
    get isPlayable() {
      var e;
      return (
        !!this.isUTS ||
        (!!this.isPlayableMediaType &&
          (!!(
            this.isLiveRadioStation ||
            this.isRadioEpisode ||
            this.hasOffersHlsUrl
          ) ||
            (this.needsPlayParams
              ? !!this.playParams
              : !!this.rawAssetUrl ||
                !!(null === (e = this.attributes.previews) || void 0 === e
                  ? void 0
                  : e.length))))
      );
    }
    get isPlaying() {
      return this.state === x.playing;
    }
    get isPreparedToPlay() {
      if ("song" === this.type)
        return !!this._assets && !!this.keyURLs && !!this._songId;
      if (this.isUTS) {
        const e = isStringNotEmpty(this.assetURL),
          n = !!(
            this.keyURLs &&
            isStringNotEmpty(this.keyURLs["hls-key-cert-url"]) &&
            isStringNotEmpty(this.keyURLs["hls-key-server-url"]) &&
            isStringNotEmpty(this.keyURLs["widevine-cert-url"])
          );
        return (e && n) || this.playRawAssetURL;
      }
      return !!isStringNotEmpty(this.assetURL) || this.playRawAssetURL;
    }
    get isrc() {
      return this.attributes.isrc;
    }
    get isReady() {
      return this.state === x.ready;
    }
    get isRestricted() {
      return this.state === x.restricted;
    }
    get isUTS() {
      var e;
      return !(
        !(null === (e = this.defaultPlayable) || void 0 === e
          ? void 0
          : e.type) || !I.includes(this.defaultPlayable.type)
      );
    }
    get isUnavailable() {
      return this.state === x.unavailable;
    }
    get needsPlayParams() {
      return ["musicMovie", "musicVideo", "song"].includes(this.type);
    }
    get normalizedType() {
      return normalizeContentType(this.type);
    }
    get offers() {
      return this.attributes.offers;
    }
    get offersHlsUrl() {
      const { offers: e } = this,
        n =
          null == e
            ? void 0
            : e.find((e) => {
                var n;
                return !!(null === (n = e.hlsUrl) || void 0 === n
                  ? void 0
                  : n.length);
              });
      return null == n ? void 0 : n.hlsUrl;
    }
    get hasOffersHlsUrl() {
      return isStringNotEmpty(this.offersHlsUrl);
    }
    get rawAssetUrl() {
      return this.attributes.assetUrl;
    }
    set playbackData(e) {
      if (void 0 === e) return;
      this.previewURL && (e.previewURL = this.previewURL);
      const n = transform$9(e);
      this.artwork && n.artwork && delete n.artwork,
        n.id !== this.id && delete n.id,
        this.playParams &&
          n.attributes.playParams &&
          (n.attributes.playParams = this.playParams),
        (n.attributes = (function (e) {
          for (var n = 1; n < arguments.length; n++) {
            var d = null != arguments[n] ? arguments[n] : {},
              p = Object.keys(d);
            "function" == typeof Object.getOwnPropertySymbols &&
              (p = p.concat(
                Object.getOwnPropertySymbols(d).filter(function (e) {
                  return Object.getOwnPropertyDescriptor(d, e).enumerable;
                })
              )),
              p.forEach(function (n) {
                _define_property$27(e, n, d[n]);
              });
          }
          return e;
        })({}, this.attributes, n.attributes)),
        Object.assign(this, n),
        D.debug("media-item: item merged with playbackData", this),
        (this.state = x.ready);
    }
    get playbackDuration() {
      return (
        this.attributes.durationInMillis ||
        this.attributes.durationInMilliseconds
      );
    }
    get playEvent() {
      var e;
      return null === (e = this.defaultPlayable) || void 0 === e
        ? void 0
        : e.playEvent;
    }
    get playlistArtworkURL() {
      var e, n, d;
      return this.hasPlaylistContainer && this.hasContainerArtwork
        ? null === (d = this.container) ||
          void 0 === d ||
          null === (n = d.attributes) ||
          void 0 === n ||
          null === (e = n.artwork) ||
          void 0 === e
          ? void 0
          : e.url
        : this.artworkURL;
    }
    get playlistName() {
      var e, n;
      return this.hasPlaylistContainer
        ? null === (n = this.container) ||
          void 0 === n ||
          null === (e = n.attributes) ||
          void 0 === e
          ? void 0
          : e.name
        : this.albumName;
    }
    get playParams() {
      return this.attributes.playParams;
    }
    get playRawAssetURL() {
      return this.isCloudUpload || !!this.rawAssetUrl;
    }
    get previewURL() {
      var e, n, d, p, h, y, _, m, g, b, P, S, T, k, E;
      return (
        (null === (d = this.attributes) ||
        void 0 === d ||
        null === (n = d.previews) ||
        void 0 === n ||
        null === (e = n[0]) ||
        void 0 === e
          ? void 0
          : e.url) ||
        (null === (y = this.attributes) ||
        void 0 === y ||
        null === (h = y.previews) ||
        void 0 === h ||
        null === (p = h[0]) ||
        void 0 === p
          ? void 0
          : p.hlsUrl) ||
        (null === (b = this.attributes) ||
        void 0 === b ||
        null === (g = b.trailers) ||
        void 0 === g ||
        null === (m = g[0]) ||
        void 0 === m ||
        null === (_ = m.assets) ||
        void 0 === _
          ? void 0
          : _.hlsUrl) ||
        (null === (T = this.attributes) ||
        void 0 === T ||
        null === (S = T.movieClips) ||
        void 0 === S ||
        null === (P = S[0]) ||
        void 0 === P
          ? void 0
          : P.hlsUrl) ||
        (null === (E = this.attributes) ||
        void 0 === E ||
        null === (k = E.video) ||
        void 0 === k
          ? void 0
          : k.hlsUrl)
      );
    }
    get rating() {
      return this.attributes.rating;
    }
    get releaseDate() {
      if (this._releaseDate) return this._releaseDate;
      if (
        this.attributes &&
        (this.attributes.releaseDate || this.attributes.releaseDateTime)
      ) {
        const e =
          this.attributes.releaseDate || this.attributes.releaseDateTime;
        return (
          (this._releaseDate = /^\d{4}-\d{1,2}-\d{1,2}/.test(e)
            ? new Date(e)
            : void 0),
          this._releaseDate
        );
      }
    }
    set releaseDate(e) {
      this._releaseDate =
        "string" == typeof e
          ? /^\d{4}-\d{1,2}-\d{1,2}/.test(e)
            ? new Date(e)
            : void 0
          : "number" == typeof e
            ? new Date(e)
            : e;
    }
    get songId() {
      return this._songId && -1 !== this._songId ? this._songId : this.id;
    }
    get state() {
      return this._state.current;
    }
    set state(e) {
      const n = { oldState: this._state.current, state: e };
      this._stateWillChange && this._stateWillChange(this),
        this.dispatchEvent(z, n),
        this._state.set(e),
        this._stateDidChange && this._stateDidChange(this),
        this.dispatchEvent(Y, n);
    }
    get title() {
      return this.attributes.name || this.attributes.title;
    }
    get trackNumber() {
      return this.attributes.trackNumber;
    }
    beginMonitoringStateDidChange(e) {
      this._stateDidChange = e;
    }
    beginMonitoringStateWillChange(e) {
      this._stateWillChange = e;
    }
    endMonitoringStateDidChange() {
      this._stateDidChange = void 0;
    }
    endMonitoringStateWillChange() {
      this._stateWillChange = void 0;
    }
    isEqual(e) {
      return (
        this.id === e.id &&
        this.type === e.type &&
        this.attributes === e.attributes
      );
    }
    resetState() {
      this.endMonitoringStateWillChange(),
        this.endMonitoringStateDidChange(),
        (this.state = x.none);
    }
    restrict() {
      this.isExplicitItem &&
        ((this.state = x.restricted), this._removePlayableData());
    }
    notSupported() {
      (this.state = x.unsupported), this._removePlayableData();
    }
    updateFromLoadError(e) {
      switch (e.reason) {
        case MKError.Reason.CONTENT_RESTRICTED:
          this.state = x.restricted;
          break;
        case MKError.Reason.CONTENT_UNAVAILABLE:
          this.state = x.unavailable;
          break;
        default:
          this.state = x.error;
      }
    }
    updateWithMZPlayData(e) {
      "musicVideo" === this.type || "musicMovie" === this.type
        ? this.updateWithLoadedAssets(void 0, e["hls-playlist-url"])
        : this.updateWithLoadedAssets(e.assets),
        (this._songId = e.songId),
        this.updateWithLoadedKeys({
          "hls-key-cert-url": e["hls-key-cert-url"],
          "hls-key-server-url": e["hls-key-server-url"],
          "widevine-cert-url": e["widevine-cert-url"],
        });
    }
    updateWithLoadedKeys(e, n) {
      (this.keyURLs = e), n && (this.keyServerQueryParameters = n);
    }
    updateWithLoadedAssets(e, n) {
      e && (this._assets = e), n && (this.assetURL = n);
    }
    _removePlayableData() {
      var e, n, d;
      null === (e = this.attributes) || void 0 === e || delete e.playParams,
        null === (n = this.attributes) || void 0 === n || delete n.previews,
        null === (d = this.attributes) || void 0 === d || delete d.trailers;
    }
    constructor(n = {}) {
      super([Y, z]),
        _define_property$27(this, "id", void 0),
        _define_property$27(this, "type", void 0),
        _define_property$27(this, "contentType", void 0),
        _define_property$27(this, "cloudId", void 0),
        _define_property$27(this, "playables", void 0),
        _define_property$27(this, "channels", void 0),
        _define_property$27(this, "assetURL", void 0),
        _define_property$27(this, "hlsMetadata", {}),
        _define_property$27(this, "flavor", void 0),
        _define_property$27(this, "keyURLs", void 0),
        _define_property$27(this, "keyServerQueryParameters", void 0),
        _define_property$27(this, "attributes", {}),
        _define_property$27(this, "playbackType", e.PlaybackType.none),
        _define_property$27(this, "trackInfo", void 0),
        _define_property$27(this, "relationships", void 0),
        _define_property$27(this, "_assets", []),
        _define_property$27(this, "_container", void 0),
        _define_property$27(this, "_context", void 0),
        _define_property$27(this, "_releaseDate", void 0),
        _define_property$27(this, "_songId", void 0),
        _define_property$27(this, "_state", createMediaItemStateGuard()),
        _define_property$27(this, "_stateDidChange", void 0),
        _define_property$27(this, "_stateWillChange", void 0),
        D.debug("media-item: creating Media Item with options:", n);
      var d;
      n.id && n.attributes
        ? (Object.assign(this, n),
          (this.type = (
            null === (d = this.playParams) || void 0 === d ? void 0 : d.kind
          )
            ? this.playParams.kind
            : this.type || "song"))
        : ((this.id = n.id || generateUUID()),
          (this.type = n.type || "song"),
          (this.attributes = { playParams: { id: this.id, kind: this.type } }));
      (this.contentType = n.contentType),
        (this._context = n.context || {}),
        n.container
          ? (this._container = n.container)
          : n.containerId &&
            n.containerType &&
            (this._container = { id: n.containerId, type: n.containerType });
    }
  }
  const J = [
    "contributors",
    "modalities",
    "movie",
    "musicVideo",
    "musicMovie",
    "trailer",
    "tvEpisode",
    "uploadedVideo",
    "uploaded-videos",
    "music-videos",
    "music-movies",
    "tv-episodes",
    "workouts",
  ];
  var X, Z;
  (e.PlaybackStates = void 0),
    ((X = e.PlaybackStates || (e.PlaybackStates = {}))[(X.none = 0)] = "none"),
    (X[(X.loading = 1)] = "loading"),
    (X[(X.playing = 2)] = "playing"),
    (X[(X.paused = 3)] = "paused"),
    (X[(X.stopped = 4)] = "stopped"),
    (X[(X.ended = 5)] = "ended"),
    (X[(X.seeking = 6)] = "seeking"),
    (X[(X.waiting = 8)] = "waiting"),
    (X[(X.stalled = 9)] = "stalled"),
    (X[(X.completed = 10)] = "completed"),
    (e.PresentationMode = void 0),
    ((Z = e.PresentationMode || (e.PresentationMode = {}))[
      (Z.pictureinpicture = 0)
    ] = "pictureinpicture"),
    (Z[(Z.inline = 1)] = "inline");
  const ee = {
    AFG: "143610",
    AGO: "143564",
    AIA: "143538",
    ALB: "143575",
    AND: "143611",
    ARE: "143481",
    ARG: "143505",
    ARM: "143524",
    ATG: "143540",
    AUS: "143460",
    AUT: "143445",
    AZE: "143568",
    BEL: "143446",
    BEN: "143576",
    BFA: "143578",
    BGD: "143490",
    BGR: "143526",
    BHR: "143559",
    BHS: "143539",
    BIH: "143612",
    BLR: "143565",
    BLZ: "143555",
    BMU: "143542",
    BOL: "143556",
    BRA: "143503",
    BRB: "143541",
    BRN: "143560",
    BTN: "143577",
    BWA: "143525",
    CAF: "143623",
    CAN: "143455",
    CHE: "143459",
    CHL: "143483",
    CHN: "143465",
    CIV: "143527",
    CMR: "143574",
    COD: "143613",
    COG: "143582",
    COL: "143501",
    CPV: "143580",
    CRI: "143495",
    CYM: "143544",
    CYP: "143557",
    CZE: "143489",
    DEU: "143443",
    DMA: "143545",
    DNK: "143458",
    DOM: "143508",
    DZA: "143563",
    ECU: "143509",
    EGY: "143516",
    ESP: "143454",
    EST: "143518",
    ETH: "143569",
    FIN: "143447",
    FJI: "143583",
    FRA: "143442",
    FSM: "143591",
    GAB: "143614",
    GBR: "143444",
    GEO: "143615",
    GHA: "143573",
    GIN: "143616",
    GMB: "143584",
    GNB: "143585",
    GRC: "143448",
    GRD: "143546",
    GTM: "143504",
    GUY: "143553",
    HKG: "143463",
    HND: "143510",
    HRV: "143494",
    HUN: "143482",
    IDN: "143476",
    IND: "143467",
    IRL: "143449",
    IRQ: "143617",
    ISL: "143558",
    ISR: "143491",
    ITA: "143450",
    JAM: "143511",
    JOR: "143528",
    JPN: "143462",
    KAZ: "143517",
    KEN: "143529",
    KGZ: "143586",
    KHM: "143579",
    KNA: "143548",
    KOR: "143466",
    KWT: "143493",
    LAO: "143587",
    LBN: "143497",
    LBR: "143588",
    LBY: "143567",
    LCA: "143549",
    LIE: "143522",
    LKA: "143486",
    LTU: "143520",
    LUX: "143451",
    LVA: "143519",
    MAC: "143515",
    MAR: "143620",
    MCO: "143618",
    MDA: "143523",
    MDG: "143531",
    MDV: "143488",
    MEX: "143468",
    MKD: "143530",
    MLI: "143532",
    MLT: "143521",
    MMR: "143570",
    MNE: "143619",
    MNG: "143592",
    MOZ: "143593",
    MRT: "143590",
    MSR: "143547",
    MUS: "143533",
    MWI: "143589",
    MYS: "143473",
    NAM: "143594",
    NER: "143534",
    NGA: "143561",
    NIC: "143512",
    NLD: "143452",
    NOR: "143457",
    NPL: "143484",
    NRU: "143606",
    NZL: "143461",
    OMN: "143562",
    PAK: "143477",
    PAN: "143485",
    PER: "143507",
    PHL: "143474",
    PLW: "143595",
    PNG: "143597",
    POL: "143478",
    PRT: "143453",
    PRY: "143513",
    PSE: "143596",
    QAT: "143498",
    ROU: "143487",
    RUS: "143469",
    RWA: "143621",
    SAU: "143479",
    SEN: "143535",
    SGP: "143464",
    SLB: "143601",
    SLE: "143600",
    SLV: "143506",
    SRB: "143500",
    STP: "143598",
    SUR: "143554",
    SVK: "143496",
    SVN: "143499",
    SWE: "143456",
    SWZ: "143602",
    SYC: "143599",
    TCA: "143552",
    TCD: "143581",
    THA: "143475",
    TJK: "143603",
    TKM: "143604",
    TON: "143608",
    TTO: "143551",
    TUN: "143536",
    TUR: "143480",
    TWN: "143470",
    TZA: "143572",
    UGA: "143537",
    UKR: "143492",
    URY: "143514",
    USA: "143441",
    UZB: "143566",
    VCT: "143550",
    VEN: "143502",
    VGB: "143543",
    VNM: "143471",
    VUT: "143609",
    WSM: "143607",
    XKX: "143624",
    YEM: "143571",
    ZAF: "143472",
    ZMB: "143622",
    ZWE: "143605",
  };
  function asyncGeneratorStep$1u(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1u(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1u(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1u(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$26(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class DeveloperToken {
    get isExpired() {
      return this.expiration < Date.now();
    }
    _decode(e) {
      return JSON.parse(w(e));
    }
    constructor(e) {
      if (
        (_define_property$26(this, "token", void 0),
        _define_property$26(this, "expiration", void 0),
        _define_property$26(this, "keyId", void 0),
        _define_property$26(this, "teamId", void 0),
        (this.token = e),
        !e ||
          !/^[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}/i.test(e))
      )
        throw new Error("Invalid token.");
      const [n, d] = e.split("."),
        { exp: p, iss: h } = this._decode(d);
      if (((this.expiration = 1e3 * p), this.isExpired))
        throw new Error("Initialized with an expired token.");
      this.teamId = h;
      const { kid: y } = this._decode(n);
      this.keyId = y;
    }
  }
  function invoke(e) {
    return void 0 === e || ((e) => "function" != typeof e)(e) ? e : e();
  }
  const te = {
    AW: "ABW",
    AF: "AFG",
    AO: "AGO",
    AI: "AIA",
    AX: "ALA",
    AL: "ALB",
    AD: "AND",
    AE: "ARE",
    AR: "ARG",
    AM: "ARM",
    AS: "ASM",
    AQ: "ATA",
    TF: "ATF",
    AG: "ATG",
    AU: "AUS",
    AT: "AUT",
    AZ: "AZE",
    BI: "BDI",
    BE: "BEL",
    BJ: "BEN",
    BQ: "BES",
    BF: "BFA",
    BD: "BGD",
    BG: "BGR",
    BH: "BHR",
    BS: "BHS",
    BA: "BIH",
    BL: "BLM",
    BY: "BLR",
    BZ: "BLZ",
    BM: "BMU",
    BO: "BOL",
    BR: "BRA",
    BB: "BRB",
    BN: "BRN",
    BT: "BTN",
    BV: "BVT",
    BW: "BWA",
    CF: "CAF",
    CA: "CAN",
    CC: "CCK",
    CH: "CHE",
    CL: "CHL",
    CN: "CHN",
    CI: "CIV",
    CM: "CMR",
    CD: "COD",
    CG: "COG",
    CK: "COK",
    CO: "COL",
    KM: "COM",
    CV: "CPV",
    CR: "CRI",
    CU: "CUB",
    CW: "CUW",
    CX: "CXR",
    KY: "CYM",
    CY: "CYP",
    CZ: "CZE",
    DE: "DEU",
    DJ: "DJI",
    DM: "DMA",
    DK: "DNK",
    DO: "DOM",
    DZ: "DZA",
    EC: "ECU",
    EG: "EGY",
    ER: "ERI",
    EH: "ESH",
    ES: "ESP",
    EE: "EST",
    ET: "ETH",
    FI: "FIN",
    FJ: "FJI",
    FK: "FLK",
    FR: "FRA",
    FO: "FRO",
    FM: "FSM",
    GA: "GAB",
    GB: "GBR",
    GE: "GEO",
    GG: "GGY",
    GH: "GHA",
    GI: "GIB",
    GN: "GIN",
    GP: "GLP",
    GM: "GMB",
    GW: "GNB",
    GQ: "GNQ",
    GR: "GRC",
    GD: "GRD",
    GL: "GRL",
    GT: "GTM",
    GF: "GUF",
    GU: "GUM",
    GY: "GUY",
    HK: "HKG",
    HM: "HMD",
    HN: "HND",
    HR: "HRV",
    HT: "HTI",
    HU: "HUN",
    ID: "IDN",
    IM: "IMN",
    IN: "IND",
    IO: "IOT",
    IE: "IRL",
    IR: "IRN",
    IQ: "IRQ",
    IS: "ISL",
    IL: "ISR",
    IT: "ITA",
    JM: "JAM",
    JE: "JEY",
    JO: "JOR",
    JP: "JPN",
    KZ: "KAZ",
    KE: "KEN",
    KG: "KGZ",
    KH: "KHM",
    KI: "KIR",
    KN: "KNA",
    KR: "KOR",
    KW: "KWT",
    LA: "LAO",
    LB: "LBN",
    LR: "LBR",
    LY: "LBY",
    LC: "LCA",
    LI: "LIE",
    LK: "LKA",
    LS: "LSO",
    LT: "LTU",
    LU: "LUX",
    LV: "LVA",
    MO: "MAC",
    MF: "MAF",
    MA: "MAR",
    MC: "MCO",
    MD: "MDA",
    MG: "MDG",
    MV: "MDV",
    MX: "MEX",
    MH: "MHL",
    MK: "MKD",
    ML: "MLI",
    MT: "MLT",
    MM: "MMR",
    ME: "MNE",
    MN: "MNG",
    MP: "MNP",
    MZ: "MOZ",
    MR: "MRT",
    MS: "MSR",
    MQ: "MTQ",
    MU: "MUS",
    MW: "MWI",
    MY: "MYS",
    YT: "MYT",
    NA: "NAM",
    NC: "NCL",
    NE: "NER",
    NF: "NFK",
    NG: "NGA",
    NI: "NIC",
    NU: "NIU",
    NL: "NLD",
    NO: "NOR",
    NP: "NPL",
    NR: "NRU",
    NZ: "NZL",
    OM: "OMN",
    PK: "PAK",
    PA: "PAN",
    PN: "PCN",
    PE: "PER",
    PH: "PHL",
    PW: "PLW",
    PG: "PNG",
    PL: "POL",
    PR: "PRI",
    KP: "PRK",
    PT: "PRT",
    PY: "PRY",
    PS: "PSE",
    PF: "PYF",
    QA: "QAT",
    RE: "REU",
    RO: "ROU",
    RU: "RUS",
    RW: "RWA",
    SA: "SAU",
    SD: "SDN",
    SN: "SEN",
    SG: "SGP",
    GS: "SGS",
    SH: "SHN",
    SJ: "SJM",
    SB: "SLB",
    SL: "SLE",
    SV: "SLV",
    SM: "SMR",
    SO: "SOM",
    PM: "SPM",
    RS: "SRB",
    SS: "SSD",
    ST: "STP",
    SR: "SUR",
    SK: "SVK",
    SI: "SVN",
    SE: "SWE",
    SZ: "SWZ",
    SX: "SXM",
    SC: "SYC",
    SY: "SYR",
    TC: "TCA",
    TD: "TCD",
    TG: "TGO",
    TH: "THA",
    TJ: "TJK",
    TK: "TKL",
    TM: "TKM",
    TL: "TLS",
    TO: "TON",
    TT: "TTO",
    TN: "TUN",
    TR: "TUR",
    TV: "TUV",
    TW: "TWN",
    TZ: "TZA",
    UG: "UGA",
    UA: "UKR",
    UM: "UMI",
    UY: "URY",
    US: "USA",
    UZ: "UZB",
    VA: "VAT",
    VC: "VCT",
    VE: "VEN",
    VG: "VGB",
    VI: "VIR",
    VN: "VNM",
    VU: "VUT",
    WF: "WLF",
    WS: "WSM",
    XK: "XKX",
    YE: "YEM",
    ZA: "ZAF",
    ZM: "ZMB",
    ZW: "ZWE",
  };
  const re = {
    af: 48,
    sq: 1,
    ar: 34,
    eu: 1,
    bg: 49,
    be: 1,
    ca: 42,
    zh: 19,
    "zh-tw": 18,
    "zh-cn": 19,
    "zh-hk": 45,
    "zh-sg": 19,
    hr: 41,
    cs: 22,
    da: 11,
    nl: 10,
    "nl-be": 65,
    en: 1,
    "en-us": 1,
    "en-eg": 26,
    "en-au": 27,
    "en-gb": 2,
    "en-ca": 6,
    "en-nz": 27,
    "en-ie": 26,
    "en-za": 26,
    "en-jm": 26,
    "en-bz": 26,
    "en-tt": 26,
    "en-001": 26,
    et: 30,
    fo: 1,
    fa: 59,
    fi: 12,
    fr: 3,
    "fr-ca": 5,
    gd: 2,
    de: 4,
    "de-ch": 57,
    el: 23,
    he: 36,
    hi: 50,
    hu: 21,
    is: 31,
    id: 37,
    it: 7,
    ja: 9,
    ko: 13,
    lv: 33,
    lt: 32,
    mk: 1,
    mt: 1,
    no: 14,
    nb: 14,
    nn: 14,
    pl: 20,
    "pt-br": 15,
    pt: 24,
    rm: 1,
    ro: 39,
    ru: 16,
    sr: 1,
    sk: 40,
    sl: 52,
    es: 8,
    "es-mx": 28,
    "es-419": 44,
    sv: 17,
    th: 35,
    ts: 1,
    tn: 1,
    tr: 25,
    uk: 29,
    ur: 55,
    ve: 1,
    vi: 43,
    xh: 1,
    yi: 1,
    zu: 56,
    ms: 38,
    iw: 36,
    lo: 46,
    tl: 47,
    kk: 51,
    ta: 53,
    te: 54,
    bn: 58,
    ga: 60,
    ht: 61,
    la: 62,
    pa: 63,
    sa: 64,
  };
  let ne = "Music-User-Token";
  function getLanguages() {
    if ("undefined" == typeof navigator) return [];
    if (navigator.languages) return navigator.languages;
    const e = navigator.language || navigator.userLanguage;
    return e ? [e] : [];
  }
  function flattenAll(e) {
    return (function (e, n = 1) {
      if ("function" == typeof Array.prototype.flat)
        return Array.prototype.flat.call(e, n);
      if (null == e)
        throw new TypeError("Cannot convert undefined or null to object");
      return (
        Array.isArray(e) || (e = Array.from(e)),
        (function flat(e, n) {
          return n <= 0
            ? e.slice()
            : Array.prototype.reduce.call(
                e,
                function (e, d) {
                  return Array.isArray(d)
                    ? e.concat(flat(d, n - 1))
                    : [...e, d];
                },
                []
              );
        })(e, n)
      );
    })(e, 1 / 0);
  }
  function joinURLPath(...e) {
    const n = flattenAll(e)
      .map((e) => (e instanceof URL ? e.pathname : e))
      .filter((e) => "string" == typeof e && 0 !== e.trim().length);
    if (0 === n.length) return "";
    let d = n[0];
    for (let p = 1; p < n.length; p++)
      d = d.replace(/[/]+$/, "") + "/" + n[p].replace(/^[/]+/, "");
    return (
      /^([a-z][a-z0-9\-_+]+)?:\/\//i.test(d) ||
        (d = "/" + d.replace(/^[/]+/, "")),
      d
    );
  }
  function splitURLPath(e) {
    e instanceof URL && (e = e.pathname);
    const n = [],
      d = e.lastIndexOf("#");
    -1 !== d && (n.unshift(e.slice(d)), (e = e.slice(0, d)));
    const p = e.lastIndexOf("?");
    return (
      -1 !== p && (n.unshift(e.slice(p)), (e = e.slice(0, p))),
      [...e.split(RegExp("(?<![/:]+)\\/+")), ...n].filter(
        (e) => 0 !== e.trim().length
      )
    );
  }
  function _define_property$25(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$Z(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$25(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$F(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  ne = "Media-User-Token";
  const addQueryParamsToURL = (e, n) => {
      const d = urlEncodeParameters(n);
      return "" === d
        ? e
        : e.endsWith("&") || e.endsWith("?")
          ? `${e}${d}`
          : e.includes("?")
            ? `${e}&${d}`
            : `${e}?${d}`;
    },
    ie = "undefined" != typeof Headers,
    headersToDict = (e) => {
      let n = {};
      var d;
      return (
        (d = e),
        ie && d instanceof Headers
          ? e.forEach((e, d) => (n[d] = e))
          : Array.isArray(e)
            ? e.forEach(([e, d]) => (n[e] = d))
            : (n = e),
        n
      );
    },
    mergeFetchHeaders = (e = {}, n = {}) =>
      _object_spread$Z({}, headersToDict(e), headersToDict(n)),
    mergeFetchOptions = (e, n) => {
      if (e || n)
        return (null == e ? void 0 : e.headers) &&
          (null == n ? void 0 : n.headers)
          ? _object_spread_props$F(_object_spread$Z({}, e, n), {
              headers: mergeFetchHeaders(e.headers, n.headers),
            })
          : _object_spread$Z({}, e, n);
    };
  function parseQueryParams(e) {
    if (!e || (e.startsWith("http") && !e.includes("?"))) return {};
    try {
      var n;
      return parseParams(
        null !== (n = e.split("?")[1]) && void 0 !== n ? n : e,
        "&",
        decodeURIComponent
      );
    } catch (Yt) {
      return {};
    }
  }
  function parseParams(e, n = "&", d = (e) => e) {
    return "string" != typeof e
      ? {}
      : e
          .split(n)
          .map((e) => e.trim().split("=", 2))
          .reduce((e, n) => {
            const [p, h] = n;
            return (
              ("" === p && void 0 === h) ||
                ((e[d(p)] = d(h)), void 0 === h && (e[d(p)] = void 0)),
              e
            );
          }, {});
  }
  function getMaxAgeFromHeaders(e) {
    const n = (function (e, n) {
      if (void 0 !== n) return ie && n instanceof Headers ? n.get(e) : n[e];
    })("cache-control", e);
    if (n) {
      return ((e) => {
        const n = Number(e);
        if (Number.isFinite(n)) return n;
      })(parseParams(n, ",")["max-age"]);
    }
  }
  const recursiveEncodeParameters = (e, n) =>
    Object.keys(e).reduce((d, p) => {
      const h = e[p],
        y = n ? `${n}[${encodeURIComponent(p)}]` : encodeURIComponent(p);
      return `${d}${d ? "&" : ""}${isObject(h) ? recursiveEncodeParameters(h, y) : `${y}=${encodeURIComponent("" + h)}`}`;
    }, "");
  function urlEncodeParameters(e) {
    return e ? recursiveEncodeParameters(e) : "";
  }
  const ae = JsonDevFlag.register("mk-hlsjs-automation-config"),
    oe = new RegExp(
      "^https://([a-z0-9]+-)?" +
        (
          "js-cdn.music.apple.com" + "/musickit/v3/".replace(/v3/, "(v2|v3)")
        ).replace(/[\.\/]/g, "\\$&"),
      "i"
    ),
    se = /^https:\/\/(.*\/includes\/js-cdn)\//i,
    ce = /^([a-z]+:)?\/\//;
  function findScript(e) {
    return isNodeEnvironment$1() || !e
      ? null
      : document.querySelector(`script[src*="${e}"]`);
  }
  function getScriptSrcElements() {
    if ("undefined" == typeof document || !document.querySelectorAll) return [];
    return Array.from(document.querySelectorAll("script[src]"));
  }
  function determineCdnBasePrefix() {
    for (const e of getScriptSrcElements()) {
      const n = oe.exec(e.src);
      if (n) return n[1] || "";
    }
    return "";
  }
  function determineCdnPathPrefix() {
    for (const e of getScriptSrcElements()) {
      const n = se.exec(e.src);
      if (n) return n[1] || "";
    }
    return "";
  }
  function determineCdnBaseHost() {
    if (isNodeEnvironment$1()) return "";
    return `//${determineCdnBasePrefix()}js-cdn.music.apple.com`;
  }
  function determineCdnPathHost() {
    const e = determineCdnPathPrefix();
    return e ? "//" + e : e;
  }
  const le = StringDevFlag.register("mk-hlsjs-log-level"),
    de = StringDevFlag.register("mk-hlsjs-version");
  function getHlsJsCdnConfig() {
    const e = { hls: "", rtc: "" };
    if (isNodeEnvironment$1()) return e;
    const n = determineCdnPathHost() || determineCdnBaseHost(),
      d = de.get() || "2.610.4",
      p = (function () {
        const e = le.value;
        switch (e) {
          case "info":
          case "error":
          case "warn":
            return "hls.production.verbose.min.js";
          case "trace":
          case "debug":
            return (
              console.warn(
                `HLS log level ${e} is not supported, loading production build.`
              ),
              "hls.js"
            );
          default:
            return "hls.js";
        }
      })();
    return (
      (e.hls = `https:${n}/hls.js/${d}/hls.js/${p}`),
      (e.rtc = `https:${n}/hls.js/${d}/rtc.js/rtc.min.js`),
      (function (e) {
        const n = ae.get();
        if (!(null == n ? void 0 : n.url)) return;
        const { url: d } = n;
        isAppleHostname(d) &&
          "carry-" === determineCdnBasePrefix() &&
          (e.hls = d);
      })(e),
      e
    );
  }
  function isAppleHostname(e) {
    try {
      return new URL(e).hostname.endsWith(".apple.com");
    } catch (Yt) {}
    return !1;
  }
  function cdnBaseURL(e, n = window) {
    var d;
    if (isNodeEnvironment$1()) return "";
    const p =
      null === (d = getLocalStorage()) || void 0 === d
        ? void 0
        : d.getItem("mkCDNBaseURLOverride");
    if (p) return p;
    const h = findScript(e);
    return h
      ? h.getAttribute("src").replace(new RegExp(e + "$"), "")
      : (determineCdnPathHost() || determineCdnBaseHost()) + "/musickit/v3/";
  }
  const ue = new Map();
  function loadScript(e, n) {
    const d = ue.get(e);
    if (d) return d;
    const p = new Promise((d, p) => {
      isNodeEnvironment$1() &&
        p("Dynamic script loading is unsupported in Node environments.");
      if (findScript(e)) return d();
      const h = document.createElement("script");
      let y;
      if (
        (n &&
          Object.keys(n).forEach((e) => {
            h.setAttribute(e, n[e]);
          }),
        (h.onload = () => {
          d();
        }),
        (h.onerror = (e) => {
          p(e);
        }),
        ce.test(e))
      )
        y = e;
      else {
        y = `${cdnBaseURL(e)}${e}`;
      }
      (h.src = y), document.head.appendChild(h);
    });
    return ue.set(e, p), p;
  }
  const pe = {
    CRITICAL: 50,
    ERROR: 40,
    WARNING: 30,
    NOTICE: 20,
    INFO: 10,
    DEBUG: 2,
    TRACE: 1,
    NONE: 0,
  };
  const he = {
    OFF: "NONE",
    0: "NONE",
    "+": "INFO",
    "++": "DEBUG",
    V: "DEBUG",
    D: "DEBUG",
    VERBOSE: "DEBUG",
    VV: "TRACE",
    SILLY: "TRACE",
    "*": "TRACE",
  };
  function getLoggingLevel(e, n = {}) {
    if ("number" == typeof e)
      return (function (e) {
        return "number" == typeof e && Object.values(pe).includes(e);
      })(e)
        ? e
        : void 0;
    let d = e.toUpperCase();
    return (
      n.allowShorthands && void 0 !== he[d] && (d = he[d]),
      (function (e) {
        return "string" == typeof e && void 0 !== pe[e.toUpperCase()];
      })(d)
        ? pe[d]
        : void 0
    );
  }
  function getLoggingLevelName(e) {
    for (const [n, d] of Object.entries(pe)) if (e === d) return n;
  }
  function walk(e, n) {
    const d = [e];
    for (; d.length > 0; ) {
      const e = d.shift();
      void 0 !== e && (d.push(...e.children), n(e));
    }
  }
  function _define_property$24(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$Y(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$24(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$E(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _define_property1(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const ye = pe.ERROR,
    DEFAULT_POLICY = (e, n) => e !== pe.NONE && n >= e;
  class Logger {
    get parent() {
      return this._parent;
    }
    get children() {
      return Array.from(this._children.values());
    }
    get namespace() {
      return void 0 === this._parent
        ? this.name
        : this._parent.namespace + "/" + this.name;
    }
    get enabled() {
      return this.level !== pe.NONE;
    }
    get level() {
      var e, n, d;
      return null !==
        (d =
          null !== (n = this._level) && void 0 !== n
            ? n
            : null === (e = this.parent) || void 0 === e
              ? void 0
              : e.level) && void 0 !== d
        ? d
        : ye;
    }
    get levelName() {
      var e;
      return null !== (e = getLoggingLevelName(this.level)) && void 0 !== e
        ? e
        : "UNKNOWN";
    }
    get levelPolicy() {
      var e, n, d;
      return null !==
        (d =
          null !== (n = this._levelPolicy) && void 0 !== n
            ? n
            : null === (e = this.parent) || void 0 === e
              ? void 0
              : e.levelPolicy) && void 0 !== d
        ? d
        : DEFAULT_POLICY;
    }
    get handlers() {
      var e, n, d;
      return null !==
        (d =
          null !== (n = this._handlers) && void 0 !== n
            ? n
            : null === (e = this.parent) || void 0 === e
              ? void 0
              : e.handlers) && void 0 !== d
        ? d
        : {};
    }
    isEnabledFor(e) {
      return this.levelPolicy(this.level, e);
    }
    setLevel(e) {
      const n = getLoggingLevel(e);
      void 0 !== n && (this._level = n);
    }
    clearLevel() {
      this._level = void 0;
    }
    setLevelPolicy(e) {
      this._levelPolicy = e;
    }
    clearLevelPolicy() {
      this._levelPolicy = void 0;
    }
    addHandler(e, n) {
      this._handlers || (this._handlers = {}), (this._handlers[e] = n);
    }
    hasHandler(e) {
      var n;
      return (
        void 0 !==
        (null === (n = this._handlers) || void 0 === n ? void 0 : n[e])
      );
    }
    removeHandler(e) {
      void 0 !== this._handlers &&
        (delete this._handlers[e],
        0 === Object.keys(this._handlers).length && this.clearHandlers());
    }
    clearHandlers() {
      this._handlers = void 0;
    }
    createChild(e, n) {
      const d = this._children.get(e);
      return void 0 !== d
        ? d
        : new Logger(
            e,
            _object_spread_props$E(_object_spread$Y({}, n), { parent: this })
          );
    }
    linkChild(e) {
      if (void 0 !== e.parent && e.parent !== this)
        throw new Error(
          `Logger '${e.name}' is already a child of a different parent ('${e.parent.name}')`
        );
      const n = this._children.get(e.name);
      if (void 0 !== n && n !== e)
        throw new Error(`A child with name '${e.name}' is already registered`);
      return (
        void 0 === n && (this._children.set(e.name, e), e.linkParent(this)), e
      );
    }
    unlinkChild(e) {
      const n = this._children.get(e.name);
      return n === e && (this._children.delete(e.name), n.unlinkParent()), e;
    }
    getByName(e) {
      return this._children.get(e);
    }
    getByNamespace(e) {
      return (function (e, n, d = "/") {
        if ("" === (n = n.trim()) || "*" === n) return e;
        const p = n.split(d);
        p[0].trim() === e.name && p.shift();
        if (0 === p.length) return e;
        let h = e;
        for (; void 0 !== h && p.length > 0; ) {
          const e = p.shift();
          h = h.getByName(e.trim());
        }
        return h;
      })(this, e);
    }
    linkParent(e) {
      return (
        this.parent !== e &&
          (this.unlinkParent(), (this._parent = e), e.linkChild(this)),
        this
      );
    }
    unlinkParent() {
      return (
        void 0 !== this._parent &&
          (this._parent.unlinkChild(this), (this._parent = void 0)),
        this
      );
    }
    log(e, n, ...d) {
      const p = getLoggingLevel(e);
      void 0 !== p &&
        this.logRecord({
          time: Date.now(),
          namespace: this.namespace,
          level: p,
          message: n,
          args: d,
        });
    }
    logRecord(e) {
      if (!this.levelPolicy(this.level, e.level)) return;
      const n = _object_spread$Y({ namespace: this.namespace }, e);
      for (const d of Object.values(this.handlers)) d.process(n);
    }
    error(e, ...n) {
      this.log(pe.ERROR, e, ...n);
    }
    warning(e, ...n) {
      this.log(pe.WARNING, e, ...n);
    }
    warn(e, ...n) {
      this.warning(e, ...n);
    }
    info(e, ...n) {
      this.log(pe.INFO, e, ...n);
    }
    debug(e, ...n) {
      this.log(pe.DEBUG, e, ...n);
    }
    trace(e, ...n) {
      this.log(pe.TRACE, e, ...n);
    }
    constructor(e, n) {
      _define_property1(this, "name", void 0),
        _define_property1(this, "_parent", void 0),
        _define_property1(this, "_children", new Map()),
        _define_property1(this, "_level", void 0),
        _define_property1(this, "_levelPolicy", void 0),
        _define_property1(this, "_handlers", void 0),
        (this.name = e),
        (this._levelPolicy = null == n ? void 0 : n.levelPolicy),
        (this._handlers = null == n ? void 0 : n.handlers),
        void 0 !== (null == n ? void 0 : n.parent) && this.linkParent(n.parent),
        void 0 !== (null == n ? void 0 : n.level) && this.setLevel(n.level);
    }
  }
  function _define_property$23(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class CallbackHandler {
    process(e) {
      this.enabled && void 0 !== this.callback && this.callback(e);
    }
    constructor(e, n = {}) {
      var d;
      _define_property$23(this, "enabled", void 0),
        _define_property$23(this, "callback", void 0),
        (this.callback = e),
        (this.enabled = null === (d = n.enabled) || void 0 === d || d);
    }
  }
  const _e = /%{([^}]+)}/gi,
    fe = {
      timestamp: (e) => String(e.time),
      time: (e) => String(e.time),
      datetime: (e) => new Date(e.time).toISOString(),
      date: (e) => new Date(e.time).toISOString(),
      level: (e) => String(e.level),
      levelname: (e) => {
        var n;
        return null !== (n = getLoggingLevelName(e.level)) && void 0 !== n
          ? n
          : "UNKNOWN";
      },
      message: (e) => e.message,
      name: (e) => e.namespace.split("/").pop(),
      namespace: (e) => e.namespace,
    };
  function _define_property$22(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const me = new Map([
      [pe.CRITICAL, "error"],
      [pe.ERROR, "error"],
      [pe.WARNING, "warn"],
      [pe.NOTICE, "warn"],
      [pe.INFO, "log"],
      [pe.DEBUG, "debug"],
    ]),
    ve =
      ((ge = "%{datetime} %{levelname} - [%{namespace}] %{message}"),
      function (e) {
        return ge.replace(_e, function (n, d) {
          return (d = d.toLowerCase()), void 0 !== fe[d] ? fe[d](e) : n;
        });
      });
  var ge;
  const be = new Logger("storekit");
  function _define_property$21(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Pe = [
    "apps.apple.com",
    "books.apple.com",
    "fitness.apple.com",
    "mediaauth.apple.com",
    "multidev.apple.com",
    "music.apple.com",
    "one.apple.com",
    "podcasts.apple.com",
    "tv.apple.com",
    "itunes.apple.com",
  ];
  const Se = [
    "apps.apple.com",
    "books.apple.com",
    "fitness.apple.com",
    "music.apple.com",
    "podcasts.apple.com",
    "tv.apple.com",
  ];
  function determineBaseCookieDomain(e) {
    let n = e;
    return (
      e &&
        Se.some(function (d) {
          if (e.endsWith("." + d)) return (n = d), !0;
        }),
      n
    );
  }
  function _define_property$20(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class AuthBridgeApp extends class {
    init(e, n) {
      var d;
      (this._receiveWindow = e),
        (this._sendWindow = n),
        (this.handleMessage = this.handleMessage.bind(this)),
        null === (d = this._receiveWindow) ||
          void 0 === d ||
          d.addEventListener("message", this.handleMessage);
    }
    sendMessage(e, n) {
      const d = { action: "mediakit:" + e, data: n };
      this._sendWindow &&
        this._sendWindow.postMessage(JSON.stringify(d), this._targetOrigin);
    }
    handleMessage(e) {
      if (!this._isOriginAllowed(e.origin)) return;
      let n;
      try {
        n = JSON.parse(e.data);
      } catch (Yt) {}
      if (!n || !this._isNamespacedData(n)) return;
      "*" === this._targetOrigin && (this._targetOrigin = e.origin),
        be.debug("auth-bridge: handleMessage", n);
      const d = n.action.replace("mediakit:", "");
      this[d]
        ? this[d](n.data)
        : be.debug("auth-bridge: unsupported method", d);
    }
    _isOriginAllowed(e) {
      if (!e) return !1;
      const [n, d] = e.split("://");
      let p = "";
      return (
        d && ((p = d.split(":")[0]), p && (p = p.toLocaleLowerCase())),
        "https" === n && !!p && Pe.some((e) => p === e || p.endsWith("." + e))
      );
    }
    _isNamespacedData(e) {
      return e.action && -1 !== e.action.indexOf("mediakit:");
    }
    constructor() {
      _define_property$21(this, "_receiveWindow", void 0),
        _define_property$21(this, "_sendWindow", void 0),
        _define_property$21(this, "_targetOrigin", "*");
    }
  } {
    requestAuthUpdate() {
      this.whenFrameInited.then(() => this.sendMessage("requestAuthUpdate"));
    }
    setCookieItem(e, n) {
      this.whenFrameInited.then(() =>
        this.sendMessage("setCookieItem", { name: e, value: n })
      );
    }
    clearAuth() {
      this.whenFrameInited.then(() => this.sendMessage("clearAuth"));
    }
    frameInit() {
      var e;
      null === (e = this._frameInitResolve) || void 0 === e || e.call(this),
        this.requestAuthUpdate();
    }
    updateAuth(e) {
      if (
        (null == e ? void 0 : e.enabled) &&
        (null == e ? void 0 : e.cookies)
      ) {
        const n = e.cookies,
          d = determineBaseCookieDomain(window.location.hostname);
        Object.keys(n).forEach((e) => {
          var p;
          const h = null !== (p = n[e]) && void 0 !== p ? p : "";
          h ? setCookie(e, h, "/", 30, void 0, d) : removeCookie(e, void 0, d);
        });
      }
      this._authUpdateResolve &&
        (this._authUpdateResolve(), (this._authUpdateResolve = void 0));
    }
    authClearedFromOtherFrame() {
      be.warn(
        "Override auth-bridge/app's authClearedFromOtherFrame to trigger app-specific sign out behavior"
      );
    }
    _getIframeSrc() {
      let e = "",
        n = determineCdnPathPrefix();
      if (n) (n += "/musickit/v3/"), (e = "?inc=" + encodeURIComponent(n));
      else {
        const n = determineCdnBasePrefix();
        n && (e = "?env=" + n.substring(0, n.length - 1));
      }
      return "https://mediaauth.apple.com/auth-bridge/" + e;
    }
    constructor() {
      super(),
        _define_property$20(this, "whenAuthCompleted", void 0),
        _define_property$20(this, "frame", void 0),
        _define_property$20(this, "whenFrameInited", void 0),
        _define_property$20(this, "_frameInitResolve", void 0),
        _define_property$20(this, "_authUpdateResolve", void 0),
        (this.whenFrameInited = new Promise(
          (e) => (this._frameInitResolve = e)
        )),
        (this.whenAuthCompleted = new Promise(
          (e) => (this._authUpdateResolve = e)
        )),
        (this.frame = document.createElement("iframe")),
        (this.frame.src = this._getIframeSrc()),
        (this.frame.style.display = "none"),
        document.body.appendChild(this.frame),
        this.init(window, this.frame.contentWindow);
    }
  }
  const Te = new Set(["apps", "books", "music", "podcasts", "tv"]),
    ke = /\.apple\.com$/;
  function getCommerceHostname(e, n) {
    !n && "undefined" != typeof location && location.hostname && (n = location);
    let d = e + ".itunes.apple.com";
    if (!n) return d;
    const p = (function (e) {
      if (!e || !ke.test(e)) return;
      const n = e.split(".");
      let d = n[n.length - 3];
      const p = d;
      if (d && d.includes("-")) {
        const e = d.split("-");
        d = e[e.length - 1];
      }
      return Te.has(d) ? p : void 0;
    })(n.hostname);
    return p && (d = `${e}.${p}.apple.com`), d;
  }
  var Ee, we, Oe;
  function buildQueryParams(e = { app: "music", p: "subscribe" }) {
    return (
      void 0 === e.app && (e.app = "music"),
      void 0 === e.p && (e.p = "subscribe"),
      Object.keys(e)
        .map((n) => `${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`)
        .join("&")
    );
  }
  !(function (e) {
    (e.APP = "music"), (e.P = "subscribe");
  })(Ee || (Ee = {})),
    (function (e) {
      (e.DEFAULT_CID = "pldfltcid"),
        (e.TV_CID = "pltvcid"),
        (e.RESTRICTIONS_ENABLED = "itre"),
        (e.STOREFRONT_COUNTRY_CODE = "itua"),
        (e.USER_TOKEN = "media-user-token");
    })(we || (we = {})),
    (e.SKRealm = void 0),
    ((Oe = e.SKRealm || (e.SKRealm = {}))[(Oe.MUSIC = 0)] = "MUSIC"),
    (Oe[(Oe.PODCAST = 1)] = "PODCAST"),
    (Oe[(Oe.TV = 2)] = "TV");
  const $e = {
      [e.SKRealm.TV]: "com.apple.onboarding.tvapp",
      [e.SKRealm.MUSIC]: "com.apple.onboarding.applemusic",
    },
    Ie = { [e.SKRealm.TV]: "pltvcid", [e.SKRealm.MUSIC]: "pldfltcid" },
    Re = {
      "com.apple.onboarding.tvapp": 5,
      "com.apple.onboarding.applemusic": 3,
    },
    Ae = memoize((e) => {
      const n = w(e);
      return Ce(n);
    });
  function ensureArray(e = []) {
    return Array.isArray(e) ? e : [e];
  }
  const Ce = memoize((e) => {
      const n = e.length,
        d = new ArrayBuffer(n),
        p = new Uint8Array(d);
      for (let h = 0; h < n; h++) p[h] = e.charCodeAt(h);
      return p;
    }),
    Me = memoize((e) => {
      const n = e.length,
        d = new ArrayBuffer(2 * n),
        p = new Uint16Array(d);
      for (let h = 0; h < n; h++) p[h] = e.charCodeAt(h);
      return p;
    }),
    De = memoize((e) => {
      let n,
        d,
        p,
        h,
        y,
        _,
        m,
        g = 0;
      const b =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
      let P = "";
      for (; g < e.length; )
        (n = e[g++]),
          (d = g < e.length ? e[g++] : Number.NaN),
          (p = g < e.length ? e[g++] : Number.NaN),
          (h = n >> 2),
          (y = ((3 & n) << 4) | (d >> 4)),
          (_ = ((15 & d) << 2) | (p >> 6)),
          (m = 63 & p),
          isNaN(d) ? (_ = m = 64) : isNaN(p) && (m = 64),
          (P += b.charAt(h) + b.charAt(y) + b.charAt(_) + b.charAt(m));
      return P;
    });
  function asyncGeneratorStep$1t(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1$(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  var je;
  !(function (e) {
    (e[(e.ParseError = -32700)] = "ParseError"),
      (e[(e.InvalidRequest = -32600)] = "InvalidRequest"),
      (e[(e.MethodNotFound = -32601)] = "MethodNotFound"),
      (e[(e.InvalidParams = -32602)] = "InvalidParams"),
      (e[(e.InternalError = -32603)] = "InternalError");
  })(je || (je = {}));
  class Dispatch {
    get source() {
      return this._source;
    }
    set source(e) {
      if (!e && this._source)
        return (
          this._source.removeEventListener("message", this.handle),
          void (this._source = void 0)
        );
      e.addEventListener("message", this.handle), (this._source = e);
    }
    apply(e, n) {
      if (!this.destination) throw new Error("No destination");
      const d = this._sequence++,
        p = new Promise((e, n) => {
          this._registry[d] = { resolve: e, reject: n };
        });
      return (
        this.send(this.destination, {
          jsonrpc: "2.0",
          id: d,
          method: e,
          params: n,
        }),
        p
      );
    }
    call(e, ...n) {
      return this.apply(e, n);
    }
    handleRequest(e) {
      var n,
        d = this;
      return ((n = function* () {
        const n = { jsonrpc: "2.0", id: e.id },
          p = d.methods[e.method];
        if (!p)
          return Object.assign(n, {
            error: { code: -32601, message: "Method not found" },
          });
        try {
          const d = yield p.apply(void 0, ensureArray(e.params));
          return Object.assign(n, { result: d });
        } catch (q) {
          return Object.assign(n, {
            error: { code: q.code || -32603, message: q.message },
          });
        }
      }),
      function () {
        var e = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = n.apply(e, d);
          function _next(e) {
            asyncGeneratorStep$1t(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$1t(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    handleResponse(e) {
      const n = this._registry[e.id];
      delete this._registry[e.id],
        n &&
          (e.error
            ? n.reject(Object.assign(Error(), e.error))
            : n.resolve(e.result));
    }
    send(e, n) {
      e.postMessage(n, e.window === e ? this.origin : void 0);
    }
    constructor(e = {}) {
      _define_property$1$(this, "destination", void 0),
        _define_property$1$(this, "origin", void 0),
        _define_property$1$(this, "methods", void 0),
        _define_property$1$(this, "_registry", {}),
        _define_property$1$(this, "_sequence", 0),
        _define_property$1$(this, "_source", void 0),
        _define_property$1$(this, "handle", (e) => {
          e.data &&
            "2.0" === e.data.jsonrpc &&
            (("*" !== this.origin && this.origin !== e.origin) ||
              (e.data.method && this.destination
                ? this.handleRequest(e.data).then((e) => {
                    this.send(this.destination, e);
                  })
                : (hasOwn(e.data, "result") || e.data.error) &&
                  this.handleResponse(e.data)));
        }),
        (this.destination = e.destination),
        (this.methods = e.methods || {}),
        (this.origin = e.origin || "*"),
        e.source && (this.source = e.source);
    }
  }
  function asyncGeneratorStep$1s(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1s(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1s(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1s(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1_(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$X(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1_(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$D(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  var xe;
  function validateToken(e) {
    if ("string" != typeof e) return !1;
    const n = e.match(/[a-zA-Z0-9=\/+]{32,}==$/);
    var d;
    return null !== (d = n && n.length > 0) && void 0 !== d && d;
  }
  !(function (e) {
    (e[(e.UNAVAILABLE = -1)] = "UNAVAILABLE"),
      (e[(e.NOT_DETERMINED = 0)] = "NOT_DETERMINED"),
      (e[(e.DENIED = 1)] = "DENIED"),
      (e[(e.RESTRICTED = 2)] = "RESTRICTED"),
      (e[(e.AUTHORIZED = 3)] = "AUTHORIZED");
  })(xe || (xe = {}));
  const Le = `https://${getCommerceHostname("buy")}/commerce/account/authenticateMusicKitRequest`,
    Ne = "https://authorize.music.apple.com",
    Ue = /^https?:\/\/(.+\.)*(apple\.com|apps\.mzstatic\.com)(\/[\w\d]+)*$/;
  var Be, Fe, Ke;
  !(function (e) {
    (e[(e.AUTHORIZE = 0)] = "AUTHORIZE"), (e[(e.SUBSCRIBE = 1)] = "SUBSCRIBE");
  })(Be || (Be = {}));
  class ServiceSetupView {
    get isServiceView() {
      return (
        /(authorize\.(.+\.)*apple\.com)/i.test(window.location.hostname) ||
        (window && window.name === this.target) ||
        !1
      );
    }
    focus() {
      this._window && window.focus && this._window.focus();
    }
    load(e = { action: 0 }) {
      var n = this;
      return _async_to_generator$1s(function* () {
        return 1 === e.action
          ? n._subscribeAction(e.parameters)
          : n._authorizeAction(e.parameters);
      })();
    }
    present(e = "", n) {
      const {
          height: d,
          left: p,
          top: h,
          width: y,
        } = this._calculateClientDimensions(),
        _ = {
          height: 650,
          menubar: "no",
          resizable: "no",
          scrollbars: "no",
          status: "no",
          toolbar: "no",
          width: 650,
        },
        m = _object_spread$X(
          _object_spread_props$D(_object_spread$X({}, _), {
            left: y / 2 - _.width / 2 + p,
            top: d / 2 - _.height / 2 + h,
          }),
          n
        ),
        g = Object.keys(m)
          .map((e) => `${e}=${m[e]}`)
          .join(",");
      return (
        /trident|msie/i.test(navigator.userAgent)
          ? ((this._window =
              window.open(window.location.href, this.target, g) || void 0),
            (this._window.location.href = e))
          : (this._window = window.open(e, this.target, g) || void 0),
        /\bedge\b/i.test(navigator.userAgent) && (this._window.opener = self),
        this.focus(),
        this._window
      );
    }
    _startPollingForWindowClosed(e) {
      this._window &&
        void 0 === this._windowClosedInterval &&
        (this._windowClosedInterval = setInterval(() => {
          var n;
          (null === (n = this._window) || void 0 === n ? void 0 : n.closed) &&
            (this._stopPollingForWindowClosed(), e());
        }, 500));
    }
    _stopPollingForWindowClosed() {
      void 0 !== this._windowClosedInterval &&
        (clearInterval(this._windowClosedInterval),
        (this._windowClosedInterval = void 0));
    }
    _authorizeAction(e = {}) {
      var n = this;
      return _async_to_generator$1s(function* () {
        var d;
        let p, h;
        const y =
          (null === (d = window.location) || void 0 === d ? void 0 : d.href) ||
          "";
        return (
          "GET" === n.authenticateMethod
            ? (h = `${Ne}/woa?${buildQueryParams(_object_spread_props$D(_object_spread$X({}, n.deeplinkParameters), { a: btoa(n._thirdPartyInfo()), referrer: y }))}`)
            : ((p = n._buildFormElement(Le)), document.body.appendChild(p)),
          new Promise((d, y) => {
            const _ = n.present(h);
            n._startPollingForWindowClosed(() => {
              y(0);
            }),
              (n.dispatch = new Dispatch({
                methods: {
                  authorize(e, n, p) {
                    validateToken(e)
                      ? d({ restricted: n && "1" === n, userToken: e, cid: p })
                      : y(0);
                  },
                  close() {},
                  decline() {
                    y(1);
                  },
                  switchUserId() {
                    y(0);
                  },
                  thirdPartyInfo: () =>
                    n._thirdPartyInfo(
                      n.developerToken,
                      _object_spread$X({}, n.deeplinkParameters, e)
                    ),
                  unavailable() {
                    y(-1);
                  },
                },
                origin: Ne,
                source: window,
                destination: _,
              })),
              p && p.submit();
          })
        );
      })();
    }
    _buildFormElement(e, n = this.target, d = this.developerToken) {
      const p = document.createElement("form");
      p.setAttribute("method", "post"),
        p.setAttribute("action", e),
        p.setAttribute("target", n),
        (p.style.display = "none");
      const h = document.createElement("input");
      h.setAttribute("name", "jwtToken"),
        h.setAttribute("value", d),
        p.appendChild(h);
      const y = document.createElement("input");
      y.setAttribute("name", "isWebPlayer"),
        y.setAttribute("value", "true"),
        p.appendChild(y);
      const _ = document.createElement("input");
      return (
        _.setAttribute("name", "LogoURL"),
        _.setAttribute("value", ""),
        p.appendChild(_),
        p
      );
    }
    _calculateClientDimensions(e = window) {
      return {
        height: e.innerHeight
          ? e.innerHeight
          : document.documentElement.clientHeight
            ? document.documentElement.clientHeight
            : screen.height,
        left: e.screenLeft ? e.screenLeft : screen.availLeft || screen.left,
        top: e.screenTop ? e.screenTop : screen.availTop || screen.top,
        width: e.innerWidth
          ? e.innerWidth
          : document.documentElement.clientWidth
            ? document.documentElement.clientWidth
            : screen.width,
      };
    }
    _subscribeAction(e = {}) {
      var n = this;
      return _async_to_generator$1s(function* () {
        return (
          Object.assign(e, n.deeplinkParameters),
          new Promise((d, p) => {
            const h =
              "https://authorize.music.apple.com/upsell?" + buildQueryParams(e);
            n.present(h),
              window.addEventListener(
                "message",
                ({ data: e, origin: n, source: h }) => {
                  const { closeWindow: y, launchClient: _ } =
                    "string" == typeof e ? JSON.parse(e) : e;
                  (n && !Ue.test(n)) ||
                    (_
                      ? 0 === _.supported
                        ? p("Unable to subscribe on this platform.")
                        : d(_)
                      : p("Subscribe action error."));
                }
              );
          })
        );
      })();
    }
    _thirdPartyInfo(e = this.developerToken, n) {
      let d = this.iconURL;
      const p = window.location.host || document.referrer,
        h = [
          ...[].slice.call(
            document.querySelectorAll('link[rel="apple-music-app-icon"]')
          ),
          ...[].slice.call(
            document.querySelectorAll(
              'link[rel="apple-touch-icon-precomposed"]'
            )
          ),
          ...[].slice.call(
            document.querySelectorAll('link[rel="apple-touch-icon"]')
          ),
        ];
      if (h && h[0] && h[0].href) {
        const e = h.find((e) => !!e.sizes && "120x120" === e.sizes.value);
        var y;
        d =
          null !== (y = null == e ? void 0 : e.href) && void 0 !== y
            ? y
            : h[0].href;
      }
      return JSON.stringify({
        thirdPartyIconURL: d,
        thirdPartyName: p,
        thirdPartyParameters: n,
        thirdPartyToken: e,
      });
    }
    constructor(e, n = {}) {
      if (
        (_define_property$1_(this, "developerToken", void 0),
        _define_property$1_(this, "authenticateMethod", void 0),
        _define_property$1_(this, "deeplinkParameters", void 0),
        _define_property$1_(this, "iconURL", void 0),
        _define_property$1_(this, "target", void 0),
        _define_property$1_(this, "dispatch", void 0),
        _define_property$1_(this, "_window", void 0),
        _define_property$1_(this, "_windowClosedInterval", void 0),
        (this.developerToken = e),
        (this.authenticateMethod = "GET"),
        (this.target = "apple-music-service-view"),
        (this.deeplinkParameters = (n && n.deeplinkParameters) || {}),
        (this.iconURL = n && n.iconURL),
        (this.authenticateMethod = (n && n.authenticateMethod) || "GET"),
        this.isServiceView && window.opener !== window)
      ) {
        var d;
        const e =
            null === (d = getSessionStorage()) || void 0 === d
              ? void 0
              : d.getItem("ac"),
          n = null != e ? new URL(e).origin : void 0;
        var p;
        if (n)
          this.dispatch = new Dispatch({
            destination:
              null !== (p = window.opener) && void 0 !== p ? p : void 0,
            origin: n,
            source: window,
          });
      }
    }
  }
  function asyncGeneratorStep$1r(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1r(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1r(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1r(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1Z(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _fetchStorefronts() {
    return (_fetchStorefronts = _async_to_generator$1r(function* (
      e,
      n = "https://api.music.apple.com/v1"
    ) {
      const d = new Headers({ Authorization: "Bearer " + e }),
        p = yield fetch(n + "/storefronts", { headers: d }),
        h = yield p.json();
      return h.errors ? Promise.reject(h.errors) : h.data;
    })).apply(this, arguments);
  }
  !(function (e) {
    (e.ID = "us"), (e.LANGUAGE_TAG = "en-gb");
  })(Fe || (Fe = {}));
  class Storefront {
    static inferFromLanguages(e, n = getLanguages()) {
      return _async_to_generator$1r(function* () {
        const d = yield (function (e) {
            return _fetchStorefronts.apply(this, arguments);
          })(e),
          p = d.map((e) => e.id),
          h = n[0] || "en-US",
          [y, _] = h.toLowerCase().split(/-|_/),
          m = p.includes(_) ? _ : "us";
        return d.find((e) => e.id === m);
      })();
    }
    constructor(e, n, d) {
      _define_property$1Z(this, "id", void 0),
        _define_property$1Z(this, "attributes", void 0),
        _define_property$1Z(this, "href", void 0),
        _define_property$1Z(this, "type", void 0),
        (this.id = e),
        (this.attributes = n),
        (this.type = "storefronts"),
        (this.href = d || `/v1/${this.type}/${e}`);
    }
  }
  function asyncGeneratorStep$1q(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1q(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1q(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1q(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1Y(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$W(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1Y(e, n, d[n]);
        });
    }
    return e;
  }
  function _ts_metadata$A(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e) {
    (e.authorizationStatusDidChange = "authorizationStatusDidChange"),
      (e.authorizationStatusWillChange = "authorizationStatusWillChange"),
      (e.eligibleForSubscribeView = "eligibleForSubscribeView"),
      (e.needsGDPRDidChange = "needsGDPRDidChange"),
      (e.storefrontCountryCodeDidChange = "storefrontCountryCodeDidChange"),
      (e.storefrontIdentifierDidChange = "storefrontIdentifierDidChange"),
      (e.userTokenDidChange = "userTokenDidChange");
  })(Ke || (Ke = {})),
    we.DEFAULT_CID;
  let Ge = !1;
  Ge = !0;
  const Ve = "https://" + getCommerceHostname("buy"),
    qe = `https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa`;
  class StoreKit extends Notifications {
    updateUserTokenFromStorage() {
      const e = this._getStorageItem(we.USER_TOKEN);
      this.userToken = e || void 0;
    }
    get authorizationStatus() {
      return this._authorizationStatus;
    }
    set authorizationStatus(e) {
      this._authorizationStatus !== e &&
        (this._getIsActiveSubscription.updateCache(void 0),
        this.dispatchEvent("authorizationStatusWillChange", {
          authorizationStatus: this._authorizationStatus,
          newAuthorizationStatus: e,
        }),
        (this._authorizationStatus = e),
        this.dispatchEvent("authorizationStatusDidChange", {
          authorizationStatus: e,
        }));
    }
    get cid() {
      if (!this._cids[this.cidNamespace]) {
        const e = this._getStorageItem(this.cidNamespace);
        this._cids[this.cidNamespace] = e || void 0;
      }
      return this._cids[this.cidNamespace];
    }
    set cid(e) {
      e
        ? this._setStorageItem(this.cidNamespace, e)
        : this._removeStorageItem(this.cidNamespace),
        (this._cids[this.cidNamespace] = e);
    }
    eligibleForSubscribeView() {
      var e = this;
      return _async_to_generator$1q(function* () {
        const n = yield e.hasMusicSubscription();
        return (
          (!e.hasAuthorized || (e.hasAuthorized && !n)) &&
          !e._dispatchedSubscribeView
        );
      })();
    }
    get hasAuthorized() {
      return this.authorizationStatus > xe.DENIED;
    }
    get logoutURL() {
      if (!this._disableLogoutURL)
        return this.iTunesBuyBase + "/account/web/logout";
    }
    get parentalControls() {
      return this._parentalControls;
    }
    set parentalControls(n) {
      (this._parentalControls = n),
        n &&
          (this.realm === e.SKRealm.MUSIC
            ? (this.restrictedEnabled = n.musicParentalControlsEnabled)
            : this.realm === e.SKRealm.TV &&
              n.videoContentRestrictions &&
              (this.authorizationStatus = xe.RESTRICTED));
    }
    get _pldfltcid() {
      return this._cids[we.DEFAULT_CID];
    }
    set _pldfltcid(e) {
      this._cids[we.DEFAULT_CID] = e;
    }
    get privacyAcknowledgements() {
      return this._privacyAcknowledgements;
    }
    set privacyAcknowledgements(e) {
      if (((this._privacyAcknowledgements = e), !e))
        return (this._gdprVersion = -1), void (this._needsGDPR = void 0);
      if (this.bundleId) {
        var n;
        const d = null !== (n = this._needsGDPR) && void 0 !== n && n;
        (this._gdprVersion = e[this.bundleId] || 0),
          (this._needsGDPR = this._gdprVersion < (Re[this.bundleId] || 0)),
          d !== this._needsGDPR &&
            this.dispatchEvent("needsGDPRDidChange", {
              GDPRVersion: this._gdprVersion,
              needsGDPR: this._needsGDPR,
            });
      }
    }
    get restrictedEnabled() {
      if (this.userToken && "boolean" != typeof this._restrictedEnabled) {
        const e = this._getStorageItem(we.RESTRICTIONS_ENABLED);
        if (e) this._restrictedEnabled = "0" !== e;
        else if (this._storefrontCountryCode) {
          const e = [
            "br",
            "ch",
            "gt",
            "hu",
            "id",
            "in",
            "it",
            "kr",
            "la",
            "lt",
            "my",
            "ru",
            "sg",
            "tr",
          ];
          this._restrictedEnabled =
            -1 !== e.indexOf(this._storefrontCountryCode) || void 0;
        }
      }
      return this._restrictedEnabled;
    }
    set restrictedEnabled(e) {
      this._restrictedEnabledOverridden ||
        (this.userToken &&
          void 0 !== e &&
          this._setStorageItem(we.RESTRICTIONS_ENABLED, e ? "1" : "0"),
        (this._restrictedEnabled = e),
        e && (this.authorizationStatus = xe.RESTRICTED));
    }
    overrideRestrictEnabled(e) {
      (this._restrictedEnabledOverridden = !1),
        (this.restrictedEnabled = e),
        (this._restrictedEnabledOverridden = !0);
    }
    get storefrontCountryCode() {
      if (!this._storefrontCountryCode) {
        const e = this._getStorageItem(we.STOREFRONT_COUNTRY_CODE);
        this._storefrontCountryCode =
          (null == e ? void 0 : e.toLowerCase()) || Fe.ID;
      }
      return this._storefrontCountryCode;
    }
    set storefrontCountryCode(e) {
      e && this.userToken
        ? this._setStorageItem(we.STOREFRONT_COUNTRY_CODE, e)
        : this._removeStorageItem(we.STOREFRONT_COUNTRY_CODE),
        e !== this._storefrontCountryCode &&
          ((this._storefrontCountryCode = e),
          this.dispatchEvent("storefrontCountryCodeDidChange", {
            storefrontCountryCode: e,
          }));
    }
    get storefrontIdentifier() {
      return this._storefrontIdentifier;
    }
    set storefrontIdentifier(e) {
      (this._storefrontIdentifier = e),
        this.dispatchEvent("storefrontIdentifierDidChange", {
          storefrontIdentifier: e,
        });
    }
    runTokenValidations(e, n = !0) {
      e && validateToken(e)
        ? (n && this._setStorageItem(we.USER_TOKEN, e),
          (this.authorizationStatus = this.restrictedEnabled
            ? xe.RESTRICTED
            : xe.AUTHORIZED))
        : (this._removeStorageItem(we.USER_TOKEN),
          (this.authorizationStatus = xe.NOT_DETERMINED));
    }
    wrapDynamicUserTokenForChanges(e, n = invoke(e)) {
      if ("function" != typeof e) return e;
      let d = n;
      return () => {
        const n = invoke(e);
        return (
          d !== n &&
            ((d = n),
            this.runTokenValidations(n, !1),
            this.dispatchEvent("userTokenDidChange", { userToken: n })),
          n || ""
        );
      };
    }
    get dynamicUserToken() {
      return this._dynamicUserToken;
    }
    set dynamicUserToken(e) {
      const n = invoke(e);
      (this._dynamicUserToken = this.wrapDynamicUserTokenForChanges(e, n)),
        this.runTokenValidations(n, "function" != typeof e),
        this.dispatchEvent("userTokenDidChange", { userToken: n });
    }
    get userToken() {
      return invoke(this.dynamicUserToken);
    }
    set userToken(e) {
      this.dynamicUserToken = e;
    }
    get userTokenIsValid() {
      return validateToken(this.userToken);
    }
    deeplinkURL(e = {}) {
      return (
        "https://finance-app.itunes.apple.com/deeplink?" +
        buildQueryParams(
          (e = _object_spread$W({}, this.deeplinkParameters || {}, e))
        )
      );
    }
    itunesDeeplinkURL(e = { p: "browse" }) {
      return (
        "https://itunes.apple.com/deeplink?" +
        buildQueryParams(
          (e = _object_spread$W({}, this.deeplinkParameters || {}, e))
        )
      );
    }
    pldfltcid() {
      var e = this;
      return _async_to_generator$1q(function* () {
        if (!e._cids[we.DEFAULT_CID])
          try {
            yield e.infoRefresh();
          } catch (Yt) {
            return;
          }
        return e._cids[we.DEFAULT_CID];
      })();
    }
    renewUserToken() {
      var e = this;
      return _async_to_generator$1q(function* () {
        if (!e.userToken) return e.requestUserToken();
        const n = new Headers({
            Authorization: "Bearer " + e.developerToken,
            Accept: "application/json",
            "Content-Type": "application/json",
            "X-Apple-Music-User-Token": "" + e.userToken,
          }),
          d = yield e.fetch(e.playBase + "/renewMusicToken", {
            method: "POST",
            headers: n,
          });
        if (401 === d.status)
          return (
            yield e.revokeUserToken(), Promise.reject(new Error("Renew token"))
          );
        const p = yield d.json();
        return (
          p["music-token"] && (e.userToken = p["music-token"]), e.userToken
        );
      })();
    }
    requestStorefrontCountryCode() {
      var e = this;
      return _async_to_generator$1q(function* () {
        if (e.authorizationStatus <= xe.DENIED)
          return Promise.reject("Not authorized: " + e.authorizationStatus);
        const n = new Headers({
            Authorization: "Bearer " + e.developerToken,
            [ne]: e.userToken || "",
          }),
          d = yield e.fetch(e.apiBase + "/me/storefront", { headers: n });
        if (d && !d.ok)
          return e._reset(), Promise.reject("Storefront Country Code error.");
        const p = yield d.json();
        if (p.errors) return Promise.reject(p.errors);
        const [h] = p.data;
        return h && h.id
          ? ((e.storefrontCountryCode = h.id), e.storefrontCountryCode)
          : Promise.reject("Storefront Country Code error.");
      })();
    }
    requestStorefrontIdentifier() {
      var e = this;
      return _async_to_generator$1q(function* () {
        if (!e.storefrontIdentifier) {
          const n = yield Storefront.inferFromLanguages(e.developerToken);
          e.storefrontIdentifier = n.id;
        }
        return e.storefrontIdentifier;
      })();
    }
    requestUserToken() {
      var e = this;
      return _async_to_generator$1q(function* () {
        if (e._serviceSetupView.isServiceView) return e.userToken || "";
        try {
          const n = yield e._serviceSetupView.load({ action: Be.AUTHORIZE });
          (e.cid = n.cid),
            (e.userToken = n.userToken),
            (e.restrictedEnabled = n.restricted);
        } catch (n) {
          return e._reset(), (e.authorizationStatus = n), Promise.reject(n);
        }
        return e.userToken;
      })();
    }
    revokeUserToken() {
      var e = this;
      return _async_to_generator$1q(function* () {
        var n;
        try {
          yield e._webPlayerLogout();
        } catch (Yt) {}
        null === (n = e.authBridgeApp) || void 0 === n || n.clearAuth(),
          e.dispatchEvent("authorizationStatusWillChange", {
            authorizationStatus: e.authorizationStatus,
            newAuthorizationStatus: xe.NOT_DETERMINED,
          }),
          e._reset(),
          e.dispatchEvent("authorizationStatusDidChange", {
            authorizationStatus: e.authorizationStatus,
          }),
          e.dispatchEvent("userTokenDidChange", { userToken: e.userToken });
      })();
    }
    setCids(e) {
      (this._cids = _object_spread$W({}, this._cids, e)),
        Object.keys(this._cids).forEach((e) => {
          this._setStorageItem(e, this._cids[e]);
        });
    }
    shouldDisplayPrivacyLink(e) {
      var n = this;
      return _async_to_generator$1q(function* () {
        return (
          e || (e = n.bundleId),
          void 0 !== n._needsGDPR || (yield n.me()),
          n._needsGDPR
        );
      })();
    }
    hasMusicSubscription() {
      var e = this;
      return _async_to_generator$1q(function* () {
        return !!e.hasAuthorized && e._getIsActiveSubscription();
      })();
    }
    _getIsActiveSubscription() {
      var n = this;
      return _async_to_generator$1q(function* () {
        var d;
        if (n.realm === e.SKRealm.PODCAST) return !0;
        return !!(null === (d = (yield n.me()).subscription) || void 0 === d
          ? void 0
          : d.active);
      })();
    }
    resetSubscribeViewEligibility() {
      this._dispatchedSubscribeView = !1;
    }
    presentSubscribeViewForEligibleUsers(e = {}, n = !0) {
      var d = this;
      return _async_to_generator$1q(function* () {
        const p = yield d.eligibleForSubscribeView();
        if (!d._serviceSetupView.isServiceView && p) {
          if (!n)
            return (
              d.dispatchEvent("eligibleForSubscribeView", e),
              void (d._dispatchedSubscribeView = !0)
            );
          try {
            const e = yield d._serviceSetupView.load({ action: Be.SUBSCRIBE });
            return (d._dispatchedSubscribeView = !0), e;
          } catch (h) {
            return d.revokeUserToken();
          }
        }
      })();
    }
    infoRefresh() {
      var e = this;
      return _async_to_generator$1q(function* () {
        if (e.authorizationStatus <= xe.DENIED)
          return Promise.reject("Not authorized: " + e.authorizationStatus);
        const n = new Headers({
          Authorization: "Bearer " + e.developerToken,
          [ne]: e.userToken || "",
        });
        try {
          const d = yield e.fetch(
              e.iTunesBuyBase + "/account/web/infoRefresh",
              { credentials: "include", headers: n }
            ),
            p = yield d.json();
          e.setCids(p);
        } catch (Yt) {}
      })();
    }
    me() {
      if (this.authorizationStatus <= xe.DENIED)
        return Promise.reject("Not authorized: " + this.authorizationStatus);
      if (!this._me) {
        var n = this;
        this._me = new Promise(
          ((d = _async_to_generator$1q(function* (d, p) {
            const h = new Headers({
                Authorization: "Bearer " + n.developerToken,
                [ne]: n.userToken || "",
              }),
              y = addQueryParamsToURL(
                n.apiBase + "/me/account",
                _object_spread$W({ meta: "subscription" }, n.meParameters)
              );
            let _;
            try {
              _ = yield n.fetch(y, { headers: h });
            } catch (Yt) {
              return p(
                new MKError(
                  MKError.Reason.NETWORK_ERROR,
                  "Failed to fetch /me/account"
                )
              );
            }
            if (_ && !_.ok)
              return (
                n.realm !== e.SKRealm.TV && n._reset(), p("Account error.")
              );
            let m = yield _.json();
            if (m.errors) return p(m.errors);
            const { data: g, meta: b } = m;
            if (!b || !b.subscription) return p("Account error.");
            n.storefrontCountryCode = b.subscription.storefront;
            const P = { meta: b, subscription: b.subscription };
            g && g.length && (P.attributes = g[0].attributes);
            try {
              let e = yield n.fetch(n.iTunesBuyBase + "/account/web/info", {
                credentials: "include",
                headers: h,
              });
              if (
                ((m = yield e.json()),
                (n.parentalControls = m.parentalControlsData),
                (n.privacyAcknowledgements = m.privacyAcknowledgement),
                isEmpty(n.privacyAcknowledgements || {}))
              ) {
                try {
                  yield n.infoRefresh();
                } catch (Yt) {
                  d(P);
                }
                (e = yield n.fetch(n.iTunesBuyBase + "/account/web/info", {
                  credentials: "include",
                  headers: h,
                })),
                  (m = yield e.json()),
                  (n.parentalControls = m.parentalControlsData),
                  (n.privacyAcknowledgements = m.privacyAcknowledgement);
              }
              P.info = m;
            } catch (Yt) {
              console.warn("Failed to fetch privacyAcknowledgements", Yt);
            }
            return d(P);
          })),
          function (e, n) {
            return d.apply(this, arguments);
          })
        )
          .then((e) => {
            var n;
            return (
              this._getIsActiveSubscription.updateCache(
                (null === (n = e.subscription) || void 0 === n
                  ? void 0
                  : n.active) || !1
              ),
              (this._me = null),
              e
            );
          })
          .catch((e) => ((this._me = null), Promise.reject(e)));
      }
      var d;
      return this._me;
    }
    musicSubscriptionOffers(e, n = getLanguages()) {
      var d = this;
      return _async_to_generator$1q(function* () {
        let p;
        if (d.hasAuthorized) {
          p = (yield d.me()).info.storeFrontISO3A;
        } else {
          if (!e) {
            const p = yield Storefront.inferFromLanguages(d.developerToken, n);
            e = null == p ? void 0 : p.id;
          }
          p = (e && te[e.toUpperCase()]) || "USA";
        }
        const h = (function (e = "en-US") {
            const n = re[e.toLowerCase()];
            if (n) return n;
            if (e.includes("-")) {
              const n = e.split("-")[0],
                d = re[n.toLowerCase()];
              if (d) return d;
            }
            return re["en-us"];
          })(n[0]),
          y = ee[p];
        if (!h || !y) return [];
        const _ = new Headers({ "X-Apple-Store-Front": `${y}-${h},8` });
        d.userToken &&
          (_.set("Authorization", "Bearer " + d.developerToken),
          _.set("Music-User-Token", d.userToken));
        const m = yield d.fetch(
          d.iTunesBuyBase + "/commerce/web/subscription/offers/music",
          { headers: _ }
        );
        if (!m.ok) return Promise.reject(m.status);
        return (yield m.json()).offers;
      })();
    }
    _getStorageItem(e) {
      var n;
      if (e)
        return "cookie" === this.persist
          ? getCookie(e)
          : "localstorage" === this.persist
            ? null === (n = this.storage) || void 0 === n
              ? void 0
              : n.getItem(`${this.storagePrefix}.${e}`)
            : void 0;
    }
    _processLocationHash(e) {
      const n = /^\#([a-zA-Z0-9+\/]{200,}={0,2})$/;
      if (n.test(e)) {
        const d = e.replace(n, "$1");
        try {
          const { itre: e, musicUserToken: n, cid: p } = JSON.parse(atob(d));
          (this.restrictedEnabled = e && "1" === e),
            (this.userToken = n),
            (this.cid = p);
        } catch (Yt) {}
        history.replaceState(null, document.title, " ");
      }
    }
    _removeStorageItem(e) {
      if ("cookie" === this.persist) this._removeCookieFromDomains(e);
      else if ("localstorage" === this.persist) {
        var n;
        return null === (n = this.storage) || void 0 === n
          ? void 0
          : n.removeItem(`${this.storagePrefix}.${e}`);
      }
    }
    _removeCookieFromDomains(e, n = window) {
      removeCookie(e);
      const { hostname: d } = n.location,
        p = d.split(".");
      if (p.length && (p.shift(), p.length > 2))
        for (let h = p.length; h > 2; h--) {
          const d = p.join(".");
          p.shift(), removeCookie(e, n, d);
        }
    }
    _reset(e = xe.NOT_DETERMINED) {
      (this._authorizationStatus = e),
        (this._cids = {}),
        (this._dispatchedSubscribeView = !1),
        (this._restrictedEnabled = void 0),
        (this._storefrontCountryCode = void 0),
        this._getIsActiveSubscription.updateCache(void 0),
        Object.keys(Ie).forEach((e) => {
          this._removeStorageItem(Ie[e]);
        }),
        this._removeStorageItem(we.RESTRICTIONS_ENABLED),
        this._removeStorageItem(we.USER_TOKEN),
        this._removeStorageItem(we.STOREFRONT_COUNTRY_CODE),
        (this._dynamicUserToken = void 0),
        (this._me = null),
        (this.privacyAcknowledgements = void 0);
    }
    _setStorageItem(e, n) {
      var d, p;
      return "cookie" === this.persist
        ? (null === (d = this.authBridgeApp) ||
            void 0 === d ||
            d.setCookieItem(e, n),
          setCookie(
            e,
            n,
            "/",
            180,
            void 0,
            determineBaseCookieDomain(window.location.hostname)
          ))
        : "localstorage" === this.persist
          ? null === (p = this.storage) || void 0 === p
            ? void 0
            : p.setItem(`${this.storagePrefix}.${e}`, n)
          : void 0;
    }
    _webPlayerLogout() {
      var e = this;
      return _async_to_generator$1q(function* () {
        const n = e.logoutURL;
        if (!n) return;
        const d = new Headers({
          Authorization: "Bearer " + e.developerToken,
          Accept: "application/json",
          "Content-Type": "application/json",
          ["X-Apple-" + ne]: "" + e.userToken,
        });
        d.delete("X-Apple-" + ne), d.append(ne, e.userToken || "");
        const p = yield e.fetch(n, {
          method: "POST",
          headers: d,
          credentials: "include",
        });
        return p && !p.ok ? Promise.reject(p.status) : p.json();
      })();
    }
    constructor(n, d) {
      super([
        "authorizationStatusDidChange",
        "authorizationStatusWillChange",
        "eligibleForSubscribeView",
        "needsGDPRDidChange",
        "storefrontCountryCodeDidChange",
        "userTokenDidChange",
        "storefrontIdentifierDidChange",
      ]),
        _define_property$1Y(this, "developerToken", void 0),
        _define_property$1Y(this, "apiBase", void 0),
        _define_property$1Y(this, "bundleId", void 0),
        _define_property$1Y(this, "cidNamespace", void 0),
        _define_property$1Y(this, "deeplinkParameters", void 0),
        _define_property$1Y(this, "iconURL", void 0),
        _define_property$1Y(this, "iTunesBuyBase", void 0),
        _define_property$1Y(this, "meParameters", void 0),
        _define_property$1Y(this, "persist", void 0),
        _define_property$1Y(this, "playBase", void 0),
        _define_property$1Y(this, "prefix", void 0),
        _define_property$1Y(this, "realm", void 0),
        _define_property$1Y(this, "storage", void 0),
        _define_property$1Y(this, "storagePrefix", void 0),
        _define_property$1Y(this, "whenAuthCompleted", void 0),
        _define_property$1Y(this, "fetch", void 0),
        _define_property$1Y(this, "_authorizationStatus", void 0),
        _define_property$1Y(this, "_developerToken", void 0),
        _define_property$1Y(this, "_disableLogoutURL", void 0),
        _define_property$1Y(this, "_dispatchedSubscribeView", void 0),
        _define_property$1Y(this, "_me", void 0),
        _define_property$1Y(this, "_cids", void 0),
        _define_property$1Y(this, "_gdprVersion", void 0),
        _define_property$1Y(this, "_needsGDPR", void 0),
        _define_property$1Y(this, "_parentalControls", void 0),
        _define_property$1Y(this, "_privacyAcknowledgements", void 0),
        _define_property$1Y(this, "_restrictedEnabled", void 0),
        _define_property$1Y(this, "_restrictedEnabledOverridden", void 0),
        _define_property$1Y(this, "_serviceSetupView", void 0),
        _define_property$1Y(this, "authBridgeApp", void 0),
        _define_property$1Y(this, "_storefrontCountryCode", void 0),
        _define_property$1Y(this, "_storefrontIdentifier", void 0),
        _define_property$1Y(this, "_dynamicUserToken", void 0),
        (this.developerToken = n),
        (this.apiBase = "https://api.music.apple.com/v1"),
        (this.iTunesBuyBase = Ve),
        (this.meParameters = {}),
        (this.persist = "localstorage"),
        (this.playBase = qe),
        (this.prefix = "music"),
        (this.realm = e.SKRealm.MUSIC),
        (this.storage = getLocalStorage()),
        (this._authorizationStatus = xe.NOT_DETERMINED),
        (this._disableLogoutURL = !1),
        (this._dispatchedSubscribeView = !1),
        (this._me = null),
        (this._cids = {}),
        (this._gdprVersion = -1),
        (this._needsGDPR = void 0),
        (this._restrictedEnabledOverridden = !1),
        (this._dynamicUserToken = getCookie(we.USER_TOKEN)),
        be.info("StoreKit initialized"),
        d &&
          (d.apiBase && (this.apiBase = d.apiBase),
          d.deeplink && (this.deeplinkParameters = d.deeplink),
          d.meParameters && (this.meParameters = d.meParameters),
          d.persist && (this.persist = d.persist),
          d.prefix && (this.prefix = d.prefix),
          void 0 !== d.realm && (this.realm = d.realm),
          void 0 !== d.disableLogoutURL &&
            (this._disableLogoutURL = d.disableLogoutURL),
          (this.bundleId = $e[this.realm])),
        (this.fetch =
          void 0 !== d && "function" == typeof d.fetch
            ? d.fetch
            : globalThis.fetch.bind(globalThis)),
        (this.cidNamespace = Ie[this.realm]),
        (this._developerToken = new DeveloperToken(n)),
        (this._serviceSetupView = new ServiceSetupView(n, {
          authenticateMethod: d && d.authenticateMethod,
          iconURL: d && d.iconURL,
          deeplinkParameters: this.deeplinkParameters,
        })),
        (this.storagePrefix =
          `${this.prefix}.${this._developerToken.teamId}`.toLocaleLowerCase()),
        this.updateUserTokenFromStorage(),
        this.developerToken &&
          this.userTokenIsValid &&
          ((this._restrictedEnabled = this.restrictedEnabled),
          this.shouldDisplayPrivacyLink(this.bundleId).catch(() => {})),
        (this._storefrontCountryCode = this.storefrontCountryCode),
        (this.whenAuthCompleted = Promise.resolve()),
        isNodeEnvironment$1() ||
          (this._processLocationHash(window.location.hash),
          "cookie" !== this.persist ||
            (null == d ? void 0 : d.disableAuthBridge) ||
            ((this.authBridgeApp = new AuthBridgeApp()),
            (this.authBridgeApp.authClearedFromOtherFrame =
              this.revokeUserToken.bind(this)),
            (this.whenAuthCompleted = this.authBridgeApp.whenAuthCompleted.then(
              () => {
                this.updateUserTokenFromStorage();
              }
            ))));
    }
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      (
        (e = 300) =>
        (n, d, p) => {
          if (void 0 === p || "function" != typeof p.value)
            throw new TypeError(
              `Only methods can be decorated with @CachedResult, but ${d} is not a method.`
            );
          return {
            configurable: !0,
            get() {
              const n = p.value,
                h = 1e3 * e;
              let y,
                _ = -1;
              function cachedResultMethod() {
                return _cachedResultMethod.apply(this, arguments);
              }
              function _cachedResultMethod() {
                return (_cachedResultMethod = _async_to_generator$1u(function* (
                  ...e
                ) {
                  const d = Date.now();
                  return (
                    (void 0 === y || -1 === _ || (_ > 0 && d > _ + h)) &&
                      ((_ = d), (y = yield n.apply(this, e))),
                    y
                  );
                })).apply(this, arguments);
              }
              return (
                (cachedResultMethod.updateCache = function (e) {
                  (_ = Date.now()), (y = e);
                }),
                (cachedResultMethod.getCachedValue = () => y),
                Object.defineProperty(this, d, {
                  value: cachedResultMethod,
                  configurable: !0,
                  writable: !0,
                }),
                cachedResultMethod
              );
            },
          };
        }
      )(900),
      _ts_metadata$A("design:type", Function),
      _ts_metadata$A("design:paramtypes", []),
      _ts_metadata$A("design:returntype", Promise),
    ],
    StoreKit.prototype,
    "_getIsActiveSubscription",
    null
  );
  const He = new Logger("player"),
    We = new Logger("paf"),
    Ye = new Logger("services"),
    ze = StringDevFlag.register("mk-logging-levels"),
    Qe = BooleanDevFlag.register("mk-console-logging"),
    Je = pe.ERROR;
  let Xe = Je;
  const Ze = new Logger("mk", {
    level: Xe,
    handlers: {
      console: new (class {
        get hasConsole() {
          return "undefined" != typeof console;
        }
        process(e) {
          if (!this.enabled || !this.hasConsole) return;
          let n = "log";
          if (this.mapLevels) {
            const p = this.levelMapping.get(e.level);
            void 0 !== (d = p) && d in console && (n = p);
          }
          var d, p;
          const h = null !== (p = e.args) && void 0 !== p ? p : [],
            y = this.format(e);
          console[n](y, ...h);
        }
        constructor(e = {}) {
          var n, d, p, h;
          _define_property$22(this, "enabled", void 0),
            _define_property$22(this, "mapLevels", void 0),
            _define_property$22(this, "levelMapping", void 0),
            _define_property$22(this, "format", void 0),
            (this.enabled = null === (n = e.enabled) || void 0 === n || n),
            (this.mapLevels = null === (d = e.mapLevels) || void 0 === d || d),
            (this.levelMapping =
              null !== (p = e.levelMapping) && void 0 !== p ? p : me),
            (this.format = null !== (h = e.formatter) && void 0 !== h ? h : ve);
        }
      })({ enabled: !1 }),
      external: new CallbackHandler(() => {}),
    },
  });
  function applyLoggingLevels(e) {
    !(function (e, n) {
      walk(e, function (e) {
        let d;
        const p = e.namespace;
        e.clearLevel(),
          void 0 === e.parent && void 0 !== n["*"]
            ? (d = getLoggingLevel(n["*"]))
            : void 0 !== n[p] && (d = getLoggingLevel(n[p])),
          void 0 !== d && e.setLevel(d);
      });
    })(
      Ze,
      (function (e) {
        const n = getLoggingLevel(e.trim(), { allowShorthands: !0 });
        if (void 0 !== n) return { "*": n };
        const d = {},
          p = e.split(",").filter((e) => "" !== e.trim());
        for (const g of p) {
          var h, y;
          const e = g.split("=", 2);
          if (2 !== e.length) continue;
          var _;
          const n =
            null !==
              (_ = null === (h = e[0]) || void 0 === h ? void 0 : h.trim()) &&
            void 0 !== _
              ? _
              : "";
          var m;
          const p = getLoggingLevel(
            null !==
              (m = null === (y = e[1]) || void 0 === y ? void 0 : y.trim()) &&
              void 0 !== m
              ? m
              : "",
            { allowShorthands: !0 }
          );
          "" !== n && void 0 !== p && (d[n] = p);
        }
        return d;
      })(e)
    );
  }
  function clearLoggingLevels() {
    Ze.setLevel(Xe),
      (function (e, n = { includeRoot: !0 }) {
        walk(e, function (e) {
          (void 0 !== e.parent || n.includeRoot) && e.clearLevel();
        });
      })(Ze, { includeRoot: !1 });
  }
  function setConsoleOutput(e) {
    Ze.handlers.console.enabled = null != e && e;
  }
  function setRootLoggingLevel(e) {
    var n;
    Xe = null !== (n = getLoggingLevel(e)) && void 0 !== n ? n : Xe;
  }
  const et = {
    getLogger: (e = "*") => Ze.getByNamespace(null != e ? e : "*"),
    setConsoleOutput(e) {
      !0 === e
        ? (Qe.enable(),
          setConsoleOutput(!0),
          Ze.info("Console output is enabled with level " + Ze.levelName))
        : (Qe.disable(), setConsoleOutput(!1));
    },
    setLoggingLevels(e, n) {
      "" !== e.trim()
        ? (ze.set(e),
          applyLoggingLevels(e),
          et.setConsoleOutput(null == n || n))
        : et.clearLoggingLevels(null != n && n);
    },
    clearLoggingLevels(e = !1) {
      et.setConsoleOutput(e), ze.clear(), clearLoggingLevels();
    },
    listLoggers: (e) =>
      (function (e) {
        const n = {};
        void 0 !== e && (e = e.startsWith("mk/") ? e : "mk/" + e);
        const d = Ze.children;
        for (; d.length > 0; ) {
          const p = d.shift();
          if (void 0 === p) break;
          (void 0 === e || p.namespace.startsWith(e)) &&
            ((n[p.namespace] = p.levelName), d.unshift(...p.children));
        }
        return n;
      })(e),
  };
  var tt;
  Qe.enabled && et.setConsoleOutput(Qe.enabled),
    void 0 !== ze.value && et.setLoggingLevels(ze.value, Qe.enabled),
    (function (e) {
      (e.NONE = "none"),
        (e.FAIRPLAY = "com.apple.fps"),
        (e.PLAYREADY = "com.microsoft.playready"),
        (e.WIDEVINE = "com.widevine.alpha");
    })(tt || (tt = {}));
  const rt = { app: {}, features: {}, urls: {} },
    nt = "mk-player-tsid",
    it = 'audio/mp4;codecs="mp4a.40.2"';
  var at, ot, st;
  function asyncGeneratorStep$1p(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1p(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1p(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1p(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function findMediaKeySystemAccess(e, n) {
    return _findMediaKeySystemAccess.apply(this, arguments);
  }
  function _findMediaKeySystemAccess() {
    return (_findMediaKeySystemAccess = _async_to_generator$1p(
      function* (e, n) {
        for (let d = 0; d < e.length; d++)
          try {
            const p = e[d];
            return [p, yield navigator.requestMediaKeySystemAccess(p, n)];
          } catch (Yt) {}
        return [];
      }
    )).apply(this, arguments);
  }
  !(function (e) {
    (e.playbackLicenseError = "playbackLicenseError"),
      (e.playbackSessionError = "playbackSessionError"),
      (e.manifestParsed = "manifestParsed"),
      (e.audioCodecIdentified = "audioCodecIdentified"),
      (e.audioTracksSwitched = "audioTracksSwitched"),
      (e.audioTracksUpdated = "audioTracksUpdated"),
      (e.textTracksSwitched = "textTracksSwitched"),
      (e.textTracksUpdated = "textTracksUpdated"),
      (e.inlineStylesParsed = "inlineStylesParsed"),
      (e.levelUpdated = "levelUpdated");
  })(at || (at = {})),
    (function (e) {
      (e.MP4 = "audio/mp4"), (e.AVC1 = "video/mp4");
    })(ot || (ot = {})),
    (function (e) {
      (e.WIDEVINE = "urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"),
        (e.PLAYREADY = "com.microsoft.playready"),
        (e.FAIRPLAY = "com.apple.streamingkeydelivery");
    })(st || (st = {}));
  let ct;
  const { NONE: lt, FAIRPLAY: dt, WIDEVINE: ut, PLAYREADY: pt } = tt;
  function supportsDrm() {
    if (!ct) throw new Error("findKeySystemPreference has not been invoked");
    return ct !== lt;
  }
  function potentialKeySystemsForAccess() {
    return (function () {
      const e = getSessionStorage();
      return !!e && "true" === e.getItem("mk-playready-cbcs-unsupported");
    })()
      ? [ut]
      : rt.features["prefer-playready"]
        ? [pt, ut]
        : [ut, pt];
  }
  function findKeySystemPreference(e) {
    return _findKeySystemPreference.apply(this, arguments);
  }
  function _findKeySystemPreference() {
    return (_findKeySystemPreference = _async_to_generator$1p(function* (e) {
      var n, d, p;
      if (
        null === (p = null == e ? void 0 : e.isNodeEnvironment) ||
        void 0 === p ||
        !p
      ) {
        if (
          null === (n = window.WebKitMediaKeys) || void 0 === n
            ? void 0
            : n.isTypeSupported(dt + ".1_0", ot.AVC1)
        )
          ct = dt;
        else if (
          null === (d = window.MSMediaKeys) || void 0 === d
            ? void 0
            : d.isTypeSupported(pt, ot.AVC1)
        )
          ct = pt;
        else {
          const e = document.createElement("video");
          if (
            hasMediaKeySupport() &&
            e.canPlayType('video/mp4;codecs="avc1.42E01E"') &&
            e.canPlayType(it)
          ) {
            const e = [
                {
                  initDataTypes: ["keyids", "cenc"],
                  distinctiveIdentifier: "optional",
                  persistentState: "required",
                  videoCapabilities: [
                    {
                      contentType: 'video/mp4;codecs="avc1.42E01E"',
                      robustness: "SW_SECURE_CRYPTO",
                    },
                  ],
                  audioCapabilities: [{ contentType: it }],
                },
              ],
              n = potentialKeySystemsForAccess(),
              [d] = yield findMediaKeySystemAccess(n, e);
            ct = d;
          }
        }
        return (ct = null != ct ? ct : lt), ct;
      }
      ct = lt;
    })).apply(this, arguments);
  }
  function hasMediaKeySupport() {
    return !!(
      navigator &&
      navigator.requestMediaKeySystemAccess &&
      window.MediaKeys &&
      window.MediaKeySystemAccess
    );
  }
  let isMergeableObject = function (e) {
    return (
      (function (e) {
        return !!e && "object" == typeof e;
      })(e) &&
      !(function (e) {
        let n = Object.prototype.toString.call(e);
        return (
          "[object RegExp]" === n ||
          "[object Date]" === n ||
          (function (e) {
            return e.$$typeof === ht;
          })(e)
        );
      })(e)
    );
  };
  let ht =
    "function" == typeof Symbol && Symbol.for
      ? Symbol.for("react.element")
      : 60103;
  function cloneUnlessOtherwiseSpecified(e, n) {
    return !1 !== n.clone && n.isMergeableObject(e)
      ? deepmerge(((d = e), Array.isArray(d) ? [] : {}), e, n)
      : e;
    var d;
  }
  function defaultArrayMerge(e, n, d) {
    return e.concat(n).map(function (e) {
      return cloneUnlessOtherwiseSpecified(e, d);
    });
  }
  function getKeys(e) {
    return Object.keys(e).concat(
      (function (e) {
        return Object.getOwnPropertySymbols
          ? Object.getOwnPropertySymbols(e).filter(function (n) {
              return e.propertyIsEnumerable(n);
            })
          : [];
      })(e)
    );
  }
  function mergeObject(e, n, d) {
    let p = {};
    return (
      d.isMergeableObject(e) &&
        getKeys(e).forEach(function (n) {
          p[n] = cloneUnlessOtherwiseSpecified(e[n], d);
        }),
      getKeys(n).forEach(function (h) {
        d.isMergeableObject(n[h]) && e[h]
          ? (p[h] = (function (e, n) {
              if (!n.customMerge) return deepmerge;
              let d = n.customMerge(e);
              return "function" == typeof d ? d : deepmerge;
            })(h, d)(e[h], n[h], d))
          : (p[h] = cloneUnlessOtherwiseSpecified(n[h], d));
      }),
      p
    );
  }
  function deepmerge(e, n, d) {
    ((d = d || {}).arrayMerge = d.arrayMerge || defaultArrayMerge),
      (d.isMergeableObject = d.isMergeableObject || isMergeableObject);
    let p = Array.isArray(n);
    return p === Array.isArray(e)
      ? p
        ? d.arrayMerge(e, n, d)
        : mergeObject(e, n, d)
      : cloneUnlessOtherwiseSpecified(n, d);
  }
  function _define_property$1X(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$V(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1X(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$C(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _object_without_properties$4(e, n) {
    if (null == e) return {};
    var d,
      p,
      h = (function (e, n) {
        if (null == e) return {};
        var d,
          p,
          h = {},
          y = Object.keys(e);
        for (p = 0; p < y.length; p++)
          (d = y[p]), n.indexOf(d) >= 0 || (h[d] = e[d]);
        return h;
      })(e, n);
    if (Object.getOwnPropertySymbols) {
      var y = Object.getOwnPropertySymbols(e);
      for (p = 0; p < y.length; p++)
        (d = y[p]),
          n.indexOf(d) >= 0 ||
            (Object.prototype.propertyIsEnumerable.call(e, d) && (h[d] = e[d]));
    }
    return h;
  }
  var yt;
  (deepmerge.all = function (e, n) {
    if (!Array.isArray(e)) throw new Error("first argument should be an array");
    return e.reduce(function (e, d) {
      return deepmerge(e, d, n);
    }, {});
  }),
    (function (e) {
      (e.dataRecordDidDelete = "dataRecordDidDelete"),
        (e.dataRecordWillDelete = "dataRecordWillDelete"),
        (e.dataRecordDidMaterialize = "dataRecordDidMaterialize"),
        (e.dataRecordDidPopulate = "dataRecordDidPopulate"),
        (e.dataRecordWillPopulate = "dataRecordWillPopulate");
    })(yt || (yt = {}));
  const isDataRecord = (e) =>
    !(
      !e ||
      "function" != typeof e.hasAttributes ||
      "function" != typeof e.hasRelationships ||
      "function" != typeof e.hasViews ||
      "function" != typeof e.serialize
    );
  class DataRecord {
    hasProperties(e) {
      return (
        !e ||
        (e.attributes || e.relationships || e.views
          ? !(e.attributes && !this.hasAttributes(e.attributes)) &&
            !(e.relationships && !this.hasRelationships(e.relationships)) &&
            !(e.views && !this.hasViews(e.views))
          : this.hasAttributes() || this.hasRelationships() || this.hasViews())
      );
    }
    hasAttributes(e) {
      return this._hasProperties(this._mjs.attributes, e);
    }
    hasRelationships(e) {
      return this._hasProperties(this._mjs.relationships, e);
    }
    hasViews(e) {
      return this._hasProperties(this._mjs.views, e);
    }
    meta(e) {
      return e ? this._meta[e] : this._meta;
    }
    serialize(e = !0, n = {}, d = {}) {
      const p = { id: this.id, type: this.type };
      return n[`${this.type}-${this.id}`] && !d.allowFullDuplicateSerializations
        ? p
        : ((n[`${this.type}-${this.id}`] = !0),
          this.hasAttributes() &&
            (p.attributes = this._mjs.attributes.reduce(
              (e, n) => ((e[n] = this[n]), e),
              {}
            )),
          this._mjs.relationships.length > 0 &&
            (p.relationships = this._serializeRelatedData(
              this._mjs.relationships,
              n,
              d
            )),
          this._mjs.views.length > 0 &&
            (p.views = this._serializeRelatedData(this._mjs.views, n, d)),
          e ? { data: p } : p);
    }
    setProperty(e, n, d = "attributes", p = {}) {
      function isMergeableObject(e) {
        return !(!e || "object" != typeof e || e instanceof DataRecord);
      }
      hasOwn(this, e) ||
        (this._mjs[d] || (this._mjs[d] = []), this._mjs[d].push(e));
      const setDescriptor = (e) => ({
        value: e,
        writable: !0,
        configurable: !0,
        enumerable: !0,
      });
      this[e] && n && "object" == typeof this[e] && "object" == typeof n
        ? "attributes" === d
          ? Object.defineProperty(
              this,
              e,
              setDescriptor(
                deepmerge(this[e], n, {
                  arrayMerge: function (e, n, d) {
                    return n;
                  },
                  isMergeableObject: isMergeableObject,
                })
              )
            )
          : "relationships" === d &&
              Array.isArray(this[e]) &&
              p.extendRelationships
            ? Object.defineProperty(
                this,
                e,
                setDescriptor(
                  deepmerge(this[e], n, {
                    isMergeableObject: isMergeableObject,
                  })
                )
              )
            : Object.defineProperty(this, e, setDescriptor(n))
        : Object.defineProperty(this, e, setDescriptor(n));
    }
    removeRelative(e, n) {
      this[e] &&
        (Array.isArray(this[e])
          ? (this[e] = this[e].filter((e) => e.id !== n))
          : delete this[e]);
    }
    setParent(e) {
      const n = this._mjs.parents,
        d = n && n.length > 0;
      this._mjs.parents = d ? n.concat(e) : e;
    }
    _hasProperties(e, n) {
      return (
        !!e && (n ? ensureArray(n).every((n) => e.includes(n)) : e.length > 0)
      );
    }
    _serializeRelatedData(e, n = {}, d = {}) {
      return e.reduce((e, p) => {
        if (d.excludeRelationships && d.excludeRelationships.has(p)) return e;
        if (d.includeRelationships && !d.includeRelationships.has(p)) return e;
        const h = this[p];
        return (
          Array.isArray(h)
            ? (e[p] = {
                data: h.map((e) =>
                  "function" == typeof e.serialize ? e.serialize(!1, n, d) : e
                ),
              })
            : (e[p] =
                h && "function" == typeof h.serialize
                  ? h.serialize(!1, n, d)
                  : h),
          e
        );
      }, {});
    }
    constructor(e, n, d = {}) {
      _define_property$1X(this, "type", void 0),
        _define_property$1X(this, "id", void 0),
        _define_property$1X(this, "_mjs", void 0),
        _define_property$1X(this, "_meta", void 0),
        (this.type = e),
        (this.id = n),
        (this._mjs = { attributes: [], relationships: [], views: [] }),
        (this._meta = {}),
        (this._mjs = _object_spread$V({}, this._mjs, d));
    }
  }
  class DataStore extends Notifications {
    get mapping() {
      return this._mapping;
    }
    set mapping(e) {
      this._mapping = e;
    }
    clear() {
      (this._records = {}), (this._expiryRecords = new Set());
    }
    peek(e, n, d) {
      if ((this._checkForExpiredRecords(), !this._records[e]))
        return n ? null : [];
      if (!n) return Object.values(this._records[e]);
      if (Array.isArray(n))
        return n.map((n) => {
          const p = this._records[e][n];
          if (p && p.hasProperties(d)) return p;
        });
      const p = this._records[e][n];
      return p && p.hasProperties(d) ? p : null;
    }
    populateDataRecords(e, n = {}, d = {}) {
      if (!e.data) return [];
      if (!Array.isArray(e.data)) return this.populateDataRecord(e.data, n, d);
      const p = [];
      return (
        e.data.forEach((e, h) => {
          const y = _object_spread_props$C(_object_spread$V({}, d), {
            parents: d.parents
              ? [
                  _object_spread_props$C(_object_spread$V({}, d.parents[0]), {
                    position: h,
                  }),
                ]
              : [],
          });
          d.parents && (d.parents[0].position = h);
          const _ = this.populateDataRecord(e, n, y);
          p.push(_);
        }),
        p
      );
    }
    populateDataRecord(e, n = {}, d) {
      const p = d.filter || this.filter,
        h = d.mapping || this.mapping;
      if (p && !p(e)) return;
      if (h) {
        let n = "function" == typeof h ? h(e) : transform$a(h, e);
        Object.assign(e, n);
      }
      this._shouldDisableRecordReuse && (n = {});
      const y = this._materializeRecord(
        n,
        _object_spread$V({ id: e.id, type: e.type }, d)
      );
      return (
        e.meta && (y._meta = e.meta),
        e.attributes &&
          e.attributes.cachingPolicy &&
          e.attributes.cachingPolicy.maxAge &&
          ((y._mjs.expiration =
            Date.now() + 1e3 * e.attributes.cachingPolicy.maxAge),
          this._removeOnExpiration && this._expiryRecords.add(y)),
        this._populateDataAttributes(e, y),
        "object" == typeof e.relationships &&
          Object.keys(e.relationships).forEach((p) => {
            let _ = e.relationships[p];
            _ &&
              "data" in _ &&
              ((_ = this.populateDataRecords(_, n, {
                mapping: h,
                parents: [
                  { relationshipName: p, parentType: y.type, parentId: y.id },
                ],
              })),
              y.setProperty(p, _, "relationships", d));
          }),
        "object" == typeof e.views &&
          Object.keys(e.views).forEach((d) => {
            const p = e.views[d];
            if (p.attributes || p.data) {
              const e = new DataRecord("view", d);
              if ((this._populateDataAttributes(p, e), p.data)) {
                const d = this.populateDataRecords(p, n, h);
                e.setProperty("data", d, "relationships");
              }
              y.setProperty(d, e, "views");
            }
          }),
        y
      );
    }
    query(e, n) {
      this._checkForExpiredRecords();
      let includeRecord = (e) => !1;
      return (
        "string" == typeof e && n
          ? (includeRecord = (d) => (null == d ? void 0 : d[e]) === n)
          : "function" == typeof e
            ? (includeRecord = (n) => {
                try {
                  return e(n);
                } catch (Yt) {
                  return !1;
                }
              })
            : "object" == typeof e &&
              (includeRecord = (n) => {
                const d = Object.keys(e);
                let p = 0;
                return (
                  d.forEach((d) => {
                    (null == n ? void 0 : n[d]) === e[d] && p++;
                  }),
                  d.length === p
                );
              }),
        Object.values(this._records).reduce(
          (e, n) => (
            Object.values(n).forEach((n) => {
              includeRecord(n) && e.push(n);
            }),
            e
          ),
          []
        )
      );
    }
    remove(e, n) {
      setTimeout(this._checkForExpiredRecords.bind(this), 0);
      if (!hasOwn(this._records, e)) return;
      const d = this.peek(e, n);
      d &&
        (this.dispatchEvent("dataRecordWillDelete", [e, n]),
        d._mjs.parents &&
          d._mjs.parents.length > 0 &&
          d._mjs.parents.forEach(
            ({ relationshipName: e, parentType: n, parentId: p }) => {
              this.peek(n, p).removeRelative(e, d.id);
            }
          ),
        delete this._records[e][n],
        this.dispatchEvent("dataRecordDidDelete", [e, n]));
    }
    save(e, n = {}) {
      return (
        setTimeout(this._checkForExpiredRecords.bind(this), 0),
        this.populateDataRecords(e, this._records, n)
      );
    }
    _populateDataAttributes(e, n) {
      "object" == typeof e.attributes &&
        (this.dispatchEvent("dataRecordWillPopulate", [n.type, n.id]),
        Object.keys(e.attributes).forEach((d) => {
          n.setProperty(d, e.attributes[d], "attributes");
        }),
        this.dispatchEvent("dataRecordDidPopulate", [n.type, n.id]));
    }
    _materializeRecord(e, n) {
      const { type: d, id: p } = n,
        h = _object_without_properties$4(n, ["type", "id"]);
      return (
        (e[d] = e[d] || {}),
        e[d][p]
          ? e[d][p].setParent(h.parents || [])
          : (e[d][p] = new DataRecord(d, p, h)),
        this.dispatchEvent("dataRecordDidMaterialize", [d, p]),
        e[d][p]
      );
    }
    _checkForExpiredRecords() {
      const e = [];
      this._expiryRecords.forEach((n) => {
        Date.now() > n._mjs.expiration &&
          (e.push([n.type, n.id]), this._expiryRecords.delete(n));
      }),
        e.forEach((e) => {
          this.remove(...e);
        });
    }
    constructor(e = {}) {
      super([
        "dataRecordDidDelete",
        "dataRecordWillDelete",
        "dataRecordDidMaterialize",
        "dataRecordWillPopulate",
        "dataRecordDidPopulate",
      ]),
        _define_property$1X(this, "_records", void 0),
        _define_property$1X(this, "_expiryRecords", void 0),
        _define_property$1X(this, "_mapping", void 0),
        _define_property$1X(this, "_removeOnExpiration", !1),
        _define_property$1X(this, "_shouldDisableRecordReuse", !0),
        _define_property$1X(this, "filter", void 0),
        (this._records = {}),
        (this._expiryRecords = new Set()),
        (this._removeOnExpiration = !!e.removeOnExpiration),
        (this._mapping = e.mapping),
        (this._shouldDisableRecordReuse = !!e.shouldDisableRecordReuse),
        (this.filter = e.filter);
    }
  }
  function _define_property$1W(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const DEFAULT_CACHE_KEY_FUNCTION = (e, n) => `${n}${e}`;
  class NetworkCache {
    getItem(e) {
      const n = this.cacheKeyForPath(e),
        d = this.storage.getItem(n);
      if (null !== d) {
        const { x: e, d: p } = JSON.parse(d);
        if (e > Date.now()) return p;
        this.storage.removeItem(n);
      }
    }
    setItem(e, n, d = this.ttl) {
      const p = this.cacheKeyForPath(e);
      this.storage.setItem(p, JSON.stringify({ x: Date.now() + d, d: n }));
    }
    removeItem(e) {
      const n = this.cacheKeyForPath(e);
      this.storage.removeItem(n);
    }
    removeItemsMatching(e, n = !0) {
      const d = this.cacheKeyForPath(e);
      this.removeItemsMatchingCacheKey(d, n);
    }
    clear() {
      this.removeItemsMatchingCacheKey(this.prefix, !1);
    }
    removeItemsMatchingCacheKey(e, n) {
      const d = new RegExp(`^${e}${n ? "$" : ""}`);
      (this.storage instanceof GenericStorage
        ? this.storage.keys
        : Object.keys(this.storage)
      ).forEach((e) => {
        e && d.test(e) && this.storage.removeItem(e);
      });
    }
    cacheKeyForPath(e) {
      return this.cacheKeyFunction(e, this.prefix);
    }
    constructor(e = {}) {
      _define_property$1W(this, "storage", void 0),
        _define_property$1W(this, "prefix", void 0),
        _define_property$1W(this, "ttl", void 0),
        _define_property$1W(this, "cacheKeyFunction", void 0),
        (this.storage = e.storage || new GenericStorage()),
        (this.prefix = e.prefix || ""),
        (this.ttl = e.ttl || 3e5),
        (this.cacheKeyFunction =
          e.cacheKeyFunction || DEFAULT_CACHE_KEY_FUNCTION);
    }
  }
  function asyncGeneratorStep$1o(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1V(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$U(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1V(e, n, d[n]);
        });
    }
    return e;
  }
  var _t;
  !(function (e) {
    (e.JSON = "application/json"),
      (e.FORM = "application/x-www-form-urlencoded");
  })(_t || (_t = {}));
  class TokenSession extends class {
    clearCacheForRequest(e, n) {
      "object" == typeof e && ((n = e), (e = void 0));
      const d = this.constructURL(e, n);
      this.networkCache.removeItemsMatching(d);
    }
    request(e, n, d) {
      var p,
        h = this;
      return ((p = function* () {
        d || "object" != typeof e || ((d = n || {}), (n = e), (e = void 0));
        let p = {};
        "object" ==
        typeof (d = _object_spread$U(
          { method: h.method, headers: h.headers, reload: !1 },
          h._fetchOptions,
          d
        )).queryParameters
          ? ((p = d.queryParameters), delete d.queryParameters)
          : ("GET" !== d.method && "DELETE" !== d.method) || (p = n);
        const y = h.constructURL(e, p),
          { method: _, reload: m = !1, useRawResponse: g } = d;
        if (
          ((d.headers = h.buildHeaders(d)),
          delete d.reload,
          delete d.useRawResponse,
          "GET" === _ && !m)
        ) {
          const e = h.getCacheItem(y);
          if (e) return Promise.resolve(e);
        }
        n &&
          Object.keys(n).length &&
          ("POST" === _ || "PUT" === _) &&
          ((d.body = d.body || n),
          "application/x-www-form-urlencoded" === d.contentType
            ? ((d.body = urlEncodeParameters(d.body)),
              d.headers.set(
                "Content-Type",
                "application/x-www-form-urlencoded"
              ))
            : ((d.body = JSON.stringify(d.body)),
              d.headers.set("Content-Type", "application/json")));
        const b = yield h._fetchFunction(y, d);
        if (!b.ok) return Promise.reject(b);
        let P;
        try {
          P = yield b.json();
        } catch (Yt) {
          P = {};
        }
        if (P.errors) return Promise.reject(P.errors);
        const S = g ? P : P.results || P.data || P;
        if ("GET" === _) {
          var T;
          const e =
            null !== (T = getMaxAgeFromHeaders(b.headers)) && void 0 !== T
              ? T
              : h.ttl;
          h.setCacheItem(y, S, e);
        }
        return S;
      }),
      function () {
        var e = this,
          n = arguments;
        return new Promise(function (d, h) {
          var y = p.apply(e, n);
          function _next(e) {
            asyncGeneratorStep$1o(y, d, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$1o(y, d, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    buildHeaders({ headers: e, reload: n = !1 } = {}) {
      void 0 === e && (e = this.headers);
      const d = ((e) => new e.constructor(e))(e);
      return n && d.set("Cache-Control", "no-cache"), d;
    }
    constructURL(e, n) {
      return ((e, n, d) =>
        addQueryParamsToURL(
          joinURLPath(null != e ? e : "", null != n ? n : ""),
          d
        ))(this.url, e, n);
    }
    getCacheItem(e) {
      const n = this.networkCache.storage,
        d = `${this.prefix}${this.prefix}cache-mut`,
        p = n.getItem(d) || null,
        h =
          this.headers.get("Music-User-Token") ||
          this.headers.get("Media-User-Token") ||
          null;
      return (
        h !== p &&
          (this.networkCache.clear(),
          null === h ? n.removeItem(d) : n.setItem(d, h)),
        this.networkCache.getItem(e)
      );
    }
    setCacheItem(e, n, d = this.ttl) {
      this.networkCache.setItem(e, n, d);
    }
    clearNetworkCache() {
      this.networkCache.clear();
    }
    _key(e, n) {
      const d = (function (e) {
        try {
          const [n, d] = e.split("?", 2);
          if (void 0 === d) return n;
          const p = d.split("&").map((e) => e.split("=", 2)),
            h = [...Array(p.length).keys()];
          h.sort((e, n) => {
            const d = p[e],
              h = p[n];
            return d < h ? -1 : d > h ? 1 : e - n;
          });
          const y = h.map((e) => p[e]);
          return `${n}?${y.map(([e, n]) => (void 0 !== n ? `${e}=${n}` : e)).join("&")}`;
        } catch (Yt) {
          return e;
        }
      })(e)
        .toLowerCase()
        .replace(this.url, "");
      return `${this.prefix}${d.replace(/[^-_0-9a-z]{1,}/g, ".")}`;
    }
    constructor(e, n) {
      if (
        (_define_property$1V(this, "url", void 0),
        _define_property$1V(this, "headers", void 0),
        _define_property$1V(this, "prefix", ""),
        _define_property$1V(this, "storage", void 0),
        _define_property$1V(this, "networkCache", void 0),
        _define_property$1V(this, "ttl", void 0),
        _define_property$1V(this, "method", "GET"),
        _define_property$1V(this, "_fetchOptions", void 0),
        _define_property$1V(this, "_fetchFunction", void 0),
        (this.url = e),
        (n = n || {}).storage && n.underlyingStorage)
      )
        throw new Error(
          "only pass storage OR underlyingStorage in sessionOptions to URLSession"
        );
      const d = n.underlyingStorage || {};
      if (
        ((this.storage = n.storage || new GenericStorage(d)),
        (this.networkCache = new NetworkCache({
          storage: this.storage,
          prefix: this.prefix,
          cacheKeyFunction: this._key.bind(this),
        })),
        (this.ttl = n.ttl || 3e5),
        (this._fetchOptions = _object_spread$U({}, n.fetchOptions)),
        "function" != typeof n.fetch && "function" != typeof fetch)
      )
        throw new Error("window.fetch is not defined");
      var p;
      (this._fetchFunction =
        null !== (p = n.fetch) && void 0 !== p ? p : fetch.bind(window)),
        (this.headers = this._fetchOptions.headers || new Headers()),
        delete this._fetchOptions.headers;
    }
  } {
    get developerToken() {
      return this._developerToken.token;
    }
    constructor(e, n, d) {
      super(e, d),
        _define_property$1V(this, "userToken", void 0),
        _define_property$1V(this, "_developerToken", void 0),
        (this._developerToken = new DeveloperToken(n)),
        this.headers.set("Authorization", "Bearer " + this.developerToken),
        (d = d || {}),
        (this.userToken = d.userToken),
        this.userToken && this.headers.set("Media-User-Token", this.userToken);
    }
  }
  const ft = Date.now(),
    mt = isNodeEnvironment$1()
      ? () => {
          const [e, n] = process.hrtime();
          return Math.floor(1e3 * e + 1e-6 * n);
        }
      : () => {
          var e, n, d;
          return null !==
            (d =
              null === (n = performance) ||
              void 0 === n ||
              null === (e = n.now) ||
              void 0 === e
                ? void 0
                : e.call(n)) && void 0 !== d
            ? d
            : Date.now() - ft;
        },
    formatByte = (e) => ("0" + (255 & e).toString(16)).slice(-2);
  function compareUint8Array(e, n) {
    if (void 0 === e && void 0 === n) return !0;
    if (typeof e != typeof n) return !1;
    if (((n = n), (e = e).byteLength !== n.byteLength)) return !1;
    for (let d = 0; d < e.byteLength; d++) if (e[d] !== n[d]) return !1;
    return !0;
  }
  function parseVersion(e) {
    const n = { version: e.toLowerCase() },
      d = e
        .toLowerCase()
        .split(".")
        .filter((e) => !!e);
    if (d.length <= 1 && !/^\d+$/.test(d[0])) return n;
    const p = parseInt(d[0], 10),
      h = parseInt(d[1], 10),
      y = parseInt(d[2], 10);
    return (
      Number.isNaN(p) ||
        ((n.major = p),
        Number.isNaN(h) || (n.minor = h),
        Number.isNaN(y) || (n.patch = y)),
      n
    );
  }
  function applyRules(e, n, d) {
    const { userAgent: p } = null != n ? n : {};
    if ("string" != typeof p || "" === p.trim()) return d;
    for (let h of e) {
      const e = h.slice(0, -1),
        y = h[h.length - 1];
      let _ = null;
      for (let h of e)
        if (((_ = p.match(h)), null !== _)) {
          Object.assign(d, y(_, n, d));
          break;
        }
      if (null !== _) break;
    }
    return d;
  }
  function _define_property$1U(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$T(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1U(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$B(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  var vt, gt;
  const bt = {
    browser: [
      [
        /^(itunes|music|tv)\/([\w\.]+)\s/i,
        (e) =>
          _object_spread_props$B(
            _object_spread$T(
              {
                name: "webview",
                variant: e[1]
                  .trim()
                  .toLowerCase()
                  .replace(/(music|tv)/i, "$1.app"),
              },
              parseVersion(e[2])
            ),
            { mobile: !1 }
          ),
      ],
      [
        /(?:(?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i,
        (e) =>
          _object_spread$T(
            { name: "webview", variant: "facebook", mobile: !0 },
            parseVersion(e[1])
          ),
      ],
      [
        /(instagram|snapchat)[\/ ]([-\w\.]+)/i,
        (e) =>
          _object_spread$T(
            { name: "webview", variant: e[1].trim().toLowerCase(), mobile: !0 },
            parseVersion(e[2])
          ),
      ],
      [
        /musical_ly(?:.+app_?version\/|_)([\w\.]+)/i,
        (e) =>
          _object_spread$T(
            { name: "webview", variant: "tiktok", mobile: !0 },
            parseVersion(e[1])
          ),
      ],
      [/twitter/i, () => ({ name: "webview", variant: "twitter", mobile: !0 })],
      [
        / wv\).+?(?:version|chrome)\/([\w\.]+)/i,
        (e) =>
          _object_spread$T({ name: "webview", mobile: !0 }, parseVersion(e[1])),
      ],
      [
        /electron\/([\w\.]+) safari/i,
        (e) =>
          _object_spread$T(
            { name: "electron", mobile: !1 },
            parseVersion(e[1])
          ),
      ],
      [
        /tesla\/(.*?(20\d\d\.([-\w\.])+))/i,
        (e) =>
          _object_spread_props$B(
            _object_spread$T(
              { name: "other", variant: "tesla", mobile: !1 },
              parseVersion(e[2])
            ),
            { version: e[1] }
          ),
      ],
      [
        /(samsung|huawei)browser\/([-\w\.]+)/i,
        (e) =>
          _object_spread$T(
            {
              name: "other",
              variant: e[1]
                .trim()
                .toLowerCase()
                .replace(/browser/i, ""),
              mobile: !0,
            },
            parseVersion(e[2])
          ),
      ],
      [
        /yabrowser\/([-\w\.]+)/i,
        (e) =>
          _object_spread$T(
            { name: "other", variant: "yandex", mobile: !1 },
            parseVersion(e[1])
          ),
      ],
      [
        /(brave|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,
        (e, { userAgent: n }) =>
          _object_spread$T(
            {
              name: "other",
              variant: e[1].trim().toLowerCase(),
              mobile: /mobile/i.test(n),
            },
            parseVersion(e[2].replace(/\-/g, "."))
          ),
      ],
      [
        /edg(e|ios|a)?\/([\w\.]+)/i,
        (e) =>
          _object_spread$T(
            {
              name: "edge",
              mobile: /(edgios|edga)/i.test(
                null !== (vt = e[1]) && void 0 !== vt ? vt : ""
              ),
            },
            parseVersion(e[2])
          ),
      ],
      [
        /trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i,
        (e) => _object_spread$T({ name: "ie", mobile: !1 }, parseVersion(e[1])),
      ],
      [
        /opr\/([\w\.]+)/i,
        /opera mini\/([-\w\.]+)/i,
        /opera [mobiletab]{3,6}\b.+version\/([-\w\.]+)/i,
        /opera(?:.+version\/|[\/ ]+)([\w\.]+)/i,
        (e) =>
          _object_spread$T(
            { name: "opera", mobile: /mobile/i.test(e[0]) },
            parseVersion(e[1])
          ),
      ],
      [
        /headlesschrome(?:\/([\w\.]+)| )/i,
        (e) =>
          _object_spread$T(
            { name: "chrome", variant: "headless", mobile: !1 },
            parseVersion(e[1])
          ),
      ],
      [
        /\b(?:crmo|crios)\/([\w\.]+)/i,
        (e) =>
          _object_spread$T({ name: "chrome", mobile: !0 }, parseVersion(e[1])),
      ],
      [
        /chrome(?: browser)?\/v?([\w\.]+)( mobile)?/i,
        (e) =>
          _object_spread$T(
            {
              name: "chrome",
              mobile: /mobile/i.test(
                null !== (gt = e[2]) && void 0 !== gt ? gt : ""
              ),
            },
            parseVersion(e[1])
          ),
      ],
      [
        /\bfocus\/([\w\.]+)/i,
        (e) =>
          _object_spread$T(
            { name: "firefox", variant: "focus", mobile: !0 },
            parseVersion(e[1])
          ),
      ],
      [
        /fxios\/([\w\.-]+)/i,
        /(?:mobile|tablet);.*(?:firefox)\/([\w\.-]+)/i,
        (e) =>
          _object_spread$T({ name: "firefox", mobile: !0 }, parseVersion(e[1])),
      ],
      [
        /(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,
        (e) =>
          _object_spread$T(
            { name: "firefox", variant: e[1].trim().toLowerCase(), mobile: !1 },
            parseVersion(e[2])
          ),
      ],
      [
        /(?:firefox)\/([\w\.]+)/i,
        /(?:mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,
        (e) =>
          _object_spread$T({ name: "firefox", mobile: !1 }, parseVersion(e[1])),
      ],
      [
        /version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i,
        /version\/([\w\.\,]+) .*(safari)/i,
        /webkit.+?(?:mobile ?safari|safari)(?:\/([\w\.]+))/i,
        (e) =>
          _object_spread$T(
            { name: "safari", mobile: /mobile/i.test(e[0]) },
            parseVersion(e[1])
          ),
      ],
    ],
    engine: [
      [
        /webkit\/(?:537\.36).+chrome\/(?!27)([\w\.]+)/i,
        (e) => _object_spread$T({ name: "blink" }, parseVersion(e[1])),
      ],
      [
        /windows.+ edge\/([\w\.]+)/i,
        (e) => _object_spread$T({ name: "blink" }, parseVersion(e[1])),
      ],
      [
        /presto\/([\w\.]+)/i,
        (e) => _object_spread$T({ name: "presto" }, parseVersion(e[2])),
      ],
      [
        /trident\/([\w\.]+)/i,
        (e) => _object_spread$T({ name: "trident" }, parseVersion(e[1])),
      ],
      [
        /gecko\/([\w\.]+)/i,
        (e) => _object_spread$T({ name: "gecko" }, parseVersion(e[1])),
      ],
      [
        /(khtml|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,
        (e) => _object_spread$T({ name: "other" }, parseVersion(e[2])),
      ],
      [
        /webkit\/([\w\.]+)/i,
        (e) => _object_spread$T({ name: "webkit" }, parseVersion(e[1])),
      ],
    ],
    os: [
      [
        /microsoft windows (vista|xp)/i,
        /windows nt 6\.2; (arm)/i,
        /windows (?:phone(?: os)?|mobile)[\/ ]?([\d\.\w ]*)/i,
        /windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,
        /(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i,
        (e) => _object_spread$T({ name: "windows" }, parseVersion(e[1])),
      ],
      [
        /ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,
        /(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,
        (e) =>
          _object_spread$T(
            { name: "ios" },
            parseVersion(e[1].replace(/_/g, "."))
          ),
      ],
      [
        /mac(?:intosh;?)? os x ?([\d\._]+)/i,
        (e) =>
          _object_spread$T(
            { name: "macos" },
            parseVersion(e[1].replace(/_/g, "."))
          ),
      ],
      [
        /cros [\w]+(?:\)| ([\w\.]+)\b)/i,
        (e) => _object_spread$T({ name: "chromeos" }, parseVersion(e[1])),
      ],
      [
        /(?:android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,
        /droid ([\w\.]+|[\d+])\b.+(android[- ]x86|harmonyos)/i,
        (e) => _object_spread$T({ name: "android" }, parseVersion(e[1])),
      ],
      [/linux/i, () => ({ name: "linux" })],
    ],
  };
  function parseUserAgent(e, n) {
    var d, p, h;
    var y;
    return (function (e, n) {
      let d = e;
      for (let p of n) d = p(d);
      return d;
    })(
      {
        navigator: e,
        ua:
          null !==
            (h = null === (d = e) || void 0 === d ? void 0 : d.userAgent) &&
          void 0 !== h
            ? h
            : "",
        extensions: [],
        browser: applyRules(bt.browser, e, { name: "unknown", mobile: !1 }),
        engine: applyRules(bt.engine, e, { name: "unknown" }),
        os: applyRules(bt.os, e, { name: "unknown" }),
      },
      null !== (y = null === (p = n) || void 0 === p ? void 0 : p.extensions) &&
        void 0 !== y
        ? y
        : []
    );
  }
  function _define_property$1T(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$S(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1T(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$A(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function flagsExtension(e) {
    let n = e.os.name;
    const d = "android" === e.os.name;
    let p = "macos" === e.os.name,
      h = "ios" === e.os.name;
    var y;
    const _ =
      "ipados" === n ||
      (h && /ipad/i.test(e.ua)) ||
      (p &&
        (null !== (y = e.navigator.maxTouchPoints) && void 0 !== y ? y : 0) >=
          2);
    _ && ((n = "ipados"), (h = !1), (p = !1));
    const m = _object_spread_props$A(_object_spread$S({}, e.browser), {
        isUnknown: "unknown" === e.browser.name,
        isSafari: "safari" === e.browser.name,
        isChrome: "chrome" === e.browser.name,
        isFirefox: "firefox" === e.browser.name,
        isEdge: "edge" === e.browser.name,
        isWebView: "webview" === e.browser.name,
        isOther: "other" === e.browser.name,
        isMobile: e.browser.mobile || h || _ || d || !1,
      }),
      g = _object_spread_props$A(_object_spread$S({}, e.engine), {
        isUnknown: "unknown" === e.engine.name,
        isWebKit: "webkit" === e.engine.name,
        isBlink: "blink" === e.engine.name,
        isGecko: "gecko" === e.engine.name,
      }),
      b = _object_spread_props$A(_object_spread$S({}, e.os), {
        name: n,
        isUnknown: "unknown" === e.os.name,
        isLinux: "linux" === e.os.name,
        isWindows: "windows" === e.os.name,
        isMacOS: p,
        isAndroid: d,
        isIOS: h,
        isIPadOS: _,
      });
    return _object_spread_props$A(_object_spread$S({}, e), {
      extensions: [...e.extensions, "flags"],
      browser: m,
      os: b,
      engine: g,
    });
  }
  function asyncGeneratorStep$1n(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1n(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1n(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1n(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function isBrowserEnvironment() {
    return _isBrowserEnvironment.apply(this, arguments);
  }
  function _isBrowserEnvironment() {
    return (_isBrowserEnvironment = _async_to_generator$1n(function* () {
      var e;
      return (
        void 0 !==
        (null === (e = window) || void 0 === e ? void 0 : e.navigator)
      );
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$1m(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1m(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1m(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1m(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function isNodeEnvironment() {
    return _isNodeEnvironment.apply(this, arguments);
  }
  function _isNodeEnvironment() {
    return (_isNodeEnvironment = _async_to_generator$1m(function* () {
      var e;
      return (
        void 0 !==
        (null === (e = globalThis) || void 0 === e ? void 0 : e.process)
      );
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$1l(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1l(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1l(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1l(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  const Pt = {
    playready: ["com.microsoft.playready", "com.youtube.playready"],
    widevine: ["com.widevine.alpha"],
    clearkey: ["org.w3.clearkey"],
    fairplay: ["com.apple.fps", "com.apple.fairplay"],
  };
  function detectEMESupport() {
    return _detectEMESupport.apply(this, arguments);
  }
  function _detectEMESupport() {
    return (_detectEMESupport = _async_to_generator$1l(function* () {
      var e, n, d, p;
      return (
        void 0 !==
          (null === (n = window) ||
          void 0 === n ||
          null === (e = n.navigator) ||
          void 0 === e
            ? void 0
            : e.requestMediaKeySystemAccess) &&
        void 0 !==
          (null === (d = window) || void 0 === d ? void 0 : d.MediaKeys) &&
        void 0 !==
          (null === (p = window) || void 0 === p
            ? void 0
            : p.MediaKeySystemAccess)
      );
    })).apply(this, arguments);
  }
  function detectEMEKeySystems() {
    return _detectEMEKeySystems.apply(this, arguments);
  }
  function _detectEMEKeySystems() {
    return (_detectEMEKeySystems = _async_to_generator$1l(function* () {
      var e, n;
      if (yield isNodeEnvironment()) return [];
      const d = [],
        p = window;
      if (
        "function" ==
        typeof (null === (e = p.WebKitMediaKeys) || void 0 === e
          ? void 0
          : e.isTypeSupported)
      )
        for (let _ of Pt.fairplay) {
          var h, y;
          if (
            (null === (h = p.WebKitMediaKeys) || void 0 === h
              ? void 0
              : h.isTypeSupported(_, "video/mp4")) ||
            (null === (y = p.WebKitMediaKeys) || void 0 === y
              ? void 0
              : y.isTypeSupported(_ + ".1_0", "video/mp4"))
          )
            return d.push("fairplay"), d;
        }
      if (
        "function" ==
        typeof (null === (n = p.MSMediaKeys) || void 0 === n
          ? void 0
          : n.isTypeSupported)
      )
        for (let _ of Pt.playready)
          p.MSMediaKeys.isTypeSupported(_, "video/mp4") && d.push("playready");
      if (yield detectEMESupport()) {
        const e = [
          {
            initDataTypes: ["keyids", "cenc"],
            distinctiveIdentifier: "optional",
            persistentState: "required",
            videoCapabilities: [
              {
                contentType: 'video/mp4;codecs="avc1.42E01E"',
                robustness: "SW_SECURE_CRYPTO",
              },
            ],
            audioCapabilities: [
              { contentType: 'audio/mp4;codecs="mp4a.40.2"' },
            ],
          },
        ];
        for (let [n, p] of Object.entries(Pt))
          for (let h of p)
            try {
              yield navigator.requestMediaKeySystemAccess(h, e), d.push(n);
              break;
            } catch (Yt) {}
      }
      return d;
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$1k(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1k(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1k(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1k(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function detectES2015() {
    return _detectES2015.apply(this, arguments);
  }
  function _detectES2015() {
    return (_detectES2015 = _async_to_generator$1k(function* () {
      try {
        new Function(
          '"use strict"; class Test {}; const identity = (x) => x;'
        )();
      } catch (Yt) {
        return !1;
      }
      return "undefined" != typeof Symbol;
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$1j(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1j(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1j(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1j(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function detectMSESupport() {
    return _detectMSESupport.apply(this, arguments);
  }
  function _detectMSESupport() {
    return (_detectMSESupport = _async_to_generator$1j(function* () {
      var e, n;
      return (
        void 0 !==
          (null === (e = window) || void 0 === e ? void 0 : e.MediaSource) &&
        void 0 !==
          (null === (n = window) || void 0 === n ? void 0 : n.SourceBuffer)
      );
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$1i(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1i(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1i(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1i(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function detectPictureInPictureSupport() {
    return _detectPictureInPictureSupport.apply(this, arguments);
  }
  function _detectPictureInPictureSupport() {
    return (_detectPictureInPictureSupport = _async_to_generator$1i(
      function* () {
        var e, n, d;
        if (yield isNodeEnvironment()) return !1;
        const p = document.createElement("video");
        return (
          (void 0 !==
            (null === (e = p) || void 0 === e
              ? void 0
              : e.webkitSupportsPresentationMode) &&
            "function" ==
              typeof (null === (n = p) || void 0 === n
                ? void 0
                : n.webkitSetPresentationMode)) ||
          void 0 !==
            (null === (d = document) || void 0 === d
              ? void 0
              : d.pictureInPictureEnabled)
        );
      }
    )).apply(this, arguments);
  }
  function asyncGeneratorStep$1h(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1S(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class RuntimeEnvironment {
    get isConfigured() {
      return this.configured;
    }
    get userAgent() {
      return this.config.userAgent;
    }
    get ua() {
      return this.userAgent.ua;
    }
    get isNodeEnvironment() {
      return this.config.isNodeEnvironment;
    }
    get isBrowserEnvironment() {
      return this.config.isBrowserEnvironment;
    }
    get isPictureInPictureSupported() {
      return this.config.isPictureInPictureSupported;
    }
    get isES2015Supported() {
      return this.config.isES2015Supported;
    }
    get isMSESupported() {
      return this.config.isMSESupported;
    }
    get isEMESupported() {
      return this.config.isEMESupported;
    }
    get availableKeySystems() {
      return this.config.availableKeySystems;
    }
    get browser() {
      return this.userAgent.browser;
    }
    get engine() {
      return this.userAgent.engine;
    }
    get os() {
      return this.userAgent.os;
    }
    get isMobile() {
      return this.browser.isMobile;
    }
    static detect() {
      var e,
        n = this;
      return ((e = function* () {
        var e, d;
        const p =
          null !==
            (d =
              null === (e = window) || void 0 === e ? void 0 : e.navigator) &&
          void 0 !== d
            ? d
            : { userAgent: "", maxTouchPoints: 0 };
        return new n({
          userAgent: yield parseUserAgent(p, { extensions: [flagsExtension] }),
          isNodeEnvironment: yield isNodeEnvironment(),
          isBrowserEnvironment: yield isBrowserEnvironment(),
          isPictureInPictureSupported: yield detectPictureInPictureSupport(),
          isES2015Supported: yield detectES2015(),
          isMSESupported: yield detectMSESupport(),
          isEMESupported: yield detectEMESupport(),
          availableKeySystems: yield detectEMEKeySystems(),
        });
      }),
      function () {
        var n = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = e.apply(n, d);
          function _next(e) {
            asyncGeneratorStep$1h(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$1h(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    configure(e) {
      for (const [n, d] of Object.entries(e)) this.config[n] = d;
      this.configured = !0;
    }
    constructor(e) {
      _define_property$1S(this, "configured", !1),
        _define_property$1S(this, "config", void 0),
        (this.config = e),
        (this.configured = !0);
    }
  }
  const AsyncDebounce =
      (e = 100, n) =>
      (d, p, h) => {
        const y = h.value,
          _ = asyncDebounce(y, e, n);
        h.value = _;
      },
    asyncDebounce = (e, n = 250, d = { isImmediate: !1 }) => {
      let p, h;
      function fulfill(e) {
        return null == e ? void 0 : e.resolve(d.cancelledValue);
      }
      const clearLastPromise = () => {
          p &&
            (p.resolved ||
              (fulfill(p), p.timeoutId && clearTimeout(p.timeoutId)),
            (p = void 0));
        },
        invokeFn = (n, d, h, y) => {
          e.apply(n, y)
            .then((e) => {
              d(e), p && (p.resolved = !0);
            })
            .catch(h);
        };
      return d.isImmediate
        ? function (...e) {
            const d = Date.now(),
              y = this;
            return (
              h && d >= h && clearLastPromise(),
              (h = Date.now() + n),
              p
                ? fulfill(Promise)
                : new Promise((n, d) => {
                    (p = { resolve: n, reject: d }), invokeFn(y, n, d, e);
                  })
            );
          }
        : function (...e) {
            const d = this;
            return (
              p && clearLastPromise(),
              new Promise(function (h, y) {
                const _ = setTimeout(invokeFn.bind(void 0, d, h, y, e), n);
                p = { resolve: h, reject: y, timeoutId: _ };
              })
            );
          };
    };
  function deprecationWarning(e, n = {}) {
    var d;
    const p =
        null !== (d = n.message) && void 0 !== d
          ? d
          : e + " has been deprecated",
      h = [];
    n.since && h.push("since: " + n.since),
      n.until && h.push("until: " + n.until),
      console.warn(
        "Deprecation Warning: " + p + (h.length > 0 ? ` (${h.join(", ")})` : "")
      );
  }
  function asyncGeneratorStep$1g(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1g(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1g(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1g(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  const St = {},
    SerialAsync = (e) => {
      let n = Promise.resolve();
      return (d, p, h) => {
        const y = h.value;
        return (
          (h.value = _async_to_generator$1g(function* (...d) {
            return (
              e &&
                (n = ((e) => {
                  let n = St[e];
                  return n || ((n = Promise.resolve()), (St[e] = n)), n;
                })(e)),
              (n = n.catch(() => {}).then(() => y.apply(this, d))),
              e && (St[e] = n),
              n
            );
          })),
          h
        );
      };
    };
  var Tt, kt, Et;
  (e.PlaybackBitrate = void 0),
    ((Tt = e.PlaybackBitrate || (e.PlaybackBitrate = {}))[(Tt.STANDARD = 64)] =
      "STANDARD"),
    (Tt[(Tt.HIGH = 256)] = "HIGH"),
    (function (e) {
      (e.apiStorefrontChanged = "apiStorefrontChanged"),
        (e.hlsLevelUpdated = "hlsLevelUpdated"),
        (e.mediaContentComplete = "mediaContentComplete"),
        (e.playbackPause = "playbackPause"),
        (e.playbackPlay = "playbackPlay"),
        (e.playbackScrub = "playbackScrub"),
        (e.playbackSeek = "playbackSeek"),
        (e.playbackSkip = "playbackSkip"),
        (e.playbackStop = "playbackStop"),
        (e.lyricsPlay = "lyricsPlay"),
        (e.lyricsStop = "lyricsStop"),
        (e.playerActivate = "playerActivate"),
        (e.playerExit = "playerExit"),
        (e.queueModified = "queueModified"),
        (e.userActivityIntent = "userActivityIntent"),
        (e.applicationActivityIntent = "applicationActivityIntent"),
        (e.timedMetadata = "timedMetadata");
    })(kt || (kt = {})),
    (function (e) {
      (e[(e.ACCURATE = 0)] = "ACCURATE"), (e[(e.ROUND = 1)] = "ROUND");
    })(Et || (Et = {}));
  class TimingAccuracy {
    time(e = 0) {
      return 1 === this.mode ? Math.round(e) : e;
    }
    constructor(e = !1) {
      var n, d, p;
      (p = void 0),
        (d = "mode") in (n = this)
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p),
        (this.mode = e ? 0 : 1);
    }
  }
  const wt = {
    audioTrackAdded: "audioTrackAdded",
    audioTrackChanged: "audioTrackChanged",
    audioTrackRemoved: "audioTrackRemoved",
    bufferedProgressDidChange: "bufferedProgressDidChange",
    drmUnsupported: "drmUnsupported",
    forcedTextTrackChanged: "forcedTextTrackChanged",
    mediaCanPlay: "mediaCanPlay",
    mediaElementCreated: "mediaElementCreated",
    mediaPlaybackError: "mediaPlaybackError",
    nowPlayingItemDidChange: "nowPlayingItemDidChange",
    nowPlayingItemWillChange: "nowPlayingItemWillChange",
    metadataDidChange: "metadataDidChange",
    playbackBitrateDidChange: "playbackBitrateDidChange",
    playbackDurationDidChange: "playbackDurationDidChange",
    playbackProgressDidChange: "playbackProgressDidChange",
    playbackRateDidChange: "playbackRateDidChange",
    playbackStateDidChange: "playbackStateDidChange",
    playbackStateWillChange: "playbackStateWillChange",
    playbackTargetAvailableDidChange: "playbackTargetAvailableDidChange",
    playbackTargetIsWirelessDidChange: "playbackTargetIsWirelessDidChange",
    playbackTimeDidChange: "playbackTimeDidChange",
    playbackVolumeDidChange: "playbackVolumeDidChange",
    playerTypeDidChange: "playerTypeDidChange",
    presentationModeDidChange: "presentationModeDidChange",
    primaryPlayerDidChange: "primaryPlayerDidChange",
    textTrackAdded: "textTrackAdded",
    textTrackChanged: "textTrackChanged",
    textTrackRemoved: "textTrackRemoved",
    timedMetadataDidChange: "timedMetadataDidChange",
  };
  function _define_property$1Q(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class BitrateCalculator {
    get bitrate() {
      return this._bitrate;
    }
    set bitrate(e) {
      this._bitrate !== e &&
        ((this._bitrate = e),
        this._dispatcher.publish(wt.playbackBitrateDidChange, { bitrate: e }));
    }
    _calculateAverageDownlink() {
      return 0 === this._downlinkSamples.length
        ? 0
        : this._downlinkSamples.reduce((e, n) => e + n, 0) /
            this._downlinkSamples.length || 0;
    }
    _recalculateBitrate(n) {
      He.debug("_recalculateBitrate", n), this._downlinkSamples.push(n);
      this._calculateAverageDownlink() > e.PlaybackBitrate.STANDARD
        ? (He.debug("setting bitrate to", e.PlaybackBitrate.HIGH),
          (this.bitrate = e.PlaybackBitrate.HIGH))
        : (He.debug("setting bitrate to", e.PlaybackBitrate.STANDARD),
          (this.bitrate = e.PlaybackBitrate.STANDARD));
    }
    constructor(n, d = e.PlaybackBitrate.STANDARD) {
      var p, h, y;
      _define_property$1Q(this, "_bitrate", void 0),
        _define_property$1Q(this, "_dispatcher", void 0),
        _define_property$1Q(this, "_downlinkSamples", []),
        (this._bitrate = d),
        (this._dispatcher = n),
        void 0 !==
          (null === (y = window) ||
          void 0 === y ||
          null === (h = y.navigator) ||
          void 0 === h ||
          null === (p = h.connection) ||
          void 0 === p
            ? void 0
            : p.downlink) &&
          this._recalculateBitrate(
            100 * (window.navigator.connection.downlink || 0)
          );
    }
  }
  var Ot, $t, It, Rt, At, Ct, Mt;
  !(function (e) {
    (e.MUSICKIT = "music_kit-integration"),
      (e.OTHER = "other"),
      (e.MINI = "mini"),
      (e.SONG = "song"),
      (e.ALBUM = "album"),
      (e.ALBUM_CLASSICAL = "album-classical"),
      (e.ARTIST = "artist"),
      (e.COMPILATION = "compilation"),
      (e.COMPILATION_CLASSICAL = "compilation-classical"),
      (e.PLAYLIST = "playlist"),
      (e.PLAYLIST_CLASSICAL = "playlist-classical"),
      (e.RADIO = "radio"),
      (e.SEARCH = "search"),
      (e.STATION = "station");
  })(Ot || (Ot = {})),
    (function (e) {
      (e[(e.UNKNOWN = 0)] = "UNKNOWN"),
        (e[(e.RADIO = 1)] = "RADIO"),
        (e[(e.PLAYLIST = 2)] = "PLAYLIST"),
        (e[(e.ALBUM = 3)] = "ALBUM"),
        (e[(e.ARTIST = 4)] = "ARTIST");
    })($t || ($t = {})),
    (e.PlayActivityEndReasonType = void 0),
    ((It = e.PlayActivityEndReasonType || (e.PlayActivityEndReasonType = {}))[
      (It.NOT_APPLICABLE = 0)
    ] = "NOT_APPLICABLE"),
    (It[(It.OTHER = 1)] = "OTHER"),
    (It[(It.TRACK_SKIPPED_FORWARDS = 2)] = "TRACK_SKIPPED_FORWARDS"),
    (It[(It.PLAYBACK_MANUALLY_PAUSED = 3)] = "PLAYBACK_MANUALLY_PAUSED"),
    (It[(It.PLAYBACK_SUSPENDED = 4)] = "PLAYBACK_SUSPENDED"),
    (It[(It.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM = 5)] =
      "MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM"),
    (It[(It.PLAYBACK_PAUSED_DUE_TO_INACTIVITY = 6)] =
      "PLAYBACK_PAUSED_DUE_TO_INACTIVITY"),
    (It[(It.NATURAL_END_OF_TRACK = 7)] = "NATURAL_END_OF_TRACK"),
    (It[(It.PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT = 8)] =
      "PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT"),
    (It[(It.TRACK_BANNED = 9)] = "TRACK_BANNED"),
    (It[(It.FAILED_TO_LOAD = 10)] = "FAILED_TO_LOAD"),
    (It[(It.PAUSED_ON_TIMEOUT = 11)] = "PAUSED_ON_TIMEOUT"),
    (It[(It.SCRUB_BEGIN = 12)] = "SCRUB_BEGIN"),
    (It[(It.SCRUB_END = 13)] = "SCRUB_END"),
    (It[(It.TRACK_SKIPPED_BACKWARDS = 14)] = "TRACK_SKIPPED_BACKWARDS"),
    (It[(It.NOT_SUPPORTED_BY_CLIENT = 15)] = "NOT_SUPPORTED_BY_CLIENT"),
    (It[(It.QUICK_PLAY = 16)] = "QUICK_PLAY"),
    (It[(It.EXITED_APPLICATION = 17)] = "EXITED_APPLICATION"),
    (function (e) {
      (e[(e.Manual = 0)] = "Manual"),
        (e[(e.Interval = 1)] = "Interval"),
        (e[(e.SkipIntro = 2)] = "SkipIntro");
    })(Rt || (Rt = {})),
    (function (e) {
      (e[(e.UNKNOWN = 0)] = "UNKNOWN"),
        (e[(e.NO_RIGHTS = 1)] = "NO_RIGHTS"),
        (e[(e.PURCHASED = 2)] = "PURCHASED"),
        (e[(e.UPLOADED = 3)] = "UPLOADED"),
        (e[(e.MATCHED = 4)] = "MATCHED"),
        (e[(e.ADDED = 5)] = "ADDED"),
        (e[(e.SUBSCRIBED = 6)] = "SUBSCRIBED"),
        (e[(e.NOT_SUPPORTED = 7)] = "NOT_SUPPORTED");
    })(At || (At = {})),
    (function (e) {
      (e[(e.NO_SELECTION_PLAY = 0)] = "NO_SELECTION_PLAY"),
        (e[(e.RESUME_LAST_PLAYED_SONG = 1)] = "RESUME_LAST_PLAYED_SONG"),
        (e[(e.RESUME_CURRENT_DEVICE_POSITION = 2)] =
          "RESUME_CURRENT_DEVICE_POSITION");
    })(Ct || (Ct = {})),
    (function (e) {
      (e[(e.NOT_APPLICABLE = 0)] = "NOT_APPLICABLE"),
        (e[(e.SIMILARITIES = 1)] = "SIMILARITIES"),
        (e[(e.ESSENTIALS = 2)] = "ESSENTIALS"),
        (e[(e.USER_LIBRARY = 3)] = "USER_LIBRARY"),
        (e[(e.ALGO_HEATSEEKER = 4)] = "ALGO_HEATSEEKER"),
        (e[(e.SEED_TRACK = 5)] = "SEED_TRACK"),
        (e[(e.GN_1M_TEMPORARY = 6)] = "GN_1M_TEMPORARY"),
        (e[(e.VECTOR = 8)] = "VECTOR"),
        (e[(e.ARTIST_SIMILARITIES = 9)] = "ARTIST_SIMILARITIES"),
        (e[(e.STORY_ALBUM_LISTENERS_ALSO_BOUGHT = 10)] =
          "STORY_ALBUM_LISTENERS_ALSO_BOUGHT"),
        (e[(e.STORY_ALBUM_SALES_LEADER = 11)] = "STORY_ALBUM_SALES_LEADER"),
        (e[(e.STORY_BILLBOARD = 12)] = "STORY_BILLBOARD"),
        (e[(e.STORY_COMPLETE_MY_ALBUM = 13)] = "STORY_COMPLETE_MY_ALBUM"),
        (e[(e.STORY_CRITICAL_PICK = 14)] = "STORY_CRITICAL_PICK"),
        (e[(e.STORY_ITUNES_ESSENTIAL = 15)] = "STORY_ITUNES_ESSENTIAL"),
        (e[(e.STORY_HEATSEEKER = 16)] = "STORY_HEATSEEKER"),
        (e[(e.STORY_IDENTITY = 17)] = "STORY_IDENTITY"),
        (e[(e.STORY_POWER_SONG = 18)] = "STORY_POWER_SONG"),
        (e[(e.STORY_SONG_SALES_LEADER = 20)] = "STORY_SONG_SALES_LEADER"),
        (e[(e.GENRE_SIMILARITIES = 21)] = "GENRE_SIMILARITIES"),
        (e[(e.STORY_IMIX = 22)] = "STORY_IMIX"),
        (e[(e.STORY_OTHER_MIX = 23)] = "STORY_OTHER_MIX"),
        (e[(e.EDITORIAL = 24)] = "EDITORIAL"),
        (e[(e.TOP_SONGS = 25)] = "TOP_SONGS"),
        (e[(e.SUBFORMAT_SONGS = 26)] = "SUBFORMAT_SONGS"),
        (e[(e.CRITICAL_PICKS = 27)] = "CRITICAL_PICKS"),
        (e[(e.US_ARTIST_SIMS = 28)] = "US_ARTIST_SIMS"),
        (e[(e.HEAVY_ROTATION = 29)] = "HEAVY_ROTATION"),
        (e[(e.STORY_FORMAT_STATION_HEAVY_ROTATION = 30)] =
          "STORY_FORMAT_STATION_HEAVY_ROTATION"),
        (e[(e.ARTIST_BASED_CORE_SIMILAR_ARTISTS = 31)] =
          "ARTIST_BASED_CORE_SIMILAR_ARTISTS"),
        (e[(e.ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS = 32)] =
          "ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS"),
        (e[(e.ARTIST_BASED_DISCOVERIES = 33)] = "ARTIST_BASED_DISCOVERIES"),
        (e[(e.ARTIST_BASED_HOT_SONGS = 34)] = "ARTIST_BASED_HOT_SONGS"),
        (e[(e.ARTIST_BASED_SEED_ARTIST = 35)] = "ARTIST_BASED_SEED_ARTIST"),
        (e[(e.ARTIST_BASED_COMPOSER = 36)] = "ARTIST_BASED_COMPOSER"),
        (e[(e.EDITORIAL_STATION_INTRO = 37)] = "EDITORIAL_STATION_INTRO"),
        (e[(e.EDITORIAL_RELATIVE_REPEAT = 38)] = "EDITORIAL_RELATIVE_REPEAT"),
        (e[(e.EDITORIAL_ABSOLUTE_REPEAT = 39)] = "EDITORIAL_ABSOLUTE_REPEAT"),
        (e[(e.EDITORIAL_SCHEDULED = 40)] = "EDITORIAL_SCHEDULED"),
        (e[(e.EDITORIAL_SUGGESTED_ARTIST = 41)] = "EDITORIAL_SUGGESTED_ARTIST"),
        (e[(e.FOR_YOU_FAMILIAR = 42)] = "FOR_YOU_FAMILIAR"),
        (e[(e.FOR_YOU_RECOMMENDED = 43)] = "FOR_YOU_RECOMMENDED"),
        (e[(e.FOR_YOU_FAVORITE_ARTIST = 44)] = "FOR_YOU_FAVORITE_ARTIST"),
        (e[(e.FOR_YOU_RECOMMENDED_ARTIST = 45)] = "FOR_YOU_RECOMMENDED_ARTIST"),
        (e[(e.EDITORIAL_POSITIONAL = 46)] = "EDITORIAL_POSITIONAL"),
        (e[(e.SIMILAR_SONGS = 47)] = "SIMILAR_SONGS"),
        (e[(e.SONG_ATTRIBUTE_FAVORITE_ARTIST = 48)] =
          "SONG_ATTRIBUTE_FAVORITE_ARTIST"),
        (e[(e.SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED = 49)] =
          "SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED"),
        (e[(e.SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL = 50)] =
          "SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL"),
        (e[(e.SONG_ATTRIBUTE_RECOMMENDED = 51)] = "SONG_ATTRIBUTE_RECOMMENDED"),
        (e[(e.SONG_ATTRIBUTE_RECOMMENDED_DERIVED = 52)] =
          "SONG_ATTRIBUTE_RECOMMENDED_DERIVED"),
        (e[(e.SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL = 53)] =
          "SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL"),
        (e[(e.SONG_ATTRIBUTE_NON_PERSONALIZED = 54)] =
          "SONG_ATTRIBUTE_NON_PERSONALIZED"),
        (e[(e.SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED = 55)] =
          "SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED"),
        (e[(e.SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL = 56)] =
          "SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL"),
        (e[(e.PERSONAL_STATION = 57)] = "PERSONAL_STATION"),
        (e[(e.PERSONAL_STATION_FAVORITE_ARTIST = 58)] =
          "PERSONAL_STATION_FAVORITE_ARTIST"),
        (e[(e.PERSONAL_STATION_RECOMMENDED = 59)] =
          "PERSONAL_STATION_RECOMMENDED"),
        (e[(e.NEW_MUSIC_STATION = 60)] = "NEW_MUSIC_STATION"),
        (e[(e.NEW_MUSIC_STATION_FAVORITE_ARTIST = 61)] =
          "NEW_MUSIC_STATION_FAVORITE_ARTIST"),
        (e[(e.NEW_MUSIC_STATION_RECOMMENDED = 62)] =
          "NEW_MUSIC_STATION_RECOMMENDED");
    })(Mt || (Mt = {}));
  var Dt, jt, xt, Lt, Nt, Ut, Bt, Ft, Kt, Gt, Vt, qt, Ht, Wt;
  /*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
  function t(e, n) {
    var d = "function" == typeof Symbol && e[Symbol.iterator];
    if (!d) return e;
    var p,
      h,
      y = d.call(e),
      _ = [];
    try {
      for (; (void 0 === n || n-- > 0) && !(p = y.next()).done; )
        _.push(p.value);
    } catch (e) {
      h = { error: e };
    } finally {
      try {
        p && !p.done && (d = y.return) && d.call(y);
      } finally {
        if (h) throw h.error;
      }
    }
    return _;
  }
  !(function (e) {
    (e[(e.UNKNOWN_FORMAT = 0)] = "UNKNOWN_FORMAT"),
      (e[(e.STEREO = 1)] = "STEREO"),
      (e[(e.SPATIAL = 2)] = "SPATIAL"),
      (e[(e.PREFERENCE_FORMAT_UNSUPPORTED = 3)] =
        "PREFERENCE_FORMAT_UNSUPPORTED");
  })(Dt || (Dt = {})),
    (function (e) {
      (e[(e.UNKNOWN_QUALITY = 0)] = "UNKNOWN_QUALITY"),
        (e[(e.HIGH_EFFICIENCY = 1)] = "HIGH_EFFICIENCY"),
        (e[(e.HIGH_QUALITY = 2)] = "HIGH_QUALITY"),
        (e[(e.LOSSLESS = 3)] = "LOSSLESS"),
        (e[(e.HIGH_RESOLUTION_LOSSLESS = 4)] = "HIGH_RESOLUTION_LOSSLESS"),
        (e[(e.PREFERENCE_QUALITY_UNSUPPORTED = 5)] =
          "PREFERENCE_QUALITY_UNSUPPORTED");
    })(jt || (jt = {})),
    (function (e) {
      (e[(e.UNSPECIFIED = 0)] = "UNSPECIFIED"),
        (e[(e.STATIC = 1)] = "STATIC"),
        (e[(e.LINE_BY_LINE = 2)] = "LINE_BY_LINE"),
        (e[(e.WORD_BY_WORD = 3)] = "WORD_BY_WORD");
    })(xt || (xt = {})),
    (function (e) {
      (e[(e.REPEAT_UNKNOWN = 0)] = "REPEAT_UNKNOWN"),
        (e[(e.REPEAT_OFF = 1)] = "REPEAT_OFF"),
        (e[(e.REPEAT_ONE = 2)] = "REPEAT_ONE"),
        (e[(e.REPEAT_ALL = 3)] = "REPEAT_ALL");
    })(Lt || (Lt = {})),
    (function (e) {
      (e[(e.SHUFFLE_UNKNOWN = 0)] = "SHUFFLE_UNKNOWN"),
        (e[(e.SHUFFLE_OFF = 1)] = "SHUFFLE_OFF"),
        (e[(e.SHUFFLE_ON = 2)] = "SHUFFLE_ON");
    })(Nt || (Nt = {})),
    (function (e) {
      (e[(e.AUTO_UNKNOWN = 0)] = "AUTO_UNKNOWN"),
        (e[(e.AUTO_OFF = 1)] = "AUTO_OFF"),
        (e[(e.AUTO_ON = 2)] = "AUTO_ON"),
        (e[(e.AUTO_ON_CONTENT_UNSUPPORTED = 3)] =
          "AUTO_ON_CONTENT_UNSUPPORTED");
    })(Ut || (Ut = {})),
    (function (e) {
      (e[(e.NOT_SPECIFIED = 0)] = "NOT_SPECIFIED"),
        (e[(e.CONTAINER_CHANGED = 1)] = "CONTAINER_CHANGED");
    })(Bt || (Bt = {})),
    (function (e) {
      (e[(e.PLAY_END = 0)] = "PLAY_END"),
        (e[(e.PLAY_START = 1)] = "PLAY_START"),
        (e[(e.LYRIC_DISPLAY = 2)] = "LYRIC_DISPLAY");
    })(Ft || (Ft = {})),
    (function (e) {
      (e[(e.INVALID = 0)] = "INVALID"),
        (e[(e.ITUNES_STORE_CONTENT = 1)] = "ITUNES_STORE_CONTENT"),
        (e[(e.NON_SONG_CLIP = 2)] = "NON_SONG_CLIP"),
        (e[(e.AD = 3)] = "AD"),
        (e[(e.STREAM = 4)] = "STREAM"),
        (e[(e.AUDIO_AD = 5)] = "AUDIO_AD"),
        (e[(e.VIDEO_AD = 6)] = "VIDEO_AD"),
        (e[(e.TIMED_METADATA_PING = 7)] = "TIMED_METADATA_PING"),
        (e[(e.ARTIST_UPLOADED_CONTENT = 8)] = "ARTIST_UPLOADED_CONTENT"),
        (e[(e.AGGREGATE_NON_CATALOG_PLAY_TIME = 9)] =
          "AGGREGATE_NON_CATALOG_PLAY_TIME"),
        (e[(e.ORIGINAL_CONTENT_MOVIES = 10)] = "ORIGINAL_CONTENT_MOVIES"),
        (e[(e.ORIGINAL_CONTENT_SHOWS = 11)] = "ORIGINAL_CONTENT_SHOWS");
    })(Kt || (Kt = {})),
    (function (e) {
      (e[(e.AUDIO = 0)] = "AUDIO"), (e[(e.VIDEO = 1)] = "VIDEO");
    })(Gt || (Gt = {})),
    (function (e) {
      (e[(e.AUTO = 0)] = "AUTO"), (e[(e.MANUAL = 1)] = "MANUAL");
    })(Vt || (Vt = {})),
    (function (e) {
      (e[(e.ORIGINATING_DEVICE = 0)] = "ORIGINATING_DEVICE"),
        (e[(e.PAIRED_WATCH = 1)] = "PAIRED_WATCH"),
        (e[(e.SONOS = 2)] = "SONOS"),
        (e[(e.CAR_PLAY = 3)] = "CAR_PLAY"),
        (e[(e.WEB_AUC = 4)] = "WEB_AUC"),
        (e[(e.TWITTER_AUC = 5)] = "TWITTER_AUC"),
        (e[(e.MUSIC_SDK = 6)] = "MUSIC_SDK"),
        (e[(e.ATV_REMOTE = 7)] = "ATV_REMOTE"),
        (e[(e.WEBPLAYER = 8)] = "WEBPLAYER"),
        (e[(e.WHOLE_HOUSE_AUDIO = 9)] = "WHOLE_HOUSE_AUDIO"),
        (e[(e.MUSICKIT = 10)] = "MUSICKIT"),
        (e[(e.VW = 11)] = "VW"),
        (e[(e.UNKNOWN_SOURCE_TYPE = 12)] = "UNKNOWN_SOURCE_TYPE"),
        (e[(e.AMAZON = 13)] = "AMAZON"),
        (e[(e.PORSCHE = 14)] = "PORSCHE"),
        (e[(e.CHROMECAST = 15)] = "CHROMECAST"),
        (e[(e.WEB_APP = 16)] = "WEB_APP"),
        (e[(e.MERCEDES_BENZ = 17)] = "MERCEDES_BENZ"),
        (e[(e.THIRD_PARTY_TV = 18)] = "THIRD_PARTY_TV"),
        (e[(e.SEAT = 19)] = "SEAT"),
        (e[(e.CUPRA = 20)] = "CUPRA");
    })(qt || (qt = {})),
    (function (e) {
      (e[(e.EPISODE = 1)] = "EPISODE"), (e[(e.SHOUTCAST = 2)] = "SHOUTCAST");
    })(Ht || (Ht = {})),
    (function (e) {
      (e[(e.NotStarted = 0)] = "NotStarted"),
        (e[(e.Running = 1)] = "Running"),
        (e[(e.Stopped = 2)] = "Stopped");
    })(Wt || (Wt = {}));
  var Yt = { type: "xstate.init" };
  function r(e) {
    return void 0 === e ? [] : [].concat(e);
  }
  function o(e) {
    return { type: "xstate.assign", assignment: e };
  }
  function i(e, n) {
    return "string" == typeof (e = "string" == typeof e && n && n[e] ? n[e] : e)
      ? { type: e }
      : "function" == typeof e
        ? { type: e.name, exec: e }
        : e;
  }
  function a(e) {
    return function (n) {
      return e === n;
    };
  }
  function u(e) {
    return "string" == typeof e ? { type: e } : e;
  }
  function c(e, n) {
    return { value: e, context: n, actions: [], changed: !1, matches: a(e) };
  }
  function f(e, n, d) {
    var p = n,
      h = !1;
    return [
      e.filter(function (e) {
        if ("xstate.assign" === e.type) {
          h = !0;
          var n = Object.assign({}, p);
          return (
            "function" == typeof e.assignment
              ? (n = e.assignment(p, d))
              : Object.keys(e.assignment).forEach(function (h) {
                  n[h] =
                    "function" == typeof e.assignment[h]
                      ? e.assignment[h](p, d)
                      : e.assignment[h];
                }),
            (p = n),
            !1
          );
        }
        return !0;
      }),
      p,
      h,
    ];
  }
  function s(e, n) {
    void 0 === n && (n = {});
    var d = t(
        f(
          r(e.states[e.initial].entry).map(function (e) {
            return i(e, n.actions);
          }),
          e.context,
          Yt
        ),
        2
      ),
      p = d[0],
      h = d[1],
      y = {
        config: e,
        _options: n,
        initialState: {
          value: e.initial,
          actions: p,
          context: h,
          matches: a(e.initial),
        },
        transition: function (n, d) {
          var p,
            h,
            _ = "string" == typeof n ? { value: n, context: e.context } : n,
            m = _.value,
            g = _.context,
            b = u(d),
            P = e.states[m];
          if (P.on) {
            var S = r(P.on[b.type]);
            try {
              for (
                var T = (function (e) {
                    var n = "function" == typeof Symbol && Symbol.iterator,
                      d = n && e[n],
                      p = 0;
                    if (d) return d.call(e);
                    if (e && "number" == typeof e.length)
                      return {
                        next: function () {
                          return (
                            e && p >= e.length && (e = void 0),
                            { value: e && e[p++], done: !e }
                          );
                        },
                      };
                    throw new TypeError(
                      n
                        ? "Object is not iterable."
                        : "Symbol.iterator is not defined."
                    );
                  })(S),
                  k = T.next();
                !k.done;
                k = T.next()
              ) {
                var E = k.value;
                if (void 0 === E) return c(m, g);
                var w = "string" == typeof E ? { target: E } : E,
                  O = w.target,
                  $ = w.actions,
                  I = void 0 === $ ? [] : $,
                  R = w.cond,
                  A =
                    void 0 === R
                      ? function () {
                          return !0;
                        }
                      : R,
                  C = void 0 === O,
                  M = null != O ? O : m,
                  D = e.states[M];
                if (A(g, b)) {
                  var j = t(
                      f(
                        (C
                          ? r(I)
                          : [].concat(P.exit, I, D.entry).filter(function (e) {
                              return e;
                            })
                        ).map(function (e) {
                          return i(e, y._options.actions);
                        }),
                        g,
                        b
                      ),
                      3
                    ),
                    x = j[0],
                    L = j[1],
                    N = j[2],
                    U = null != O ? O : m;
                  return {
                    value: U,
                    context: L,
                    actions: x,
                    changed: O !== m || x.length > 0 || N,
                    matches: a(U),
                  };
                }
              }
            } catch (t) {
              p = { error: t };
            } finally {
              try {
                k && !k.done && (h = T.return) && h.call(T);
              } finally {
                if (p) throw p.error;
              }
            }
          }
          return c(m, g);
        },
      };
    return y;
  }
  var l = function (e, n) {
    return e.actions.forEach(function (d) {
      var p = d.exec;
      return p && p(e.context, n);
    });
  };
  function v(e) {
    var n = e.initialState,
      d = Wt.NotStarted,
      p = new Set(),
      h = {
        _machine: e,
        send: function (h) {
          d === Wt.Running &&
            ((n = e.transition(n, h)),
            l(n, u(h)),
            p.forEach(function (e) {
              return e(n);
            }));
        },
        subscribe: function (e) {
          return (
            p.add(e),
            e(n),
            {
              unsubscribe: function () {
                return p.delete(e);
              },
            }
          );
        },
        start: function (p) {
          if (p) {
            var y =
              "object" == typeof p
                ? p
                : { context: e.config.context, value: p };
            n = {
              value: y.value,
              actions: [],
              context: y.context,
              matches: a(y.value),
            };
          }
          return (d = Wt.Running), l(n, Yt), h;
        },
        stop: function () {
          return (d = Wt.Stopped), p.clear(), h;
        },
        get state() {
          return n;
        },
        get status() {
          return d;
        },
      };
    return h;
  }
  const zt = /(?:st|ra)\.([0-9]+)/,
    Qt = /st\.([0-9]+)/;
  function asyncGeneratorStep$1f(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1P(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$R(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1P(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$z(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _object_without_properties$3(e, n) {
    if (null == e) return {};
    var d,
      p,
      h = (function (e, n) {
        if (null == e) return {};
        var d,
          p,
          h = {},
          y = Object.keys(e);
        for (p = 0; p < y.length; p++)
          (d = y[p]), n.indexOf(d) >= 0 || (h[d] = e[d]);
        return h;
      })(e, n);
    if (Object.getOwnPropertySymbols) {
      var y = Object.getOwnPropertySymbols(e);
      for (p = 0; p < y.length; p++)
        (d = y[p]),
          n.indexOf(d) >= 0 ||
            (Object.prototype.propertyIsEnumerable.call(e, d) && (h[d] = e[d]));
    }
    return h;
  }
  const toTimeMeasuredData = (e) => {
    var { timestamp: n } = e;
    return _object_spread_props$z(
      _object_spread$R({}, _object_without_properties$3(e, ["timestamp"])),
      { "milliseconds-since-play": Date.now() - n }
    );
  };
  class PlayActivitySender {
    get accessToken() {
      return invoke(this._accessToken);
    }
    get musicUserToken() {
      return invoke(this._musicUserToken);
    }
    get url() {
      return this._isQA
        ? "https://universal-activity-service.itunes.apple.com/qa/play"
        : "https://universal-activity-service.itunes.apple.com/play";
    }
    send(e) {
      var n,
        d = this;
      return ((n = function* () {
        const n = {
          client_id: d._clientId,
          event_type: d._eventType,
          data: ensureArray(e).map(toTimeMeasuredData),
        };
        if (0 === n.data.length)
          throw new Error("send() called without any data");
        const p = d._generateFetchOptions({
          method: "POST",
          body: JSON.stringify(n),
          headers: d.headers(),
        });
        return (
          yield d._fetch(d.url, p),
          d._logInfo &&
            console.info(
              "play activity:",
              d._sourceType === qt.AMAZON ? JSON.stringify(n) : n
            ),
          n
        );
      }),
      function () {
        var e = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = n.apply(e, d);
          function _next(e) {
            asyncGeneratorStep$1f(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$1f(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    baseHeaders() {
      var e, n;
      const d =
        null !==
          (n =
            null === (e = this._fetchOptions) || void 0 === e
              ? void 0
              : e.headers) && void 0 !== n
          ? n
          : {};
      return d instanceof this._headersClass
        ? new this._headersClass(Array.from(d.entries()))
        : new this._headersClass(d);
    }
    headers() {
      const e = this._preferDSID ? "X-Dsid" : "media-user-token",
        n = this.baseHeaders();
      return (
        n.set("Authorization", "Bearer " + this.accessToken),
        n.set("Content-Type", "application/json"),
        n.set(e, "" + this.musicUserToken),
        this._isQA &&
          void 0 !== this._traceTag &&
          n.set("Data-Trace-Tag", this._traceTag),
        n
      );
    }
    _generateFetchOptions(e) {
      return _object_spread$R({}, this._fetchOptions, e);
    }
    constructor(e) {
      var n, d, p, h;
      _define_property$1P(this, "mode", Vt.AUTO),
        _define_property$1P(this, "_accessToken", void 0),
        _define_property$1P(this, "_musicUserToken", void 0),
        _define_property$1P(this, "_clientId", void 0),
        _define_property$1P(this, "_eventType", void 0),
        _define_property$1P(this, "_fetch", void 0),
        _define_property$1P(this, "_fetchOptions", void 0),
        _define_property$1P(this, "_headersClass", void 0),
        _define_property$1P(this, "_isQA", !1),
        _define_property$1P(this, "_logInfo", !1),
        _define_property$1P(this, "_preferDSID", !1),
        _define_property$1P(this, "_sourceType", void 0),
        _define_property$1P(this, "_traceTag", void 0),
        (this._accessToken = e.accessToken),
        (this._clientId = e.clientId),
        (this._eventType = e.eventType),
        (this._fetch = null !== (n = e.fetch) && void 0 !== n ? n : fetch),
        (this._fetchOptions =
          null !== (d = e.fetchOptions) && void 0 !== d ? d : {}),
        (this._headersClass =
          null !== (p = e.headersClass) && void 0 !== p ? p : Headers),
        (this._isQA = null !== (h = e.isQA) && void 0 !== h && h),
        (this._logInfo = e.logInfo || this._isQA),
        (this._musicUserToken = e.musicUserToken),
        (this._preferDSID = e.preferDSID),
        (this._sourceType = e.sourceType),
        (this._traceTag = e.traceTag);
    }
  }
  const fullAppId = (e, n) => {
      if (void 0 === (null == n ? void 0 : n.name)) return "MusicKitApp/1.0";
      if (void 0 !== e) return e;
      return `${(function (e) {
        return e
          .toLowerCase()
          .replace(/[-_]+/g, " ")
          .replace(/[^\w\s]/g, "")
          .replace(/\b./g, (e) => e.toUpperCase())
          .replace(/\s/g, "");
      })(n.name)}/${(null == n ? void 0 : n.version) || "1.0"}`;
    },
    os = (e) => {
      var n, d;
      const p = e.toLowerCase();
      let h,
        y = "Unidentified OS";
      const _ = /mobile/.test(p);
      var m;
      _ && /android|adr/.test(p)
        ? ((y = "Android"), (h = p.match(/(?:android|adr)\ ((\d+[._])+\d+)/)))
        : _ && /iphone|ipad|ipod/.test(p)
          ? ((y = "iOS"),
            (h = p.match(/os\ ((\d+[._])+\d+)\ like\ mac\ os\ x/)))
          : /tizen/.test(p)
            ? ((y = "Tizen"), (h = p.match(/tizen (.*)/)))
            : /web0s|webos/.test(p)
              ? ((y = "WebOS"), (h = p.match(/[web0s|webos] (.*)/)))
              : !_ && /cros/.test(p)
                ? (y = "ChromeOS")
                : !_ && /macintosh/.test(p)
                  ? ((y = "macOS"), (h = p.match(/os\ x\ ((\d+[._])+\d+)\b/)))
                  : !_ && /linux/.test(p)
                    ? (y = "Linux")
                    : !_ &&
                      /windows/.test(p) &&
                      ((y = "Windows"), (h = p.match(/windows ([^\)]*)/)));
      return `${y}/${null !== (m = null == h || null === (d = h[1]) || void 0 === d || null === (n = d.replace) || void 0 === n ? void 0 : n.call(d, /_/g, ".")) && void 0 !== m ? m : "0.0"}`;
    },
    model = (e) =>
      "model/" + ((null == e ? void 0 : e.platform) || "Unavailable"),
    build = (e) => {
      const n = null == e ? void 0 : e.build;
      return void 0 === n || "" === n ? "build/0.0.0" : "build/" + n;
    };
  function asyncGeneratorStep$1e(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1O(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$Q(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1O(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$y(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const Jt = { platform: "", userAgent: "" };
  class PlayActivityBase {
    get accessToken() {
      return invoke(this._accessToken);
    }
    get appID() {
      return (
        void 0 === this._appId &&
          (this._appId = fullAppId(this._appId, this._appInfo)),
        this._appId
      );
    }
    get deviceName() {
      return this._deviceName;
    }
    get musicUserToken() {
      return invoke(this._musicUserToken);
    }
    get navigator() {
      var e;
      return null !== (e = this._navigator) && void 0 !== e
        ? e
        : "undefined" == typeof navigator
          ? Jt
          : navigator;
    }
    get storefrontId() {
      return invoke(this._storefrontId);
    }
    get userAgent() {
      var e;
      return null !== (e = this._userAgent) && void 0 !== e
        ? e
        : this.navigator.userAgent;
    }
    get userIsSubscribed() {
      return invoke(this._userIsSubscribed);
    }
    get allowReportingId() {
      return invoke(this._allowReportingId);
    }
    get utcOffsetInSeconds() {
      if (
        void 0 === this._utcOffsetInSeconds &&
        void 0 !== this._utcOffset &&
        !isNaN(this._utcOffset)
      ) {
        const e = 60 * this._utcOffset;
        this._utcOffsetInSeconds = e <= 0 ? Math.abs(e) : -e;
      }
      return void 0 === this._utcOffsetInSeconds ||
        isNaN(this._utcOffsetInSeconds)
        ? -1
        : this._utcOffsetInSeconds;
    }
    send(e) {
      var n,
        d = this;
      return ((n = function* () {
        return d.sender.send(e);
      }),
      function () {
        var e = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = n.apply(e, d);
          function _next(e) {
            asyncGeneratorStep$1e(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$1e(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    buildDescriptorForPlayParams(e, n, d, p, h) {
      const y = "stream" === e.format ? Kt.STREAM : Kt.ITUNES_STORE_CONTENT;
      return _object_spread$Q(
        _object_spread_props$y(_object_spread$Q({}, e), {
          container: d,
          duration: null != p ? p : 0,
          eventType: n,
          itemType: y,
        }),
        h
      );
    }
    buildForPlayParams(e, n, d, p = 0, h = {}, y = !1) {
      return this.build(this.buildDescriptorForPlayParams(e, n, d, p, h), y);
    }
    constructor(e, n, d, p) {
      var h, y, _, m;
      (_define_property$1O(this, "_accessToken", void 0),
      _define_property$1O(this, "_musicUserToken", void 0),
      _define_property$1O(this, "_storefrontId", void 0),
      _define_property$1O(this, "privateEnabled", void 0),
      _define_property$1O(this, "siriInitiated", void 0),
      _define_property$1O(this, "buildVersion", void 0),
      _define_property$1O(this, "clientId", void 0),
      _define_property$1O(this, "eventType", void 0),
      _define_property$1O(this, "guid", void 0),
      _define_property$1O(this, "internalBuild", void 0),
      _define_property$1O(this, "metricsClientId", void 0),
      _define_property$1O(this, "preferDSID", void 0),
      _define_property$1O(this, "sender", void 0),
      _define_property$1O(this, "sourceType", void 0),
      _define_property$1O(this, "_appId", void 0),
      _define_property$1O(this, "_appInfo", void 0),
      _define_property$1O(this, "_deviceName", void 0),
      _define_property$1O(this, "_navigator", void 0),
      _define_property$1O(this, "_utcOffset", void 0),
      _define_property$1O(this, "_utcOffsetInSeconds", void 0),
      _define_property$1O(this, "_userAgent", void 0),
      _define_property$1O(this, "_userIsSubscribed", void 0),
      _define_property$1O(this, "_allowReportingId", void 0),
      (this._accessToken = e),
      (this._musicUserToken = n),
      (this._storefrontId = d),
      (this.privateEnabled = !1),
      (this.siriInitiated = !1),
      (this.clientId = "JSCLIENT"),
      (this.eventType = "JSPLAY"),
      (this.internalBuild = !1),
      (this.preferDSID = !1),
      (this.sourceType = qt.MUSICKIT),
      (this._utcOffset = new Date().getTimezoneOffset()),
      (this._userIsSubscribed = !0),
      (this._allowReportingId = !1),
      p) &&
        ((this._appInfo = p.app),
        (this._navigator = p.navigator),
        (this._userAgent = p.userAgent),
        hasOwn(p, "utcOffset") && isNaN(p.utcOffset)
          ? (this._utcOffsetInSeconds = -1)
          : hasOwn(p, "utcOffset") && (this._utcOffset = p.utcOffset),
        (this.clientId = p.clientId || "JSCLIENT"),
        (this._deviceName = p.deviceName),
        (this.guid = p.guid),
        (this.metricsClientId = p.metricsClientId),
        (this.preferDSID = null !== (y = p.preferDSID) && void 0 !== y && y),
        (this.sourceType =
          void 0 !== p.sourceType && "number" == typeof p.sourceType
            ? p.sourceType
            : qt.MUSICKIT),
        (this._userIsSubscribed =
          null === (_ = p.userIsSubscribed) || void 0 === _ || _),
        (this._allowReportingId =
          null !== (m = p.allowReportingId) && void 0 !== m && m));
      (this.buildVersion = ((e, n, d, p) =>
        [fullAppId(e, n), os(p), model(d), build(n)].join(" "))(
        this._appId,
        this._appInfo,
        this.navigator,
        this.userAgent
      )),
        (this.sender = new PlayActivitySender({
          accessToken: this._accessToken,
          clientId: this.clientId,
          eventType: this.eventType,
          fetch: null == p ? void 0 : p.fetch,
          fetchOptions: null == p ? void 0 : p.fetchOptions,
          headersClass:
            null == p || null === (h = p.fetch) || void 0 === h
              ? void 0
              : h.Headers,
          isQA: null == p ? void 0 : p.isQA,
          logInfo: null == p ? void 0 : p.logInfo,
          musicUserToken: this._musicUserToken,
          preferDSID: this.preferDSID,
          sourceType: this.sourceType,
          traceTag: null == p ? void 0 : p.traceTag,
        }));
    }
  }
  const Xt = new Map([
    ["play", Ft.PLAY_START],
    ["playbackstarted", Ft.PLAY_START],
    ["stop", Ft.PLAY_END],
    ["playbackstopped", Ft.PLAY_END],
  ]);
  function mapEventTypeString(e) {
    return "number" == typeof e
      ? e
      : null !== (n = Xt.get(e)) && void 0 !== n
        ? n
        : Ft.PLAY_END;
    var n;
  }
  const Zt = new Map([
    ["exit", e.PlayActivityEndReasonType.EXITED_APPLICATION],
    ["next", e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS],
    ["pause", e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED],
    ["playbackfinished", e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK],
    ["playbackstopped", e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED],
    ["previous", e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS],
    ["scrub_begin", e.PlayActivityEndReasonType.SCRUB_BEGIN],
    ["scrub_end", e.PlayActivityEndReasonType.SCRUB_END],
    ["stop", e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK],
  ]);
  function normalizePlayActivityDescriptor(e) {
    const n = deepClone(e),
      d = (function (e) {
        var n;
        const d =
          null !== (n = e.eventType) && void 0 !== n ? n : Ft.PLAY_START;
        if ("number" == typeof d) return { eventType: d };
        return { eventTypeString: d, eventType: mapEventTypeString(d) };
      })(e);
    return (
      (n.eventType = d.eventType),
      (n.eventTypeString = d.eventTypeString),
      void 0 === n.endReasonType &&
        void 0 !== d.eventTypeString &&
        (n.endReasonType = (function (e) {
          if (void 0 !== e) return Zt.get(e);
        })(d.eventTypeString)),
      !1 !== n.reporting && (n.reporting = !0),
      n
    );
  }
  function _define_property$1N(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$x(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const createHelper = (e, n) => (d, p, h) => {
    const { helpers: y } = h.cache;
    return e in y || (y[e] = n(d, p, h)), y[e];
  };
  const returnAsField =
      (e, n) =>
      (...d) =>
        (function (e, n) {
          if (void 0 !== n) return { [e]: n };
        })(e, n(...d)),
    createFieldFn = (e, n) => (d, p, h) => {
      const { fields: y } = h.cache;
      var _;
      return (
        e in y ||
          (h.cache.fields = _object_spread_props$x(
            (function (e) {
              for (var n = 1; n < arguments.length; n++) {
                var d = null != arguments[n] ? arguments[n] : {},
                  p = Object.keys(d);
                "function" == typeof Object.getOwnPropertySymbols &&
                  (p = p.concat(
                    Object.getOwnPropertySymbols(d).filter(function (e) {
                      return Object.getOwnPropertyDescriptor(d, e).enumerable;
                    })
                  )),
                  p.forEach(function (n) {
                    _define_property$1N(e, n, d[n]);
                  });
              }
              return e;
            })({}, y),
            { [e]: ((_ = n(d, p, h)), null == _ ? void 0 : { [e]: _ }) }
          )),
        h.cache.fields[e]
      );
    },
    createClientFieldFn = (e, n) =>
      createFieldFn(e, (e, d, { client: p }) => p[n]),
    er = createFieldFn("event-type", (e, n, d) => {
      return void 0 === e.eventType
        ? Ft.PLAY_START
        : e.itemType === Kt.TIMED_METADATA_PING && void 0 !== e.timedMetadata
          ? Ft.PLAY_END
          : null !== (p = e.eventType) && void 0 !== p
            ? p
            : Ft.PLAY_START;
      var p;
    }),
    tr = createHelper("should-include-audio-quality", (e, n, d) => {
      var p, h;
      const y = e.userPreference;
      return (
        er(e, n, d)["event-type"] === Ft.PLAY_END &&
        void 0 !==
          (null === (p = e.audioQuality) || void 0 === p
            ? void 0
            : p.provided) &&
        void 0 !==
          (null === (h = e.audioQuality) || void 0 === h
            ? void 0
            : h.targeted) &&
        void 0 !== (null == y ? void 0 : y.audioQuality) &&
        void 0 !== (null == y ? void 0 : y.playbackFormat)
      );
    }),
    rr = createFieldFn("audio-quality-provided", (e, n, d) => {
      if (!tr(e, n, d)) return;
      const p = e.audioQuality;
      if (void 0 === (null == p ? void 0 : p.provided)) return;
      const { provided: h } = p;
      var y, _, m;
      return {
        "audio-sample-rate-in-hz":
          null !== (y = h.audioSampleRateHz) && void 0 !== y ? y : 0,
        "audio-bit-depth":
          null !== (_ = h.audioBitDepth) && void 0 !== _ ? _ : 0,
        "bit-rate-in-bps": null !== (m = h.bitRateBps) && void 0 !== m ? m : 0,
        codec: h.codec,
        "audio-channel-type": h.audioChannelType,
        "playback-format": h.playbackFormat,
      };
    }),
    nr = createFieldFn("audio-quality-targeted", (e, n, d) => {
      if (!tr(e, n, d)) return;
      const p = e.audioQuality;
      if (void 0 === (null == p ? void 0 : p.targeted)) return;
      const { targeted: h } = p;
      var y, _, m;
      return {
        "audio-sample-rate-in-hz":
          null !== (y = h.audioSampleRateHz) && void 0 !== y ? y : 0,
        "audio-bit-depth":
          null !== (_ = h.audioBitDepth) && void 0 !== _ ? _ : 0,
        "bit-rate-in-bps": null !== (m = h.bitRateBps) && void 0 !== m ? m : 0,
        codec: h.codec,
        "audio-channel-type": h.audioChannelType,
        "playback-format": h.playbackFormat,
      };
    }),
    ir = createClientFieldFn("build-version", "buildVersion"),
    ar = [
      "uploadedVideo",
      "uploadedAudio",
      "uploaded-videos",
      "uploaded-audios",
    ],
    or = createHelper(
      "is-auc",
      ({ kind: e }) => void 0 !== e && ar.includes(e)
    ),
    sr = createHelper(
      "should-send-timed-metadata",
      ({ endReasonType: n, eventType: d, itemType: p, timedMetadata: h }) =>
        void 0 !== h &&
        (p === Kt.TIMED_METADATA_PING ||
          d === Ft.PLAY_START ||
          n === e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED)
    ),
    cr = createFieldFn("type", (e, n, d) => {
      const { id: p, reporting: h } = e;
      var y;
      if ("-1" === p || !h)
        switch (
          null === (y = er(e, n, d)) || void 0 === y ? void 0 : y["event-type"]
        ) {
          case Ft.PLAY_END:
            return Kt.AGGREGATE_NON_CATALOG_PLAY_TIME;
          case Ft.PLAY_START:
            if ("-1" === p) return Kt.INVALID;
        }
      const { format: _, kind: m, itemType: g } = e;
      return "musicMovie" === m
        ? Kt.ORIGINAL_CONTENT_MOVIES
        : sr(e, n, d)
          ? g === Kt.TIMED_METADATA_PING
            ? g
            : Kt.STREAM
          : "stream" === _
            ? Kt.STREAM
            : or(e, n, d)
              ? Kt.ARTIST_UPLOADED_CONTENT
              : null != g
                ? g
                : Kt.ITUNES_STORE_CONTENT;
    }),
    lr = createFieldFn("container-type", (e, n, d) => {
      var p;
      if (
        (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
        Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
      )
        return;
      const { container: h } = e;
      if (void 0 === h) return $t.UNKNOWN;
      var y;
      const _ = null !== (y = h.type) && void 0 !== y ? y : h.kind;
      if ("number" == typeof _) return _;
      switch (_) {
        case "album":
        case "albums":
        case "library-albums":
          return $t.ALBUM;
        case "artist":
        case "artists":
        case "library-artists":
          return $t.ARTIST;
        case "playlist":
        case "playlists":
        case "library-playlists":
          return $t.PLAYLIST;
        case "radio":
        case "radioStation":
        case "station":
        case "stations":
          return $t.RADIO;
        default:
          return $t.UNKNOWN;
      }
    });
  function _define_property$1M(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const dr = [
      returnAsField("album-adam-id", (e, n, d) => {
        var p;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.ALBUM
        )
          return;
        const { container: h } = e,
          y = null == h ? void 0 : h.id;
        return void 0 === y || k(y) ? void 0 : y;
      }),
      returnAsField("cloud-album-id", (e, n, d) => {
        var p;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.ALBUM
        )
          return;
        const { container: h } = e,
          y = null == h ? void 0 : h.id;
        return void 0 !== y && k(y) ? y : void 0;
      }),
      returnAsField("global-playlist-id", (e, n, d) => {
        var p;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.PLAYLIST
        )
          return;
        const { container: h } = e;
        var y;
        const _ =
          null !== (y = null == h ? void 0 : h.catalogId) && void 0 !== y
            ? y
            : null == h
              ? void 0
              : h.globalId;
        return (null == h ? void 0 : h.isLibrary) && _
          ? _
          : k(null == h ? void 0 : h.id) || null == h
            ? void 0
            : h.id;
      }),
      returnAsField("playlist-version-hash", (e, n, d) => {
        var p;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.PLAYLIST
        )
          return;
        const { container: h } = e,
          y = null == h ? void 0 : h.versionHash;
        return void 0 !== y && "" !== y ? y : void 0;
      }),
      returnAsField("station-hash", (e, n, d) => {
        var p, h;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.RADIO
        )
          return;
        const y =
          null === (h = e.container) || void 0 === h ? void 0 : h.stationHash;
        return void 0 !== y && "" !== y ? y : void 0;
      }),
      returnAsField("station-id", (e, n, d) => {
        var p, h;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) === $t.RADIO
        )
          return null === (h = e.container) || void 0 === h ? void 0 : h.id;
      }),
      returnAsField("station-personalized-id", (e, n, d) => {
        var p, h;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.RADIO
        )
          return;
        const y = null === (h = e.container) || void 0 === h ? void 0 : h.id;
        return void 0 !== y && Qt.test(y)
          ? parseInt(y.replace(Qt, "$1"), 10)
          : void 0;
      }),
      returnAsField("universal-library-id", (e, n, d) => {
        var p;
        if (
          (null === (p = lr(e, n, d)) || void 0 === p
            ? void 0
            : p["container-type"]) !== $t.PLAYLIST
        )
          return;
        const { container: h } = e;
        var y;
        const _ =
            null !== (y = null == h ? void 0 : h.catalogId) && void 0 !== y
              ? y
              : null == h
                ? void 0
                : h.globalId,
          m = null == h ? void 0 : h.id;
        if (void 0 !== m)
          if ((null == h ? void 0 : h.isLibrary) && _) {
            if ("" !== m) return m;
          } else if (k(m)) return m;
      }),
    ],
    ur = createFieldFn("container-ids", (e, n, d) => {
      var p;
      if (
        (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
        Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
      )
        return;
      const h = dr.reduce(
        (p, h) =>
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$1M(e, n, d[n]);
                });
            }
            return e;
          })({}, p, h(e, n, d)),
        Object.create(null)
      );
      return isEmpty(h) ? void 0 : h;
    }),
    pr = createClientFieldFn("developer-token", "accessToken"),
    hr = createClientFieldFn("device-name", "deviceName"),
    yr = createFieldFn("display-type", (e, n, d) => {
      var p, h;
      if (
        (null === (p = er(e, n, d)) || void 0 === p
          ? void 0
          : p["event-type"]) === Ft.LYRIC_DISPLAY
      )
        return null === (h = e.lyricDescriptor) || void 0 === h
          ? void 0
          : h.displayType;
    }),
    _r = createHelper(
      "initial-start-position-in-milliseconds",
      ({ position: e = 0, startPositionInMilliseconds: n }) =>
        n || Math.round(1e3 * e)
    ),
    fr = createFieldFn("end-position-in-milliseconds", (e, n, d) => {
      var p;
      switch (
        null === (p = er(e, n, d)) || void 0 === p ? void 0 : p["event-type"]
      ) {
        case Ft.LYRIC_DISPLAY:
          var h;
          if (
            void 0 ===
            (null === (h = e.lyricDescriptor) || void 0 === h
              ? void 0
              : h.duration)
          )
            return;
          return Math.round(e.lyricDescriptor.duration);
        case Ft.PLAY_START:
          return;
        default:
          if (n && void 0 === n.position) return;
          return e.endPositionInMilliseconds || _r(e, n, d);
      }
    }),
    mr = createHelper(
      "is-private",
      ({ id: e, reporting: n }) => "-1" === e || !n
    ),
    vr = createFieldFn("end-reason-type", (n, d, p) => {
      var h;
      if (!d || void 0 !== (null == d ? void 0 : d.position))
        return ((null === (h = cr(n, d, p)) || void 0 === h
          ? void 0
          : h.type) === Kt.TIMED_METADATA_PING &&
          void 0 !== n.timedMetadata) ||
          (mr(n, d, p) && n.eventType === Ft.PLAY_END)
          ? e.PlayActivityEndReasonType.NOT_APPLICABLE
          : n.endReasonType;
    }),
    { CONTAINER_CHANGED: gr, NOT_SPECIFIED: br } = Bt,
    Pr = createFieldFn("event-reason-hint-type", (e, n, d) => {
      var p, h;
      if (
        (null === (p = er(e, n, d)) || void 0 === p
          ? void 0
          : p["event-type"]) !== Ft.PLAY_START
      )
        return;
      const y = e.container;
      return void 0 === y
        ? br
        : !1 === n
          ? d.isAlexa
            ? br
            : gr
          : (null == n || null === (h = n.container) || void 0 === h
                ? void 0
                : h.id) !== y.id
            ? gr
            : br;
    }),
    Sr = createFieldFn("feature-name", (e, n, d) => {
      var p, h, y;
      if (
        (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
        Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
      )
        return;
      return (
        "" +
        (null !==
          (y = null === (h = e.container) || void 0 === h ? void 0 : h.name) &&
        void 0 !== y
          ? y
          : Ot.MUSICKIT)
      );
    }),
    Tr = createClientFieldFn("guid", "guid"),
    kr = createHelper("should-have-auc-adam-id", or),
    Er = createHelper(
      "should-have-radio-adam-id",
      ({ id: e, container: n }) =>
        zt.test(e) || "radioStation" === (null == n ? void 0 : n.kind)
    ),
    wr = createHelper(
      "is-library-item-or-library-type",
      ({ id: e, isLibrary: n }, d, p) => n || k(e)
    ),
    Or = createHelper("catalog-id", ({ catalogId: e, container: n }) =>
      null != e ? e : null == n ? void 0 : n.catalogId
    ),
    $r = createHelper(
      "is-library-item-with-catalog-id",
      (e, n, d) => e.isLibrary && !!Or(e, n, d)
    );
  function _define_property$1L(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Ir = [
      returnAsField("auc-adam-id", (e, n, d) => {
        if (!mr(e, n, d) && !Er(e, n, d)) return kr(e, n, d) ? e.id : void 0;
      }),
      returnAsField("cloud-id", (e, n, d) => {
        var p;
        const { id: h } = e,
          y = void 0 !== h && "" !== h;
        return mr(e, n, d) &&
          (null === (p = er(e, n, d)) || void 0 === p
            ? void 0
            : p["event-type"]) === Ft.PLAY_START &&
          y &&
          "-1" !== h
          ? h
          : Er(e, n, d) || kr(e, n, d)
            ? e.cloudId
            : ($r(e, n, d) && y) || wr(e, n, d)
              ? h
              : e.cloudId;
      }),
      returnAsField("lyric-id", (e, n, d) => {
        var p, h;
        if (
          (null === (p = er(e, n, d)) || void 0 === p
            ? void 0
            : p["event-type"]) === Ft.LYRIC_DISPLAY
        )
          return null === (h = e.lyricDescriptor) || void 0 === h
            ? void 0
            : h.id;
      }),
      returnAsField("purchased-adam-id", (e, n, d) => e.purchasedId),
      returnAsField("reporting-adam-id", (e, n, d) => {
        if (!0 !== d.client.allowReportingId) return;
        var p;
        return (
          (null !== (p = er(e, n, d)) && void 0 !== p ? p : {})["event-type"],
          wr(e, n, d) ? e.reportingId : void 0
        );
      }),
      returnAsField("radio-adam-id", (e, n, d) => {
        if (mr(e, n, d)) return;
        const { container: p, id: h } = e;
        return zt.test(h) || "radioStation" === (null == p ? void 0 : p.kind)
          ? parseInt(("" + h).replace(zt, "$1"), 10)
          : void 0;
      }),
      returnAsField("subscription-adam-id", (e, n, d) => {
        if (!(mr(e, n, d) || Er(e, n, d) || kr(e, n, d))) {
          if ($r(e, n, d)) return Or(e, n, d);
          if (!wr(e, n, d)) return e.id;
        }
      }),
    ],
    Rr = createFieldFn("ids", (e, n, d) => {
      var p;
      if (
        (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
        Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
      )
        return;
      const h = Ir.reduce(
        (p, h) =>
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$1L(e, n, d[n]);
                });
            }
            return e;
          })({}, p, h(e, n, d)),
        Object.create(null)
      );
      return isEmpty(h) ? void 0 : h;
    }),
    Ar = createClientFieldFn("internal-build", "internalBuild"),
    Cr = createFieldFn("is-collaborative", (e, n, d) => {
      var p;
      return (
        !0 ===
          (null === (p = e.container) || void 0 === p
            ? void 0
            : p.isCollaborative) || void 0
      );
    }),
    Mr = createFieldFn("lyric-language", (e, n, d) => {
      var p, h;
      if (
        (null === (p = er(e, n, d)) || void 0 === p
          ? void 0
          : p["event-type"]) === Ft.LYRIC_DISPLAY
      )
        return null === (h = e.lyricDescriptor) || void 0 === h
          ? void 0
          : h.language;
    }),
    Dr = createHelper(
      "has-episode-streaming-kind",
      ({ streamingKind: e }, n, d) => e === Ht.EPISODE
    ),
    jr = createHelper("is-stream", (e, n, d) => {
      var p;
      return (
        (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
        Kt.STREAM
      );
    }),
    xr = createHelper(
      "is-live-stream",
      (e, n, d) => jr(e, n, d) && !Dr(e, n, d)
    ),
    Lr = createFieldFn("media-duration-in-milliseconds", (e, n, d) => {
      var p;
      const h =
        null === (p = er(e, n, d)) || void 0 === p ? void 0 : p["event-type"];
      if (h === Ft.LYRIC_DISPLAY) return 0;
      if (xr(e, n, d)) return 0;
      const y = Math.round(1e3 * e.duration);
      if (h === Ft.PLAY_START) return y;
      var _, m;
      const g =
        null !== (m = e.startPositionInMilliseconds) && void 0 !== m
          ? m
          : Math.round(
              1e3 * (null !== (_ = e.position) && void 0 !== _ ? _ : 0)
            );
      return g > 1e3 * e.duration ? g : y;
    }),
    { AUDIO: Nr, VIDEO: Ur } = Gt,
    Br = createFieldFn("media-type", (e, n, d) => {
      var p;
      if (
        (null === (p = er(e, n, d)) || void 0 === p
          ? void 0
          : p["event-type"]) === Ft.LYRIC_DISPLAY
      )
        return Nr;
      const { kind: h, mediaType: y } = e;
      if ("number" == typeof y) return y;
      const _ = "string" == typeof y ? y : h;
      return _ && /video|movie/i.test(_) ? Ur : Nr;
    }),
    Fr = createClientFieldFn("metrics-client-id", "metricsClientId"),
    Kr = createFieldFn("offline", () => !1),
    Gr = createFieldFn("persistent-id", () => generateUUID()),
    Vr = createFieldFn("play-mode", (e, n, d) => {
      var p, h, y, _, m;
      if (
        (null === (p = er(e, n, d)) || void 0 === p
          ? void 0
          : p["event-type"]) === Ft.LYRIC_DISPLAY ||
        (null === (h = cr(e, n, d)) || void 0 === h ? void 0 : h.type) ===
          Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
      )
        return {
          "auto-play-mode":
            null !== (y = Vr.autoplayMode) && void 0 !== y ? y : 0,
          "repeat-play-mode":
            null !== (_ = Vr.repeatPlayMode) && void 0 !== _ ? _ : 0,
          "shuffle-play-mode":
            null !== (m = Vr.shufflePlayMode) && void 0 !== m ? m : 0,
        };
      const g = invoke(e.playMode);
      var b, P, S;
      return void 0 !== g
        ? {
            "auto-play-mode":
              null !== (b = g.autoplayMode) && void 0 !== b ? b : 0,
            "repeat-play-mode":
              null !== (P = g.repeatPlayMode) && void 0 !== P ? P : 0,
            "shuffle-play-mode":
              null !== (S = g.shufflePlayMode) && void 0 !== S ? S : 0,
          }
        : void 0;
    }),
    qr = createClientFieldFn("private-enabled", "privateEnabled"),
    Hr = createFieldFn("reco-data", (e, n, d) => {
      var p, h;
      if (
        (null === (p = er(e, n, d)) || void 0 === p
          ? void 0
          : p["event-type"]) !== Ft.LYRIC_DISPLAY &&
        (null === (h = cr(e, n, d)) || void 0 === h ? void 0 : h.type) !==
          Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
      )
        return e.recoData;
    }),
    Wr = createClientFieldFn("sb-enabled", "userIsSubscribed"),
    Yr = createClientFieldFn("siri-initiated", "siriInitiated"),
    zr = createClientFieldFn("source-type", "sourceType"),
    Qr = createFieldFn("start-position-in-milliseconds", (e, n, d) => {
      var p, h;
      const y =
        null === (p = er(e, n, d)) || void 0 === p ? void 0 : p["event-type"];
      return y === Ft.LYRIC_DISPLAY ||
        (null === (h = cr(e, n, d)) || void 0 === h ? void 0 : h.type) ===
          Kt.AGGREGATE_NON_CATALOG_PLAY_TIME ||
        xr(e, n, d)
        ? 0
        : y === Ft.PLAY_START
          ? _r(e, n, d)
          : null !==
                (m =
                  null !== (_ = e.startPositionInMilliseconds) && void 0 !== _
                    ? _
                    : previousPosition(n)) && void 0 !== m
            ? m
            : 0;
      var _, m;
    }),
    previousPosition = (e) =>
      e && void 0 !== e.position ? Math.round(1e3 * e.position) : 0,
    Jr = createClientFieldFn("store-front", "storefrontId"),
    Xr = createFieldFn("timed-metadata", (e, n, d) => {
      const p = e.timedMetadata;
      if (void 0 !== p && shouldSendTimedMetadata(e, n, d))
        return ((e, n = 8) => {
          if (!(e instanceof Uint8Array)) return "";
          const d = Array.prototype.map.call(e, formatByte).join("");
          return 0 === n
            ? d
            : d.replace(new RegExp(`(.{1,${n}})`, "g"), "$1 ").trim();
        })(p, 0);
    }),
    shouldSendTimedMetadata = (e, n, d) => {
      var p, h;
      return (
        (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
          Kt.TIMED_METADATA_PING ||
        (null === (h = er(e, n, d)) || void 0 === h
          ? void 0
          : h["event-type"]) !== Ft.LYRIC_DISPLAY
      );
    },
    Zr = createFieldFn("timestamp", ({ timestamp: e }, n, d) =>
      null != e ? e : Date.now()
    ),
    en = createClientFieldFn("user-agent", "userAgent"),
    tn = createFieldFn("user-preference-audio-quality", (e, n, d) => {
      var p;
      if (tr(e, n, d))
        return null === (p = e.userPreference) || void 0 === p
          ? void 0
          : p.audioQuality;
    }),
    rn = createFieldFn("user-preference-playback-format", (e, n, d) => {
      var p;
      if (tr(e, n, d))
        return null === (p = e.userPreference) || void 0 === p
          ? void 0
          : p.playbackFormat;
    }),
    nn = createFieldFn("user-token", (e, n, { client: d }) => {
      if (!d.preferDSID) return d.musicUserToken;
    }),
    an = createFieldFn("utc-offset-in-seconds", (e, n, d) => {
      var p;
      return (null === (p = cr(e, n, d)) || void 0 === p ? void 0 : p.type) ===
        Kt.AGGREGATE_NON_CATALOG_PLAY_TIME
        ? 0
        : d.client.utcOffsetInSeconds;
    }),
    on = {
      "audio-quality-provided": rr,
      "audio-quality-targeted": nr,
      "build-version": ir,
      "container-ids": ur,
      "container-type": lr,
      "developer-token": pr,
      "device-name": hr,
      "display-type": yr,
      "end-position-in-milliseconds": fr,
      "end-reason-type": vr,
      "event-reason-hint-type": Pr,
      "event-type": er,
      "feature-name": Sr,
      guid: Tr,
      ids: Rr,
      "internal-build": Ar,
      "is-collaborative": Cr,
      "lyric-language": Mr,
      "media-duration-in-milliseconds": Lr,
      "media-type": Br,
      "metrics-client-id": Fr,
      offline: Kr,
      "persistent-id": Gr,
      "play-mode": Vr,
      "private-enabled": qr,
      "reco-data": Hr,
      "sb-enabled": Wr,
      "siri-initiated": Yr,
      "source-type": zr,
      "start-position-in-milliseconds": Qr,
      "store-front": Jr,
      "timed-metadata": Xr,
      timestamp: Zr,
      type: cr,
      "user-agent": en,
      "user-preference-audio-quality": tn,
      "user-preference-playback-format": rn,
      "user-token": nn,
      "utc-offset-in-seconds": an,
    };
  function _define_property$1K(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$M(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1K(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$w(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  let sn = 0;
  function _define_property$1J(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$v(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const buildPlayActivityData$1 = (e, n, d, p = !1) => {
    const h = ((e, ...n) =>
      _object_spread_props$w(_object_spread$M({}, e, Object.assign({}, ...n)), {
        cache: {
          fields: Object.assign(
            {},
            ...n.map((e) => {
              var n;
              return null == e || null === (n = e.cache) || void 0 === n
                ? void 0
                : n.fields;
            })
          ),
          helpers: Object.assign(
            {},
            ...n.map((e) => {
              var n;
              return null == e || null === (n = e.cache) || void 0 === n
                ? void 0
                : n.helpers;
            })
          ),
        },
      }))(
      "boolean" == typeof p
        ? ((e = {}, n) =>
            _object_spread$M(
              { id: (sn++).toFixed(0), client: n, isAlexa: !1 },
              e
            ))({ isAlexa: p }, e)
        : _object_spread_props$v(
            (function (e) {
              for (var n = 1; n < arguments.length; n++) {
                var d = null != arguments[n] ? arguments[n] : {},
                  p = Object.keys(d);
                "function" == typeof Object.getOwnPropertySymbols &&
                  (p = p.concat(
                    Object.getOwnPropertySymbols(d).filter(function (e) {
                      return Object.getOwnPropertyDescriptor(d, e).enumerable;
                    })
                  )),
                  p.forEach(function (n) {
                    _define_property$1J(e, n, d[n]);
                  });
              }
              return e;
            })({}, p),
            { client: e }
          )
    );
    return (
      (n = normalizePlayActivityDescriptor(n)),
      d && (d = normalizePlayActivityDescriptor(d)),
      Object.assign(
        Object.create(null),
        ...Object.values(on).map((e) => (null == e ? void 0 : e(n, d, h)))
      )
    );
  };
  function _define_property$1I(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$K(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1I(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$u(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _define_property$1H(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$J(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1H(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$t(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function asyncGeneratorStep$1d(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1d(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1d(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1d(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1G(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$s(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  class LyricsPlayActivity extends PlayActivityBase {
    get state() {
      return this._machine.state.value;
    }
    play(e) {
      var n = this;
      return _async_to_generator$1d(function* () {
        var d;
        if ("playing" === n.state)
          throw Error(
            "lyrics are already being displayed. Did you forget to stop them?"
          );
        if (void 0 === e) throw Error("Missing descriptor for lyrics play");
        We.info(
          `Staring tracking: lyricsId=${null === (d = e.lyricDescriptor) || void 0 === d ? void 0 : d.id}, itemId=${e.id}, catalogId=${e.catalogId}`
        ),
          (n.startDescriptor = e),
          n._machine.send({ type: "play" });
      })();
    }
    stop() {
      var e = this;
      return _async_to_generator$1d(function* () {
        var n;
        if ("playing" !== e.state)
          throw Error(
            "lyrics are not being displayed. Did you forget to display them?"
          );
        if (void 0 === e.startDescriptor)
          throw Error("Missing start descriptor for lyrics stop");
        We.info(
          `Stopping tracking: lyricsId=${null === (n = e.startDescriptor.lyricDescriptor) || void 0 === n ? void 0 : n.id}, itemId=${e.startDescriptor.id}, catalogId=${e.startDescriptor.catalogId}`
        ),
          e._machine.send({ type: "stop" });
        const d = e._machine.state.context.duration,
          p = JSON.parse(JSON.stringify(e.startDescriptor));
        (p.lyricDescriptor = _object_spread_props$s(
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$1G(e, n, d[n]);
                });
            }
            return e;
          })({}, p.lyricDescriptor),
          { duration: Math.round(d) }
        )),
          We.debug("Clearing tracked descriptor"),
          (e.startDescriptor = void 0);
        const h = e.build(p, !1);
        try {
          We.debug("Sending PAF request with data payload"),
            yield e.send(h),
            We.debug("Done sending PAF request");
        } catch (q) {
          console.error("Error sending Lyrics PAF request: " + q.message),
            We.error("Error sending Lyrics PAF request: " + q.message);
        }
      })();
    }
    exit() {
      return _async_to_generator$1d(function* () {})();
    }
    build(e, n) {
      return ((e, n, d) => {
        if (void 0 === n)
          throw new Error("called without a play activity descriptor");
        const p = _object_spread_props$u(_object_spread$K({}, n), {
          eventType: Ft.LYRIC_DISPLAY,
        });
        return ((e, ...n) => n.reduce((e, n) => n(e), e))(
          _object_spread_props$u(
            _object_spread$K({}, buildPlayActivityData$1(e, p, d, !1)),
            {
              "media-duration-in-milliseconds": 0,
              "media-type": Gt.AUDIO,
              "start-position-in-milliseconds": 0,
              "play-mode": {
                "auto-play-mode": 0,
                "repeat-play-mode": 0,
                "shuffle-play-mode": 0,
              },
            }
          ),
          (e) =>
            exceptFields(
              e,
              "character-display-count",
              "event-reason-hint-type",
              "reco-data"
            )
        );
      })(this, e, n);
    }
    constructor(e, n, d, p) {
      super(e, n, d, p),
        _define_property$1G(this, "_machine", void 0),
        _define_property$1G(this, "startDescriptor", void 0),
        (this._machine = v(
          s({
            id: "lpaf",
            initial: "idle",
            context: { initialShowTime: -1, duration: -1 },
            states: {
              idle: {
                entry: o((e) =>
                  _object_spread_props$t(_object_spread$J({}, e), {
                    initialShowTime: void 0,
                    duration: mt() - e.initialShowTime,
                  })
                ),
                on: { play: "playing" },
              },
              playing: {
                entry: o((e) =>
                  _object_spread_props$t(_object_spread$J({}, e), {
                    initialShowTime: mt(),
                  })
                ),
                on: { stop: "idle" },
              },
            },
          })
        ).start());
    }
  }
  var cn;
  !(function (e) {
    e[(e.ALEXA = 13)] = "ALEXA";
  })(cn || (cn = {}));
  const createCookieJar = (e) => {
      switch ((void 0 === e && (e = "browser"), e)) {
        case "browser":
          return { get: getCookie, set: setCookie };
        case "memory":
          return ((e = {}) => ({
            get(n) {
              if (void 0 !== n) return e[n];
            },
            set(n, d) {
              e[n] = d;
            },
          }))();
        default:
          return e;
      }
    },
    empty = (e, n) => write(e, n, [], "/", 0),
    read = (e, n) => {
      const d = e.get(n);
      if (void 0 === d || "" === d) return [];
      return ensureArray(JSON.parse(atob(d)));
    },
    write = (e, n, d, p, h, y) => e.set(n, btoa(JSON.stringify(d)), p, h, y);
  function asyncGeneratorStep$1c(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1c(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1c(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1c(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1F(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const { AUTO: ln } = Vt;
  class PlayActivityBatchableSender {
    flush() {
      var e = this;
      return _async_to_generator$1c(function* () {
        const n = read(e.jar, "amupaee");
        if (void 0 !== n && 0 !== n.length)
          try {
            yield e.sender.send(n), empty(e.jar, "amupaee");
          } catch (q) {
            throw new Error("flush: " + q.message);
          }
      })();
    }
    send(n) {
      var d = this;
      return _async_to_generator$1c(function* () {
        if (
          d.mode === ln &&
          (Array.isArray(n) ||
            n["end-reason-type"] !==
              e.PlayActivityEndReasonType.EXITED_APPLICATION)
        )
          return d.sender.send(n);
        ((e, n, d, p, h, y) => {
          write(e, n, [...read(e, n), d], p, h, y);
        })(d.jar, "amupaee", n, "/");
      })();
    }
    constructor(e, n) {
      _define_property$1F(this, "sender", void 0),
        _define_property$1F(this, "jar", void 0),
        _define_property$1F(this, "mode", void 0),
        (this.sender = e),
        (this.jar = n),
        (this.mode = ln);
    }
  }
  function asyncGeneratorStep$1b(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1b(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1b(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1b(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1E(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class Timeline {
    get events() {
      return this._events;
    }
    get first() {
      return this.at(0);
    }
    get keys() {
      return this._keys;
    }
    get last() {
      return this.at(this.length - 1);
    }
    get length() {
      return this._keys.length;
    }
    get second() {
      return this.at(1);
    }
    at(e) {
      if (e > this.length - 1) throw new Error("Invalid timeline index");
      const n = this._keys[e];
      return this._events[n];
    }
    before(e) {
      if ("number" != typeof e) {
        const n = [];
        for (const e in this._events)
          hasOwn(this._events, e) && n.push(this._events[e]);
        e = this._keys[n.indexOf(e)];
      }
      const n = this._keys.indexOf(e);
      if (-1 === n) throw new Error("Key not found");
      if (n > 0) return this._events[this._keys[n - 1]];
    }
    drain() {
      const e = this._keys.map((e) => this._events[e]);
      return this.reset(), e;
    }
    reset() {
      (this._events = {}), (this._keys = []);
    }
    pop() {
      var e = this;
      return _async_to_generator$1b(function* () {
        const n = e._keys.pop();
        if (void 0 === n) return Promise.reject("TIMELINE IS EMPTY");
        const d = e._events[n];
        return delete e._events[n], Promise.resolve(d);
      })();
    }
    add(e, n) {
      var d = this;
      return _async_to_generator$1b(function* () {
        return d.push(e, n);
      })();
    }
    push(e, n = Date.now()) {
      var d = this;
      return _async_to_generator$1b(function* () {
        for (; -1 !== d._keys.indexOf(n); ) n++;
        return (d._events[n] = e), d._keys.push(n), Promise.resolve(n);
      })();
    }
    shift() {
      var e = this;
      return _async_to_generator$1b(function* () {
        const n = e._keys.shift();
        if (void 0 === n) return Promise.reject("TIMELINE IS EMPTY");
        const d = e._events[n];
        return delete e._events[n], Promise.resolve(d);
      })();
    }
    unshift(e, n = Date.now()) {
      var d = this;
      return _async_to_generator$1b(function* () {
        for (; -1 !== d._keys.indexOf(n); ) n++;
        return (d._events[n] = e), d._keys.unshift(n), Promise.resolve(n);
      })();
    }
    constructor() {
      _define_property$1E(this, "_events", {}),
        _define_property$1E(this, "_keys", []);
    }
  }
  function asyncGeneratorStep$1a(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1D(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class TimedMetadataTracker {
    get currentValue() {
      return this._currentValue;
    }
    clear() {
      this._currentValue = void 0;
    }
    ping(e, n) {
      var d,
        p = this;
      return ((d = function* () {
        p.timedMetadataChanged(e) &&
          (void 0 !== p._currentValue &&
            (yield p.client.pingTimedMetadata(n, p._currentValue)),
          (p._currentValue = void 0 === e ? void 0 : e.slice(0)));
      }),
      function () {
        var e = this,
          n = arguments;
        return new Promise(function (p, h) {
          var y = d.apply(e, n);
          function _next(e) {
            asyncGeneratorStep$1a(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$1a(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    timedMetadataChanged(e) {
      const { _currentValue: n } = this;
      return void 0 === n
        ? void 0 !== e
        : void 0 === e || e.length !== n.length || n.some((n, d) => n !== e[d]);
    }
    constructor(e, n) {
      _define_property$1D(this, "client", void 0),
        _define_property$1D(this, "_currentValue", void 0),
        (this.client = e),
        (this._currentValue = n);
    }
  }
  const transitionEvent = (e) => ({ type: e });
  function deriveTransitionEvent(n) {
    if (n.itemType === Kt.TIMED_METADATA_PING) return !1;
    if (
      (function (e) {
        return e.eventType === Ft.PLAY_START;
      })(n)
    )
      return transitionEvent("play");
    if (
      (function (e) {
        if (e.eventType !== Ft.PLAY_END) return !1;
        if (void 0 === e.endReasonType)
          throw new Error(
            "PLAY_END activity descriptor requires an endReasonType value"
          );
        return !0;
      })(n)
    ) {
      const d = n.endReasonType;
      if (d === e.PlayActivityEndReasonType.SCRUB_BEGIN)
        return transitionEvent("scrubBegin");
      if (d === e.PlayActivityEndReasonType.SCRUB_END)
        return transitionEvent("scrubEnd");
      if (d === e.PlayActivityEndReasonType.EXITED_APPLICATION) return !1;
    }
    return transitionEvent("stop");
  }
  function _define_property$1C(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$H(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1C(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$r(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _object_without_properties$2(e, n) {
    if (null == e) return {};
    var d,
      p,
      h = (function (e, n) {
        if (null == e) return {};
        var d,
          p,
          h = {},
          y = Object.keys(e);
        for (p = 0; p < y.length; p++)
          (d = y[p]), n.indexOf(d) >= 0 || (h[d] = e[d]);
        return h;
      })(e, n);
    if (Object.getOwnPropertySymbols) {
      var y = Object.getOwnPropertySymbols(e);
      for (p = 0; p < y.length; p++)
        (d = y[p]),
          n.indexOf(d) >= 0 ||
            (Object.prototype.propertyIsEnumerable.call(e, d) && (h[d] = e[d]));
    }
    return h;
  }
  class MPAFStateMachine {
    get currentState() {
      return this.machineService.state;
    }
    get currentStateName() {
      return this.currentState.value;
    }
    matches(e) {
      return this.machineService.state.matches(e);
    }
    transition(e, n) {
      const d = deriveTransitionEvent(e);
      if (!1 === d) return this.currentStateName;
      if ((this.machineService.send(d), this.matches("error")))
        throw new Error(this.machineService.state.context.errorMessage);
      return this.currentStateName;
    }
    constructor() {
      _define_property$1C(this, "machine", void 0),
        _define_property$1C(this, "machineService", void 0),
        (this.machine = s(
          {
            id: "mpaf",
            initial: "idle",
            context: {},
            states: {
              error: {},
              idle: {
                on: {
                  play: "playing",
                  stop: "idle",
                  scrubBegin: {
                    target: "scrubbing",
                    actions: o((e) =>
                      _object_spread_props$r(_object_spread$H({}, e), {
                        stateBeforeScrub: "idle",
                      })
                    ),
                  },
                  scrubEnd: {
                    target: "error",
                    actions: ["clearStateBeforeScrub", "setScrubEndError"],
                  },
                },
              },
              playing: {
                on: {
                  scrubBegin: {
                    target: "scrubbing",
                    actions: o((e) =>
                      _object_spread_props$r(_object_spread$H({}, e), {
                        stateBeforeScrub: "playing",
                      })
                    ),
                  },
                  stop: "idle",
                  scrubEnd: {
                    target: "error",
                    actions: ["clearStateBeforeScrub", "setScrubEndError"],
                  },
                },
              },
              scrubbing: {
                on: {
                  scrubEnd: [
                    {
                      target: "idle",
                      cond: ({ stateBeforeScrub: e }) => "idle" === e,
                      actions: ["clearStateBeforeScrub"],
                    },
                    { target: "playing", actions: ["clearStateBeforeScrub"] },
                  ],
                },
              },
            },
          },
          {
            actions: {
              clearStateBeforeScrub: o((e) =>
                _object_without_properties$2(e, ["stateBeforeScrub"])
              ),
              setScrubEndError: o((e) =>
                _object_spread_props$r(_object_spread$H({}, e), {
                  errorMessage:
                    "The scrub() method was called with the SCRUB_END action without a previous SCRUB_START descriptor",
                })
              ),
            },
          }
        )),
        (this.machineService = v(this.machine).start());
    }
  }
  function asyncGeneratorStep$19(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$19(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$19(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$19(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1B(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$G(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1B(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$q(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  class StatelessPlayActivity extends PlayActivityBase {
    build(e, n) {
      return buildPlayActivityData$1(this, e, n, "JSCLIENT" !== this.clientId);
    }
    constructor(e, n, d, p) {
      super(e, n, d, p);
    }
  }
  class PlayActivity {
    get mode() {
      return this.sender.mode;
    }
    set mode(e) {
      this.sender.mode = e;
    }
    get privateEnabled() {
      return this._paf.privateEnabled;
    }
    set privateEnabled(e) {
      this._paf.privateEnabled = e;
    }
    get timedMetadata() {
      return this._timedMetadataTracker.currentValue;
    }
    clearTimedMetadata() {
      return this._timedMetadataTracker.clear();
    }
    setTimedMetadata(e, n) {
      var d = this;
      return _async_to_generator$19(function* () {
        yield d._timedMetadataTracker.ping(e, n);
      })();
    }
    activate(n = !1) {
      var d = this;
      return _async_to_generator$19(function* () {
        if (n)
          try {
            yield d.flush();
          } catch (h) {
            if (
              !((e) =>
                ((e) => {
                  switch (typeof e) {
                    case "string":
                      return e;
                    case "object":
                      return e.message
                        ? "string" != typeof e.message
                          ? ""
                          : e.message
                        : "";
                    default:
                      return "";
                  }
                })(e).includes("send() called without any data"))(h)
            )
              throw h;
          }
        const p = d.timeline.last;
        if (
          p &&
          p.endReasonType === e.PlayActivityEndReasonType.EXITED_APPLICATION
        )
          return d.timeline.pop();
      })();
    }
    exit(n = 0) {
      var d = this;
      return _async_to_generator$19(function* () {
        yield d.stop(n, e.PlayActivityEndReasonType.EXITED_APPLICATION);
      })();
    }
    pause(n = 0) {
      var d = this;
      return _async_to_generator$19(function* () {
        yield d.stop(n, e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED);
      })();
    }
    pingTimedMetadata(e, n, d = this.previousDescriptor) {
      var p = this;
      return _async_to_generator$19(function* () {
        p.setTimedMetadata(n, e),
          yield p._addToTimeline(
            _object_spread_props$q(_object_spread$G({}, d), {
              position: e,
              itemType: Kt.TIMED_METADATA_PING,
              timedMetadata: n,
            })
          );
      })();
    }
    play(e, n = 0) {
      var d = this;
      return _async_to_generator$19(function* () {
        const p = d.timeline.length > 0;
        if (void 0 === e) {
          if (!p) return;
          const e = d.previousDescriptor;
          return (
            e.eventType === Ft.PLAY_END && delete e.endReasonType,
            void (yield d._addToTimeline(
              _object_spread_props$q(
                _object_spread$G({}, d.sanitizePreviousDescriptor(e)),
                { eventType: Ft.PLAY_START }
              )
            ))
          );
        }
        if (p) {
          const e = d.previousDescriptor;
          if (
            d._machine.matches("playing") &&
            !(({ id: e, reporting: n = !0, eventType: d }) =>
              ("-1" === e || !n) && d === Ft.PLAY_END)(e)
          )
            return Promise.reject(
              new Error(
                "The play() method was called without a previous stop() or pause() call."
              )
            );
        }
        yield d._addToTimeline(
          _object_spread_props$q(_object_spread$G({}, e), {
            eventType: Ft.PLAY_START,
            position: n,
          })
        );
      })();
    }
    scrub(n = 0, d = e.PlayActivityEndReasonType.SCRUB_BEGIN) {
      var p = this;
      return _async_to_generator$19(function* () {
        yield p._addToTimeline(
          _object_spread_props$q(
            _object_spread$G(
              {},
              p.sanitizePreviousDescriptor(p.previousDescriptor)
            ),
            { eventType: Ft.PLAY_END, endReasonType: d, position: n }
          )
        );
      })();
    }
    skip(n, d = e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS, p = 0) {
      var h = this;
      return _async_to_generator$19(function* () {
        yield h.stop(p, d), yield h.play(n);
      })();
    }
    stop(n = 0, d = e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK) {
      var p = this;
      return _async_to_generator$19(function* () {
        let h = p.previousDescriptor;
        if (
          (h.endReasonType === e.PlayActivityEndReasonType.EXITED_APPLICATION &&
            (yield p.timeline.pop(),
            empty(p._cookieJar, "amupaee"),
            (h = p.previousDescriptor)),
          p._machine.matches("playing"))
        ) {
          const e = _object_spread_props$q(
            _object_spread$G({}, p.sanitizePreviousDescriptor(h)),
            {
              eventType: Ft.PLAY_END,
              endReasonType: d,
              position: n,
              timedMetadata: p._timedMetadataTracker.currentValue,
            }
          );
          yield p._addToTimeline(e);
        }
      })();
    }
    build(e, n) {
      if (
        (void 0 === e &&
          void 0 === n &&
          We.warn(
            "You are calling build() from a stateful PAF client. Please, use a stateless client or exit(), pause(), play(), scrub(), skip() or stop() instead."
          ),
        void 0 === e)
      ) {
        if (0 === this.timeline.length)
          throw new Error("build() called without a play activity descriptor");
        e = this.timeline.last;
      }
      if (void 0 === n) {
        if (
          void 0 === (n = this.timeline.before(e)) &&
          e.eventType === Ft.PLAY_END
        )
          throw new Error(
            "Cannot build() for PLAY_END descriptors without previous descriptors"
          );
        n = null != n && n;
      }
      return this._paf.build(
        _object_spread_props$q(_object_spread$G({}, e), {
          timedMetadata: this.timedMetadata,
        }),
        n
      );
    }
    addForPlayParams(e, n, d, p = 0, h = {}) {
      var y = this;
      return _async_to_generator$19(function* () {
        yield y._addToTimeline(y.buildDescriptorForPlayParams(e, n, d, p, h));
      })();
    }
    buildDescriptorForPlayParams(e, n, d, p = 0, h = {}) {
      const y = "stream" === e.format ? Kt.STREAM : Kt.ITUNES_STORE_CONTENT;
      return normalizePlayActivityDescriptor(
        _object_spread$G(
          _object_spread_props$q(_object_spread$G({}, e), {
            container: d,
            duration: p,
            eventType: n,
            itemType: y,
          }),
          h
        )
      );
    }
    flush() {
      return this.sender.flush();
    }
    _addToTimeline(e) {
      var n = this;
      return _async_to_generator$19(function* () {
        e = _object_spread_props$q(_object_spread$G({}, e), {
          timestamp: Date.now(),
        });
        const d = n.timeline.length > 0 && n.timeline.last;
        yield n.timeline.add(e);
        const p = n.build(e, d);
        yield n.send(p, e);
      })();
    }
    get previousDescriptor() {
      const e = this.timeline.last;
      if (void 0 === e)
        throw new Error("A method was called without a previous descriptor");
      return exceptFields(e, "timestamp");
    }
    buildForPlayParams(e, n, d, p = 0, h = {}, y = !1) {
      return (
        We.warn(
          "You are using buildsForPlayParams from a stateful PlayActivity. Please, use StatelessPlayActivity instead"
        ),
        this._paf.buildForPlayParams(e, n, d, p, h, y)
      );
    }
    send(e, n) {
      e = ensureArray(e);
      const d = normalizePlayActivityDescriptor(n);
      return (
        e.forEach((e) => this._machine.transition(d, e)), this.sender.send(e)
      );
    }
    sanitizePreviousDescriptor(e) {
      let n = deepClone(e);
      return (
        n.itemType === Kt.TIMED_METADATA_PING &&
          (n = exceptFields(n, "itemType")),
        n
      );
    }
    constructor(e, n, d, p) {
      _define_property$1B(this, "sender", void 0),
        _define_property$1B(this, "timeline", new Timeline()),
        _define_property$1B(this, "_cookieJar", void 0),
        _define_property$1B(this, "_paf", void 0),
        _define_property$1B(this, "_machine", void 0),
        _define_property$1B(this, "_timedMetadataTracker", void 0),
        (this._paf = new StatelessPlayActivity(e, n, d, p)),
        (this._cookieJar = createCookieJar(null == p ? void 0 : p.cookieJar)),
        (this.sender = new PlayActivityBatchableSender(
          this._paf.sender,
          this._cookieJar
        )),
        (this._machine = new MPAFStateMachine()),
        (this._timedMetadataTracker = new TimedMetadataTracker(this));
    }
  }
  const Bind = () => (e, n, d) => {
      if (void 0 === d || "function" != typeof d.value)
        throw new TypeError(
          `Only methods can be decorated with @Bind, but ${n} is not a method.`
        );
      return {
        configurable: !0,
        get() {
          const e = d.value.bind(this);
          return (
            Object.defineProperty(this, n, {
              value: e,
              configurable: !0,
              writable: !0,
            }),
            e
          );
        },
      };
    },
    dn = [
      "exitFullscreen",
      "webkitExitFullscreen",
      "mozCancelFullScreen",
      "msExitFullscreen",
    ],
    un = [
      "fullscreenElement",
      "webkitFullscreenElement",
      "mozFullScreenElement",
      "msFullscreenElement",
    ],
    pn = [
      "requestFullscreen",
      "webkitRequestFullscreen",
      "mozRequestFullScreen",
      "msRequestFullscreen",
    ],
    noop = () => Promise.resolve(),
    hn = ((e) => {
      if (void 0 === e) return noop;
      const n = dn.find((n) => "function" == typeof e.prototype[n]);
      return "string" != typeof n
        ? noop
        : (e = self.document) => {
            var d;
            return null == e || null === (d = e[n]) || void 0 === d
              ? void 0
              : d.call(e);
          };
    })(Document),
    yn = ((e) => {
      if (void 0 === e) return () => !1;
      const n = un.find((n) => n in e.prototype);
      return "string" != typeof n ? () => !1 : (e = self.document) => !!e[n];
    })(Document),
    _n = ((e) => {
      if (void 0 === e) return noop;
      const n = pn.find((n) => "function" == typeof e.prototype[n]);
      return "string" != typeof n ? noop : (e) => (null == e ? void 0 : e[n]());
    })(HTMLElement);
  function asyncGeneratorStep$18(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$18(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$18(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$18(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  class Fullscreen {
    exit() {
      var e = this;
      return _async_to_generator$18(function* () {
        if (e.isInFullscreen())
          return e.stopDispatchingEvents(() => e.exitFullscreen());
      })();
    }
    request(e) {
      var n = this;
      return _async_to_generator$18(function* () {
        if (void 0 !== e)
          return n.stopDispatchingEvents(() =>
            n.requestFullscreenForElement(e)
          );
      })();
    }
    stopDispatchingEvents(e) {
      var n = this;
      return _async_to_generator$18(function* () {
        return n.player.windowHandlers.stopListeningToVisibilityChanges(e);
      })();
    }
    exitFullscreen() {
      return hn();
    }
    isInFullscreen() {
      return yn();
    }
    requestFullscreenForElement(e) {
      return _n(e);
    }
    constructor(e) {
      var n, d, p;
      (p = void 0),
        (d = "player") in (n = this)
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p),
        (this.player = e);
    }
  }
  function asyncGeneratorStep$17(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1z(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class UnsupportedSeeker {
    start() {
      He.warn("seeker.start is not supported in this playback method");
    }
    end() {
      He.warn("seeker.end is not supported in this playback method");
    }
    seekToTime(e) {
      return (
        He.warn("seekToTime is not supported in this playback method"),
        Promise.resolve()
      );
    }
    constructor() {
      _define_property$1z(this, "ended", !1);
    }
  }
  class PlayerSeeker {
    get ended() {
      return this._ended;
    }
    get isEngagedInPlayback() {
      return this._player.isEngagedInPlayback;
    }
    get stillPlayingSameItem() {
      return this._currentItem === this._player.nowPlayingItem;
    }
    end() {
      He.debug("seeker: end"),
        -1 !== this._startTime
          ? this._ended
            ? He.warn("seeker: Cannot end the same seeker twice.")
            : (this.dispatchStartEvent(), this.dispatchEndEvent())
          : He.warn("seeker: Cannot end a seeker before starting it.");
    }
    seekToTime(e) {
      var n,
        d = this;
      return ((n = function* () {
        if ((He.debug("seeker: seekToTime", e), !d.ended))
          return (
            d.stillPlayingSameItem ||
              ((d._currentItem = d._player.nowPlayingItem), (d._startTime = 0)),
            (d._lastSeekedTime = e),
            d._player.seekToTime(e)
          );
        He.warn("seeker: Cannot seek once the seeker has ended");
      }),
      function () {
        var e = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = n.apply(e, d);
          function _next(e) {
            asyncGeneratorStep$17(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$17(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    start() {
      He.debug("seeker: start"),
        -1 === this._startTime
          ? ((this._currentItem = this._player.nowPlayingItem),
            (this._startTime = this._player.currentPlaybackTime),
            (this._lastSeekedTime = this._startTime))
          : He.warn("seeker: Cannot start same seeker twice");
    }
    dispatch(e, n) {
      this.isEngagedInPlayback
        ? (He.debug("seeker: dispatch", e), this._player.dispatch(e, n))
        : He.debug(
            "seeker: do not dispatch because isEngagedInPlayback",
            this.isEngagedInPlayback
          );
    }
    dispatchStartEvent() {
      this.stillPlayingSameItem ||
        ((this._startTime = 0), (this._lastSeekedTime = 0)),
        this.dispatch(kt.playbackScrub, {
          item: this._currentItem,
          position: this._startTime,
        });
    }
    dispatchEndEvent() {
      (this._ended = !0),
        this.dispatch(kt.playbackScrub, {
          item: this._currentItem,
          position: this._lastSeekedTime,
          endReasonType: e.PlayActivityEndReasonType.SCRUB_END,
        });
    }
    constructor(e) {
      _define_property$1z(this, "_ended", !1),
        _define_property$1z(this, "_lastSeekedTime", -1),
        _define_property$1z(this, "_player", void 0),
        _define_property$1z(this, "_startTime", -1),
        _define_property$1z(this, "_currentItem", void 0),
        He.debug("seeker: new"),
        (this._player = e);
    }
  }
  function asyncGeneratorStep$16(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1y(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$z(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$z(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const {
    visibilityChangeEvent: fn,
    visibilityState: mn,
    unloadEventName: vn,
  } = (() => {
    let e = "visibilitychange",
      n = "visibilityState";
    void 0 !== document.mozHidden
      ? ((e = "mozvisibilitychange"), (n = "mozVisibilityState"))
      : void 0 !== document.msHidden
        ? ((e = "msvisibilitychange"), (n = "msVisibilityState"))
        : document.webkitHidden &&
          ((e = "webkitvisibilitychange"), (n = "webkitVisibilityState"));
    return {
      visibilityChangeEvent: e,
      visibilityState: n,
      unloadEventName: "onpagehide" in window ? "pagehide" : "unload",
    };
  })();
  class WindowHandlers {
    activate(e = self, n = self.document) {
      n.addEventListener(fn, this.visibilityChanged),
        e.addEventListener("storage", this.storage, !1),
        e.addEventListener(vn, this.windowUnloaded);
    }
    deactivate() {
      document.removeEventListener(fn, this.visibilityChanged),
        window.removeEventListener("storage", this.storage),
        window.addEventListener(vn, this.windowUnloaded);
    }
    stopListeningToVisibilityChanges(e) {
      var n,
        d = this;
      return ((n = function* () {
        d.dispatchVisibilityChanges = !1;
        const n = yield e();
        return (d.dispatchVisibilityChanges = !0), n;
      }),
      function () {
        var e = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = n.apply(e, d);
          function _next(e) {
            asyncGeneratorStep$16(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$16(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    dispatch(e, n = {}) {
      this.player.dispatch(e, n);
    }
    storage({ key: e, newValue: n }) {
      e === nt && this.player.tsidChanged(n);
    }
    visibilityChanged(e) {
      const n = e.target[mn];
      He.info("dc visibilityState", n, e, yn()),
        this.runtimeEnvironment.os.isIOS &&
          this.dispatchVisibilityChanges &&
          ("hidden" === n
            ? this.dispatch(kt.playerExit, {
                item: this.player.nowPlayingItem,
                position: this.player.currentPlaybackTime,
              })
            : "visible" === n && this.dispatch(kt.playerActivate));
    }
    windowUnloaded() {
      this.player.isPlaying &&
        this.dispatch(kt.playerExit, {
          item: this.player.nowPlayingItem,
          position: this.player.currentPlaybackTime,
        });
    }
    constructor(e, n) {
      _define_property$1y(this, "player", void 0),
        _define_property$1y(this, "runtimeEnvironment", void 0),
        _define_property$1y(this, "dispatchVisibilityChanges", !0),
        (this.player = e),
        (this.runtimeEnvironment = n);
    }
  }
  function asyncGeneratorStep$15(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$15(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$15(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$15(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1x(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$F(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1x(e, n, d[n]);
        });
    }
    return e;
  }
  function _ts_metadata$y(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  _ts_decorate$z(
    [
      Bind(),
      _ts_metadata$z("design:type", Function),
      _ts_metadata$z("design:paramtypes", [void 0]),
      _ts_metadata$z("design:returntype", void 0),
    ],
    WindowHandlers.prototype,
    "storage",
    null
  ),
    _ts_decorate$z(
      [
        Bind(),
        _ts_metadata$z("design:type", Function),
        _ts_metadata$z("design:paramtypes", [
          "undefined" == typeof Event ? Object : Event,
        ]),
        _ts_metadata$z("design:returntype", void 0),
      ],
      WindowHandlers.prototype,
      "visibilityChanged",
      null
    ),
    _ts_decorate$z(
      [
        Bind(),
        _ts_metadata$z("design:type", Function),
        _ts_metadata$z("design:paramtypes", []),
        _ts_metadata$z("design:returntype", void 0),
      ],
      WindowHandlers.prototype,
      "windowUnloaded",
      null
    );
  const {
      bufferedProgressDidChange: gn,
      mediaCanPlay: bn,
      mediaElementCreated: Pn,
      mediaPlaybackError: Sn,
      nowPlayingItemDidChange: Tn,
      nowPlayingItemWillChange: kn,
      metadataDidChange: En,
      primaryPlayerDidChange: wn,
      playbackDurationDidChange: On,
      playbackProgressDidChange: $n,
      playbackStateDidChange: In,
      playbackRateDidChange: Rn,
      playbackStateWillChange: An,
      playbackTargetAvailableDidChange: Cn,
      playbackTargetIsWirelessDidChange: Mn,
      playbackTimeDidChange: Dn,
      playbackVolumeDidChange: jn,
    } = wt,
    xn = [
      "canplay",
      "durationchange",
      "ended",
      "error",
      "loadedmetadata",
      "loadstart",
      "pause",
      "play",
      "playing",
      "progress",
      "ratechange",
      "seeked",
      "seeking",
      "timeupdate",
      "volumechange",
      "waiting",
    ],
    Ln = ["NotAllowedError", "NotSupportedError"],
    {
      ended: Nn,
      loading: Un,
      paused: Bn,
      playing: Fn,
      seeking: Kn,
      stopped: Gn,
      waiting: Vn,
    } = e.PlaybackStates;
  class BasePlayer {
    get bitrate() {
      return this._bitrateCalculator.bitrate;
    }
    get currentBufferedProgress() {
      return this._currentBufferedProgress;
    }
    get _currentDuration() {
      return this._targetElement.duration;
    }
    get _currentTime() {
      const e = this._targetElement.currentTime,
        n = this._buffer;
      var d;
      return (
        e -
        (null !== (d = null == n ? void 0 : n.currentTimestampOffset) &&
        void 0 !== d
          ? d
          : 0)
      );
    }
    get currentPlaybackDuration() {
      const n = this.nowPlayingItem;
      if (!n) return 0;
      const d = "podcast-episodes" === n.type,
        p =
          n.playbackType === e.PlaybackType.encryptedFull ||
          n.playbackType === e.PlaybackType.unencryptedFull,
        h = n.playbackDuration;
      return p && h && !d
        ? this.calculateTime(h / 1e3)
        : this.calculateTime(this._currentDuration);
    }
    get currentPlaybackTime() {
      return this.calculateTime(this._currentTime);
    }
    calculateTime(e) {
      return this._timing.time(e);
    }
    get currentPlaybackTimeRemaining() {
      return this.currentPlaybackDuration - this.currentPlaybackTime;
    }
    get currentPlaybackProgress() {
      return this._currentPlaybackProgress || 0;
    }
    get hasMediaElement() {
      return (
        this._targetElement instanceof HTMLElement &&
        null !== this._targetElement.parentNode
      );
    }
    get isEngagedInPlayback() {
      return !this._stopped && !this.isPaused();
    }
    get isPlaying() {
      return this.playbackState === Fn;
    }
    get isPrimaryPlayer() {
      return this._isPrimaryPlayer;
    }
    set isPrimaryPlayer(e) {
      var n;
      e !== this._isPrimaryPlayer &&
        ((this._isPrimaryPlayer = e),
        this._isPrimaryPlayer
          ? null === (n = getLocalStorage()) ||
            void 0 === n ||
            n.setItem(nt, this._serial)
          : (this._dispatcher.publish(wn, { target: this }),
            this.pause({ userInitiated: !1 })));
    }
    get isReady() {
      return 0 !== this._targetElement.readyState;
    }
    get nowPlayingItem() {
      return this._nowPlayingItem;
    }
    set nowPlayingItem(e) {
      const n = this._dispatcher;
      if (void 0 === e)
        return (
          n.publish(kn, { item: e }),
          (this._nowPlayingItem = e),
          void n.publish(Tn, { item: e })
        );
      const d = this._nowPlayingItem,
        p = this._buffer;
      (null == d ? void 0 : d.isEqual(e)) ||
        (n.publish(kn, { item: e }),
        this.isPlaying &&
          (null == p ? void 0 : p.currentItem) !== e &&
          this._pauseMedia(),
        d &&
          (He.debug("setting state to ended on ", d.title),
          (d.state = x.ended),
          d.endMonitoringStateDidChange(),
          d.endMonitoringStateWillChange()),
        (this._nowPlayingItem = e),
        He.debug("setting state to playing on ", e.title),
        (e.state = x.playing),
        e && e.info && this._setTargetElementTitle(e.info),
        n.publish(Tn, { item: e }),
        n.publish(On, {
          currentTarget: this._targetElement,
          duration: this.currentPlaybackDuration,
          target: this._targetElement,
          type: "durationchange",
        }));
    }
    get playbackRate() {
      return this._targetElement.playbackRate;
    }
    set playbackRate(e) {
      this._targetElement.playbackRate = e;
    }
    get playbackState() {
      return this._playbackState;
    }
    setPlaybackState(e, n) {
      const d = this._playbackState;
      if (e === d) return;
      const p = { oldState: d, state: e, nowPlayingItem: n };
      He.debug("BasePlayer.playbackState is changing", p),
        this._dispatcher.publish(An, p),
        (this._playbackState = e),
        this._dispatcher.publish(In, p);
    }
    get playbackTargetAvailable() {
      return (
        void 0 !== window.WebKitPlaybackTargetAvailabilityEvent &&
        this._playbackTargetAvailable
      );
    }
    set playbackTargetAvailable(e) {
      e !== this._playbackTargetAvailable &&
        ((this._playbackTargetAvailable = e),
        this._dispatcher.publish(Cn, { available: e }));
    }
    get playbackTargetIsWireless() {
      return (
        void 0 !== window.WebKitPlaybackTargetAvailabilityEvent &&
        this._playbackTargetIsWireless
      );
    }
    set playbackTargetIsWireless(e) {
      e !== this._playbackTargetIsWireless &&
        ((this._playbackTargetIsWireless = e),
        this._dispatcher.publish(Mn, { playing: e }));
    }
    get volume() {
      return this._targetElement.volume;
    }
    set volume(e) {
      this._targetElement.volume = e;
    }
    get isDestroyed() {
      return this._isDestroyed;
    }
    clearNextManifest() {
      var e;
      null === (e = this._buffer) || void 0 === e || e.clearNextManifest();
    }
    initialize() {
      var e = this;
      return _async_to_generator$15(function* () {
        He.debug("BasePlayer.initialize"),
          e.isPlayerSupported()
            ? (yield e.initializeMediaElement(),
              yield e.initializeExtension(),
              e.initializeEventHandlers(),
              e._dispatcher.publish(Pn, e._targetElement))
            : He.warn("{this.constructor.name} not supported");
      })();
    }
    initializeEventHandlers() {
      if ((this.windowHandlers.activate(), !this.hasMediaElement)) return;
      const e = this._targetElement;
      window.WebKitPlaybackTargetAvailabilityEvent &&
        (e.addEventListener("webkitplaybacktargetavailabilitychanged", (e) => {
          this.playbackTargetAvailable = "available" === e.availability;
        }),
        e.addEventListener(
          "webkitcurrentplaybacktargetiswirelesschanged",
          (e) => {
            this.playbackTargetIsWireless =
              e.target === this._targetElement &&
              !this.playbackTargetIsWireless;
          }
        )),
        xn.forEach((n) => e.addEventListener(n, this)),
        this._dispatcher.publish(kt.playerActivate);
    }
    removeEventHandlers() {
      xn.forEach((e) => this._targetElement.removeEventListener(e, this)),
        this.windowHandlers.deactivate();
    }
    isPaused() {
      return this._paused;
    }
    exitFullscreen() {
      return this.fullscreen.exit();
    }
    requestFullscreen(e) {
      return this.fullscreen.request(e);
    }
    newSeeker() {
      var e;
      return (
        null === (e = this._seeker) || void 0 === e || e.end(),
        (this._seeker = new PlayerSeeker(this)),
        this._seeker
      );
    }
    stop(e) {
      var n = this;
      return _async_to_generator$15(function* () {
        He.debug("BasePlayer.stop", e),
          yield n._waitForPendingPlay(),
          n.isPlaying &&
            (He.debug("BasePlayer.play dispatching playbackStop"),
            n.dispatch(
              kt.playbackStop,
              _object_spread$F(
                {
                  item: n.nowPlayingItem,
                  position: n.currentPlaybackTime,
                  startPosition: n.initialBufferPosition,
                  playingDate: n.currentPlayingDate,
                  startPlayingDate: n.initialPlayingDate,
                },
                e
              )
            )),
          yield n.stopMediaAndCleanup();
      })();
    }
    stopMediaAndCleanup(e = Gn) {
      var n = this;
      return _async_to_generator$15(function* () {
        He.debug("stopMediaAndCleanup"),
          yield n._stopMediaElement(),
          (n._stopped = !0),
          (n._paused = !1);
        const d = n.nowPlayingItem;
        (n.nowPlayingItem = void 0),
          (n.initialBufferPosition = void 0),
          (n.initialPlayingDate = void 0),
          n.setPlaybackState(e, d);
      })();
    }
    onPlaybackError(n, d) {
      this.resetDeferredPlay(),
        this.stop({
          endReasonType: e.PlayActivityEndReasonType.FAILED_TO_LOAD,
          userInitiated: !1,
        });
    }
    calculatePlaybackProgress() {
      const e =
        Math.round(
          100 * (this.currentPlaybackTime / this.currentPlaybackDuration || 0)
        ) / 100;
      this._currentPlaybackProgress !== e &&
        ((this._currentPlaybackProgress = e),
        this._dispatcher.publish($n, {
          progress: this._currentPlaybackProgress,
        }));
    }
    calculateBufferedProgress(e) {
      const n = Math.round((e / this.currentPlaybackDuration) * 100);
      this._currentBufferedProgress !== n &&
        ((this._currentBufferedProgress = n),
        this._dispatcher.publish(gn, { progress: n }));
    }
    destroy() {
      var e, n;
      if (
        (He.debug("BasePlayer.destroy"),
        (this._isDestroyed = !0),
        this._dispatcher.unsubscribe(Sn, this.onPlaybackError),
        !this.hasMediaElement)
      )
        return;
      const d = this._targetElement;
      null === (e = this.extension) || void 0 === e || e.destroy(d),
        this.removeEventHandlers(),
        this.cleanupElement(),
        null === (n = d.parentNode) || void 0 === n || n.removeChild(d);
    }
    handleEvent(n) {
      var d = this;
      return _async_to_generator$15(function* () {
        "timeupdate" !== n.type &&
          He.debug(
            "BasePlayer.handleEvent: ",
            n.type,
            n,
            d.isPaused(),
            d._stopped
          );
        const { nowPlayingItem: p } = d;
        switch (((n.timestamp = Date.now()), n.type)) {
          case "canplay":
            d._dispatcher.publish(bn, n),
              d._playbackState !== Vn ||
                d._targetElement.paused ||
                d.setPlaybackState(Fn, p);
            break;
          case "durationchange":
            d._targetElement.duration !== 1 / 0 &&
              ((n.duration = d.currentPlaybackDuration),
              d._dispatcher.publish(On, n),
              d.calculatePlaybackProgress());
            break;
          case "ended": {
            var h;
            if (
              (He.debug('media element "ended" event'),
              null === (h = d.nowPlayingItem) || void 0 === h
                ? void 0
                : h.isLinearStream)
            )
              return void He.warn("ignoring ended event for linear stream", n);
            if (d.isElementCleaned()) {
              He.debug('media element already cleaned, ignoring "ended" event');
              break;
            }
            const p = d.nowPlayingItem,
              y = (null == p ? void 0 : p.playbackDuration)
                ? p.playbackDuration / 1e3
                : d.currentPlaybackTime,
              _ = d.currentPlayingDate;
            yield d.stopMediaAndCleanup(Nn),
              d.dispatch(kt.playbackStop, {
                item: p,
                position: y,
                playingDate: _,
                endReasonType: e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK,
              });
            break;
          }
          case "error":
            He.error("Playback Error", n, d._targetElement.error),
              d._dispatcher.publish(
                Sn,
                new MKError(MKError.Reason.MEDIA_PLAYBACK, "Playback Error")
              );
            break;
          case "loadedmetadata":
            d._dispatcher.publish(En, n);
            break;
          case "loadstart":
            d.setPlaybackState(Un, p);
            break;
          case "pause":
            d.setPlaybackState(d._stopped ? Gn : Bn, p);
            break;
          case "play":
          case "playing":
            (d._paused = !1),
              (d._stopped = !1),
              (d.isPrimaryPlayer = !0),
              d.setPlaybackState(Fn, p);
            break;
          case "progress": {
            const e = d._targetElement.buffered;
            d.handleBufferStart(),
              1 === e.length &&
                0 === e.start(0) &&
                d.calculateBufferedProgress(e.end(0));
            break;
          }
          case "ratechange":
            d._dispatcher.publish(Rn, n);
            break;
          case "seeked":
            d._stopped
              ? d.setPlaybackState(Gn, p)
              : d._paused
                ? d.setPlaybackState(Bn, p)
                : d.playbackState !== Nn && d.setPlaybackState(Fn, p);
            break;
          case "seeking":
            d.playbackState === Bn
              ? (d._paused = !0)
              : d.playbackState === Gn && (d._stopped = !0),
              d.playbackState !== Nn && d.setPlaybackState(Kn, p);
            break;
          case "timeupdate": {
            d._dispatcher.publish(Dn, {
              currentPlaybackDuration: d.currentPlaybackDuration,
              currentPlaybackTime: d.currentPlaybackTime,
              currentPlaybackTimeRemaining: d.currentPlaybackTimeRemaining,
            }),
              d.calculatePlaybackProgress();
            const e = d._buffer;
            e && (e.currentTime = d.currentPlaybackTime);
            break;
          }
          case "volumechange":
            d._dispatcher.publish(jn, n);
            break;
          case "waiting":
            d.setPlaybackState(Vn, p);
        }
      })();
    }
    handleBufferStart() {
      const { _targetElement: e } = this;
      void 0 !== this.initialBufferPosition ||
        e.paused ||
        0 === e.buffered.length ||
        ((this.initialBufferPosition = e.buffered.start(0)),
        (this.initialPlayingDate = this.currentPlayingDate),
        He.debug(
          "BasePlayer.handleBufferStart: setting initial buffer position ",
          this.initialBufferPosition
        ));
    }
    pause(e = {}) {
      var n = this;
      return _async_to_generator$15(function* () {
        yield n._waitForPendingPlay(),
          n.isPlaying &&
            (yield n._pauseMedia(),
            (n._paused = !0),
            n.dispatch(
              kt.playbackPause,
              _object_spread$F(
                {
                  item: n.nowPlayingItem,
                  position: n.currentPlaybackTime,
                  playingDate: n.currentPlayingDate,
                },
                e
              )
            ));
      })();
    }
    play(e = !0) {
      var n = this;
      return _async_to_generator$15(function* () {
        if ((He.debug("BasePlayer.play()"), n.nowPlayingItem))
          try {
            yield n._playMedia(),
              He.debug("BasePlayer.play dispatching playbackPlay"),
              n.dispatch(kt.playbackPlay, {
                userInitiated: e,
                item: n.nowPlayingItem,
                position: n.currentPlaybackTime,
                playingDate: n.currentPlayingDate,
              });
          } catch (Yt) {
            if (
              (Yt &&
                Ln.includes(Yt.name) &&
                He.error("BasePlayer.play() rejected due to", Yt),
              "NotAllowedError" === (null == Yt ? void 0 : Yt.name))
            )
              throw new MKError(
                MKError.Reason.USER_INTERACTION_REQUIRED,
                "Playback of media content requires user interaction first and cannot be automatically started on page load."
              );
          }
      })();
    }
    preload() {
      return this._loadMedia();
    }
    showPlaybackTargetPicker() {
      this.playbackTargetAvailable &&
        this._targetElement.webkitShowPlaybackTargetPicker();
    }
    dispatch(e, n) {
      void 0 === n.item && (n.item = this.nowPlayingItem),
        hasOwn(n, "isPlaying") || (n.isPlaying = this.isPlaying),
        this._dispatcher.publish(e, n);
    }
    tsidChanged(e) {
      void 0 !== e && "" !== e && (this.isPrimaryPlayer = e === this._serial);
    }
    _waitForPendingPlay() {
      var e = this;
      return _async_to_generator$15(function* () {
        e._deferredPlay &&
          (yield e._deferredPlay.promise, (e._deferredPlay = void 0));
      })();
    }
    _loadMedia() {
      var e = this;
      return _async_to_generator$15(function* () {
        He.debug("BasePlayer._loadMedia", e._targetElement),
          e._targetElement.load();
      })();
    }
    _pauseMedia() {
      var e = this;
      return _async_to_generator$15(function* () {
        e._targetElement.pause();
      })();
    }
    _playAssetURL(e, n) {
      var d = this;
      return _async_to_generator$15(function* () {
        He.debug("BasePlayer._playAssetURL", e), (d._targetElement.src = e);
        const p = d._loadMedia();
        if (n) return He.debug("BasePlayer.loadOnly"), void (yield p);
        yield d._playMedia();
      })();
    }
    playItemFromUnencryptedSource(e, n, d) {
      var p = this;
      return _async_to_generator$15(function* () {
        return (
          (null == d ? void 0 : d.startTime) && (e += "#t=" + d.startTime),
          n || p.startPlaybackSequence(),
          yield p._playAssetURL(e, n),
          p.finishPlaybackSequence()
        );
      })();
    }
    _playMedia() {
      var e = this;
      return _async_to_generator$15(function* () {
        He.debug("BasePlayer._playMedia", e._targetElement, e.extension);
        try {
          yield e._targetElement.play(), (e._playbackDidStart = !0);
        } catch (q) {
          throw (
            (He.error(
              "BasePlayer._playMedia: targetElement.play() rejected",
              q
            ),
            q)
          );
        }
      })();
    }
    _setTargetElementTitle(e) {
      this.hasMediaElement && (this._targetElement.title = e);
    }
    resetDeferredPlay() {
      this._deferredPlay = void 0;
    }
    _stopMediaElement() {
      var e = this;
      return _async_to_generator$15(function* () {
        e.hasMediaElement && (e._targetElement.pause(), e.cleanupElement());
      })();
    }
    cleanupElement() {
      const e = this._targetElement;
      e &&
        !this.isElementCleaned() &&
        ((e.currentTime = 0),
        e.removeAttribute("src"),
        e.removeAttribute("title"));
    }
    isElementCleaned() {
      const e = this._targetElement;
      return !e || (0 === e.currentTime && "" === e.src && "" === e.title);
    }
    finishPlaybackSequence() {
      var e;
      He.debug("BasePlayer.finishPlaybackSequence", this._deferredPlay);
      const n =
        null === (e = this._deferredPlay) || void 0 === e
          ? void 0
          : e.resolve(void 0);
      return (this._deferredPlay = void 0), n;
    }
    startPlaybackSequence() {
      return (
        He.debug("BasePlayer.startPlaybackSequence", this._deferredPlay),
        this._deferredPlay &&
          (He.warn("Previous playback sequence not cleared"),
          this.finishPlaybackSequence()),
        (this._deferredPlay = (function () {
          let e, n;
          return {
            promise: new Promise(function (d, p) {
              (e = d), (n = p);
            }),
            resolve(n) {
              null == e || e(n);
            },
            reject(e) {
              null == n || n(e);
            },
          };
        })()),
        this._deferredPlay.promise
      );
    }
    constructor(n) {
      var d;
      _define_property$1x(this, "privateEnabled", !1),
        _define_property$1x(this, "siriInitiated", !1),
        _define_property$1x(this, "windowHandlers", void 0),
        _define_property$1x(this, "_dispatcher", void 0),
        _define_property$1x(this, "_buffer", void 0),
        _define_property$1x(this, "services", void 0),
        _define_property$1x(this, "_context", void 0),
        _define_property$1x(this, "_currentBufferedProgress", 0),
        _define_property$1x(this, "initialBufferPosition", void 0),
        _define_property$1x(this, "initialPlayingDate", void 0),
        _define_property$1x(this, "_paused", !1),
        _define_property$1x(this, "_playbackState", e.PlaybackStates.none),
        _define_property$1x(this, "_stopped", !1),
        _define_property$1x(this, "_playbackDidStart", !1),
        _define_property$1x(this, "_nowPlayingItem", void 0),
        _define_property$1x(this, "_bitrateCalculator", void 0),
        _define_property$1x(this, "_currentPlaybackProgress", 0),
        _define_property$1x(this, "_isPrimaryPlayer", !0),
        _define_property$1x(this, "_playbackTargetAvailable", !1),
        _define_property$1x(this, "_playbackTargetIsWireless", !1),
        _define_property$1x(this, "_seeker", void 0),
        _define_property$1x(this, "_serial", Date.now().toString()),
        _define_property$1x(this, "_timing", void 0),
        _define_property$1x(this, "fullscreen", void 0),
        _define_property$1x(this, "_isDestroyed", !1),
        _define_property$1x(this, "_deferredPlay", void 0),
        (this.services = n.services),
        (this._dispatcher = n.services.dispatcher),
        (this._timing = n.services.timing),
        (this._context = n.context || {}),
        (this.privateEnabled = n.privateEnabled || !1),
        (this.siriInitiated = n.siriInitiated || !1),
        (this._bitrateCalculator = n.services.bitrateCalculator),
        (this.windowHandlers = new WindowHandlers(this, n.services.runtime)),
        (this.fullscreen = new Fullscreen(this)),
        null === (d = getLocalStorage()) ||
          void 0 === d ||
          d.setItem(nt, this._serial),
        this._dispatcher.subscribe(Sn, this.onPlaybackError);
    }
  }
  function generateAssetUrl(e, n) {
    if ("Preview" === e.type && isStringNotEmpty(e.previewURL))
      return e.previewURL;
    let d = e.assetURL;
    if (!d) throw new Error("Cannot generate asset URL");
    return (
      n &&
        (n.startOver && (d = addQueryParamsToURL(d, { startOver: !0 })),
        n.bingeWatching && (d = addQueryParamsToURL(d, { bingeWatching: !0 }))),
      e.supportsLinearScrubbing &&
        (d = addQueryParamsToURL(d, { linearScrubbingSupported: !0 })),
      d.match(/xapsub=accepts-css/) ||
        (d = addQueryParamsToURL(d, { xapsub: "accepts-css" })),
      d
    );
  }
  var qn;
  function toPersistedTrack(e) {
    return { label: e.label, kind: e.kind, language: e.language };
  }
  function saveTrack(e, n) {
    var d, p;
    (d = e),
      (p = toPersistedTrack(n)),
      hasLocalStorage() &&
        (p
          ? getLocalStorage().setItem(d, JSON.stringify(p))
          : getLocalStorage().setItem(d, ""));
  }
  function loadTrack(e) {
    return getJsonFromLocalStorage(e);
  }
  function trackEquals(e, n) {
    const d = toPersistedTrack(e),
      p = toPersistedTrack(n);
    for (const h of Object.keys(d)) if (d[h] !== p[h]) return !1;
    return !0;
  }
  function _define_property$1w(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$y("design:type", Function),
      _ts_metadata$y("design:paramtypes", [
        String,
        void 0 === MKError ? Object : MKError,
      ]),
      _ts_metadata$y("design:returntype", void 0),
    ],
    BasePlayer.prototype,
    "onPlaybackError",
    null
  ),
    (function (e) {
      (e.Home = "com.apple.amp.appletv.home-team-radio"),
        (e.Away = "com.apple.amp.appletv.away-team-radio");
    })(qn || (qn = {}));
  class AudioTrackManager {
    get isDestroyed() {
      return this._isDestroyed;
    }
    get currentTrack() {
      return this.tracks.find((e) => e.enabled);
    }
    set currentTrack(e) {
      e &&
        (He.debug("MEDIA_TRACK Setting audio track " + e.label),
        this.extensionTracks
          ? (He.debug(
              `MEDIA_TRACK Setting track on extension ${e.id}-${e.label}`
            ),
            (this.extensionTracks.audioTrack = e))
          : (He.debug("MEDIA_TRACK disabling all audio tracks"),
            Array.from(this.mediaElement.audioTracks).forEach((n) => {
              n !== e && (n.enabled = !1);
            }),
            He.debug("MEDIA_TRACK enabling", e),
            (e.enabled = !0)),
        (function (e) {
          return (
            void 0 !== e.characteristics &&
            e.characteristics.includes("com.apple.amp.appletv.home-team-radio")
          );
        })(e) ||
          (function (e) {
            return (
              void 0 !== e.characteristics &&
              e.characteristics.includes(
                "com.apple.amp.appletv.away-team-radio"
              )
            );
          })(e) ||
          (saveTrack("mk-audio-track", e),
          He.debug(
            `MEDIA_TRACK save track selection ${e.language},${e.label},${e.kind}`
          )));
    }
    get tracks() {
      return this.extensionTracks
        ? this._extensionTracks || this.extensionTracks.audioTracks || []
        : Array.from(this.mediaElement.audioTracks);
    }
    destroy() {
      if (((this._isDestroyed = !0), this.extensionTracks)) {
        const e = this.extensionTracks;
        e.removeEventListener(
          at.audioTracksUpdated,
          this.onExtensionAudioTracksUpdated
        ),
          e.removeEventListener(
            at.audioTracksSwitched,
            this.onExtensionAudioTrackSwitched
          );
      } else {
        if (!this.mediaElement.audioTracks) return;
        this.mediaElement.audioTracks.removeEventListener(
          "addtrack",
          this.onAudioTrackAdded
        ),
          this.mediaElement.audioTracks.removeEventListener(
            "change",
            this.onAudioTrackChanged
          ),
          this.mediaElement.audioTracks.removeEventListener(
            "removetrack",
            this.onAudioTrackRemoved
          );
      }
    }
    onExtensionAudioTracksUpdated(e) {
      var n;
      He.debug(
        "MEDIA_TRACK Extension audio tracks updated " + JSON.stringify(e)
      ),
        (this._extensionTracks = e);
      const d = loadTrack("mk-audio-track");
      if (
        (null === (n = this.tracks) || void 0 === n ? void 0 : n.length) >= 0 &&
        void 0 !== d &&
        (void 0 === this.currentTrack || !trackEquals(this.currentTrack, d))
      )
        for (const p of this.tracks)
          if (trackEquals(p, d)) {
            He.debug("Found track matching persisted track: " + p.label),
              (this.currentTrack = p);
            break;
          }
      this.dispatcher.publish(wt.audioTrackAdded, e);
    }
    onExtensionAudioTrackSwitched(e) {
      if (
        (He.debug(
          "MEDIA_TRACK Extension audio track switched " + JSON.stringify(e)
        ),
        this._extensionTracks)
      ) {
        const preserveSelectedTrack = (n) => {
          n.enabled = e.selectedId === n.id;
        };
        this._extensionTracks.forEach(preserveSelectedTrack);
      }
      this.dispatcher.publish(wt.audioTrackChanged, e);
    }
    onAudioTrackAdded(e) {
      const n = loadTrack("mk-audio-track");
      void 0 !== n &&
        trackEquals(e.track, n) &&
        (He.debug("Found new track matching persisted track: " + e.track.label),
        (this.currentTrack = e.track)),
        this.dispatcher.publish(wt.audioTrackAdded, e);
    }
    onAudioTrackChanged(e) {
      this.dispatcher.publish(wt.audioTrackChanged, e);
    }
    onAudioTrackRemoved(e) {
      this.dispatcher.publish(wt.audioTrackRemoved, e);
    }
    constructor(e, n, d) {
      if (
        (_define_property$1w(this, "mediaElement", void 0),
        _define_property$1w(this, "dispatcher", void 0),
        _define_property$1w(this, "extensionTracks", void 0),
        _define_property$1w(this, "_extensionTracks", void 0),
        _define_property$1w(this, "_isDestroyed", void 0),
        (this.mediaElement = e),
        (this.dispatcher = n),
        (this.extensionTracks = d),
        (this._extensionTracks = []),
        (this._isDestroyed = !1),
        this.extensionTracks)
      ) {
        He.debug(
          "MEDIA_TRACK Initializing audio track manager for hls track events"
        ),
          (this.onExtensionAudioTracksUpdated =
            this.onExtensionAudioTracksUpdated.bind(this)),
          (this.onExtensionAudioTrackSwitched =
            this.onExtensionAudioTrackSwitched.bind(this));
        const e = this.extensionTracks;
        e.addEventListener(
          at.audioTracksUpdated,
          this.onExtensionAudioTracksUpdated
        ),
          e.addEventListener(
            at.audioTracksSwitched,
            this.onExtensionAudioTrackSwitched
          );
      } else {
        if (!e.audioTracks) return;
        He.debug(
          "MEDIA_TRACK Initializing audio track manager for native track events"
        ),
          (this.onAudioTrackAdded = this.onAudioTrackAdded.bind(this)),
          (this.onAudioTrackChanged = this.onAudioTrackChanged.bind(this)),
          (this.onAudioTrackRemoved = this.onAudioTrackRemoved.bind(this)),
          e.audioTracks.addEventListener("addtrack", this.onAudioTrackAdded),
          e.audioTracks.addEventListener("change", this.onAudioTrackChanged),
          e.audioTracks.addEventListener(
            "removetrack",
            this.onAudioTrackRemoved
          );
      }
    }
  }
  const Hn = [],
    Wn = [];
  function nextAvailableAudioElement() {
    let e = Wn.pop();
    return (
      e
        ? He.debug(`dom-helpers: retrieving audio tag, ${Wn.length} remain`)
        : (He.debug("dom-helpers: no available audio tags, creating one"),
          (e = document.createElement("audio"))),
      e
    );
  }
  function deferPlayback() {
    fillAvailableElements("audio", Wn),
      fillAvailableElements("video", Hn),
      He.debug(
        `dom-helpers: defer playback called.  There are ${Hn.length} available video elements and ${Wn.length} available audio elements.`
      );
  }
  function fillAvailableElements(e, n) {
    let d = 100 - n.length;
    for (; d > 0; ) {
      const p = document.createElement(e);
      p.load(), n.push(p), d--;
    }
  }
  const Yn = BooleanDevFlag.register("mk-load-manifest-once"),
    shouldLoadManifestOnce = () => !Yn.configured || Yn.enabled;
  var zn =
    "undefined" != typeof globalThis
      ? globalThis
      : "undefined" != typeof window
        ? window
        : void 0 !== n
          ? n
          : "undefined" != typeof self
            ? self
            : {};
  function unwrapExports(e) {
    return e &&
      e.__esModule &&
      Object.prototype.hasOwnProperty.call(e, "default")
      ? e.default
      : e;
  }
  function createCommonjsModule(e, n) {
    return e((n = { exports: {} }), n.exports), n.exports;
  }
  var Qn = createCommonjsModule(function (e, n) {
    Object.defineProperty(n, "__esModule", { value: !0 }),
      (n.isValidScrollSetting =
        n.isValidPositionAlignSetting =
        n.isValidLineAlignSetting =
        n.isValidLineAndPositionSetting =
        n.isValidDirectionSetting =
        n.isValidAlignSetting =
        n.isValidPercentValue =
          void 0),
      (n.isValidPercentValue = function (e) {
        return "number" == typeof e && e >= 0 && e <= 100;
      }),
      (n.isValidAlignSetting = function (e) {
        return (
          "string" == typeof e &&
          ["start", "center", "end", "left", "right", "middle"].includes(e)
        );
      }),
      (n.isValidDirectionSetting = function (e) {
        return "string" == typeof e && ["", "rl", "lr"].includes(e);
      }),
      (n.isValidLineAndPositionSetting = function (e) {
        return "number" == typeof e || "auto" === e;
      }),
      (n.isValidLineAlignSetting = function (e) {
        return "string" == typeof e && ["start", "center", "end"].includes(e);
      }),
      (n.isValidPositionAlignSetting = function (e) {
        return (
          "string" == typeof e &&
          [
            "line-left",
            "center",
            "line-right",
            "auto",
            "left",
            "start",
            "middle",
            "end",
            "right",
          ].includes(e)
        );
      }),
      (n.isValidScrollSetting = function (e) {
        return ["", "up"].includes(e);
      });
  });
  unwrapExports(Qn),
    Qn.isValidScrollSetting,
    Qn.isValidPositionAlignSetting,
    Qn.isValidLineAlignSetting,
    Qn.isValidLineAndPositionSetting,
    Qn.isValidDirectionSetting,
    Qn.isValidAlignSetting,
    Qn.isValidPercentValue;
  var Jn = createCommonjsModule(function (e, n) {
    Object.defineProperty(n, "__esModule", { value: !0 });
    const d = {
        "&amp;": "&",
        "&lt;": "<",
        "&gt;": ">",
        "&lrm;": "",
        "&rlm;": "",
        "&nbsp;": "",
      },
      p = {
        c: "span",
        i: "i",
        b: "b",
        u: "u",
        ruby: "ruby",
        rt: "rt",
        v: "span",
        lang: "span",
      },
      h = { v: "title", lang: "lang" },
      y = { rt: "ruby" },
      _ = {
        "text-combine-upright":
          "-webkit-text-combine:horizontal; text-orientation: mixed;",
      };
    class ParserUtility {
      static parseTimeStamp(e) {
        function computeSeconds(e) {
          const [n, d, p, h] = e.map((e) => (e ? parseInt("" + e) : 0));
          return 3600 * n + 60 * d + p + h / 1e3;
        }
        const n = /^(\d+):(\d{2})(:\d{2})?\.(\d{3})/.exec(e);
        return n
          ? n[3]
            ? computeSeconds([n[1], n[2], n[3].substring(1), n[4]])
            : parseInt(n[1]) > 59
              ? computeSeconds([n[1], n[2], null, n[4]])
              : computeSeconds([null, n[1], n[2], n[4]])
          : null;
      }
      static parseContent(e, n, m) {
        let g = n.text;
        function nextToken() {
          if (!g) return null;
          const e = /^([^<]*)(<[^>]+>?)?/.exec(g);
          return (n = e[1] ? e[1] : e[2]), (g = g.substr(n.length)), n;
          var n;
        }
        function unescape1(e) {
          return d[e];
        }
        function unescape(e) {
          return e.replace(/&(amp|lt|gt|lrm|rlm|nbsp);/g, unescape1);
        }
        function shouldAdd(e, n) {
          return (
            !y[n.dataset.localName] ||
            y[n.dataset.localName] === e.dataset.localName
          );
        }
        function createElement(n, d, y) {
          const g = p[n];
          if (!g) return null;
          const b = e.document.createElement(g);
          b.dataset.localName = g;
          const P = h[n];
          if ((P && y && (b[P] = y.trim()), d))
            if (m[d]) {
              const e = (function (e) {
                let n = "";
                for (const d in e) n += _[d] ? _[d] : d + ":" + e[d] + ";";
                return n;
              })(m[d]);
              b.setAttribute("style", e);
            } else
              console.info(
                `WebVTT: parseContent: Style referenced, but no style defined for '${d}'!`
              );
          return b;
        }
        const b = e.document.createElement("div"),
          P = [];
        let S,
          T,
          k = b;
        for (; null !== (S = nextToken()); )
          if ("<" !== S[0])
            k.appendChild(e.document.createTextNode(unescape(S)));
          else {
            if ("/" === S[1]) {
              P.length &&
                P[P.length - 1] === S.substr(2).replace(">", "") &&
                (P.pop(), (k = k.parentNode));
              continue;
            }
            const n = ParserUtility.parseTimeStamp(S.substr(1, S.length - 2));
            let d;
            if (n) {
              (d = e.document.createProcessingInstruction(
                "timestamp",
                n.toString()
              )),
                k.appendChild(d);
              continue;
            }
            if (
              ((T = /^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/.exec(S)),
              !T)
            )
              continue;
            if (((d = createElement(T[1], T[2], T[3])), !d)) continue;
            if (!shouldAdd(k, d)) continue;
            T[2], P.push(T[1]), k.appendChild(d), (k = d);
          }
        return b;
      }
    }
    n.default = ParserUtility;
  });
  unwrapExports(Jn);
  var Xn = createCommonjsModule(function (e, n) {
    var d =
      (zn && zn.__decorate) ||
      function (e, n, d, p) {
        var h,
          y = arguments.length,
          _ =
            y < 3
              ? n
              : null === p
                ? (p = Object.getOwnPropertyDescriptor(n, d))
                : p;
        if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
          _ = Reflect.decorate(e, n, d, p);
        else
          for (var m = e.length - 1; m >= 0; m--)
            (h = e[m]) &&
              (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
        return y > 3 && _ && Object.defineProperty(n, d, _), _;
      };
    Object.defineProperty(n, "__esModule", { value: !0 }), (n.VTTCue = void 0);
    let p = class {
      get id() {
        return this._id;
      }
      set id(e) {
        this._id = "" + e;
      }
      get pauseOnExit() {
        return this._pauseOnExit;
      }
      set pauseOnExit(e) {
        this._pauseOnExit = !!e;
      }
      get startTime() {
        return this._startTime;
      }
      set startTime(e) {
        if ("number" != typeof e)
          throw new TypeError("Start time must be set to a number: " + e);
        (this._startTime = e), (this.hasBeenReset = !0);
      }
      get endTime() {
        return this._endTime;
      }
      set endTime(e) {
        if ("number" != typeof e)
          throw new TypeError("End time must be set to a number: " + e);
        (this._endTime = e), (this.hasBeenReset = !0);
      }
      get text() {
        return this._text;
      }
      set text(e) {
        (this._text = "" + e), (this.hasBeenReset = !0);
      }
      get region() {
        return this._region;
      }
      set region(e) {
        (this._region = e), (this.hasBeenReset = !0);
      }
      get vertical() {
        return this._vertical;
      }
      set vertical(e) {
        if (!Qn.isValidDirectionSetting(e))
          throw new SyntaxError(
            "An invalid or illegal string was specified for vertical: " + e
          );
        (this._vertical = e), (this.hasBeenReset = !0);
      }
      get snapToLines() {
        return this._snapToLines;
      }
      set snapToLines(e) {
        (this._snapToLines = !!e), (this.hasBeenReset = !0);
      }
      get line() {
        return this._line;
      }
      set line(e) {
        if (!Qn.isValidLineAndPositionSetting(e))
          throw new SyntaxError(
            "An invalid number or illegal string was specified for line: " + e
          );
        (this._line = e), (this.hasBeenReset = !0);
      }
      get lineAlign() {
        return this._lineAlign;
      }
      set lineAlign(e) {
        if (!Qn.isValidLineAlignSetting(e))
          throw new SyntaxError(
            "An invalid or illegal string was specified for lineAlign: " + e
          );
        (this._lineAlign = e), (this.hasBeenReset = !0);
      }
      get position() {
        return this._position;
      }
      set position(e) {
        if (!Qn.isValidLineAndPositionSetting(e))
          throw new Error("Position must be between 0 and 100 or auto: " + e);
        (this._position = e), (this.hasBeenReset = !0);
      }
      get positionAlign() {
        return this._positionAlign;
      }
      set positionAlign(e) {
        if (!Qn.isValidPositionAlignSetting(e))
          throw new SyntaxError(
            "An invalid or illegal string was specified for positionAlign: " + e
          );
        (this._positionAlign = e), (this.hasBeenReset = !0);
      }
      get size() {
        return this._size;
      }
      set size(e) {
        if (e < 0 || e > 100)
          throw new Error("Size must be between 0 and 100: " + e);
        (this._size = e), (this.hasBeenReset = !0);
      }
      get align() {
        return this._align;
      }
      set align(e) {
        if (!Qn.isValidAlignSetting(e))
          throw new SyntaxError(
            "An invalid or illegal string was specified for align: " + e
          );
        (this._align = e), (this.hasBeenReset = !0);
      }
      getCueAsHTML() {
        return Jn.default.parseContent(window, this, {});
      }
      static create(e) {
        if (
          !e.hasOwnProperty("startTime") ||
          !e.hasOwnProperty("endTime") ||
          !e.hasOwnProperty("text")
        )
          throw new Error(
            "You must at least have start time, end time, and text."
          );
        const n = new this(e.startTime, e.endTime, e.text);
        return (
          Object.keys(e).forEach((d) => {
            n.hasOwnProperty(d) && (n[d] = e[d]);
          }),
          n
        );
      }
      static fromJSON(e) {
        return this.create(JSON.parse(e));
      }
      toJSON() {
        const e = {};
        return (
          Object.keys(this).forEach((n) => {
            this.hasOwnProperty(n) &&
              "getCueAsHTML" !== n &&
              "hasBeenReset" !== n &&
              "displayState" !== n &&
              (e[n] = this[n]);
          }),
          e
        );
      }
      constructor(e, n, d) {
        (this._id = ""),
          (this._pauseOnExit = !1),
          (this._region = null),
          (this._vertical = ""),
          (this._snapToLines = !0),
          (this._line = "auto"),
          (this._lineAlign = "start"),
          (this._position = "auto"),
          (this._positionAlign = "auto"),
          (this._size = 100),
          (this._align = "center"),
          (this.hasBeenReset = !1),
          (this._startTime = e),
          (this._endTime = n),
          (this._text = d);
      }
    };
    (p = d(
      [
        function (e) {
          let n = e;
          "undefined" != typeof window &&
            null != window.VTTCue &&
            ((n = window.VTTCue),
            (n.create = e.create),
            (n.fromJSON = e.fromJSON),
            (n.prototype.toJSON = e.prototype.toJSON));
          return n;
        },
      ],
      p
    )),
      (n.VTTCue = p);
  });
  unwrapExports(Xn), Xn.VTTCue;
  var Zn = createCommonjsModule(function (e, n) {
    var d =
      (zn && zn.__decorate) ||
      function (e, n, d, p) {
        var h,
          y = arguments.length,
          _ =
            y < 3
              ? n
              : null === p
                ? (p = Object.getOwnPropertyDescriptor(n, d))
                : p;
        if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
          _ = Reflect.decorate(e, n, d, p);
        else
          for (var m = e.length - 1; m >= 0; m--)
            (h = e[m]) &&
              (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
        return y > 3 && _ && Object.defineProperty(n, d, _), _;
      };
    Object.defineProperty(n, "__esModule", { value: !0 }),
      (n.VTTRegion = void 0);
    let p = class {
      get id() {
        return this._id;
      }
      set id(e) {
        if ("string" != typeof e) throw new Error("ID must be a string.");
        this._id = e;
      }
      get lines() {
        return this._lines;
      }
      set lines(e) {
        if ("number" != typeof e)
          throw new TypeError("Lines must be set to a number.");
        this._lines = e;
      }
      get regionAnchorX() {
        return this._regionAnchorX;
      }
      set regionAnchorX(e) {
        if (!Qn.isValidPercentValue(e))
          throw new TypeError("RegionAnchorX must be between 0 and 100.");
        this._regionAnchorX = e;
      }
      get regionAnchorY() {
        return this._regionAnchorY;
      }
      set regionAnchorY(e) {
        if (!Qn.isValidPercentValue(e))
          throw new TypeError("RegionAnchorY must be between 0 and 100.");
        this._regionAnchorY = e;
      }
      get scroll() {
        return this._scroll;
      }
      set scroll(e) {
        if ("string" == typeof e) {
          const n = e.toLowerCase();
          if (Qn.isValidScrollSetting(n)) return void (this._scroll = n);
        }
        throw new SyntaxError("An invalid or illegal string was specified.");
      }
      get viewportAnchorX() {
        return this._viewportAnchorX;
      }
      set viewportAnchorX(e) {
        if (!Qn.isValidPercentValue(e))
          throw new TypeError("ViewportAnchorX must be between 0 and 100.");
        this._viewportAnchorX = e;
      }
      get viewportAnchorY() {
        return this._viewportAnchorY;
      }
      set viewportAnchorY(e) {
        if (!Qn.isValidPercentValue(e))
          throw new TypeError("ViewportAnchorY must be between 0 and 100.");
        this._viewportAnchorY = e;
      }
      get width() {
        return this._width;
      }
      set width(e) {
        if (!Qn.isValidPercentValue(e))
          throw new TypeError("Width must be between 0 and 100.");
        this._lines = e;
      }
      toJSON() {
        const e = {};
        return (
          Object.keys(this).forEach((n) => {
            this.hasOwnProperty(n) && (e[n] = this[n]);
          }),
          e
        );
      }
      static create(e) {
        const n = new this();
        return (
          Object.keys(e).forEach((d) => {
            n.hasOwnProperty(d) && (n[d] = e[d]);
          }),
          n
        );
      }
      static fromJSON(e) {
        return this.create(JSON.parse(e));
      }
      constructor() {
        (this._id = ""),
          (this._lines = 3),
          (this._regionAnchorX = 0),
          (this._regionAnchorY = 100),
          (this._scroll = ""),
          (this._viewportAnchorX = 0),
          (this._viewportAnchorY = 100),
          (this._width = 100);
      }
    };
    (p = d(
      [
        function (e) {
          let n = e;
          "undefined" != typeof window &&
            null != window.VTTRegion &&
            ((n = window.VTTRegion),
            (n.create = e.create),
            (n.fromJSON = e.fromJSON),
            (n.prototype.toJSON = e.prototype.toJSON));
          return n;
        },
      ],
      p
    )),
      (n.VTTRegion = p);
  });
  unwrapExports(Zn), Zn.VTTRegion;
  var ei = createCommonjsModule(function (e, n) {
    Object.defineProperty(n, "__esModule", { value: !0 });
  });
  unwrapExports(ei);
  var ti = createCommonjsModule(function (e, n) {
    var d =
        (zn && zn.__createBinding) ||
        (Object.create
          ? function (e, n, d, p) {
              void 0 === p && (p = d),
                Object.defineProperty(e, p, {
                  enumerable: !0,
                  get: function () {
                    return n[d];
                  },
                });
            }
          : function (e, n, d, p) {
              void 0 === p && (p = d), (e[p] = n[d]);
            }),
      p =
        (zn && zn.__exportStar) ||
        function (e, n) {
          for (var p in e) "default" === p || n.hasOwnProperty(p) || d(n, e, p);
        };
    Object.defineProperty(n, "__esModule", { value: !0 }),
      (n.VTTRegion = n.VTTCue = n.WebVTTParser = n.ParsingError = void 0),
      Object.defineProperty(n, "VTTCue", {
        enumerable: !0,
        get: function () {
          return Xn.VTTCue;
        },
      }),
      Object.defineProperty(n, "VTTRegion", {
        enumerable: !0,
        get: function () {
          return Zn.VTTRegion;
        },
      });
    class ParsingError extends Error {
      constructor(e, n) {
        super(),
          (this.name = "ParsingError"),
          (this.code = "number" == typeof e ? e : e.code),
          n
            ? (this.message = n)
            : e instanceof ParsingError && (this.message = e.message);
      }
    }
    (n.ParsingError = ParsingError),
      (ParsingError.Errors = {
        BadSignature: new ParsingError(0, "Malformed WebVTT signature."),
        BadTimeStamp: new ParsingError(1, "Malformed time stamp."),
      });
    class Settings {
      set(e, n) {
        this.get(e) || "" === n || (this.values[e] = n);
      }
      get(e, n, d) {
        return "object" == typeof n && "string" == typeof d
          ? this.has(e)
            ? this.values[e]
            : n[d]
          : this.has(e)
            ? this.values[e]
            : n;
      }
      has(e) {
        return e in this.values;
      }
      alt(e, n, d) {
        for (let p = 0; p < d.length; ++p)
          if (n === d[p]) {
            this.set(e, n);
            break;
          }
      }
      integer(e, n) {
        /^-?\d+$/.test(n) && this.set(e, parseInt(n, 10));
      }
      percent(e, n) {
        if (n.match(/^([\d]{1,3})(\.[\d]*)?%$/))
          try {
            const d = parseFloat(n);
            if (d >= 0 && d <= 100) return this.set(e, d), !0;
          } catch (d) {
            return !1;
          }
        return !1;
      }
      constructor() {
        this.values = {};
      }
    }
    class WebVTTParser {
      static StringDecoder() {
        return {
          decode: (e) => {
            if (!e) return "";
            if ("string" != typeof e)
              throw new Error("Error - expected string data.");
            return decodeURIComponent(encodeURIComponent(e));
          },
        };
      }
      reportOrThrowError(e) {
        if (
          !(
            e instanceof ParsingError &&
            "function" == typeof this.onparsingerror
          )
        )
          throw e;
        this.onparsingerror(e);
      }
      parseOptions(e, n, d, p) {
        const h = p ? e.split(p) : [e];
        for (const y of h) {
          if ("string" != typeof y) continue;
          const e = y.split(d);
          if (2 !== e.length) continue;
          n(e[0], e[1]);
        }
      }
      parseCue(e, n, d) {
        const p = e,
          consumeTimeStamp = () => {
            const n = Jn.default.parseTimeStamp(e);
            if (null === n)
              throw new ParsingError(
                ParsingError.Errors.BadTimeStamp,
                "Malformed timestamp: " + p
              );
            return (e = e.replace(/^[^\sa-zA-Z-]+/, "")), n;
          },
          skipWhitespace = () => {
            e = e.replace(/^\s+/, "");
          };
        if (
          (skipWhitespace(),
          (n.startTime = consumeTimeStamp()),
          skipWhitespace(),
          "--\x3e" !== e.substr(0, 3))
        )
          throw new ParsingError(
            ParsingError.Errors.BadTimeStamp,
            "Malformed time stamp (time stamps must be separated by '--\x3e'): " +
              p
          );
        (e = e.substr(3)),
          skipWhitespace(),
          (n.endTime = consumeTimeStamp()),
          skipWhitespace(),
          ((e, n) => {
            const p = new Settings();
            this.parseOptions(
              e,
              (e, n) => {
                let h, y;
                switch (e) {
                  case "region":
                    for (let h = d.length - 1; h >= 0; h--)
                      if (d[h].id === n) {
                        p.set(e, d[h].region);
                        break;
                      }
                    break;
                  case "vertical":
                    p.alt(e, n, ["rl", "lr"]);
                    break;
                  case "line":
                    (h = n.split(",")),
                      (y = h[0]),
                      p.integer(e, y),
                      p.percent(e, y) && p.set("snapToLines", !1),
                      p.alt(e, y, ["auto"]),
                      2 === h.length &&
                        p.alt("lineAlign", h[1], [
                          "start",
                          "middle",
                          "center",
                          "end",
                        ]);
                    break;
                  case "position":
                    if (
                      ((h = n.split(",")), p.percent(e, h[0]), 2 === h.length)
                    ) {
                      let e = [
                        "line-left",
                        "line-right",
                        "center",
                        "auto",
                        "left",
                        "start",
                        "middle",
                        "end",
                        "right",
                      ];
                      p.alt("positionAlign", h[1], e);
                    }
                    break;
                  case "size":
                    p.percent(e, n);
                    break;
                  case "align":
                    let _ = [
                      "start",
                      "center",
                      "end",
                      "left",
                      "right",
                      "middle",
                    ];
                    p.alt(e, n, _);
                }
              },
              /:/,
              /\s/
            ),
              (n.region = p.get("region", null)),
              (n.vertical = p.get("vertical", "")),
              (n.line = p.get("line", void 0 === n.line ? "auto" : n.line));
            const h = p.get("lineAlign", "start");
            (n.lineAlign =
              "center" === h || "middle" === h ? this.middleOrCenter : h),
              (n.snapToLines = p.get("snapToLines", !0)),
              (n.size = p.get("size", 100));
            const y = p.get("align", "center");
            (n.align =
              "center" === y || "middle" === y ? this.middleOrCenter : y),
              (n.position = p.get("position", "auto"));
            let _ = p.get(
              "positionAlign",
              {
                start: "start",
                left: "start",
                center: "center",
                middle: "middle",
                right: "end",
                end: "end",
              },
              n.align
            );
            n.positionAlign =
              "center" === _ || "middle" === _
                ? this.middleOrCenter
                : {
                    start: "start",
                    "line-left": "start",
                    left: "start",
                    center: "center",
                    middle: "middle",
                    "line-right": "end",
                    right: "end",
                    end: "end",
                  }[_];
          })(e, n);
      }
      parseRegion(e) {
        const n = new Settings();
        if (
          (this.parseOptions(
            e,
            (e, d) => {
              switch (e) {
                case "id":
                  n.set(e, d);
                  break;
                case "width":
                  n.percent(e, d);
                  break;
                case "lines":
                  n.integer(e, d);
                  break;
                case "regionanchor":
                case "viewportanchor": {
                  const p = d.split(",");
                  if (2 !== p.length) break;
                  const h = new Settings();
                  if (
                    (h.percent("x", p[0]),
                    h.percent("y", p[1]),
                    !h.has("x") || !h.has("y"))
                  )
                    break;
                  n.set(e + "X", h.get("x")), n.set(e + "Y", h.get("y"));
                  break;
                }
                case "scroll":
                  n.alt(e, d, ["up"]);
              }
            },
            /=/,
            /\s/
          ),
          n.has("id"))
        ) {
          const e = new Zn.VTTRegion();
          (e.width = n.get("width", 100)),
            (e.lines = n.get("lines", 3)),
            (e.regionAnchorX = n.get("regionanchorX", 0)),
            (e.regionAnchorY = n.get("regionanchorY", 100)),
            (e.viewportAnchorX = n.get("viewportanchorX", 0)),
            (e.viewportAnchorY = n.get("viewportanchorY", 100)),
            (e.scroll = n.get("scroll", "")),
            this.onregion && this.onregion(e),
            this.regionList.push({ id: n.get("id"), region: e });
        }
      }
      parseStyle(e) {
        const parseStyles = (e) => {
            const n = {},
              d = e.split(";");
            for (let p = 0; p < d.length; p++)
              if (d[p].includes(":")) {
                const e = d[p].split(":", 2),
                  h = e[0].trim(),
                  y = e[1].trim();
                "" !== h && "" !== y && (n[h] = y);
              }
            return n;
          },
          n = e.split("}");
        n.pop();
        for (const d of n) {
          let e = null,
            n = null;
          const p = d.split("{");
          p[0] && (e = p[0].trim()),
            p[1] && (n = parseStyles(p[1])),
            e && n && (this._styles[e] = n);
        }
        this.onStylesParsedCallback &&
          this.onStylesParsedCallback(this._styles);
      }
      parseHeader(e) {
        this.parseOptions(
          e,
          function (e, n) {
            switch (e) {
              case "Region":
                this.parseRegion(n);
            }
          },
          /:/
        );
      }
      parse(e) {
        e && (this.buffer += this.decoder.decode(e, { stream: !0 }));
        const collectNextLine = () => {
          const e = this.buffer;
          let n = 0;
          const calculateBreakPosition = (e, n) => {
            const d = { start: -1, length: -1 };
            if ("\r" === e[n]) (d.start = n), (d.length = 1);
            else if ("\n" === e[n]) (d.start = n), (d.length = 1);
            else if (
              "<" === e[n] &&
              n + 1 < e.length &&
              "b" === e[n + 1] &&
              n + 2 < e.length &&
              "r" === e[n + 2]
            ) {
              let p = n + 2;
              for (; p < e.length && ">" !== e[p++]; );
              (d.start = n), (d.length = p - n);
            }
            return d;
          };
          let d = { start: e.length, length: 0 };
          for (; n < e.length; ) {
            const p = calculateBreakPosition(e, n);
            if (p.length > 0) {
              d = p;
              break;
            }
            ++n;
          }
          const p = e.substr(0, d.start);
          return (this.buffer = e.substr(d.start + d.length)), p;
        };
        try {
          let e;
          if ("INITIAL" === this.state) {
            if (!/\r\n|\n/.test(this.buffer)) return this;
            (this.alreadyCollectedLine = ""), (e = collectNextLine());
            const n = /^()?WEBVTT([ \t].*)?$/.exec(e);
            if (!n || !n[0])
              throw new ParsingError(ParsingError.Errors.BadSignature);
            this.state = "HEADER";
          }
          for (; this.buffer; ) {
            if (!/\r\n|\n/.test(this.buffer)) return this;
            switch (
              (this.alreadyCollectedLine
                ? ((e = this.alreadyCollectedLine),
                  (this.alreadyCollectedLine = ""))
                : (e = collectNextLine()),
              this.state)
            ) {
              case "HEADER":
                e.includes(":")
                  ? this.parseHeader(e)
                  : e || (this.state = "ID");
                continue;
              case "NOTE":
                e || (this.state = "ID");
                continue;
              case "STYLE":
                e
                  ? (this.styleCollector += e)
                  : (this.parseStyle(this.styleCollector),
                    (this.state = "ID"),
                    (this.styleCollector = ""));
                continue;
              case "ID":
                if (/^NOTE($|[ \t])/.test(e)) {
                  this.state = "NOTE";
                  break;
                }
                if (/^STYLE($|[ \t])/.test(e)) {
                  this.state = "STYLE";
                  break;
                }
                if (!e) continue;
                if (
                  ((this.cue = new Xn.VTTCue(0, 0, "")),
                  (this.state = "CUE"),
                  !e.includes("--\x3e"))
                ) {
                  this.cue.id = e;
                  continue;
                }
              case "CUE":
                try {
                  this.parseCue(e, this.cue, this.regionList);
                } catch (Yt) {
                  this.reportOrThrowError(Yt),
                    (this.cue = null),
                    (this.state = "BADCUE");
                  continue;
                }
                this.state = "CUETEXT";
                continue;
              case "CUETEXT": {
                const n = e.includes("--\x3e");
                if (!e || n) {
                  (this.alreadyCollectedLine = e),
                    this.oncue && this.oncue(this.cue),
                    (this.cue = null),
                    (this.state = "ID");
                  continue;
                }
                this.cue.text && (this.cue.text += "\n"), (this.cue.text += e);
                continue;
              }
              case "BADCUE":
                e || (this.state = "ID");
                continue;
            }
          }
        } catch (Yt) {
          this.reportOrThrowError(Yt),
            "CUETEXT" === this.state &&
              this.cue &&
              this.oncue &&
              this.oncue(this.cue),
            (this.cue = null),
            (this.state = "INITIAL" === this.state ? "BADWEBVTT" : "BADCUE");
        }
        return this;
      }
      flush() {
        try {
          if (
            ((this.buffer += this.decoder.decode()),
            (this.cue || "HEADER" === this.state) &&
              ((this.buffer += "\n\n"), this.parse()),
            "INITIAL" === this.state)
          )
            throw new ParsingError(ParsingError.Errors.BadSignature);
        } catch (Yt) {
          this.reportOrThrowError(Yt);
        }
        return this.onflush && this.onflush(), this;
      }
      styles() {
        return this._styles;
      }
      constructor(e, n, d) {
        (this.window = e),
          (this.state = "INITIAL"),
          (this.styleCollector = ""),
          (this.buffer = ""),
          (this.decoder = n || new TextDecoder("utf8")),
          (this.regionList = []),
          (this.alreadyCollectedLine = ""),
          (this.onStylesParsedCallback = d),
          (this._styles = {}),
          (this.middleOrCenter = "center");
        const p = new Xn.VTTCue(0, 0, "middleOrCenter");
        try {
          (p.align = "center"),
            "center" !== p.align && (this.middleOrCenter = "middle");
        } catch (Yt) {
          this.middleOrCenter = "middle";
        }
      }
    }
    (n.default = WebVTTParser), (n.WebVTTParser = WebVTTParser), p(ei, n);
  });
  unwrapExports(ti), ti.VTTRegion, ti.VTTCue, ti.WebVTTParser, ti.ParsingError;
  var ri = createCommonjsModule(function (e, n) {
    var d =
        (zn && zn.__createBinding) ||
        (Object.create
          ? function (e, n, d, p) {
              void 0 === p && (p = d),
                Object.defineProperty(e, p, {
                  enumerable: !0,
                  get: function () {
                    return n[d];
                  },
                });
            }
          : function (e, n, d, p) {
              void 0 === p && (p = d), (e[p] = n[d]);
            }),
      p =
        (zn && zn.__exportStar) ||
        function (e, n) {
          for (var p in e) "default" === p || n.hasOwnProperty(p) || d(n, e, p);
        };
    Object.defineProperty(n, "__esModule", { value: !0 }),
      (n.VTTCue =
        n.WebVTTRenderer =
        n.BoxPosition =
        n.CueStyleBox =
        n.StyleBox =
          void 0),
      Object.defineProperty(n, "VTTCue", {
        enumerable: !0,
        get: function () {
          return Xn.VTTCue;
        },
      });
    const h = [
        /^(::cue\()(\..*)(\))/,
        /^(::cue\()(#.*)(\))/,
        /^(::cue\()(c|i|b|u|ruby|rt|v|lang)(\))/,
      ],
      y = [
        [1470, 1470],
        [1472, 1472],
        [1475, 1475],
        [1478, 1478],
        [1488, 1514],
        [1520, 1524],
        [1544, 1544],
        [1547, 1547],
        [1549, 1549],
        [1563, 1563],
        [1566, 1610],
        [1645, 1647],
        [1649, 1749],
        [1765, 1766],
        [1774, 1775],
        [1786, 1805],
        [1807, 1808],
        [1810, 1839],
        [1869, 1957],
        [1969, 1969],
        [1984, 2026],
        [2036, 2037],
        [2042, 2042],
        [2048, 2069],
        [2074, 2074],
        [2084, 2084],
        [2088, 2088],
        [2096, 2110],
        [2112, 2136],
        [2142, 2142],
        [2208, 2208],
        [2210, 2220],
        [8207, 8207],
        [64285, 64285],
        [64287, 64296],
        [64298, 64310],
        [64312, 64316],
        [64318, 64318],
        [64320, 64321],
        [64323, 64324],
        [64326, 64449],
        [64467, 64829],
        [64848, 64911],
        [64914, 64967],
        [65008, 65020],
        [65136, 65140],
        [65142, 65276],
        [67584, 67589],
        [67592, 67592],
        [67594, 67637],
        [67639, 67640],
        [67644, 67644],
        [67647, 67669],
        [67671, 67679],
        [67840, 67867],
        [67872, 67897],
        [67903, 67903],
        [67968, 68023],
        [68030, 68031],
        [68096, 68096],
        [68112, 68115],
        [68117, 68119],
        [68121, 68147],
        [68160, 68167],
        [68176, 68184],
        [68192, 68223],
        [68352, 68405],
        [68416, 68437],
        [68440, 68466],
        [68472, 68479],
        [68608, 68680],
        [126464, 126467],
        [126469, 126495],
        [126497, 126498],
        [126500, 126500],
        [126503, 126503],
        [126505, 126514],
        [126516, 126519],
        [126521, 126521],
        [126523, 126523],
        [126530, 126530],
        [126535, 126535],
        [126537, 126537],
        [126539, 126539],
        [126541, 126543],
        [126545, 126546],
        [126548, 126548],
        [126551, 126551],
        [126553, 126553],
        [126555, 126555],
        [126557, 126557],
        [126559, 126559],
        [126561, 126562],
        [126564, 126564],
        [126567, 126570],
        [126572, 126578],
        [126580, 126583],
        [126585, 126588],
        [126590, 126590],
        [126592, 126601],
        [126603, 126619],
        [126625, 126627],
        [126629, 126633],
        [126635, 126651],
        [1114109, 1114109],
      ];
    class StyleBox {
      applyStyles(e, n) {
        n = n || this.div;
        for (const d in e) e.hasOwnProperty(d) && (n.style[d] = e[d]);
      }
      formatStyle(e, n) {
        return 0 === e ? "0" : e + n;
      }
    }
    n.StyleBox = StyleBox;
    class CueStyleBox extends StyleBox {
      determineBidi(e) {
        let n,
          d = [],
          p = "";
        if (!e || !e.childNodes) return "ltr";
        function pushNodes(e, n) {
          for (let d = n.childNodes.length - 1; d >= 0; d--)
            e.push(n.childNodes[d]);
        }
        function nextTextNode(e) {
          if (!e || !e.length) return null;
          let n = e.pop(),
            d = n.textContent || n.innerText;
          if (d) {
            const n = /^.*(\n|\r)/.exec(d);
            return n ? ((e.length = 0), n[0]) : d;
          }
          return "ruby" === n.tagName
            ? nextTextNode(e)
            : n.childNodes
              ? (pushNodes(e, n), nextTextNode(e))
              : void 0;
        }
        function isContainedInCharacterList(e, n) {
          for (const d of n) if (e >= d[0] && e <= d[1]) return !0;
          return !1;
        }
        for (pushNodes(d, e); (p = nextTextNode(d)); )
          for (let e = 0; e < p.length; e++)
            if (((n = p.charCodeAt(e)), isContainedInCharacterList(n, y)))
              return "rtl";
        return "ltr";
      }
      parseOpacity(e) {
        if (!e || "string" != typeof e) return null;
        const n = (e = e
          .replace(/ /g, "")
          .replace("rgba(", "")
          .replace(")", "")).split(",");
        return n && n.length >= 4 ? n[3] : null;
      }
      directionSettingToWritingMode(e) {
        return "" === e
          ? "horizontal-tb"
          : "lr" === e
            ? "vertical-lr"
            : "vertical-rl";
      }
      move(e) {
        this.applyStyles({
          top: this.formatStyle(e.top, "px"),
          bottom: this.formatStyle(e.bottom, "px"),
          left: this.formatStyle(e.left, "px"),
          right: this.formatStyle(e.right, "px"),
          height: this.formatStyle(e.height, "px"),
          width: this.formatStyle(e.width, "px"),
        });
      }
      constructor(e, n, d, p, h) {
        super(), (this.cue = n);
        let y =
          {
            start: "left",
            "line-left": "left",
            left: "left",
            center: "center",
            middle: "center",
            "line-right": "right",
            right: "right",
            end: "right",
          }[n.positionAlign] || n.align;
        "middle" === y && (y = "center");
        let _ = { textAlign: y, whiteSpace: "pre-line", position: "absolute" };
        (_.direction = this.determineBidi(this.cueDiv)),
          (_.writingMode = this.directionSettingToWritingMode(n.vertical)),
          (_.unicodeBidi = "plaintext"),
          (this.div = e.document.createElement("div")),
          this.applyStyles(_),
          (_ = { backgroundColor: p.backgroundColor, display: "inline-block" }),
          this.parseOpacity(_.backgroundColor) &&
            ((_.padding = "5px"), (_.borderRadius = "5px")),
          (this.backgroundDiv = e.document.createElement("div")),
          this.applyStyles(_, this.backgroundDiv),
          (_ = {
            color: d.color,
            backgroundColor: d.backgroundColor,
            textShadow: d.textShadow,
            fontSize: d.fontSize,
            fontFamily: d.fontFamily,
            position: "relative",
            left: "0",
            right: "0",
            top: "0",
            bottom: "0",
            display: "inline-block",
            textOrientation: "upright",
          }),
          (_.writingMode = this.directionSettingToWritingMode(n.vertical)),
          (_.unicodeBidi = "plaintext"),
          (this.cueDiv = Jn.default.parseContent(e, n, h)),
          this.applyStyles(_, this.cueDiv),
          this.backgroundDiv.appendChild(this.cueDiv),
          this.div.appendChild(this.backgroundDiv);
        let m = 0;
        if ("number" == typeof n.position) {
          let e = n.positionAlign || n.align;
          if (e)
            switch (e) {
              case "start":
              case "left":
                m = n.position;
                break;
              case "center":
              case "middle":
                m = n.position - n.size / 2;
                break;
              case "end":
              case "right":
                m = n.position - n.size;
            }
        }
        "" === n.vertical
          ? this.applyStyles({
              left: this.formatStyle(m, "%"),
              width: this.formatStyle(n.size, "%"),
            })
          : this.applyStyles({
              top: this.formatStyle(m, "%"),
              height: this.formatStyle(n.size, "%"),
            });
      }
    }
    n.CueStyleBox = CueStyleBox;
    class BoxPosition {
      calculateNewLines(e) {
        let n = 1;
        for (let d = 0; d < e.length; d++) "\n" === e[d] && n++;
        return n;
      }
      move(e, n) {
        switch (((n = void 0 !== n ? n : this.singleLineHeight), e)) {
          case "+x":
            (this.left += n), (this.right += n);
            break;
          case "-x":
            (this.left -= n), (this.right -= n);
            break;
          case "+y":
            (this.top += n), (this.bottom += n);
            break;
          case "-y":
            (this.top -= n), (this.bottom -= n);
        }
      }
      overlaps(e) {
        return (
          this.left < e.right &&
          this.right > e.left &&
          this.top < e.bottom &&
          this.bottom > e.top
        );
      }
      overlapsAny(e) {
        for (const n of e) if (this.overlaps(n)) return !0;
        return !1;
      }
      within(e) {
        return (
          this.top >= e.top &&
          this.bottom <= e.bottom &&
          this.left >= e.left &&
          this.right <= e.right
        );
      }
      moveIfOutOfBounds(e, n) {
        switch (n) {
          case "+x":
            this.left < e.left &&
              ((this.left = e.left), (this.right = this.left + this.width));
            break;
          case "-x":
            this.right > e.right &&
              ((this.right = e.right), (this.left = this.right - this.width));
            break;
          case "+y":
            this.top < e.top &&
              ((this.top = e.top), (this.bottom = this.top + this.height));
            break;
          case "-y":
            this.bottom > e.bottom &&
              ((this.bottom = e.bottom),
              (this.top = this.bottom - this.height));
        }
      }
      toCSSCompatValues(e) {
        return {
          top: this.top - e.top,
          bottom: e.bottom - this.bottom,
          left: this.left - e.left,
          right: e.right - this.right,
          height: this.height,
          width: this.width,
        };
      }
      static getSimpleBoxPosition(e) {
        let n = null;
        e instanceof StyleBox && e.div
          ? (n = e.div)
          : e instanceof HTMLElement && (n = e);
        let d = n.offsetHeight || 0,
          p = n.offsetWidth || 0,
          h = n.offsetTop || 0,
          y = h + d,
          _ = n.getBoundingClientRect();
        const { left: m, right: g } = _;
        return (
          _.top && (h = _.top),
          _.height && (d = _.height),
          _.width && (p = _.width),
          _.bottom && (y = _.bottom),
          { left: m, right: g, top: h, height: d, bottom: y, width: p }
        );
      }
      static getBoxPosition(e, n) {
        if (e && e.length > 0) {
          let d = 0,
            p = e[0][n];
          for (let h = 0; h < e.length; h++)
            n in ["top", "right"]
              ? e[h][n] > p && ((d = h), (p = e[h][n]))
              : n in ["bottom", "left"] &&
                e[h][n] < p &&
                ((d = h), (p = e[h][n]));
          return e[d];
        }
        return null;
      }
      static moveToMinimumDistancePlacement(e, n, d) {
        "height" === e.property
          ? "+y" === n
            ? ((e.top = d.topMostBoxPosition.bottom + 0),
              (e.bottom = e.top + e.height))
            : "-y" === n &&
              ((e.bottom = d.bottomMostBoxPosition.top - 0),
              (e.top = e.bottom - e.height))
          : "width" === e.property &&
            ("+x" === n
              ? ((e.left = d.rightMostBoxPosition.right + 0),
                (e.right = e.left + e.width))
              : "-x" === n &&
                ((e.right = d.leftMostBoxPosition.left - 0),
                (e.left = e.right - e.width)));
      }
      static moveBoxToLinePosition(e, n, d) {
        const p = e.cue;
        let h,
          y = new BoxPosition(e),
          _ = (function (e) {
            if (
              "number" == typeof e.line &&
              (e.snapToLines || (e.line >= 0 && e.line <= 100))
            )
              return e.line;
            if (
              !e.track ||
              !e.track.textTrackList ||
              !e.track.textTrackList.mediaElement
            )
              return -1;
            let n = 0;
            const d = e.track,
              p = d.textTrackList;
            for (let h = 0; h < p.length && p[h] !== d; h++)
              "showing" === p[h].mode && n++;
            return -1 * ++n;
          })(p),
          m = [];
        if (p.snapToLines) {
          let e = 0;
          switch (p.vertical) {
            case "":
              (m = ["+y", "-y"]), (h = "height");
              break;
            case "rl":
              (m = ["+x", "-x"]), (h = "width");
              break;
            case "lr":
              (m = ["-x", "+x"]), (h = "width");
          }
          const d = y.lineHeight,
            g = n[h] + d,
            b = m[0];
          if (_ < 0) {
            let h = 0;
            switch (p.vertical) {
              case "":
                h = n.height - d - 0.05 * n.height;
                break;
              case "rl":
              case "lr":
                h = -n.width + d + 0.05 * n.width;
            }
            (e = h), (m = m.reverse());
          } else {
            switch (p.vertical) {
              case "":
                e = d * Math.round(_);
                break;
              case "rl":
                e = n.width - d * Math.round(_);
                break;
              case "lr":
                e = d * Math.round(_);
            }
            Math.abs(e) > g &&
              ((e = e < 0 ? -1 : 1), (e *= Math.ceil(g / d) * d));
          }
          y.move(b, e);
        } else {
          const d = "" === p.vertical ? n.height : n.width,
            h = (y.lineHeight / d) * 100;
          switch (p.lineAlign) {
            case "center":
            case "middle":
              _ -= h / 2;
              break;
            case "end":
              _ -= h;
          }
          switch (p.vertical) {
            case "":
              e.applyStyles({ top: e.formatStyle(_, "%") });
              break;
            case "rl":
              e.applyStyles({ right: e.formatStyle(_, "%") });
              break;
            case "lr":
              e.applyStyles({ left: e.formatStyle(_, "%") });
          }
          (m = ["+y", "-y", "+x", "-x"]),
            "+y" === p.axis
              ? (m = ["+y", "-y", "+x", "-x"])
              : "-y" === p.axis && (m = ["-y", "+y", "+x", "-x"]),
            (y = new BoxPosition(e));
        }
        const g = (function (e, p) {
          let h;
          for (let y = 0; y < p.length; y++) {
            e.moveIfOutOfBounds(n, p[y]);
            let _ = 0,
              m = !1;
            for (; e.overlapsAny(d) && !(_ > 9); )
              m
                ? e.move(p[y])
                : (d &&
                    d.length > 0 &&
                    (h ||
                      (h = {
                        topMostBoxPosition: BoxPosition.getBoxPosition(
                          d,
                          "top"
                        ),
                        bottomMostBoxPosition: BoxPosition.getBoxPosition(
                          d,
                          "bottom"
                        ),
                        leftMostBoxPosition: BoxPosition.getBoxPosition(
                          d,
                          "left"
                        ),
                        rightMostBoxPosition: BoxPosition.getBoxPosition(
                          d,
                          "right"
                        ),
                      }),
                    BoxPosition.moveToMinimumDistancePlacement(e, p[y], h)),
                  (m = !0)),
                _++;
          }
          return e;
        })(y, m);
        e.move(g.toCSSCompatValues(n));
      }
      constructor(e) {
        var n;
        let d, p, h, y, _, m;
        if (
          (e instanceof CueStyleBox && e.cue
            ? (n = e.cue) && "" !== n.vertical
              ? (this.property = "width")
              : (this.property = "height")
            : e instanceof BoxPosition &&
              (this.property = e.property || "height"),
          e instanceof CueStyleBox && e.div)
        ) {
          (h = e.div.offsetHeight),
            (y = e.div.offsetWidth),
            (_ = e.div.offsetTop);
          const n = e.div.firstChild;
          if (
            ((m = n
              ? n.getBoundingClientRect()
              : e.div.getBoundingClientRect()),
            (d = (m && m[this.property]) || null),
            n && n.firstChild)
          ) {
            const e = n.firstChild;
            if (e && "string" == typeof e.textContent) {
              p = d / this.calculateNewLines(e.textContent);
            }
          }
        } else e instanceof BoxPosition && (m = e);
        (this.left = m.left),
          (this.right = m.right),
          (this.top = m.top || _),
          (this.height = m.height || h),
          (this.bottom = m.bottom || _ + (m.height || h)),
          (this.width = m.width || y),
          (this.lineHeight = null !== d ? d : m.lineHeight),
          (this.singleLineHeight = null !== p ? p : m.singleLineHeight),
          this.singleLineHeight || (this.singleLineHeight = 41);
      }
    }
    n.BoxPosition = BoxPosition;
    class WebVTTRenderer {
      initSubtitleCSS() {
        const e = [
          new Xn.VTTCue(0, 0, "String to init CSS - Won't be visible to user"),
        ];
        (this.paddedOverlay.style.opacity = "0"),
          this.processCues(e),
          this.processCues([]),
          (this.paddedOverlay.style.opacity = "1");
      }
      convertCueToDOMTree(e) {
        return e
          ? Jn.default.parseContent(this.window, e, this.globalStyleCollection)
          : null;
      }
      setStyles(e) {
        function applyStyles(e, n, d) {
          for (const p in n)
            n.hasOwnProperty(p) &&
              ((!0 === d && void 0 !== e[p]) || !1 === d) &&
              (e[p] = n[p]);
        }
        for (const n in e) {
          let d = !1,
            p = null;
          "::cue" === n
            ? ((p = this.foregroundStyleOptions), (d = !0))
            : "::-webkit-media-text-track-display" === n &&
              ((p = this.backgroundStyleOptions), (d = !0));
          const y = e[n];
          if (!0 === d) applyStyles(p, y, d);
          else
            for (let e = 0; e < h.length; e++) {
              const p = h[e].exec(n);
              if (p && 4 === p.length) {
                const e = p[2],
                  n = {};
                applyStyles(n, y, d), (this.globalStyleCollection[e] = n);
              }
            }
        }
        this.initSubtitleCSS(),
          this.loggingEnabled &&
            (console.log(
              "WebVTTRenderer setStyles foregroundStyleOptions: " +
                JSON.stringify(this.foregroundStyleOptions)
            ),
            console.log(
              "WebVTTRenderer setStyles backgroundStyleOptions: " +
                JSON.stringify(this.backgroundStyleOptions)
            ),
            console.log(
              "WebVTTRenderer setStyles globalStyleCollection: " +
                JSON.stringify(this.globalStyleCollection)
            ));
      }
      processCues(e) {
        if (!e) return;
        for (; this.paddedOverlay.firstChild; )
          this.paddedOverlay.removeChild(this.paddedOverlay.firstChild);
        if (
          !(function (e) {
            for (let n = 0; n < e.length; n++)
              if (e[n].hasBeenReset || !e[n].displayState) return !0;
            return !1;
          })(e)
        ) {
          for (let n = 0; n < e.length; n++)
            this.paddedOverlay.appendChild(e[n].displayState);
          return;
        }
        const n = [],
          d = BoxPosition.getSimpleBoxPosition(this.paddedOverlay);
        e.length > 1 &&
          (e = (function (e) {
            const n = [];
            let d = 0;
            for (let p = 0; p < e.length; p++) {
              let h = e[p];
              if ("number" != typeof h.line) return e;
              (d += h.line), n.push(h);
            }
            return (
              (d /= e.length),
              d > 50
                ? (n.forEach(function (e) {
                    e.axis = "-y";
                  }),
                  n.sort((e, n) => n.line - e.line))
                : (n.forEach(function (e) {
                    e.axis = "+y";
                  }),
                  n.sort((e, n) => e.line - n.line)),
              n
            );
          })(e));
        for (let p = 0; p < e.length; p++) {
          let h = e[p],
            y = new CueStyleBox(
              this.window,
              h,
              this.foregroundStyleOptions,
              this.backgroundStyleOptions,
              this.globalStyleCollection
            );
          this.paddedOverlay.appendChild(y.div),
            BoxPosition.moveBoxToLinePosition(y, d, n),
            (h.displayState = y.div),
            n.push(BoxPosition.getSimpleBoxPosition(y));
        }
      }
      setSize(e, n) {
        e && (this.overlay.style.width = e + "px"),
          n && (this.overlay.style.height = n + "px");
      }
      getOverlay() {
        return this.overlay;
      }
      constructor(e, n, d = !0) {
        if (!e) return null;
        (this.window = e),
          (this.overlay = n),
          (this.loggingEnabled = d),
          (this.foregroundStyleOptions = {
            fontFamily: "Helvetica",
            fontSize: "36px",
            color: "rgba(255, 255, 255, 1)",
            textShadow: "",
            backgroundColor: "rgba(0, 0, 0, 0)",
          }),
          (this.backgroundStyleOptions = {
            backgroundColor: "rgba(0, 0, 0, 0.5)",
          }),
          (this.globalStyleCollection = {});
        const p = e.document.createElement("div");
        (p.style.position = "absolute"),
          (p.style.left = "0"),
          (p.style.right = "0"),
          (p.style.top = "0"),
          (p.style.bottom = "0"),
          (p.style.margin = "1.5%"),
          (this.paddedOverlay = p),
          n.appendChild(this.paddedOverlay),
          this.initSubtitleCSS();
      }
    }
    (n.default = WebVTTRenderer), (n.WebVTTRenderer = WebVTTRenderer), p(ei, n);
  });
  unwrapExports(ri),
    ri.VTTCue,
    ri.WebVTTRenderer,
    ri.BoxPosition,
    ri.CueStyleBox,
    ri.StyleBox;
  var ni = createCommonjsModule(function (e, n) {
    var d =
        (zn && zn.__createBinding) ||
        (Object.create
          ? function (e, n, d, p) {
              void 0 === p && (p = d),
                Object.defineProperty(e, p, {
                  enumerable: !0,
                  get: function () {
                    return n[d];
                  },
                });
            }
          : function (e, n, d, p) {
              void 0 === p && (p = d), (e[p] = n[d]);
            }),
      p =
        (zn && zn.__exportStar) ||
        function (e, n) {
          for (var p in e) "default" === p || n.hasOwnProperty(p) || d(n, e, p);
        };
    Object.defineProperty(n, "__esModule", { value: !0 }), p(ti, n), p(ri, n);
  });
  unwrapExports(ni);
  var ii = ni.WebVTTRenderer;
  function _define_property$1v(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const {
    textTracksSwitched: ai,
    textTracksUpdated: oi,
    inlineStylesParsed: si,
  } = at;
  class TextTrackManager {
    get isDestroyed() {
      return this._isDestroyed;
    }
    get currentTrack() {
      return this.tracks.find((e) => "showing" === e.mode);
    }
    set currentTrack(e) {
      if (!e) return;
      let n;
      saveTrack("mk-text-track", e),
        He.debug(
          `MEDIA_TRACK save track selection ${e.language},${e.label},${e.kind}`
        ),
        this.extensionTracks
          ? (He.debug("MEDIA_TRACK Setting track on extension " + e.label),
            "Off" === e.label
              ? (this.clearCurrentlyPlayingTrack(),
                (n = this.extensionTracks.selectForcedTrack()),
                void 0 === n && this.onExtensionTextTrackSwitched({ track: e }))
              : (this.extensionTracks.textTrack = e))
          : (He.debug("MEDIA_TRACK Setting track on element " + e.label),
            this._tracks.forEach((n) => {
              n !== e && "showing" === n.mode && (n.mode = "disabled");
            }),
            e &&
              (He.debug(
                "MEDIA_TRACK setting track mode to showing for " + e.label
              ),
              this.isTrackOff(e)
                ? ((this._tracks[0].mode = "showing"),
                  (n = this.selectNativeForcedTrack(
                    this.mediaElement.audioTracks
                  )))
                : (e.mode = "showing"))),
        this.dispatcher.publish(wt.forcedTextTrackChanged, n);
    }
    get tracks() {
      return this._tracks;
    }
    destroy() {
      if (
        ((this._isDestroyed = !0),
        this.clearCurrentlyPlayingTrack(),
        this.extensionTracks)
      ) {
        const e = this.extensionTracks;
        e.removeEventListener(oi, this.onExtensionTextTracksAdded),
          e.removeEventListener(ai, this.onExtensionTextTrackSwitched),
          e.removeEventListener(si, this.onExtensionInlineStylesParsed);
      } else
        this.mediaElement.textTracks.removeEventListener(
          "addtrack",
          this.onTextTrackAdded
        ),
          this.mediaElement.textTracks.removeEventListener(
            "change",
            this.onTextTrackChanged
          ),
          this.mediaElement.textTracks.removeEventListener(
            "removetrack",
            this.onTextTrackRemoved
          ),
          this.mediaElement.removeEventListener("playing", this.onPlayStart);
      this.dispatcher.unsubscribe(
        wt.audioTrackChanged,
        this.onAudioTrackAddedOrChanged
      ),
        this.dispatcher.unsubscribe(
          wt.audioTrackAdded,
          this.onAudioTrackAddedOrChanged
        );
    }
    restoreSelectedTrack() {
      var e;
      const n = loadTrack("mk-text-track");
      if (
        (null === (e = this.tracks) || void 0 === e ? void 0 : e.length) >= 0 &&
        void 0 !== n &&
        (void 0 === this.currentTrack || !trackEquals(this.currentTrack, n))
      )
        for (const d of this.tracks)
          if (trackEquals(d, n)) {
            He.debug("Found track matching persisted track: " + d.label),
              (this.currentTrack = d);
            break;
          }
    }
    getSavedTrack() {
      return loadTrack("mk-text-track");
    }
    onExtensionInlineStylesParsed(e) {
      He.debug("MEDIA_TRACK Extension inline styles parsed", e),
        this.renderer.setStyles(e.styles);
    }
    onExtensionTextTracksAdded(e) {
      He.debug(
        "MEDIA_TRACK Extension text tracks updated " + JSON.stringify(e)
      ),
        this._tracks.push(...e),
        this.restoreSelectedTrack(),
        this.dispatcher.publish(wt.textTrackAdded, e);
    }
    onExtensionTextTrackSwitched(e) {
      He.debug("MEDIA_TRACKS Extension text track switched " + e),
        this.handleVTT(e);
      const n = e.track;
      if (this._tracks) {
        const preserveSelectedTrack = (d) => {
          e.track
            ? (n.forced && "Off" === d.label) ||
              ("Off" === n.label && "Off" === d.label)
              ? (d.mode = "showing")
              : (d.mode =
                  e.track.persistentID === d.id ? "showing" : "disabled")
            : (d.mode = "Off" === d.label ? "showing" : "disabled");
        };
        this._tracks.forEach(preserveSelectedTrack);
      }
      this.dispatcher.publish(wt.textTrackChanged, e);
    }
    handleVTT(e) {
      const n = e && e.track && e.track.id;
      if (void 0 !== n && n >= 0) {
        const e = this.filterSelectableTextTracks(this.mediaElement.textTracks)[
          n
        ];
        this.onNativeTrackChange(e);
      } else this.clearCurrentlyPlayingTrack();
    }
    onAudioTrackAddedOrChanged(e, n) {
      if (
        (He.debug("MEDIA_TRACKS text track manager detects audio track change"),
        this.shouldForceSubtitle())
      )
        if (this.extensionTracks) {
          He.debug("MEDIA_TRACKS selecting forced text track via extension");
          const e = this.extensionTracks.selectForcedTrack();
          e
            ? this.dispatcher.publish(wt.forcedTextTrackChanged, e)
            : this.clearCurrentlyPlayingTrack();
        } else
          He.debug("MEDIA_TRACKS selecting forced text track natively"),
            (this.currentTrack = this._tracks[0]);
    }
    onTextTrackAdded(e) {
      this._tracks.push(e.track), this.dispatcher.publish(wt.textTrackAdded, e);
    }
    onPlayStart() {
      this.restoreSelectedTrack();
    }
    onTextTrackRemoved(e) {
      this.dispatcher.publish(wt.textTrackRemoved, e);
    }
    onTextTrackChanged(e) {
      const n = this.findNativeSelectedTextTrack();
      let d = this.getSavedTrack();
      if ((d || (d = this._tracks[0]), n && !trackEquals(n, d)))
        if (this.isTrackOff(d) && "forced" !== n.kind) {
          const e = this.tracks.find((e) => trackEquals(e, d));
          this.currentTrack = e;
        } else {
          const e = this.findNativeTrack(d);
          e && (this.currentTrack = e);
        }
      else this.dispatcher.publish(wt.textTrackChanged, e);
    }
    findNativeSelectedTextTrack() {
      for (let e = 0; e < this.mediaElement.textTracks.length; e++) {
        const n = this.mediaElement.textTracks[e];
        if ("showing" === n.mode) return n;
      }
    }
    findNativeTrack(e) {
      for (let n = 0; n < this.mediaElement.textTracks.length; n++) {
        const d = this.mediaElement.textTracks[n];
        if (trackEquals(d, e)) return d;
      }
    }
    selectNativeForcedTrack(e) {
      for (let n = 0; n < e.length; n++) {
        const d = e[n];
        if (d.enabled) {
          const e = this.findNativeForcedTrack(d);
          return e && "showing" !== e.mode && (e.mode = "showing"), e;
        }
      }
    }
    findNativeForcedTrack(e) {
      const n = this.mediaElement.textTracks;
      for (let d = 0; d < n.length; d++) {
        const p = n[d];
        if ("forced" === p.kind && p.language === e.language) return p;
      }
    }
    onNativeTrackChange(e) {
      this.clearCurrentlyPlayingTrack(),
        (this._currentlyPlayingTrack = e),
        e.addEventListener("cuechange", this.onCueChange);
    }
    clearCurrentlyPlayingTrack() {
      var e;
      void 0 !== this._currentlyPlayingTrack &&
        null != (e = this._currentlyPlayingTrack) &&
        "string" == typeof e.id &&
        "removeEventListener" in e &&
        (this._currentlyPlayingTrack.removeEventListener(
          "cuechange",
          this.onCueChange
        ),
        this.renderer.processCues({}),
        delete this._currentlyPlayingTrack);
    }
    onCueChange(e) {
      const n = e && e.target && e.target.activeCues;
      n && this.renderer.processCues(n);
    }
    filterSelectableTextTracks(e) {
      const n = [];
      for (let d = 0; d < e.length; d++) {
        const p = e[d];
        ("captions" === p.kind ||
          "subtitles" === p.kind ||
          ("metadata" === p.kind && p.customTextTrackCueRenderer)) &&
          n.push(p);
      }
      return n;
    }
    shouldForceSubtitle() {
      He.debug("MEDIA_TRACKS Determining whether to select forced text track");
      const e = this.getSavedTrack();
      return !e || this.isTrackOff(e);
    }
    isTrackOff(e) {
      return "Off" === e.label || "Auto" === e.label;
    }
    constructor(e, n, d) {
      _define_property$1v(this, "mediaElement", void 0),
        _define_property$1v(this, "dispatcher", void 0),
        _define_property$1v(this, "extensionTracks", void 0),
        _define_property$1v(this, "_tracks", void 0),
        _define_property$1v(this, "renderer", void 0),
        _define_property$1v(this, "_currentlyPlayingTrack", void 0),
        _define_property$1v(this, "_isDestroyed", void 0),
        (this.mediaElement = e),
        (this.dispatcher = n),
        (this.extensionTracks = d),
        (this._tracks = []),
        (this._isDestroyed = !1);
      const p = this.getSavedTrack();
      if (
        (this._tracks.push({
          id: -2,
          label: "Off",
          language: "",
          kind: "subtitles",
          mode: !p || this.isTrackOff(p) ? "showing" : "disabled",
        }),
        this.extensionTracks)
      ) {
        He.debug(
          "MEDIA_TRACK Initializing text track manager for HLS.js track events"
        );
        const n = e.parentElement;
        (this.renderer = new ii(window, n, !1)),
          this.renderer.setStyles({ "::cue": { fontSize: "calc(1vw + 1em)" } }),
          (this.onExtensionTextTracksAdded =
            this.onExtensionTextTracksAdded.bind(this)),
          (this.onExtensionTextTrackSwitched =
            this.onExtensionTextTrackSwitched.bind(this)),
          (this.onExtensionInlineStylesParsed =
            this.onExtensionInlineStylesParsed.bind(this)),
          (this.onCueChange = this.onCueChange.bind(this));
        const d = this.extensionTracks;
        d.addEventListener(oi, this.onExtensionTextTracksAdded),
          d.addEventListener(ai, this.onExtensionTextTrackSwitched),
          d.addEventListener(si, this.onExtensionInlineStylesParsed);
      } else
        He.debug(
          "MEDIA_TRACK Initializing text track manager for native track events"
        ),
          (this.onTextTrackAdded = this.onTextTrackAdded.bind(this)),
          (this.onTextTrackChanged = this.onTextTrackChanged.bind(this)),
          (this.onTextTrackRemoved = this.onTextTrackRemoved.bind(this)),
          (this.onPlayStart = this.onPlayStart.bind(this)),
          e.textTracks.addEventListener("addtrack", this.onTextTrackAdded),
          e.textTracks.addEventListener("change", this.onTextTrackChanged),
          e.textTracks.addEventListener("removetrack", this.onTextTrackRemoved),
          e.addEventListener("playing", this.onPlayStart);
      (this.onAudioTrackAddedOrChanged = debounce(
        this.onAudioTrackAddedOrChanged.bind(this)
      )),
        n.subscribe(wt.audioTrackChanged, this.onAudioTrackAddedOrChanged),
        n.subscribe(wt.audioTrackAdded, this.onAudioTrackAddedOrChanged);
    }
  }
  function asyncGeneratorStep$14(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$14(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$14(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$14(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1u(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$x(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const ci = {
      "picture-in-picture": e.PresentationMode.pictureinpicture,
      inline: e.PresentationMode.inline,
    },
    li = {};
  (li[e.PresentationMode.pictureinpicture] = "picture-in-picture"),
    (li[e.PresentationMode.inline] = "inline");
  const { presentationModeDidChange: di } = wt,
    { playbackLicenseError: ui } = at,
    { stopped: pi } = e.PlaybackStates;
  class VideoPlayer extends BasePlayer {
    get audioTracks() {
      var e, n;
      return null !==
        (n =
          null === (e = this.audioTrackManager) || void 0 === e
            ? void 0
            : e.tracks) && void 0 !== n
        ? n
        : [];
    }
    get containerElement() {
      return this._context.videoContainerElement
        ? this._context.videoContainerElement
        : document.getElementById("apple-music-video-container");
    }
    get currentAudioTrack() {
      var e;
      return null === (e = this.audioTrackManager) || void 0 === e
        ? void 0
        : e.currentTrack;
    }
    set currentAudioTrack(e) {
      void 0 !== this.audioTrackManager &&
        (this.audioTrackManager.currentTrack = e);
    }
    get currentTextTrack() {
      var e;
      return null === (e = this.textTrackManager) || void 0 === e
        ? void 0
        : e.currentTrack;
    }
    set currentTextTrack(e) {
      void 0 !== this.textTrackManager &&
        (this.textTrackManager.currentTrack = e);
    }
    get _targetElement() {
      return (
        this.video ||
        (function (e) {
          for (var n = 1; n < arguments.length; n++) {
            var d = null != arguments[n] ? arguments[n] : {},
              p = Object.keys(d);
            "function" == typeof Object.getOwnPropertySymbols &&
              (p = p.concat(
                Object.getOwnPropertySymbols(d).filter(function (e) {
                  return Object.getOwnPropertyDescriptor(d, e).enumerable;
                })
              )),
              p.forEach(function (n) {
                _define_property$1u(e, n, d[n]);
              });
          }
          return e;
        })({}, document.createElement("video"))
      );
    }
    get textTracks() {
      var e, n;
      return null !==
        (n =
          null === (e = this.textTrackManager) || void 0 === e
            ? void 0
            : e.tracks) && void 0 !== n
        ? n
        : [];
    }
    initializeExtension() {
      var e = this;
      return _async_to_generator$14(function* () {
        const { os: n } = e.services.runtime;
        e.restrictPlatforms && n.isAndroid
          ? He.warn(
              "videoPlayer.initializeExtension Not supported on the current platform"
            )
          : e.video ||
            He.warn(
              "videoPlayer.initializeExtension No video element, not initializing extension"
            );
      })();
    }
    onPlaybackLicenseError(e) {
      this.resetDeferredPlay(), this._dispatcher.publish(ui, e);
    }
    setupTrackManagers(e) {
      var n, d, p, h;
      null === (d = this.textTrackManager) ||
        void 0 === d ||
        null === (n = d.destroy) ||
        void 0 === n ||
        n.call(d),
        (this.textTrackManager = new TextTrackManager(
          this._targetElement,
          this._dispatcher,
          e
        )),
        null === (h = this.audioTrackManager) ||
          void 0 === h ||
          null === (p = h.destroy) ||
          void 0 === p ||
          p.call(h),
        (this.audioTrackManager = new AudioTrackManager(
          this._targetElement,
          this._dispatcher,
          e
        ));
    }
    destroy() {
      var e, n;
      this.finishPlaybackSequence(),
        null === (e = this.textTrackManager) || void 0 === e || e.destroy(),
        null === (n = this.audioTrackManager) || void 0 === n || n.destroy(),
        super.destroy();
    }
    initializeEventHandlers() {
      var e = this,
        _superprop_get_initializeEventHandlers = () =>
          super.initializeEventHandlers;
      return _async_to_generator$14(function* () {
        _superprop_get_initializeEventHandlers().call(e),
          e.hasMediaElement &&
            (e._targetElement.addEventListener(
              "webkitpresentationmodechanged",
              e.pipEventHandler
            ),
            e._targetElement.addEventListener(
              "enterpictureinpicture",
              e.pipEventHandler
            ),
            e._targetElement.addEventListener(
              "leavepictureinpicture",
              e.pipEventHandler
            ));
      })();
    }
    removeEventHandlers() {
      if ((super.removeEventHandlers(), !this.hasMediaElement)) return;
      const { _targetElement: e } = this;
      e.removeEventListener(
        "webkitpresentationmodechanged",
        this.pipEventHandler
      ),
        e.removeEventListener("enterpictureinpicture", this.pipEventHandler),
        e.removeEventListener("leavepictureinpicture", this.pipEventHandler);
    }
    initializeMediaElement() {
      var e = this;
      return _async_to_generator$14(function* () {
        He.debug(
          "videoPlayer.initializeMediaElement Initializing media element"
        );
        const n = e.containerElement;
        n
          ? ((e.video = (function () {
              let e = Hn.pop();
              return (
                e
                  ? He.debug(
                      `dom-helpers: retrieving video tag, ${Hn.length} remain`
                    )
                  : (He.debug(
                      "dom-helpers: no available video tags, creating one"
                    ),
                    (e = document.createElement("video"))),
                e
              );
            })()),
            (e.video.autoplay = !1),
            (e.video.controls = !1),
            (e.video.playsInline = !0),
            (e.video.id = "apple-music-video-player"),
            n.appendChild(e.video))
          : He.warn(
              "videoPlayer.initializeMediaElement No video element; no container defined"
            );
      })();
    }
    isPlayerSupported() {
      return this.services.runtime.isES2015Supported;
    }
    _stopMediaElement() {
      var e = this,
        _superprop_get__stopMediaElement = () => super._stopMediaElement;
      return _async_to_generator$14(function* () {
        yield _superprop_get__stopMediaElement().call(e), e.destroy();
      })();
    }
    pipEventHandler(n) {
      switch (n.type) {
        case "enterpictureinpicture":
          this._dispatcher.publish(di, {
            mode: e.PresentationMode.pictureinpicture,
          });
          break;
        case "leavepictureinpicture":
          this._dispatcher.publish(di, { mode: e.PresentationMode.inline });
          break;
        case "webkitpresentationmodechanged": {
          const e = this._targetElement;
          this._dispatcher.publish(di, {
            mode: this._translateStringToPresentationMode(
              e.webkitPresentationMode
            ),
          });
          break;
        }
      }
    }
    playItemFromEncryptedSource(n, d = !1, p = {}) {
      var h = this;
      return _async_to_generator$14(function* () {
        if (
          (He.debug("videoPlayer.playItemFromEncryptedSource", n, d),
          h.playbackState === pi)
        )
          return void He.debug(
            "video-player.playItemFromEncryptedSource aborting playback because player is stopped"
          );
        (n.playbackType = e.PlaybackType.encryptedFull),
          (h.nowPlayingItem = n),
          (n.state = x.loading),
          (h.userInitiated = d);
        const y = generateAssetUrl(n, p);
        yield h.playHlsStream(y, n, p);
      })();
    }
    playItemFromUnencryptedSource(e, n, d) {
      var p = this;
      return _async_to_generator$14(function* () {
        if (
          (He.debug("videoPlayer.playItemFromUnencryptedSource", e, n),
          p.playbackState === pi)
        )
          return void He.debug(
            "videoPlayer.playItemFromUnencryptedSource aborting playback because player is stopped"
          );
        const [d] = e.split("?");
        d.endsWith("m3u") || d.endsWith("m3u8")
          ? yield p.playHlsStream(e)
          : yield p._playAssetURL(e, n);
      })();
    }
    setPresentationMode(n) {
      var d = this;
      return _async_to_generator$14(function* () {
        const p = d._targetElement;
        if (
          p.webkitSupportsPresentationMode &&
          "function" == typeof p.webkitSetPresentationMode
        )
          return p.webkitSetPresentationMode(
            d._translatePresentationModeToString(n)
          );
        if (p.requestPictureInPicture && document.exitPictureInPicture) {
          if (n === e.PresentationMode.pictureinpicture)
            return p.requestPictureInPicture();
          if (n === e.PresentationMode.inline)
            return document.exitPictureInPicture();
        }
      })();
    }
    _translateStringToPresentationMode(n) {
      let d = ci[n];
      return (
        void 0 === d &&
          (He.warn(
            `videoPlayer._translateStringToPresentationMode ${n} is not a valid presentation mode, setting to inline`
          ),
          (d = e.PresentationMode.inline)),
        d
      );
    }
    _translatePresentationModeToString(e) {
      let n = li[e];
      return (
        void 0 === n &&
          (He.warn(
            `videoPlayer._translatePresentationModeToString ${e} is not a valid presentation mode, setting to inline`
          ),
          (n = "inline")),
        n
      );
    }
    setNextSeamlessItem(e) {
      return _async_to_generator$14(function* () {})();
    }
    constructor(e) {
      super(e),
        _define_property$1u(this, "extension", void 0),
        _define_property$1u(this, "video", void 0),
        _define_property$1u(this, "mediaPlayerType", "video"),
        _define_property$1u(this, "restrictPlatforms", void 0),
        _define_property$1u(this, "textTrackManager", void 0),
        _define_property$1u(this, "audioTrackManager", void 0),
        _define_property$1u(this, "_shouldLoadManifestsOnce", !1),
        _define_property$1u(this, "userInitiated", !1),
        (this.restrictPlatforms =
          !("restrict-platforms" in rt.features) ||
          rt.features["restrict-platforms"]),
        (this.pipEventHandler = this.pipEventHandler.bind(this)),
        (this._shouldLoadManifestsOnce = shouldLoadManifestOnce());
    }
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$x("design:type", Function),
      _ts_metadata$x("design:paramtypes", [void 0]),
      _ts_metadata$x("design:returntype", void 0),
    ],
    VideoPlayer.prototype,
    "onPlaybackLicenseError",
    null
  );
  const decayingOperation = (e, n, d, p = 0) =>
    e().catch((h) => {
      const y = p + 1;
      function possiblyRetry(p) {
        if (p && y < 3) {
          const p = 1e3 * y;
          return new Promise((h, _) => {
            setTimeout(() => {
              decayingOperation(e, n, d, y).then(h, _);
            }, p);
          });
        }
        throw h;
      }
      const _ = n(h);
      return "boolean" == typeof _ ? possiblyRetry(_) : _.then(possiblyRetry);
    });
  let hi = {
    developerToken: "developerTokenNotSet",
    musicUserToken: "musicUserTokenNotSet",
    cid: "cidNotSet",
  };
  function asyncGeneratorStep$13(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$13(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$13(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$13(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1t(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$D(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$1t(e, n, d[n]);
        });
    }
    return e;
  }
  function createHlsOffersLicenseChallengeBody(e) {
    return { "adam-id": e.id, id: 1 };
  }
  function createStreamingKeysLicenseChallengeBody(e, n, d = 0) {
    var p;
    return _object_spread$D(
      { id: d, "lease-action": n },
      null !== (p = e.keyServerQueryParameters) && void 0 !== p ? p : {}
    );
  }
  function createLicenseChallengeBody(e, n, d, p, h, y) {
    let _;
    const m = {
      challenge: d.challenge || De(d.licenseChallenge),
      "key-system": p,
      uri: d.keyuri,
    };
    return (
      y && (m["extended-lease"] = y),
      (_ = n.isUTS
        ? {
            "streaming-request": {
              version: 1,
              "streaming-keys": [
                _object_spread$D(
                  {},
                  m,
                  createStreamingKeysLicenseChallengeBody(n, e)
                ),
              ],
            },
          }
        : n.isLiveRadioStation
          ? _object_spread$D(
              {},
              m,
              (function (e) {
                return { event: e.isLiveAudioStation ? "beats1" : "amtv" };
              })(n)
            )
          : n.hasOffersHlsUrl
            ? {
                "license-requests": [
                  _object_spread$D(
                    {},
                    m,
                    createHlsOffersLicenseChallengeBody(n)
                  ),
                ],
              }
            : _object_spread$D(
                {},
                m,
                (function (e, n = !1) {
                  return {
                    adamId: e.songId,
                    isLibrary: e.isCloudItem,
                    "user-initiated": n,
                  };
                })(n, h)
              )),
      _
    );
  }
  class License {
    fetch(e) {
      const n = {
        Authorization: "Bearer " + hi.developerToken,
        Accept: "application/json",
        "Content-Type": "application/json",
        "X-Apple-Music-User-Token": "" + hi.musicUserToken,
      };
      this.keySystem === tt.WIDEVINE && (n["X-Apple-Renewal"] = !0);
      const d = new Headers(n);
      return decayingOperation(
        () =>
          fetch(this.licenseUrl, {
            method: "POST",
            body: JSON.stringify(e),
            headers: d,
          }),
        (e) => e instanceof TypeError,
        "license fetch"
      );
    }
    reset() {
      (this.licenseUrl = void 0),
        (this.playableItem = void 0),
        (this.data = void 0),
        (this.initiated = void 0),
        (this.keySystem = void 0),
        (this.startResponse = void 0);
    }
    start(e, n, d, p, h = !1, y = !1) {
      var _ = this;
      return _async_to_generator$13(function* () {
        (_.licenseUrl = e),
          (_.playableItem = n),
          (_.data = d),
          (_.keySystem = p),
          (_.initiated = h);
        const m = d.isRenewalRequest ? "renew" : "start",
          g = createLicenseChallengeBody(m, n, d, p, h, y);
        n.hasOffersHlsUrl &&
          !_.licenseUrl.includes("start") &&
          (_.licenseUrl += "/" + m),
          (_.startResponse = _.fetch(g));
        try {
          var b, P, S;
          const e = yield _.startResponse;
          if (!e.ok) {
            let n;
            try {
              n = yield e.json();
            } catch (Yt) {}
            _.processJsonError(n);
          }
          const n = yield e.json();
          let d = n;
          return (
            (
              null == n ||
              null === (P = n["streaming-response"]) ||
              void 0 === P ||
              null === (b = P["streaming-keys"]) ||
              void 0 === b
                ? void 0
                : b.length
            )
              ? (d = n["streaming-response"]["streaming-keys"][0])
              : (null == n ||
                null === (S = n["license-responses"]) ||
                void 0 === S
                  ? void 0
                  : S.length) && (d = n["license-responses"][0]),
            0 !== d.status && _.processJsonError(d),
            d
          );
        } catch (q) {
          throw ((_.startResponse = void 0), q);
        }
      })();
    }
    processJsonError(e) {
      let n = new MKError(
        MKError.Reason.MEDIA_LICENSE,
        "Error acquiring license"
      );
      if (
        ((null == e ? void 0 : e.errorCode) && (e.status = e.errorCode),
        -1021 === (null == e ? void 0 : e.status) && (e.status = 190121),
        e && 0 !== e.status)
      ) {
        if (!e.message)
          switch (e.status) {
            case -1004:
              e.message = MKError.Reason.DEVICE_LIMIT;
              break;
            case -1017:
              e.message = MKError.Reason.GEO_BLOCK;
              break;
            default:
              e.message = MKError.Reason.MEDIA_LICENSE;
          }
        (n = MKError.serverError(e)),
          (n.data = e),
          n.reason === MKError.Reason.PLAYREADY_CBC_ENCRYPTION_ERROR &&
            (function () {
              const e = getSessionStorage();
              e && e.setItem("mk-playready-cbcs-unsupported", "true");
            })();
      }
      throw n;
    }
    stop() {
      var e = this;
      return _async_to_generator$13(function* () {
        if (e.startResponse)
          try {
            yield e.startResponse;
          } catch (q) {}
        if (!e.playableItem || !e.data || !e.licenseUrl) return;
        if (!e.playableItem.isUTS) return;
        const n = createLicenseChallengeBody(
            "stop",
            e.playableItem,
            e.data,
            e.keySystem,
            e.initiated
          ),
          d = e.fetch(n);
        e.reset();
        try {
          yield d;
        } catch (q) {
          He.warn("license.stop request error", q);
        }
      })();
    }
    constructor() {
      _define_property$1t(this, "licenseUrl", void 0),
        _define_property$1t(this, "playableItem", void 0),
        _define_property$1t(this, "data", void 0),
        _define_property$1t(this, "initiated", void 0),
        _define_property$1t(this, "keySystem", void 0),
        _define_property$1t(this, "startResponse", void 0);
    }
  }
  function asyncGeneratorStep$12(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$12(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$12(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$12(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1s(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$w(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class KeySession extends Notifications {
    get extID() {
      if (this.extURI) return this.extURI.replace("data:;base64,", "");
    }
    get isFairplay() {
      return this.keySystem === tt.FAIRPLAY;
    }
    get isPlayReady() {
      return this.keySystem === tt.PLAYREADY;
    }
    get isWidevine() {
      return this.keySystem === tt.WIDEVINE;
    }
    acquirePlaybackLicense(e, n, d, p) {
      var h = this;
      return _async_to_generator$12(function* () {
        if (!h.keyServerURL || !h.developerToken || !h.userToken) return;
        const { keyServerURL: d, keySystem: y } = h,
          _ = p.item;
        try {
          return yield h.license.start(
            d,
            _,
            { challenge: n, keyuri: e },
            y,
            h.initiated,
            h.isLegacyEme && _.isUTS
          );
        } catch (Yt) {
          h.dispatchEvent(at.playbackLicenseError, Yt);
        }
      })();
    }
    startLicenseSession(e) {
      var n = this;
      return _async_to_generator$12(function* () {
        let d;
        He.debug("Starting License Session", e);
        const { message: p, target: h, messageType: y } = e;
        if (n.keySystem !== tt.FAIRPLAY && "license-request" !== y)
          return void He.debug("not making license request for", y);
        if (n.isPlayReady) {
          const e = String.fromCharCode.apply(
            null,
            new Uint16Array(p.buffer || p)
          );
          d = new DOMParser()
            .parseFromString(e, "application/xml")
            .getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;
        } else d = De(new Uint8Array(p));
        const _ = h.extURI || n.extURI,
          m = n.mediaKeySessions[_];
        if (!m)
          return void He.debug("no key session info, aborting license request");
        const g = n.acquirePlaybackLicense(_, d, n.initiated, m);
        if (m.delayCdmUpdate) m["license-json"] = g;
        else {
          const e = yield g;
          yield n.handleLicenseJson(e, h, _);
        }
      })();
    }
    setKeyURLs(e) {
      (this.keyCertURL =
        e[this.isFairplay ? "hls-key-cert-url" : "widevine-cert-url"]),
        (this.keyServerURL = e["hls-key-server-url"]);
    }
    dispatchKeyError(e) {
      var n, d;
      this.isFairplay &&
      4294955417 ===
        (null == e ||
        null === (d = e.target) ||
        void 0 === d ||
        null === (n = d.error) ||
        void 0 === n
          ? void 0
          : n.systemCode)
        ? He.error("Ignoring error", e)
        : (console.error(
            MKError.Reason.MEDIA_KEY + " error in dispatchKeyError:",
            e
          ),
          this.dispatchEvent(
            at.playbackSessionError,
            new MKError(MKError.Reason.MEDIA_KEY, e)
          ));
    }
    dispatchSessionError(e) {
      this.dispatchEvent(
        at.playbackSessionError,
        new MKError(MKError.Reason.MEDIA_SESSION, e)
      );
    }
    loadCertificateBuffer() {
      var e = this;
      return _async_to_generator$12(function* () {
        if (!e.keyCertURL)
          return Promise.reject(
            new MKError(MKError.Reason.MEDIA_SESSION, "No certificate URL")
          );
        let n;
        try {
          n = yield fetch(`${e.keyCertURL}?t=${Date.now()}`);
        } catch (q) {
          throw (e.dispatchKeyError(q), q);
        }
        const d = yield n.arrayBuffer(),
          p = String.fromCharCode.apply(String, new Uint8Array(d));
        return /^\<\?xml/.test(p)
          ? Promise.reject(
              new MKError(
                MKError.Reason.MEDIA_CERTIFICATE,
                "Invalid certificate."
              )
            )
          : d;
      })();
    }
    handleSessionCreation(e) {
      var n = this;
      return _async_to_generator$12(function* () {
        return n.createSession(e).catch((e) => {
          n.dispatchSessionError(e);
        });
      })();
    }
    handleLicenseJson(e, n, d) {
      var p = this;
      return _async_to_generator$12(function* () {
        if (
          (He.debug(`updating session ${d} with license response`, e),
          null == e ? void 0 : e.license)
        ) {
          const d = Ae(e.license);
          try {
            yield n.update(d);
          } catch (Yt) {
            He.error("Failed to updated media keys", Yt),
              p.dispatchKeyError(Yt);
          }
        }
      })();
    }
    addMediaKeySessionInfo(e, n, d, p = !1) {
      const h = this.mediaKeySessions[e];
      h
        ? (He.debug(
            `keySession info exists for ${d.title}, making existing session ${h.session.sessionId} the old session`
          ),
          (h.oldSession = h.session),
          (h.session = n))
        : (He.debug("creating key session info for " + d.title),
          (this.mediaKeySessions[e] = {
            session: n,
            item: d,
            delayCdmUpdate: p,
          }));
    }
    stopLicenseSession() {
      He.info("key session sending license stop"), this.license.stop();
    }
    constructor() {
      super([at.playbackLicenseError, at.playbackSessionError]),
        _define_property$1s(this, "developerToken", void 0),
        _define_property$1s(this, "adamId", void 0),
        _define_property$1s(this, "userToken", void 0),
        _define_property$1s(this, "extURI", void 0),
        _define_property$1s(this, "item", void 0),
        _define_property$1s(this, "initiated", !0),
        _define_property$1s(this, "isLibrary", !1),
        _define_property$1s(this, "keyCertURL", void 0),
        _define_property$1s(this, "keyServerURL", void 0),
        _define_property$1s(this, "keySystem", tt.FAIRPLAY),
        _define_property$1s(this, "isLegacyEme", !1),
        _define_property$1s(this, "boundDispatchKeyError", void 0),
        _define_property$1s(this, "boundDispatchSessionError", void 0),
        _define_property$1s(this, "boundHandleSessionCreation", void 0),
        _define_property$1s(this, "boundStartLicenseSession", void 0),
        _define_property$1s(this, "mediaKeySessions", {}),
        _define_property$1s(this, "_pendingRenewal", void 0),
        _define_property$1s(this, "license", void 0),
        (this.boundDispatchKeyError = this.dispatchKeyError.bind(this)),
        (this.boundDispatchSessionError = this.dispatchSessionError.bind(this)),
        (this.boundHandleSessionCreation =
          this.handleSessionCreation.bind(this)),
        (this.boundStartLicenseSession = this.startLicenseSession.bind(this)),
        (this.license = new License());
    }
  }
  function asyncGeneratorStep$11(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$11(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$11(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$11(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1r(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$v(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$w("design:type", Function),
      _ts_metadata$w("design:paramtypes", [void 0]),
      _ts_metadata$w("design:returntype", Promise),
    ],
    KeySession.prototype,
    "startLicenseSession",
    null
  );
  class FairplayEncryptedSession extends KeySession {
    attachMedia(e, n) {
      var d = this;
      return _async_to_generator$11(function* () {
        (d.keySystem = n.keySystem),
          (d._keySystemAccess = n),
          e.addEventListener("encrypted", d.boundHandleSessionCreation, !1);
      })();
    }
    detachMedia(e) {
      e.removeEventListener("encrypted", this.boundHandleSessionCreation);
      const n = this._mediaKeySessions,
        d = this._mediaKeySessionRenewals;
      Object.values(n).forEach((e) => {
        e.removeEventListener("message", this.boundStartLicenseSession),
          asAsync(e.close());
      }),
        (this._mediaKeySessions = {}),
        Object.values(d).forEach((e) => clearTimeout(e)),
        (this._mediaKeySessionRenewals = {});
    }
    createSession(e) {
      var n = this;
      return _async_to_generator$11(function* () {
        He.debug("fairplay eme:  createSession", e);
        const d = n._keySystemAccess;
        if (!d) return;
        const { initData: p, target: h, initDataType: y } = e;
        var _;
        n._mediaKeysPromise ||
          (n._mediaKeysPromise = new Promise(
            ((_ = _async_to_generator$11(function* (e, p) {
              const y = yield d.createMediaKeys();
              try {
                yield h.setMediaKeys(y), (n._mediaKeys = y);
                const e = yield n.loadCertificateBuffer();
                yield y.setServerCertificate(e);
              } catch (q) {
                n.dispatchKeyError(q), p(q);
              }
              e(y);
            })),
            function (e, n) {
              return _.apply(this, arguments);
            })
          ));
        const m = yield n._mediaKeysPromise,
          g = new Uint8Array(p),
          b = String.fromCharCode.apply(void 0, Array.from(g));
        if (n.mediaKeySessions[b])
          return void He.error(
            "fairplay eme: not creating new session for extURI",
            b
          );
        const P = m.createSession();
        He.debug("fairplay eme: creating new key session for", b),
          n.addMediaKeySessionInfo(b, P, n.item),
          P.addEventListener("message", n.startFairplayLicenseSession),
          (P.extURI = b),
          yield P.generateRequest(y, p),
          (n._mediaKeySessions[P.sessionId] = P),
          He.debug("fairplay eme: created session", P);
      })();
    }
    startFairplayLicenseSession(e) {
      const { message: n, target: d } = e,
        p = De(new Uint8Array(n)),
        h = d.extURI || this.extURI,
        y = this.mediaKeySessions[h];
      if (y)
        return this.acquirePlaybackLicense(h, p, this.initiated, y).then((e) =>
          this.handleLicenseJson(e, d, h)
        );
      He.debug(
        "fairplay eme: no key session info, aborting license request",
        h
      );
    }
    handleLicenseJson(e, n, d) {
      var p = this,
        _superprop_get_handleLicenseJson = () => super.handleLicenseJson;
      return _async_to_generator$11(function* () {
        if (!e) return;
        const h = p.mediaKeySessions[d];
        if (!h)
          return void He.debug(
            "fairplay eme: media key session does not exist, not updating"
          );
        const y = e["renew-after"];
        if (e.license && y) {
          He.debug("fairplay eme: got renew after value", y, d);
          const e = p._mediaKeySessionRenewals,
            _ = e[n.sessionId];
          _ && clearTimeout(_),
            (e[n.sessionId] = setTimeout(
              () => p._renewMediaKeySession(h, d),
              1e3 * y
            ));
        }
        yield _superprop_get_handleLicenseJson().call(p, e, n, d);
      })();
    }
    _renewMediaKeySession(e, n) {
      delete this._mediaKeySessionRenewals[e.session.sessionId],
        He.debug("fairplay eme: renewing session", e),
        e.session.update(Ce("renew"));
    }
    applyDelayedCdmUpdates() {}
    loadKeys(e) {
      return _async_to_generator$11(function* () {})();
    }
    clearSessions() {
      return _async_to_generator$11(function* () {})();
    }
    constructor(...e) {
      super(...e),
        _define_property$1r(this, "_keySystemAccess", void 0),
        _define_property$1r(this, "_mediaKeysPromise", void 0),
        _define_property$1r(this, "_mediaKeySessions", {}),
        _define_property$1r(this, "_mediaKeySessionRenewals", {}),
        _define_property$1r(this, "_mediaKeys", void 0);
    }
  }
  function asyncGeneratorStep$10(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$10(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$10(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$10(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1q(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$v("design:type", Function),
      _ts_metadata$v("design:paramtypes", [void 0]),
      _ts_metadata$v("design:returntype", void 0),
    ],
    FairplayEncryptedSession.prototype,
    "startFairplayLicenseSession",
    null
  );
  const yi = /^(?:.*)(skd:\/\/.+)$/i;
  class WebKitSession extends KeySession {
    get isDestroyed() {
      return this._isDestroyed;
    }
    attachMedia(e, n) {
      return (
        (this.target = e),
        e.addEventListener(
          "webkitneedkey",
          this.boundHandleSessionCreation,
          !1
        ),
        e.addEventListener("webkitkeyerror", this.boundDispatchKeyError),
        e
      );
    }
    detachMedia(e) {
      e &&
        (e.removeEventListener(
          "webkitneedkey",
          this.boundHandleSessionCreation,
          !1
        ),
        e.removeEventListener("webkitkeyerror", this.boundDispatchKeyError));
    }
    destroy() {
      He.debug("FPS destroy"),
        (this._isDestroyed = !0),
        this.detachMedia(this.target),
        this.session &&
          (this.session.removeEventListener(
            "webkitkeyerror",
            this.boundDispatchKeyError
          ),
          this.session.removeEventListener(
            "webkitkeymessage",
            this.boundStartLicenseSession
          ));
    }
    createSession(e) {
      He.debug("FPS createSession", e);
      const { initData: n, target: d } = e,
        { item: p } = this;
      if (!p)
        return He.error("Cannot createSession without item"), Promise.resolve();
      const h = this._extractAssetId(n);
      if ((He.debug("extURI", h), !d.webkitKeys && window.WebKitMediaKeys)) {
        const e = new window.WebKitMediaKeys(this.keySystem);
        d.webkitSetMediaKeys(e);
      }
      return this.loadCertificateBuffer().then((e) => {
        const y = this._concatInitDataIdAndCertificate(n, h, e),
          _ = "VIDEO" === d.tagName ? ot.AVC1 : ot.MP4,
          m = d.webkitKeys.createSession(_, y);
        this.addMediaKeySessionInfo(h, m, p),
          (this.session = m),
          (m.extURI = h),
          m.addEventListener("webkitkeyerror", this.boundDispatchKeyError),
          m.addEventListener("webkitkeymessage", this.boundStartLicenseSession);
      });
    }
    _extractAssetId(e) {
      let n = String.fromCharCode.apply(null, new Uint16Array(e.buffer || e));
      const d = n.match(yi);
      return (
        d && d.length >= 2 && (n = d[1]),
        He.debug("Extracted assetId from EXT-X-KEY URI", n),
        n
      );
    }
    _concatInitDataIdAndCertificate(e, n, d) {
      "string" == typeof n && (n = Me(n)), (d = new Uint8Array(d));
      let p = 0;
      const h = new ArrayBuffer(
          e.byteLength + 4 + n.byteLength + 4 + d.byteLength
        ),
        y = new DataView(h);
      new Uint8Array(h, p, e.byteLength).set(e),
        (p += e.byteLength),
        y.setUint32(p, n.byteLength, !0),
        (p += 4);
      const _ = new Uint8Array(h, p, n.byteLength);
      _.set(n), (p += _.byteLength), y.setUint32(p, d.byteLength, !0), (p += 4);
      return (
        new Uint8Array(h, p, d.byteLength).set(d),
        new Uint8Array(h, 0, h.byteLength)
      );
    }
    applyDelayedCdmUpdates() {}
    loadKeys(e) {
      return _async_to_generator$10(function* () {})();
    }
    clearSessions() {
      return _async_to_generator$10(function* () {})();
    }
    constructor(...e) {
      super(...e),
        _define_property$1q(this, "target", void 0),
        _define_property$1q(this, "session", void 0),
        _define_property$1q(this, "_isDestroyed", !1),
        _define_property$1q(this, "isLegacyEme", !0);
    }
  }
  function asyncGeneratorStep$$(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$$(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$$(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$$(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  class MSSession extends KeySession {
    attachMedia(e, n) {
      return (
        (this.keySystem = n.keySystem),
        e.addEventListener("msneedkey", this.boundHandleSessionCreation, !1),
        e.addEventListener("mskeyerror", this.boundDispatchKeyError),
        e
      );
    }
    detachMedia(e) {
      e.removeEventListener("msneedkey", this.boundHandleSessionCreation, !1),
        e.removeEventListener("mskeyerror", this.boundDispatchKeyError);
    }
    createSession(e) {
      const { initData: n, target: d } = e;
      if (!d.msKeys) {
        const e = new MSMediaKeys(this.keySystem);
        d.msSetMediaKeys(e);
      }
      const p = d.msKeys.createSession(ot.MP4, n);
      return (
        p.addEventListener("mskeyerror", this.dispatchKeyError),
        p.addEventListener("mskeymessage", this.startLicenseSession.bind(this)),
        p
      );
    }
    applyDelayedCdmUpdates() {}
    loadKeys(e) {
      return _async_to_generator$$(function* () {})();
    }
    clearSessions() {
      return _async_to_generator$$(function* () {})();
    }
  }
  const _i = {
      [tt.WIDEVINE]: st.WIDEVINE,
      [tt.FAIRPLAY]: st.FAIRPLAY,
      [tt.PLAYREADY]: st.PLAYREADY,
    },
    fi = [
      0, 0, 1, 222, 112, 115, 115, 104, 0, 0, 0, 0, 154, 4, 240, 121, 152, 64,
      66, 134, 171, 146, 230, 91, 224, 136, 95, 149, 0, 0, 1, 190,
    ],
    mi = [190, 1, 0, 0, 1, 0, 1, 0, 180, 1];
  function concatenate(e, ...n) {
    let d = 0;
    for (const y of n) d += y.length;
    const p = new e(d);
    let h = 0;
    for (const y of n) p.set(y, h), (h += y.length);
    return p;
  }
  const { WIDEVINE: vi, PLAYREADY: gi } = tt,
    bi = {};
  (bi[vi] = (e) => {
    He.debug("generating Widevine pssh for keyId");
    const n = new Uint8Array([
      0, 0, 0, 52, 112, 115, 115, 104, 0, 0, 0, 0, 237, 239, 139, 169, 121, 214,
      74, 206, 163, 200, 39, 220, 213, 29, 33, 237, 0, 0, 0, 20, 8, 1, 18, 16,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ]);
    for (let d = 0; d < e.length; d++) n[n.length - 16 + d] = e[d];
    return He.debug("generatePSSH", n), n;
  }),
    (bi[gi] = (e) => {
      He.debug("generating Playready pssh for keyId"),
        ((e) => {
          const swap = (e, n, d) => {
            const p = e[n];
            (e[n] = e[d]), (e[d] = p);
          };
          swap(e, 0, 3), swap(e, 1, 2), swap(e, 4, 5), swap(e, 6, 7);
        })(e);
      const n = De(e),
        d =
          '<WRMHEADER xmlns="http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version="4.3.0.0"><DATA><PROTECTINFO><KIDS><KID ALGID="AESCTR" VALUE="[KEYID]"></KID></KIDS></PROTECTINFO></DATA></WRMHEADER>'.replace(
            "[KEYID]",
            n
          ),
        p = Me(d),
        h = new Uint8Array(p.buffer, p.byteOffset, p.byteLength);
      return concatenate(Uint8Array, fi, mi, h);
    });
  function asyncGeneratorStep$_(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$_(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$_(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$_(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1p(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class PreloadingEncryptedSession extends KeySession {
    attachMedia(e, n) {
      (this.keySystem = n.keySystem),
        (this._keySystemAccess = n),
        (this._target = e);
    }
    detachMedia() {
      asAsync(this.clearSessions());
    }
    createSession(e) {
      return _async_to_generator$_(function* () {})();
    }
    _mediaKeysSetup() {
      var e = this;
      return _async_to_generator$_(function* () {
        const n = e._keySystemAccess;
        var d;
        n &&
          (e._mediaKeysPromise ||
            (e._mediaKeysPromise = new Promise(
              ((d = _async_to_generator$_(function* (d, p) {
                const h = yield n.createMediaKeys();
                try {
                  var y;
                  yield null === (y = e._target) || void 0 === y
                    ? void 0
                    : y.setMediaKeys(h),
                    (e._mediaKeys = h);
                } catch (q) {
                  e.dispatchKeyError(q), p(q);
                }
                if (e.isWidevine) {
                  const n = yield e.loadCertificateBuffer();
                  yield h.setServerCertificate(n);
                }
                d(h);
              })),
              function (e, n) {
                return d.apply(this, arguments);
              })
            )),
          yield e._mediaKeysPromise);
      })();
    }
    createSessionAndGenerateRequest(e, n, d) {
      var p = this;
      return _async_to_generator$_(function* () {
        var h;
        const y = !!(null == d ? void 0 : d.isRenewal),
          _ = !!(null == d ? void 0 : d.delayCdmUpdate);
        if (!y && p.mediaKeySessions[e]) return;
        He.debug(
          `createSessionAndGenerateRequest for item ${n.title}, isRenewal ${y}`
        );
        const m =
            null === (h = p._mediaKeys) || void 0 === h
              ? void 0
              : h.createSession(),
          { keySystem: g } = p;
        if (!m) return;
        p.addMediaKeySessionInfo(e, m, n, _);
        const b = ((e) => {
            if (e.includes("data")) {
              const [n, d] = e.split(",");
              return d;
            }
            return e;
          })(e),
          P = Ae(b),
          S = (p.isWidevine && n.isSong) || 16 === P.length;
        let T;
        var k;
        return (
          He.debug("extracted uri", e),
          p.isPlayReady && !S
            ? (He.debug("handling Playready object"),
              (m.extURI = e),
              (k = P),
              (T = concatenate(Uint8Array, new Uint8Array(fi), k)))
            : S
              ? (He.debug("handling keyId only initData"),
                (m.extURI = "data:;base64," + De(P)),
                (T = ((e, n) => {
                  const d = bi[n];
                  if (!d) return He.warn("No pssh generator for ", n), e;
                  return d(Uint8Array.from(e));
                })(P, g)))
              : (He.debug("handling pssh initData"), (m.extURI = e), (T = P)),
          m.addEventListener("message", p.startLicenseSession),
          m.generateRequest("cenc", T).catch((e) => {
            if (e.message.match(/generateRequest.*\(75\)/))
              return m.generateRequest("cenc", T);
            throw e;
          })
        );
      })();
    }
    handleLicenseJson(e, n, d) {
      var p = this,
        _superprop_get_handleLicenseJson = () => super.handleLicenseJson;
      return _async_to_generator$_(function* () {
        var h;
        if (!e) return;
        const y = p.mediaKeySessions[d];
        if (!y)
          return void He.debug(
            "media key session does not exist, not updating"
          );
        const _ = e["renew-after"];
        if (e.license && _) {
          He.debug("Got renew after value", _, d);
          const e = p._mediaKeySessionRenewals,
            h = e[n.sessionId];
          h && clearTimeout(h),
            (e[n.sessionId] = setTimeout(
              () => p._renewMediaKeySession(y, d),
              1e3 * _
            ));
        }
        yield _superprop_get_handleLicenseJson().call(p, e, n, d);
        const m =
          null === (h = p.mediaKeySessions[d]) || void 0 === h
            ? void 0
            : h.oldSession;
        m &&
          (He.debug("removing old key session after updating", d),
          yield p._removeAndCloseSession(m),
          delete p.mediaKeySessions[d].oldSession,
          delete p._mediaKeySessionRenewals[m.sessionId]);
      })();
    }
    _renewMediaKeySession(e, n) {
      delete this._mediaKeySessionRenewals[e.session.sessionId],
        asAsync(
          this.createSessionAndGenerateRequest(n, e.item, { isRenewal: !0 })
        );
    }
    applyDelayedCdmUpdates() {
      var e = this;
      return _async_to_generator$_(function* () {
        He.debug("applying delayed CDM updates");
        const n = Object.entries(e.mediaKeySessions);
        for (const d of n) {
          const [n, p] = d;
          if (p.delayCdmUpdate) {
            const d = yield p["license-json"];
            He.debug("delayed update of license", d),
              (p.delayCdmUpdate = !1),
              yield e.handleLicenseJson(d, p.session, n);
          }
        }
      })();
    }
    loadKeys(e, n, d) {
      var p = this;
      return _async_to_generator$_(function* () {
        yield p._mediaKeysSetup();
        const h = p.filterKeyValues(e);
        for (const e of h) {
          const { dataUri: h } = e;
          yield p.createSessionAndGenerateRequest(h, n, d);
        }
        if (null == n ? void 0 : n.isLiveAudioStation) {
          const e = Object.keys(p.mediaKeySessions),
            n = h.reduce((e, n) => ((e[n.dataUri] = !0), e), {});
          for (const d of e) n[d] || (yield p._scheduleRemoveSession(d));
        }
      })();
    }
    filterKeyValues(e) {
      let n;
      if (1 === e.length) n = e;
      else {
        const d = _i[this.keySystem];
        n = e.filter((e) => e.keyFormat === d);
      }
      return n;
    }
    clearSessions(e) {
      var n = this;
      return _async_to_generator$_(function* () {
        const d = n.mediaKeySessions;
        if (null == e ? void 0 : e.length) {
          const d = n.filterKeyValues(e);
          for (const e of d) {
            const d = e.dataUri;
            clearTimeout(n._sessionRemovalTimeouts[d]),
              yield n._removeSessionImmediately(d);
          }
        } else {
          Object.values(n._sessionRemovalTimeouts).forEach((e) =>
            clearTimeout(e)
          ),
            He.debug("clearing key sessions", d);
          for (const e of Object.keys(d)) yield n._removeSessionImmediately(e);
        }
      })();
    }
    _scheduleRemoveSession(e) {
      var n = this;
      return _async_to_generator$_(function* () {
        if (!n.mediaKeySessions[e])
          return void He.warn(
            "no session for dataUri, not scheduling remove",
            e
          );
        if (n._sessionRemovalTimeouts[e]) return;
        const d = setTimeout(() => {
          asAsync(n._removeSessionImmediately(e));
        }, 6e4);
        He.debug("deferring removal of keysession for dataUri", e),
          (n._sessionRemovalTimeouts[e] = d);
      })();
    }
    _removeSessionImmediately(e) {
      var n = this;
      return _async_to_generator$_(function* () {
        const d = n.mediaKeySessions[e];
        if (!d) return void He.warn("no session for dataUri, not removing", e);
        He.debug("removing keysession for", e);
        const { session: p, oldSession: h } = d;
        n._clearSessionRenewal(p),
          delete n.mediaKeySessions[e],
          yield n._removeAndCloseSession(p),
          h && (yield n._removeAndCloseSession(h));
      })();
    }
    _removeAndCloseSession(e) {
      var n = this;
      return _async_to_generator$_(function* () {
        e.removeEventListener("message", n.startLicenseSession),
          He.debug("tearing down session", e.sessionId);
        try {
          yield e.remove();
        } catch (Yt) {
          He.warn("Error invoking session.remove()", Yt);
        } finally {
          try {
            yield e.close();
          } catch (Yt) {
            He.warn("Error invoking session.close()", Yt);
          }
        }
      })();
    }
    _clearSessionRenewal(e) {
      const n = this._mediaKeySessionRenewals[e.sessionId];
      n &&
        (He.debug(
          "clearing scheduled license renewal for session",
          e.sessionId
        ),
        clearTimeout(n),
        delete this._mediaKeySessionRenewals[e.sessionId]);
    }
    constructor(...e) {
      super(...e),
        _define_property$1p(this, "_keySystemAccess", void 0),
        _define_property$1p(this, "_mediaKeysPromise", void 0),
        _define_property$1p(this, "_mediaKeys", void 0),
        _define_property$1p(this, "_target", void 0),
        _define_property$1p(this, "_sessionRemovalTimeouts", {}),
        _define_property$1p(this, "_mediaKeySessionRenewals", {});
    }
  }
  function asyncGeneratorStep$Z(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$Z(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$Z(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$Z(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1o(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Pi = BooleanDevFlag.register("mk-safari-modern-eme");
  class MediaExtension extends Notifications {
    get hasMediaKeySupport() {
      return hasMediaKeySupport();
    }
    get hasMediaSession() {
      return void 0 !== this._session;
    }
    get isFairplay() {
      return this._session.isFairplay;
    }
    set extURI(e) {
      this._session.extURI = e;
    }
    set initiated(e) {
      this._session.initiated = e;
    }
    get session() {
      return this._session;
    }
    clearSessions(e) {
      var n = this;
      return _async_to_generator$Z(function* () {
        var d;
        return null === (d = n.session) || void 0 === d
          ? void 0
          : d.clearSessions(e);
      })();
    }
    initializeKeySystem() {
      var e = this;
      return _async_to_generator$Z(function* () {
        yield e._attachSession();
        const { _session: n } = e;
        n &&
          [at.playbackLicenseError, at.playbackSessionError].forEach((d) => {
            n.addEventListener(d, (n) => {
              e.dispatchEvent(d, n);
            });
          });
      })();
    }
    _requestModernFairplayAccess() {
      var e = this;
      return _async_to_generator$Z(function* () {
        const { contentType: n } = e,
          d = [
            {
              initDataTypes: ["skd"],
              audioCapabilities: [{ contentType: n, robustness: "" }],
              videoCapabilities: [{ contentType: n, robustness: "" }],
              distinctiveIdentifier: "not-allowed",
              persistentState: "not-allowed",
              sessionTypes: ["temporary"],
            },
          ],
          [, p] = yield findMediaKeySystemAccess([tt.FAIRPLAY], d);
        return p;
      })();
    }
    _attachSession() {
      var e = this;
      return _async_to_generator$Z(function* () {
        var n, d;
        const { mediaElement: p, contentType: h } = e;
        if (
          null === (n = window.WebKitMediaKeys) || void 0 === n
            ? void 0
            : n.isTypeSupported(tt.FAIRPLAY + ".1_0", ot.MP4)
        ) {
          let n;
          Pi.enabled &&
            e.hasMediaKeySupport &&
            (n = yield e._requestModernFairplayAccess()),
            n
              ? (He.warn("media-extension: Using Fairplay modern EME"),
                (e._session = new FairplayEncryptedSession()),
                e._session.attachMedia(p, n))
              : (He.warn("media-extension: Using Fairplay legacy EME"),
                (e._session = new WebKitSession()),
                e._session.attachMedia(p, { keySystem: tt.FAIRPLAY }));
        } else if (
          null === (d = window.MSMediaKeys) || void 0 === d
            ? void 0
            : d.isTypeSupported(tt.PLAYREADY, ot.MP4)
        )
          (e._session = new MSSession()),
            e._session.attachMedia(p, { keySystem: tt.PLAYREADY });
        else if (e.hasMediaKeySupport && p.canPlayType(h)) {
          e._session = new PreloadingEncryptedSession();
          const n = [
              {
                initDataTypes: ["cenc", "keyids"],
                audioCapabilities: [{ contentType: h }],
                distinctiveIdentifier: "optional",
                persistentState: "required",
              },
            ],
            d = potentialKeySystemsForAccess(),
            [, _] = yield findMediaKeySystemAccess(d, n);
          var y;
          if (_)
            null === (y = e._session) || void 0 === y || y.attachMedia(p, _);
          else He.warn("media-extension: No keysystem detected!");
        }
      })();
    }
    setMediaItem(e) {
      !(function (e, n) {
        n.keyURLs &&
          ((e.developerToken = hi.developerToken),
          (e.userToken = hi.musicUserToken),
          (e.item = n),
          (e.adamId = n.songId),
          (e.isLibrary = n.isCloudItem),
          e.setKeyURLs(n.keyURLs));
      })(this._session, e);
    }
    destroy(e) {
      var n;
      null === (n = this._session) || void 0 === n || n.detachMedia(e);
    }
    constructor(e, n) {
      super([at.playbackLicenseError, at.playbackSessionError]),
        _define_property$1o(this, "_session", void 0),
        _define_property$1o(this, "mediaElement", void 0),
        _define_property$1o(this, "contentType", void 0),
        (this.mediaElement = e),
        (this.contentType = n);
    }
  }
  const Si = BooleanDevFlag.register("mk-force-audio-mse"),
    shouldForceAudioMse = () => Si.enabled;
  function asyncGeneratorStep$Y(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1n(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class ByteRangeSegment {
    load() {
      var e,
        n = this;
      return ((e = function* () {
        const { url: e, range: d } = n;
        if (!e) return new Uint8Array();
        const p = new Headers();
        p.append("Range", d);
        const h = yield fetch(e, { headers: p }),
          y = yield h.arrayBuffer();
        return new Uint8Array(y);
      }),
      function () {
        var n = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = e.apply(n, d);
          function _next(e) {
            asyncGeneratorStep$Y(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$Y(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    constructor({ url: e, startByte: n, length: d, isInitSegment: p = !1 }) {
      _define_property$1n(this, "url", void 0),
        _define_property$1n(this, "range", void 0),
        _define_property$1n(this, "startByte", void 0),
        _define_property$1n(this, "endByte", void 0),
        _define_property$1n(this, "length", void 0),
        _define_property$1n(this, "startTime", void 0),
        _define_property$1n(this, "endTime", void 0),
        _define_property$1n(this, "isInitSegment", void 0),
        (this.url = e),
        (this.isInitSegment = p),
        (this.startByte = parseInt(n, 10)),
        (this.length = parseInt(d, 10)),
        (this.endByte = this.startByte + this.length - 1),
        (this.range = `bytes=${this.startByte}-${this.endByte}`);
    }
  }
  function asyncGeneratorStep$X(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1m(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class ContinuousSegment {
    load() {
      var e,
        n = this;
      return ((e = function* () {
        const { url: e } = n;
        if (!e) return new Uint8Array();
        const d = yield fetch(e),
          p = yield d.arrayBuffer();
        return new Uint8Array(p);
      }),
      function () {
        var n = this,
          d = arguments;
        return new Promise(function (p, h) {
          var y = e.apply(n, d);
          function _next(e) {
            asyncGeneratorStep$X(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$X(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    constructor(e, n = !1) {
      _define_property$1m(this, "url", void 0),
        _define_property$1m(this, "isInitSegment", void 0),
        (this.url = e),
        (this.isInitSegment = n);
    }
  }
  function _define_property$1l(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Ti = /^#EXT-X-BYTERANGE:([^\n]+)\n/gim,
    ki = /^#EXT-X-MAP:([^\n]+)\n/im,
    Ei = /#EXTINF:\d*\.\d*\,[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim,
    wi =
      /#EXTINF:\d*\.\d*,\s*#EXT-X-BITRATE:\d{1,3}[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim;
  class SegmentList {
    get segments() {
      return this._segments;
    }
    addSegment(e, n) {
      this._addedSegments[n] ||
        (He.debug("Adding segment", n),
        this._segments.push(e),
        (this._addedSegments[n] = !0));
    }
    extractLiveRadioSegments(e, n) {
      this._extractContinuousSegments(Ei, e, n);
    }
    extractHlsOffersSegments(e, n) {
      this._extractContinuousSegments(wi, e, n);
    }
    _extractContinuousSegments(e, n, d) {
      if (!n || !e.test(n)) return;
      let p;
      for (e.lastIndex = 0; (p = e.exec(n)); ) {
        const e = p[0].startsWith("#EXT-X-MAP") ? p[2] : p[1],
          n = joinURLPath([...splitURLPath(d).slice(0, -1), e]),
          h = p[0].startsWith("#EXT-X-MAP");
        this.addSegment(new ContinuousSegment(n, h), e);
      }
    }
    extractByteRangeSegments(e, n) {
      if (!e || !Ti.test(e)) return;
      const d = (function (e) {
        if (!e || !ki.test(e)) return;
        const [, n] = e.match(ki);
        return n.split(",").reduce((e, n) => {
          const [d, p] = n.split("=");
          return (e[d.toLowerCase()] = p.replace(/\"/gi, "")), e;
        }, {});
      })(e);
      var p;
      const h = null !== (p = n.split("/").pop()) && void 0 !== p ? p : "",
        y = n.replace(h, d.uri),
        [_, m] = d.byterange.split("@"),
        g = new ByteRangeSegment({ url: y, startByte: m, length: _ });
      var b;
      this.addSegment(g, g.range),
        (null !== (b = e.match(Ti)) && void 0 !== b ? b : []).forEach((e) => {
          const [, n, d] = e.match(/^#EXT-X-BYTERANGE:(\d+)@(\d+)\n/),
            p = new ByteRangeSegment({ url: y, startByte: d, length: n });
          this.addSegment(p, p.range);
        });
    }
    constructor() {
      _define_property$1l(this, "_segments", []),
        _define_property$1l(this, "_addedSegments", {});
    }
  }
  var Oi;
  function asyncGeneratorStep$W(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$W(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$W(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$W(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1k(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$u(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e) {
    e.keysParsed = "keysParsed";
  })(Oi || (Oi = {}));
  const $i = /^#EXT-X-TARGETDURATION:(\d+)/im,
    Ii = /^#EXT-X-KEY:[^\n]+URI="([^"]+)"/im,
    Ri = /^#EXT-X-KEY:[^\n]+URI="([^"]+)",KEYFORMAT="([^"]+)"/gim;
  function loadManifestData(e) {
    return _loadManifestData.apply(this, arguments);
  }
  function _loadManifestData() {
    return (_loadManifestData = _async_to_generator$W(function* (e) {
      return (yield fetch(e)).text();
    })).apply(this, arguments);
  }
  class Manifest extends Notifications {
    parse() {
      const e = this._item,
        n = this._data;
      if (ct !== tt.FAIRPLAY || shouldForceAudioMse())
        if ((this._detectKeyTags(), e.hasOffersHlsUrl))
          this._segmentList.extractHlsOffersSegments(n, e.assetURL);
        else if (e.isLiveRadioStation) {
          this._segmentList.extractLiveRadioSegments(n, e.assetURL);
          const [, d] = this._data.match($i);
          He.debug(
            `manifest: setting up manifest refresh interval at ${d} seconds`
          );
          const p = 1e3 * parseInt(d, 10);
          this._manifestRefreshInterval = setInterval(this.liveRadioRefresh, p);
        } else this._segmentList.extractByteRangeSegments(n, e.assetURL);
    }
    static load(e, n = !0) {
      var d = this;
      return _async_to_generator$W(function* () {
        He.debug("loading manifest for item", e.title);
        const p = e.assetURL;
        let h;
        const y = getSessionStorage(),
          _ = !!y && n;
        if (_ && ((h = null == y ? void 0 : y.getItem(p)), h))
          return new d(h, e);
        const m = new Date().getTime();
        h = yield loadManifestData(p);
        const g = new d(h, e);
        return (
          (g.downlink = (function (e, n) {
            return (8 * n.length) / ((new Date().getTime() - e) / 1e3) / 1024;
          })(m, h)),
          _ && (null == y || y.setItem(p, h)),
          Promise.resolve(g)
        );
      })();
    }
    get downlink() {
      return this._downlink;
    }
    set downlink(e) {
      this._downlink = e;
    }
    get mediaItem() {
      return this._item;
    }
    liveRadioRefresh() {
      var e = this;
      return _async_to_generator$W(function* () {
        const n = yield loadManifestData(e._url);
        (e._data = n),
          e._detectKeyTags(),
          e._segmentList.extractLiveRadioSegments(n, e._url),
          e.dispatchEvent(at.manifestParsed);
      })();
    }
    segmentsForTimeRange(e) {
      const n = Math.floor(e.start / 10) + 1,
        d = Math.floor(e.end / 10) + 1,
        { segments: p } = this;
      return [p[0], ...p.slice(n, d + 1)];
    }
    get segments() {
      return this._segmentList.segments;
    }
    get extURI() {
      if (!this._extURI) {
        const e = this._data.match(Ii);
        He.debug("manifest: EXT_X_KEY_URI matches", e),
          (this._extURI = (e && e[1]) || void 0);
      }
      return this._extURI;
    }
    get keyValues() {
      let e = this._modernKeys;
      return e.length || (e = this._legacyKeys), e;
    }
    _detectKeyTags() {
      const e = this.keyValues;
      e.length &&
        this.dispatchEvent(Oi.keysParsed, { item: this.mediaItem, keys: e });
    }
    get _legacyKeys() {
      const e = this._data.match(Ii);
      He.debug("manifest: EXT_X_KEY_URI matches", e);
      const n = (e && e[1]) || void 0;
      this._extURI = n;
      const d = [];
      return n && d.push({ keyFormat: st.WIDEVINE, dataUri: n }), d;
    }
    get _modernKeys() {
      let e;
      Ri.lastIndex = 0;
      const n = [];
      for (; (e = Ri.exec(this._data)); ) {
        const [d, p, h] = e;
        n.push({ keyFormat: h, dataUri: p });
      }
      return n;
    }
    stop() {
      this._manifestRefreshInterval &&
        clearInterval(this._manifestRefreshInterval);
    }
    constructor(e, n) {
      super([at.manifestParsed, Oi.keysParsed]),
        _define_property$1k(this, "_data", void 0),
        _define_property$1k(this, "_downlink", 0),
        _define_property$1k(this, "_extURI", void 0),
        _define_property$1k(this, "_url", void 0),
        _define_property$1k(this, "_item", void 0),
        _define_property$1k(this, "_segmentList", new SegmentList()),
        _define_property$1k(this, "_manifestRefreshInterval", void 0),
        (this._data = e),
        (this._item = n),
        (this._url = n.assetURL);
    }
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$u("design:type", Function),
      _ts_metadata$u("design:paramtypes", []),
      _ts_metadata$u("design:returntype", Promise),
    ],
    Manifest.prototype,
    "liveRadioRefresh",
    null
  );
  const Ai = "seamlessAudioTransition",
    Ci = "bufferTimedMetadataDidChange",
    Mi = "loadSegmentError",
    Di = isNodeEnvironment$1() ? require("util").TextDecoder : self.TextDecoder;
  function encodedArrayToString(e, n = "utf-8") {
    if ("iso-8859-1" === n) return String.fromCharCode(...e);
    return new Di(n).decode(e);
  }
  function readNullTerminatedString(e, n = 0, d) {
    const p = [];
    d = null != d ? d : e.length;
    for (let h = n; h < d; h++) {
      const n = e[h];
      if ("\0" === String.fromCharCode(n)) break;
      p.push(String.fromCharCode(n));
    }
    return [p.join(""), p.length];
  }
  function _define_property$1j(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class BaseMp4Box {
    get size() {
      return this.end - this.start;
    }
    get rawBytes() {
      return this.data.slice(this.start, this.end);
    }
    constructor(e, n, d, p) {
      _define_property$1j(this, "id", void 0),
        _define_property$1j(this, "data", void 0),
        _define_property$1j(this, "start", void 0),
        _define_property$1j(this, "end", void 0),
        (this.id = e),
        (this.data = n),
        (this.start = d),
        (this.end = p);
    }
  }
  const ji = [
    237, 239, 139, 169, 121, 214, 74, 206, 163, 200, 39, 220, 213, 29, 33, 237,
  ];
  class PsshBox extends BaseMp4Box {
    get systemId() {
      const { data: e, start: n } = this,
        d = n + 12;
      return e.slice(d, d + 16);
    }
    get dataSize() {
      return this.view.getUint32(28);
    }
    get psshData() {
      const { data: e, start: n, dataSize: d } = this,
        p = n + 32;
      return e.slice(p, p + d);
    }
    get keyBytes() {
      const { psshData: e } = this;
      return e.slice(2, 18);
    }
    get isWidevine() {
      return arrayEquals(this.systemId, ji);
    }
    constructor(e, n, d) {
      var p, h, y;
      super("pssh", e, n, d),
        (y = void 0),
        (h = "view") in (p = this)
          ? Object.defineProperty(p, h, {
              value: y,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (p[h] = y),
        (this.view = new DataView(e.buffer, n));
    }
  }
  function _define_property$1h(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class TencBox extends BaseMp4Box {
    get isProtected() {
      const { data: e, start: n } = this;
      return e[n + 14];
    }
    get defaultKeyId() {
      const { data: e, start: n } = this;
      return e.slice(n + 16, n + 32);
    }
    set defaultKeyId(e) {
      const { data: n, start: d } = this;
      for (let p = 0; p < e.length; p++) n[p + d + 16] = e[p];
    }
    constructor(e, n, d) {
      super("tenc", e, n, d),
        _define_property$1h(this, "data", void 0),
        _define_property$1h(this, "start", void 0),
        _define_property$1h(this, "end", void 0),
        (this.data = e),
        (this.start = n),
        (this.end = d);
    }
  }
  function findBox(e, n, d = []) {
    for (let p = n; p < e.length; ) {
      if (0 === d.length) return;
      const n = new DataView(e.buffer, p).getUint32(0),
        h = encodedArrayToString(e.subarray(p + 4, p + 8)),
        y = p + n;
      if (1 === d.length && h === d[0]) return new BaseMp4Box(h, e, p, y);
      if (h === d[0]) return findBox(e, p + 8, d.slice(1));
      p += n;
    }
  }
  const rewriteDefaultKid = (e) => {
    const [n] = (function (e) {
      const n = findBox(e, 0, ["moov", "trak", "mdia", "minf", "stbl", "stsd"]),
        d = [];
      if (!n) return d;
      for (let p = n.start + 16; p < n.end; ) {
        let h = findBox(e, p, ["enca"]),
          y = 36;
        if ((h || ((h = findBox(e, p, ["encv"])), (y = 86)), !h)) return d;
        const _ = findBox(e, h.start + y, ["sinf", "schi", "tenc"]);
        _
          ? (d.push(new TencBox(_.data, _.start, _.end)), (p = _.end))
          : (p = n.end);
      }
      return d;
    })(e);
    if (!n) return;
    const d = (function (e) {
      const n = findBox(e, 0, ["moov"]),
        d = [];
      if (!n) return d;
      const p = new DataView(e.buffer, 0);
      for (let h = n.start + 8; h < n.size; ) {
        const n = p.getUint32(h);
        "pssh" === encodedArrayToString(e.subarray(h + 4, h + 8)) &&
          d.push(new PsshBox(e, h, h + n)),
          (h += n);
      }
      return d;
    })(e).find((e) => e.isWidevine);
    d && (n.defaultKeyId = d.keyBytes);
  };
  function _define_property$1g(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class ID3Tag {
    get major() {
      return this.version[0];
    }
    get minor() {
      return this.version[1];
    }
    get revision() {
      var e;
      return null !== (e = this.version[2]) && void 0 !== e ? e : 0;
    }
    static parse(e) {
      return (function (e) {
        if (
          0 === e.length ||
          "ID3" !==
            (function (e, n = 0) {
              return decodeString(e.subarray(n, 3));
            })(e)
        )
          return;
        const n = {};
        let d = 3;
        (n.version = [3, e[d++], e[d++]]),
          (n.flags = (function (e, n = 5) {
            const d = e[n];
            return {
              unsynchronized: decodeBitFlag(d, 7),
              extendedHeader: decodeBitFlag(d, 6),
              experimental: decodeBitFlag(d, 5),
              footer: decodeBitFlag(d, 4),
            };
          })(e)),
          (d += 1);
        const p = d + 4 + decodeSynchSafeUint32(e.subarray(d, d + 4));
        (d += 4),
          n.flags.extendedHeader &&
            (d += decodeSynchSafeUint32(e.subarray(d, d + 4)));
        n.version[1] > 2 && (n.frames = decodeID3Frames(e, n.version, [d, p]));
        return new ID3Tag(n);
      })(e);
    }
    constructor(e) {
      var n;
      _define_property$1g(this, "version", [3, 2, 0]),
        _define_property$1g(this, "frames", []),
        _define_property$1g(this, "flags", {
          unsynchronized: !1,
          extendedHeader: !1,
          footer: !1,
          experimental: !1,
        }),
        (this.version = e.version),
        (this.flags = (function (e) {
          for (var n = 1; n < arguments.length; n++) {
            var d = null != arguments[n] ? arguments[n] : {},
              p = Object.keys(d);
            "function" == typeof Object.getOwnPropertySymbols &&
              (p = p.concat(
                Object.getOwnPropertySymbols(d).filter(function (e) {
                  return Object.getOwnPropertyDescriptor(d, e).enumerable;
                })
              )),
              p.forEach(function (n) {
                _define_property$1g(e, n, d[n]);
              });
          }
          return e;
        })(
          {
            unsynchronized: !1,
            extendedHeader: !1,
            footer: !1,
            experimental: !1,
          },
          e.flags
        )),
        (this.frames = null !== (n = e.frames) && void 0 !== n ? n : []);
    }
  }
  const xi = {
    WXXX: function (e, n, d) {
      const p = decodeCharset(n[0]),
        [h, y] = decodeNullTerminatedString(n.subarray(1), p),
        _ = y > 0 ? y + 2 : 0;
      return {
        key: "WXXX",
        data: decodeString(n.subarray(_), p),
        description: h,
      };
    },
    TXXX: function (e, n, d) {
      const p = decodeCharset(n[0]),
        [h, y] = decodeNullTerminatedString(n.subarray(1), p),
        _ = y > 0 ? y + 2 : 0;
      return {
        key: "TXXX",
        data: decodeString(n.subarray(_), p),
        description: h,
      };
    },
    TPE1: function (e, n, d) {
      return {
        key: "TPE1",
        data: trimNull(decodeString(n.subarray(1), decodeCharset(n[0]))),
      };
    },
    TIT2: function (e, n, d) {
      return {
        key: "TIT2",
        data: trimNull(decodeString(n.subarray(1), decodeCharset(n[0]))),
      };
    },
    TALB: function (e, n, d) {
      return {
        key: "TALB",
        data: trimNull(decodeString(n.subarray(1), decodeCharset(n[0]))),
      };
    },
    TEXT: function (e, n, d) {
      return {
        key: "TEXT",
        data: trimNull(decodeString(n.subarray(1), decodeCharset(n[0]))),
      };
    },
    PRIV: function (e, n, d) {
      const [p, h] = decodeNullTerminatedString(n);
      if (0 === h) return;
      return { key: "PRIV", owner: p, data: n.slice(h + 1) };
    },
    CHAP: function (e, n, d) {
      const p = new DataView(n.buffer),
        h = {
          key: "CHAP",
          elementId: "",
          startTime: 0,
          endTime: 0,
          frames: [],
        },
        [y, _] = decodeNullTerminatedString(n);
      h.elementId = y;
      let m = _ + 1;
      return (
        (h.startTime = p.getUint32(m)),
        (m += 4),
        (h.endTime = p.getUint32(m)),
        (m += 4),
        (h.startOffset = p.getUint32(m)),
        (m += 4),
        (h.endOffset = p.getUint32(m)),
        (m += 4),
        (h.frames = decodeID3Frames(n, d, [m, n.length])),
        h
      );
    },
  };
  function decodeID3Frames(e, n, d) {
    var p;
    const h =
      null !== (p = (d = null != d ? d : [0, e.byteLength])[1]) && void 0 !== p
        ? p
        : e.byteLength;
    var y;
    let _ = null !== (y = d[0]) && void 0 !== y ? y : 0;
    const m = new DataView(e.buffer, 0, h),
      g = [];
    for (; _ + 8 <= h; ) {
      var b;
      const d = decodeString(e.subarray(_, _ + 4));
      _ += 4;
      const p =
        4 === n[1]
          ? decodeSynchSafeUint32(e.subarray(_, _ + 4))
          : m.getUint32(_);
      if (((_ += 4), e[_++], e[_++], _ + p > h)) break;
      const y = e.slice(_, _ + p),
        P = null === (b = xi[d]) || void 0 === b ? void 0 : b.call(xi, d, y, n);
      P && g.push(P), (_ += p);
    }
    return g;
  }
  function decodeString(e, n = "utf-8") {
    return new TextDecoder(n).decode(e);
  }
  function decodeBitFlag(e, n) {
    return 0 != (e & (1 << n));
  }
  const Li = { 0: "iso-8859-1", 1: "utf-16", 2: "utf-16be", 3: "utf-8" };
  function decodeCharset(e) {
    var n;
    return null !== (n = Li[e]) && void 0 !== n ? n : "iso-8859-1";
  }
  function trimNull(e) {
    return e.replace(/^\0*|\0*/g, "");
  }
  function decodeNullTerminatedString(e, n = "utf-8", d = 0) {
    const p = [];
    for (let h = d; h < e.byteLength; h++) {
      const n = e[h];
      if (0 === n) break;
      p.push(n);
    }
    return [decodeString(new Uint8Array(p), n), p.length];
  }
  function decodeSynchSafeUint32(e) {
    return (
      2097152 * (127 & e[0]) +
      16384 * (127 & e[1]) +
      128 * (127 & e[2]) +
      (127 & e[3])
    );
  }
  function checkBoxName(e, n, d) {
    return (
      !(n + 4 > e.length) &&
      e[n] === d[0] &&
      e[n + 1] === d[1] &&
      e[n + 2] === d[2] &&
      e[n + 3] === d[3]
    );
  }
  function findEmsgs(e) {
    const n = e.length,
      d = [];
    if (
      (function (e) {
        return (
          (null == e ? void 0 : e.length) >= 8 &&
          checkBoxName(e, 4, [102, 116, 121, 112])
        );
      })(e)
    )
      return d;
    for (let p = 0; p < n; p++) {
      if (checkBoxName(e, p, [109, 111, 111, 102])) return d;
      if (checkBoxName(e, p, [101, 109, 115, 103])) {
        const n = p - 4,
          h = new DataView(e.buffer, n).getUint32(0),
          y = e.subarray(n, n + h);
        (p = p + h - 1), d.push(y);
      }
    }
    return d;
  }
  function _define_property$1f(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class TimedMetadata {
    storefrontAdamId(e) {
      var n;
      return null === (n = this.storefrontAdamIds) || void 0 === n
        ? void 0
        : n[e];
    }
    equals(e) {
      return (function (e, n) {
        var d, p, h, y;
        if (void 0 === e && void 0 === n) return !0;
        if (typeof e != typeof n) return !1;
        if (
          ((n = n),
          (e = e).album !== n.album ||
            e.title !== n.title ||
            e.performer !== n.performer)
        )
          return !1;
        if (
          (null === (d = e.links) || void 0 === d ? void 0 : d.length) !==
          (null === (p = n.links) || void 0 === p ? void 0 : p.length)
        )
          return !1;
        for (
          let g = 0;
          g <
          (null !==
            (y = null === (h = e.links) || void 0 === h ? void 0 : h.length) &&
          void 0 !== y
            ? y
            : 0);
          g++
        ) {
          var _, m;
          if (
            !objectKeyValueEquals(
              null === (_ = e.links) || void 0 === _ ? void 0 : _[g],
              null === (m = n.links) || void 0 === m ? void 0 : m[g]
            )
          )
            return !1;
        }
        if (!objectKeyValueEquals(e.storefrontAdamIds, n.storefrontAdamIds))
          return !1;
        if (!compareUint8Array(e.blob, n.blob)) return !1;
        return !0;
      })(this, e);
    }
    constructor(e) {
      var n;
      _define_property$1f(this, "performer", void 0),
        _define_property$1f(this, "title", void 0),
        _define_property$1f(this, "album", void 0),
        _define_property$1f(this, "links", void 0),
        _define_property$1f(this, "storefrontAdamIds", void 0),
        _define_property$1f(this, "blob", void 0),
        (this.performer = null == e ? void 0 : e.performer),
        (this.title = null == e ? void 0 : e.title),
        (this.album = null == e ? void 0 : e.album),
        (this.links = null == e ? void 0 : e.links),
        (this.storefrontAdamIds =
          null !== (n = null == e ? void 0 : e.storefrontAdamIds) &&
          void 0 !== n
            ? n
            : {}),
        (this.blob = null == e ? void 0 : e.blob);
    }
  }
  function objectKeyValueEquals(e, n) {
    if (void 0 === e && void 0 === n) return !0;
    if (typeof e != typeof n) return !1;
    (e = e), (n = n);
    const d = Object.keys(e),
      p = Object.keys(n);
    if (d.length !== p.length) return !1;
    for (const h of d) if (e[h] !== n[h]) return !1;
    return !0;
  }
  function parseStorefrontAdamIds(e) {
    let n;
    n =
      "Uint8Array" === e.constructor.name
        ? new TextDecoder("utf-8").decode(e)
        : e;
    const d = n.trim().split(",");
    if (0 === d.length) return;
    const isEmptyString = (e) => void 0 === e || "" === e,
      p = {};
    for (const h of d) {
      const [e, n] = h.split(":", 2).map((e) => e.trim());
      isEmptyString(e) ||
        isEmptyString(n) ||
        "0" === n ||
        void 0 !== p[e] ||
        (p[e] = n);
    }
    return p;
  }
  function parsePingBlob(e) {
    return "string" == typeof e
      ? Uint8Array.from(atob(e), (e) => e.charCodeAt(0))
      : e;
  }
  function _define_property$1e(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class Emsg {
    get length() {
      return this.data.length;
    }
    get elementPresentationTime() {
      const { presentationTime: e, timeScale: n } = this;
      return e && n ? Math.round(e / n) : NaN;
    }
    get timedMetadata() {
      var e;
      if (this._timedMetadata) return this._timedMetadata;
      const n = null === (e = this.id3) || void 0 === e ? void 0 : e.frames;
      return n
        ? ((this._timedMetadata = (function (e) {
            const n = {};
            for (const p of e)
              if (void 0 !== p.key)
                switch (p.key) {
                  case "TALB":
                    n.album = p.data;
                    break;
                  case "TIT2":
                    n.title = p.data;
                    break;
                  case "TPE1":
                    n.performer = p.data;
                    break;
                  case "WXXX":
                    var d;
                    if (void 0 !== p.description)
                      if (
                        (void 0 === n.links && (n.links = []),
                        !n.links.some((e) => e.url === p.data))
                      )
                        n.links.push({
                          description:
                            null !== (d = p.description) && void 0 !== d
                              ? d
                              : "",
                          url: p.data,
                        });
                    break;
                  case "PRIV":
                    "com.apple.radio.adamid" === p.owner &&
                      (n.storefrontAdamIds = parseStorefrontAdamIds(p.data)),
                      "com.apple.radio.ping.jingle" === p.owner &&
                        (n.blob = parsePingBlob(p.data));
                }
            return new TimedMetadata(n);
          })(n)),
          this._timedMetadata)
        : void 0;
    }
    constructor(e) {
      _define_property$1e(this, "data", void 0),
        _define_property$1e(this, "schemeIdUri", void 0),
        _define_property$1e(this, "eventDuration", void 0),
        _define_property$1e(this, "presentationTime", void 0),
        _define_property$1e(this, "payload", void 0),
        _define_property$1e(this, "timeScale", void 0),
        _define_property$1e(this, "id3", void 0),
        _define_property$1e(this, "id", void 0),
        _define_property$1e(this, "_timedMetadata", void 0),
        (this.data = e);
      const n = new DataView(e.buffer);
      let d = 8;
      if (1 !== e[d]) return;
      (d += 4), (this.timeScale = n.getUint32(d)), (d += 4);
      const p = n.getUint32(d);
      d += 4;
      const h = n.getUint32(d);
      if (
        ((d += 4),
        (this.presentationTime = Math.pow(2, 32) * p + h),
        !Number.isSafeInteger(this.presentationTime))
      )
        throw (
          ((this.presentationTime = Number.MAX_SAFE_INTEGER),
          new Error("Failed to create 64 bit integer"))
        );
      (this.eventDuration = n.getUint32(d)),
        (d += 4),
        (this.id = n.getUint32(d)),
        (d += 4);
      const [y, _] = readNullTerminatedString(e, d);
      (d += _ + 1), (this.schemeIdUri = y);
      const [m, g] = readNullTerminatedString(e, d);
      (d += g + 1),
        (this.payload = e.subarray(d, e.byteLength)),
        (this.id3 = ID3Tag.parse(this.payload));
    }
  }
  function _define_property$1d(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class TimedMetadataManager {
    processEmsgs(e) {
      const n = findEmsgs(e);
      n.length &&
        (this._currentEmsgInterval ||
          (this._currentEmsgInterval = setInterval(this._getCurrentEmsg, 1e3)),
        n.forEach((e) => {
          const n = new Emsg(e);
          this._emsgLookup[n.elementPresentationTime] = n;
        }));
    }
    stop() {
      const { _currentEmsgInterval: e } = this;
      e && clearInterval(e);
    }
    _getCurrentEmsg() {
      const { _currentTime: e, _emsgLookup: n } = this,
        d = Math.round(e()),
        p = [],
        h = Object.keys(n);
      for (let _ = 0; _ < h.length; _++) {
        const e = parseInt(h[_], 10);
        if (!(e < d)) break;
        p.push(e);
      }
      const y = p.pop();
      if (y) {
        const e = n[y];
        if (!e) return;
        const { _currentEmsg: d, _onDidChange: p } = this,
          h = null == d ? void 0 : d.payload,
          _ = e.payload;
        (h && arrayEquals(h, _)) || ((this._currentEmsg = e), p(e)),
          this._cleanupEmsgs(y);
      }
    }
    _cleanupEmsgs(e) {
      const { _emsgLookup: n } = this;
      Object.keys(n).forEach((d) => {
        parseInt(d, 10) < e && delete n[d];
      });
    }
    constructor(e, n) {
      _define_property$1d(this, "_currentTime", void 0),
        _define_property$1d(this, "_onDidChange", void 0),
        _define_property$1d(this, "_currentEmsgInterval", void 0),
        _define_property$1d(this, "_emsgLookup", void 0),
        _define_property$1d(this, "_currentEmsg", void 0),
        (this._currentTime = e),
        (this._onDidChange = n),
        (this._emsgLookup = {}),
        (this._getCurrentEmsg = this._getCurrentEmsg.bind(this));
    }
  }
  function _define_property$1c(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class SegmentProcessor {
    process(e, n) {
      const { _item: d } = this;
      try {
        d.isLiveRadioStation
          ? this._processLiveRadioSegment(n)
          : d.hasOffersHlsUrl && this._processHlsOffersSegment(e, n);
      } catch (Yt) {
        He.error("Error processing segment", Yt);
      }
    }
    stop() {
      this._timedMetadataManager.stop();
    }
    _processHlsOffersSegment(e, n) {
      e.isInitSegment && rewriteDefaultKid(n);
    }
    _processLiveRadioSegment(e) {
      this._timedMetadataManager.processEmsgs(e);
    }
    constructor(e, n, d) {
      _define_property$1c(this, "_item", void 0),
        _define_property$1c(this, "_timedMetadataManager", void 0),
        (this._item = e),
        (this._timedMetadataManager = new TimedMetadataManager(
          () => n.currentTime,
          (e) => {
            d.publish(Ci, e.timedMetadata);
          }
        ));
    }
  }
  function asyncGeneratorStep$V(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$V(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$V(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$V(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1b(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$t(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$t(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const Ni = He.createChild("mse"),
    Ui = BooleanDevFlag.get("mk-mse-buffer"),
    { manifestParsed: Bi } = at;
  class MseBuffer {
    onSourceOpen() {
      Ni.debug("mediaSource open handler");
      const { mediaSource: e } = this;
      if (e.activeSourceBuffers.length > 0)
        return void Ni.debug("not adding new source buffer");
      Ni.debug("adding new source buffer");
      const n = e.addSourceBuffer(it);
      (this.sourceBuffer = n),
        n.addEventListener("updateend", this.updateEndHandler);
      const { clip: d, hasAppendWindowSupport: p } = this;
      d &&
        (p
          ? (Ni.debug("appendWindowStart/End", d.start, d.end),
            (n.appendWindowStart = d.start),
            (n.appendWindowEnd = d.end))
          : (Ni.debug("seeking for clip", d.start),
            asAsync(this.seek(d.start)))),
        this.updateSegmentToFetch(0, !0);
    }
    setNextManifest(e) {
      Ni.debug("setting next manifest for ", e.mediaItem.title),
        this.nextSeamlessTransition
          ? (Ni.debug(
              "abandoning transition scheduled for " +
                this.nextSeamlessTransition
            ),
            this.revertSeamlessTransition(!0),
            (this.playbackTimeline.next = { manifest: e }))
          : ((this.playbackTimeline.next = { manifest: e }),
            this.isFullyBuffered &&
              (Ni.debug(
                "current song is fully buffered, beginning transition to next"
              ),
              this.transitionToNextManifest()));
    }
    isItemPlaying(e) {
      var n, d;
      const { playbackTimeline: p } = this,
        h = this.nextSeamlessTransition
          ? null === (n = p.previous) || void 0 === n
            ? void 0
            : n.manifest.mediaItem
          : null === (d = p.current) || void 0 === d
            ? void 0
            : d.manifest.mediaItem;
      return (
        !!h &&
        (Ni.debug(`isItemPlaying ${e.title}, ${h.title}, ${e.id === h.id}`),
        e.id === h.id)
      );
    }
    get currentItem() {
      return this.manifest.mediaItem;
    }
    get playableUrl() {
      let e = this._playableUrl;
      return (
        e ||
        ((e = window.URL.createObjectURL(this.mediaSource)),
        Ni.debug("created url", e),
        (this._playableUrl = e),
        e)
      );
    }
    get segments() {
      const { manifest: e, clip: n } = this;
      return n ? e.segmentsForTimeRange(n) : e.segments || [];
    }
    get currentTime() {
      return this._currentTime;
    }
    set currentTime(e) {
      if (((e += this.currentTimestampOffset), this._currentTime === e)) return;
      const { nextSeamlessTransition: n } = this;
      if (n && e >= n) {
        var d, p;
        Ni.debug("setting offset to", n),
          (this.currentTimestampOffset = n || 0),
          (this.nextSeamlessTransition = void 0),
          (this.duration = this.manifest.mediaItem.playbackDuration / 1e3),
          Ni.debug("buffer setting duration to", this.duration);
        const e = {
          previous:
            null === (p = this.playbackTimeline.previous) ||
            void 0 === p ||
            null === (d = p.manifest) ||
            void 0 === d
              ? void 0
              : d.mediaItem,
          current: this.manifest.mediaItem,
        };
        Ni.debug("dispatching seamless audio transition", e),
          this.dispatcher.publish(Ai, e);
      }
      this._currentTime = e;
      const { isOverBufferLimit: h, timeToTrim: y } = this,
        _ = e > this.timeToTrim;
      h &&
        _ &&
        (Ni.debug("buffer over limit, trimming to ", y),
        this.removeToTime(y),
        (this.timeToTrim += 10));
    }
    get hasAppendWindowSupport() {
      var e;
      return (
        void 0 !==
        (null === (e = this.sourceBuffer) || void 0 === e
          ? void 0
          : e.appendWindowStart)
      );
    }
    seek(e) {
      var n = this;
      return _async_to_generator$V(function* () {
        const { duration: d, seekWhenUpdated: p, sourceBuffer: h } = n;
        if (
          (n.resolveSeekPromise(!1),
          Ni.debug("seek to ", e),
          (e = +e) > d &&
            (Ni.debug("rounding seek time to duration", e, d), (e = d)),
          !h)
        )
          return !1;
        if ((n.revertSeamlessTransition(), h.updating))
          return (
            Ni.debug("sourcebuffer updating, deferring seek"),
            new Promise((d) => {
              p && p.resolve(!1),
                (n.seekWhenUpdated = { seek: n.seek.bind(n, e), resolve: d });
            })
          );
        (n.currentlyLoadingSegmentIndex = void 0),
          n.updateSegmentToFetch(0, !0),
          n.removeToTime(e),
          (n.timeToTrim = 10 * Math.floor(e / 10));
        const y = n.getSegmentForTime(e);
        0 !== y && (yield n.firstSegmentLoadPromise),
          Ni.debug("seeking to", e, "segment", y),
          n.updateSegmentToFetch(y, !0);
        const _ = new Promise((d) => {
          n.seekResolver = { time: e, resolve: d };
        });
        return n.checkSeekBuffered(), _;
      })();
    }
    clearNextManifest() {
      this.revertSeamlessTransition(!0), (this.playbackTimeline.next = void 0);
    }
    revertSeamlessTransition(e = !1) {
      const { playbackTimeline: n, nextSeamlessTransition: d } = this;
      if (!d || !n.previous)
        return void Ni.debug("no need to revert, no transition");
      (this.isAtEndOfStream = e),
        Ni.debug("reverting seamless transition with discardNextManifest", e),
        e ? this.clearBufferToEnd(d) : this.clearBuffer(),
        Ni.debug("abandoning transition to " + this.manifest.mediaItem.title),
        (n.next = e ? void 0 : n.current),
        (n.current = n.previous),
        (n.previous = void 0);
      const p = this.manifest.mediaItem;
      Ni.debug("current item reverted to " + p.title),
        (this.nextSeamlessTransition = void 0),
        (this.duration = p.playbackDuration / 1e3),
        Ni.debug("reverted duration to " + this.duration),
        e ||
          ((this.currentTimestampOffset = 0),
          (this.timestampOffsetAdjustment = 0),
          Ni.debug(
            "reverted currentTimestampOffset and timestampOffsetAdjustment to 0"
          )),
        this.printInfo(),
        (this.segmentIndexToFetch = -1);
    }
    get streamHasEnding() {
      return !this.manifest.mediaItem.isLiveRadioStation;
    }
    stop() {
      this.segmentProcessor.stop(), this.setEndOfStream(), this.remove();
    }
    remove() {
      var e;
      Ni.debug("removing sourceBuffer and mediaSource");
      const { sourceBuffer: n, mediaSource: d } = this;
      null === (e = this.seekResolver) || void 0 === e || e.resolve(!1),
        this.manifest.removeEventListener(Bi, this.onManifestParsed);
      const p = this._playableUrl;
      p && (Ni.debug("revoking url", p), window.URL.revokeObjectURL(p)),
        d.removeEventListener("sourceopen", this.onSourceOpen),
        n &&
          (n.removeEventListener("updateend", this.updateEndHandler),
          (this.sourceBuffer = void 0));
    }
    onManifestParsed() {
      const e = this.segmentIndexToFetch + 1;
      Ni.debug("manifestParsed, loading segment", e),
        this.updateSegmentToFetch(e, !0);
    }
    updateEndHandler() {
      if ((this.kickstartBuffer(), this.clearDeferredRemove())) return;
      if (
        (Ni.debug("update end", this.seekWhenUpdated), this.seekWhenUpdated)
      ) {
        Ni.debug("updateEndHandler resolving seekWhenUpdated");
        const { seekWhenUpdated: e } = this;
        return (
          asAsync(e.seek().then(e.resolve)),
          void (this.seekWhenUpdated = void 0)
        );
      }
      this.checkSeekBuffered();
      const { clip: e, sourceBuffer: n, hasAppendWindowSupport: d } = this;
      if (e && n && !d) {
        const { buffered: d } = n;
        if (this.isTimeBuffered(e.end + 1)) {
          const p = d.end(d.length - 1);
          return (
            Ni.debug("clipping sourcebuffer to", e.end, p),
            void n.remove(e.end, p)
          );
        }
      }
      if (this.isAtEndOfStream)
        return (
          Ni.debug("buffer is at end of stream"),
          this.streamHasEnding &&
            (Ni.debug("isAtEndOfStream, not fetching any more segments"),
            this.playbackTimeline.next || this.setEndOfStream(),
            this.transitionToNextManifest()),
          void (this.isAtEndOfStream = !1)
        );
      Ni.debug("updateEndHandler invoking loadSegment"),
        asAsync(this.loadSegment());
    }
    clearDeferredRemove() {
      var e;
      if (0 === this.deferredRemoves.length) return !1;
      const n = this.deferredRemoves.shift();
      return (
        null === (e = this.sourceBuffer) ||
          void 0 === e ||
          e.remove(n.start, n.end),
        !0
      );
    }
    transitionToNextManifest() {
      var e;
      Ni.debug("beginning transition to next manifest");
      const { playbackTimeline: n, sourceBuffer: d } = this;
      if (!n.next || !d) return void Ni.debug("no next manifest");
      const p = this.endOfBufferTime || this.currentTimestampOffset;
      Ni.debug("setting seamless transition at", p),
        (this.nextSeamlessTransition = p),
        (this.timestampOffsetAdjustment = p),
        (this.playbackTimeline.current.endTime = p),
        (n.previous = n.current),
        Ni.debug(
          "previous manifest set to",
          null === (e = n.previous) || void 0 === e
            ? void 0
            : e.manifest.mediaItem.title
        ),
        (n.current = n.next),
        Ni.debug("current manifest set to", n.current.manifest.mediaItem.title),
        (n.next = void 0),
        this.updateSegmentToFetch(0, !0),
        this.printInfo();
    }
    updateSegmentToFetch(e, n = !1) {
      this.segments.length &&
        e < this.segments.length &&
        e !== this.segmentIndexToFetch &&
        ((this.segmentIndexToFetch = e),
        n &&
          (Ni.debug("updateSegmentToFetch invoking loadSegment"),
          asAsync(this.loadSegment())));
    }
    loadSegment() {
      var e = this;
      return _async_to_generator$V(function* () {
        const n = e.segmentIndexToFetch,
          d = e.segments[n];
        if (n !== e.currentlyLoadingSegmentIndex) {
          if (d)
            try {
              Ni.debug("begin loadSegment " + n),
                (e.currentlyLoadingSegmentIndex = n);
              const h = d.load();
              0 === n && (e.firstSegmentLoadPromise = h);
              const y = yield h;
              if (0 !== n && n !== e.segmentIndexToFetch)
                return void Ni.debug(
                  "load segment index to fetch changed, not processing bytes for segment",
                  n
                );
              e.segmentProcessor.process(d, y),
                Ni.debug("loadSegment processed: " + n);
              const { sourceBuffer: _, timestampOffsetAdjustment: m } = e;
              if (!_) return;
              try {
                "number" == typeof m &&
                  (Ni.debug("adjusting timestampOffset of sourcebuffer to", m),
                  (_.timestampOffset = m),
                  (e.timestampOffsetAdjustment = void 0)),
                  _.appendBuffer(y),
                  (e.isFullyBuffered = !1),
                  (e.isOverBufferLimit = !1),
                  Ni.debug("appended to buffer", y.length),
                  e.printBufferTimes(),
                  n === e.segments.length - 1
                    ? (e.isAtEndOfStream = !0)
                    : n === e.segmentIndexToFetch &&
                      (Ni.debug(
                        "loadSegment bumping segment index to fetch to ",
                        n + 1
                      ),
                      e.updateSegmentToFetch(n + 1));
              } catch (p) {
                "QuotaExceededError" === p.name
                  ? ((e.isOverBufferLimit = !0),
                    Ni.debug("reached buffer limit"))
                  : Ni.warn("Error appending to source buffer", p);
              }
            } catch (Yt) {
              Ni.error("Error loading segment", Yt),
                e.dispatcher.publish(Mi, Yt);
            } finally {
              e.currentlyLoadingSegmentIndex = void 0;
            }
        } else
          Ni.debug(`segment ${n} is currently loading, not loading it again`);
      })();
    }
    setEndOfStream() {
      const { sourceBuffer: e, mediaSource: n } = this;
      e &&
        "ended" !== n.readyState &&
        (e.updating || "open" !== n.readyState
          ? Ni.error(
              "Could not end of stream (updating, readyState)",
              e.updating,
              n.readyState
            )
          : (Ni.debug("mediaSource.endOfStream"),
            n.endOfStream(),
            (this.isFullyBuffered = !0)));
    }
    removeToTime(e) {
      Ni.debug("removing to time", e),
        e > 0 &&
          (this.isTimeBuffered(e) || this.isOverBufferLimit) &&
          this.safeSourceBufferRemove(0, e);
    }
    safeSourceBufferRemove(e, n) {
      const { sourceBuffer: d } = this;
      d &&
        (d.updating
          ? this.deferredRemoves.push({ start: e, end: n })
          : d.remove(e, n));
    }
    get previousOffset() {
      var e, n;
      return (
        (null === (n = this.playbackTimeline) ||
        void 0 === n ||
        null === (e = n.previous) ||
        void 0 === e
          ? void 0
          : e.endTime) || 0
      );
    }
    get manifest() {
      var e;
      return null === (e = this.playbackTimeline.current) || void 0 === e
        ? void 0
        : e.manifest;
    }
    checkSeekBuffered() {
      const { seekResolver: e, currentTimestampOffset: n } = this;
      if (!e) return;
      const { time: d } = e,
        p = d + n,
        h = this.isTimeBuffered(p);
      Ni.debug("resolving seek for time, adjustedTime, isBuffered", d, p, h),
        this.printBufferTimes(),
        h &&
          (Ni.debug("resolving seek to true for time:", p),
          (this.element.currentTime = p),
          this.resolveSeekPromise(!0));
    }
    resolveSeekPromise(e) {
      this.seekResolver &&
        (this.seekResolver.resolve(e), (this.seekResolver = void 0));
    }
    get endOfBufferTime() {
      var e;
      const n =
        null === (e = this.sourceBuffer) || void 0 === e ? void 0 : e.buffered;
      return !(!n || !n.length) && n.end(n.length - 1);
    }
    isTimeBuffered(e) {
      var n;
      const d =
        null === (n = this.sourceBuffer) || void 0 === n ? void 0 : n.buffered;
      if (!d) return !1;
      for (let p = 0; p < d.length; p++)
        if (
          (Ni.debug("isTimeBuffered", d.start(p), e, d.end(p)),
          e >= d.start(p) && e <= d.end(p))
        )
          return !0;
      return !1;
    }
    clearBufferToEnd(e) {
      const { sourceBuffer: n } = this;
      if (!n || !n.buffered) return;
      const d = n.buffered.end(n.buffered.length - 1);
      this.safeSourceBufferRemove(e, d);
    }
    clearBuffer() {
      const { sourceBuffer: e } = this;
      if (!e || !e.buffered) return;
      const n = e.buffered;
      for (let d = 0; d < n.length; d++)
        this.safeSourceBufferRemove(n.start(d), n.end(d));
    }
    get bufferTimesString() {
      var e;
      const n =
        null === (e = this.sourceBuffer) || void 0 === e ? void 0 : e.buffered;
      if (!n) return "";
      const d = [];
      for (let p = 0; p < n.length; p++)
        d.push(`start ${n.start(p)} end: ${n.end(p)}`);
      return d.join(",");
    }
    printBufferTimes() {
      Ui && Ni.debug("buffer times", this.bufferTimesString);
    }
    getSegmentForTime(e) {
      return Math.floor(e / 10) + 1;
    }
    kickstartBuffer() {
      const { hasKickstarted: e, element: n, clip: d } = this,
        { buffered: p } = n;
      e ||
        (this.manifest.mediaItem.isSong
          ? d &&
            this.isTimeBuffered(d.start) &&
            ((n.currentTime = d.start), (this.hasKickstarted = !0))
          : p.length &&
            ((n.currentTime = p.start(0)), (this.hasKickstarted = !0)));
    }
    printInfo() {
      var e, n;
      const { playbackTimeline: d } = this;
      Ni.info("---- Buffer Info ----"),
        Ni.info("currently buffering item", d.current.manifest.mediaItem.title),
        Ni.info(
          "next item to buffer",
          null === (e = d.next) || void 0 === e
            ? void 0
            : e.manifest.mediaItem.title
        ),
        Ni.info(
          "previously buffered item",
          null === (n = d.previous) || void 0 === n
            ? void 0
            : n.manifest.mediaItem.title
        ),
        Ni.info("currentTimestampOffset", this.currentTimestampOffset),
        Ni.info("currentTime", this.currentTime),
        Ni.info("duration", this.duration),
        Ni.info("nextSeamlessTransition", this.nextSeamlessTransition),
        Ni.info("timestampOffsetAdjustment", this.timestampOffsetAdjustment),
        Ni.info("buffered times", this.bufferTimesString),
        Ni.info("isAtEndOfStream", this.isAtEndOfStream),
        Ni.info("isFullyBuffered", this.isFullyBuffered),
        Ni.info("segmentIndexToFetch", this.segmentIndexToFetch),
        Ni.info("segments.length", this.segments.length),
        Ni.info("---- End Buffer Info ----");
    }
    constructor({
      dispatcher: e,
      element: n,
      manifest: d,
      currentTime: p,
      duration: h,
      clip: y,
    }) {
      _define_property$1b(this, "dispatcher", void 0),
        _define_property$1b(this, "mediaSource", void 0),
        _define_property$1b(this, "sourceBuffer", void 0),
        _define_property$1b(this, "element", void 0),
        _define_property$1b(this, "_currentTime", void 0),
        _define_property$1b(this, "currentlyLoadingSegmentIndex", void 0),
        _define_property$1b(this, "duration", void 0),
        _define_property$1b(this, "firstSegmentLoadPromise", Promise.resolve()),
        _define_property$1b(this, "hasKickstarted", !1),
        _define_property$1b(this, "isOverBufferLimit", void 0),
        _define_property$1b(this, "seekResolver", void 0),
        _define_property$1b(this, "seekWhenUpdated", void 0),
        _define_property$1b(this, "segmentIndexToFetch", -1),
        _define_property$1b(this, "segmentProcessor", void 0),
        _define_property$1b(this, "timeToTrim", 10),
        _define_property$1b(this, "isAtEndOfStream", !1),
        _define_property$1b(this, "isFullyBuffered", !1),
        _define_property$1b(this, "_playableUrl", void 0),
        _define_property$1b(this, "clip", void 0),
        _define_property$1b(this, "deferredRemoves", []),
        _define_property$1b(this, "timestampOffsetAdjustment", void 0),
        _define_property$1b(this, "playbackTimeline", void 0),
        _define_property$1b(this, "currentTimestampOffset", 0),
        _define_property$1b(this, "nextSeamlessTransition", void 0),
        (this.dispatcher = e),
        (this.clip = y),
        (this.element = n),
        (this.mediaSource = new MediaSource()),
        this.mediaSource.addEventListener("sourceopen", this.onSourceOpen),
        (this.segmentProcessor = new SegmentProcessor(d.mediaItem, n, e)),
        (this.playbackTimeline = { current: { manifest: d } }),
        d.addEventListener(Bi, this.onManifestParsed),
        (this._currentTime = p || 0),
        (this.duration = h),
        (window.mseBuffer = this);
    }
  }
  function asyncGeneratorStep$U(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$U(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$U(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$U(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$1a(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$s(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$s(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  _ts_decorate$t(
    [
      Bind(),
      _ts_metadata$t("design:type", Function),
      _ts_metadata$t("design:paramtypes", []),
      _ts_metadata$t("design:returntype", void 0),
    ],
    MseBuffer.prototype,
    "onSourceOpen",
    null
  ),
    _ts_decorate$t(
      [
        Bind(),
        _ts_metadata$t("design:type", Function),
        _ts_metadata$t("design:paramtypes", []),
        _ts_metadata$t("design:returntype", void 0),
      ],
      MseBuffer.prototype,
      "onManifestParsed",
      null
    ),
    _ts_decorate$t(
      [
        Bind(),
        _ts_metadata$t("design:type", Function),
        _ts_metadata$t("design:paramtypes", []),
        _ts_metadata$t("design:returntype", void 0),
      ],
      MseBuffer.prototype,
      "updateEndHandler",
      null
    );
  const { mediaPlaybackError: Fi } = wt;
  class AudioPlayer extends BasePlayer {
    destroy() {
      var e = this,
        _superprop_get_destroy = () => super.destroy;
      return _async_to_generator$U(function* () {
        _superprop_get_destroy().call(e),
          e._dispatcher.unsubscribe(Mi, e.onLoadSegmentError);
      })();
    }
    onLoadSegmentError(e) {
      this._dispatcher.publish(
        Fi,
        new MKError(MKError.Reason.MEDIA_SESSION, e)
      ),
        this.destroy();
    }
    get currentPlayingDate() {}
    get isPlayingAtLiveEdge() {
      return !1;
    }
    get seekableTimeRanges() {
      return this.currentPlaybackDuration
        ? [{ start: 0, end: this.currentPlaybackDuration }]
        : void 0;
    }
    get supportsPreviewImages() {
      return !1;
    }
    get _targetElement() {
      return this.audio;
    }
    initializeExtension() {
      var e = this;
      return _async_to_generator$U(function* () {
        (e.extension = new MediaExtension(e.audio, it)),
          yield e.extension.initializeKeySystem(),
          e.extension.addEventListener(at.playbackLicenseError, (n) => {
            e.resetDeferredPlay(), e._dispatcher.publish(Fi, n);
          }),
          e.extension.addEventListener(at.playbackSessionError, (n) => {
            e._dispatcher.publish(
              Fi,
              new MKError(MKError.Reason.MEDIA_SESSION, n)
            ),
              e.destroy();
          });
      })();
    }
    initializeMediaElement() {
      var e = this;
      return _async_to_generator$U(function* () {
        const n = nextAvailableAudioElement();
        (n.autoplay = !1),
          (n.id = "apple-music-player"),
          (n.controls = !1),
          (n.muted = !1),
          (n.playbackRate = 1),
          (n.preload = "metadata"),
          (n.volume = 1),
          (e.audio = n),
          document.body.appendChild(n),
          He.debug("initializedMediaElement", n);
      })();
    }
    removeEventHandlers() {
      this._targetElement.removeEventListener("timeupdate", this.onTimeUpdate),
        this._targetElement.removeEventListener(
          "timeupdate",
          this.delayedCdmUpdateCheck
        ),
        super.removeEventHandlers();
    }
    isPlayerSupported() {
      return !0;
    }
    _stopMediaElement() {
      var e = this,
        _superprop_get__stopMediaElement = () => super._stopMediaElement;
      return _async_to_generator$U(function* () {
        var n;
        yield _superprop_get__stopMediaElement().call(e),
          yield e.tearDownManifests(),
          null === (n = e._buffer) || void 0 === n || n.stop(),
          (e._buffer = void 0);
      })();
    }
    setNextSeamlessItem(e) {
      var n = this;
      return _async_to_generator$U(function* () {
        const { extension: d, nextManifest: p } = n,
          h = n._buffer;
        if (!h || !d) return;
        if ((null == p ? void 0 : p.mediaItem.id) === e.id)
          return void He.debug("already have next manifest for ", e.title);
        n._targetElement.removeEventListener("timeupdate", n.onTimeUpdate),
          n._targetElement.addEventListener("timeupdate", n.onTimeUpdate),
          He.debug("player preparing next manifest for", e.title);
        const y = yield n.loadAndParseManifest(e, !1);
        h.setNextManifest(y),
          d.setMediaItem(e),
          (d.extURI = y.extURI),
          (n.nextManifest = y);
      })();
    }
    playItemFromEncryptedSource(n, d = !1, p) {
      var h = this;
      return _async_to_generator$U(function* () {
        const y = h._paused && !d;
        He.debug("playItemFromEncryptedSource", n.title);
        const _ = y ? void 0 : h.startPlaybackSequence();
        if (n.playRawAssetURL)
          return (
            (n.playbackType = e.PlaybackType.unencryptedFull),
            (h.nowPlayingItem = n),
            yield h._playAssetURL(n.assetURL, y),
            h.finishPlaybackSequence()
          );
        const { extension: m } = h;
        var g, b;
        h.delaySeamlessCdmUpdates &&
          (null === (b = h.extension) ||
            void 0 === b ||
            null === (g = b.session) ||
            void 0 === g ||
            g.applyDelayedCdmUpdates());
        if (!m) return _;
        (m.initiated = d),
          m.setMediaItem(n),
          (n.playbackType = e.PlaybackType.encryptedFull),
          (h.nowPlayingItem = n),
          (n.state = x.loading);
        const P = yield h.getManifestForItem(n);
        h.manifest = P;
        const S = shouldForceAudioMse();
        if (
          ((n.isSong || (m.isFairplay && S)) && (m.extURI = P.extURI),
          (n.state = x.ready),
          m.isFairplay && !S)
        ) {
          let e = n.assetURL;
          (null == p ? void 0 : p.startTime) && (e += "#t=" + p.startTime),
            yield h._playAssetURL(e, y);
        } else {
          const e = h._buffer;
          e &&
          h.isSeamlessAudioTransitionsEnabled &&
          e.isItemPlaying(P.mediaItem)
            ? He.debug("already have buffer, continuing playback")
            : yield h.beginNewBufferForItem(y, P, p);
        }
        return h.finishPlaybackSequence();
      })();
    }
    getManifestForItem(e) {
      var n = this;
      return _async_to_generator$U(function* () {
        var d, p;
        He.debug("reconciling item to play against playing item");
        const {
            nextManifest: h,
            manifest: y,
            isSeamlessAudioTransitionsEnabled: _,
          } = n,
          m = n._buffer;
        if (!m || !y)
          return (
            He.debug(
              "no buffer or manifest, creating manifest [title, buffer, manifest]",
              e.title,
              !!m,
              !!y
            ),
            n.loadAndParseManifest(e)
          );
        if (!_)
          return (
            He.debug(
              "seamless transitions disabled, stopping and creating manifest for",
              e.title
            ),
            yield n.tearDownManifests(),
            n.loadAndParseManifest(e)
          );
        const g = !m.isItemPlaying(e);
        let b;
        return (
          He.debug("itemMismatch", g),
          h && !g
            ? (He.debug(
                `replacing manifest for ${y.mediaItem.title} with next manifest ${h.mediaItem.title}`
              ),
              (b = h),
              (n.nextManifest = void 0),
              He.debug(
                "cease listening for keys on manifest for",
                y.mediaItem.title
              ),
              yield n.tearDownManifest(y))
            : g
              ? (null == h ? void 0 : h.mediaItem.id) !== e.id
                ? (He.debug(
                    `item to play ${e.title} does not match playing or next items, tearing down all manifests`
                  ),
                  yield n.tearDownManifests(),
                  (b = yield n.loadAndParseManifest(e)))
                : (He.debug(
                    `item to play ${e.title} matches next item, tearing down current manifest`
                  ),
                  yield n.tearDownManifest(y),
                  (b = h))
              : (He.debug(
                  "item is already playing, returning existing manifest"
                ),
                (b = y)),
          He.debug("getManifestForItem loading keys for", y.mediaItem.title),
          null === (p = n.extension) ||
            void 0 === p ||
            null === (d = p.session) ||
            void 0 === d ||
            d.loadKeys(b.keyValues, b.mediaItem),
          b
        );
      })();
    }
    seekToTime(e) {
      var n = this;
      return _async_to_generator$U(function* () {
        const d = n._buffer;
        if (d) {
          He.debug("audio-player: buffer seek to", e);
          if (!(yield d.seek(e))) return;
          n.isSeamlessAudioTransitionsEnabled && n.onTimeUpdate();
        } else
          He.debug("audio-player: media element seek to", e),
            (n._targetElement.currentTime = e);
      })();
    }
    tearDownManifests() {
      var e = this;
      return _async_to_generator$U(function* () {
        (e.manifest = yield e.tearDownManifest(e.manifest)),
          (e.nextManifest = yield e.tearDownManifest(e.nextManifest));
      })();
    }
    tearDownManifest(e) {
      var n = this;
      return _async_to_generator$U(function* () {
        const { extension: d } = n;
        e &&
          (He.debug("tearing down manifest for", e.mediaItem.title),
          e.stop(),
          d && (yield d.clearSessions(e.keyValues)),
          e.removeEventListener(Oi.keysParsed, n.loadKeysHandler));
      })();
    }
    loadAndParseManifest(e, n = !0) {
      var d = this;
      return _async_to_generator$U(function* () {
        let p;
        He.debug(`will load and parse manifest for ${e.title}, loadKeys ${n}`);
        try {
          return (
            (p = yield Manifest.load(e, !1)),
            n && p.addEventListener(Oi.keysParsed, d.loadKeysHandler),
            p.parse(),
            p
          );
        } catch (q) {
          d.resetDeferredPlay();
          const n = new MKError(
            MKError.Reason.NETWORK_ERROR,
            "Could not fetch manifest"
          );
          throw ((n.data = q), d._dispatcher.publish(Fi, n), n);
        }
      })();
    }
    onTimeUpdate() {
      if (!this._buffer) return;
      const {
        currentPlaybackTimeRemaining: e,
        nextManifest: n,
        delaySeamlessCdmUpdates: d,
      } = this;
      if (n && e < 15) {
        var p, h, y, _;
        if ((He.debug("player loading keys for", n.mediaItem.title, d), d))
          null === (h = this.extension) ||
            void 0 === h ||
            null === (p = h.session) ||
            void 0 === p ||
            p.loadKeys(n.keyValues, n.mediaItem, { delayCdmUpdate: !0 }),
            this._targetElement.addEventListener(
              "timeupdate",
              this.delayedCdmUpdateCheck
            );
        else
          null === (_ = this.extension) ||
            void 0 === _ ||
            null === (y = _.session) ||
            void 0 === y ||
            y.loadKeys(n.keyValues, n.mediaItem);
        this._targetElement.removeEventListener(
          "timeupdate",
          this.onTimeUpdate
        );
      }
    }
    delayedCdmUpdateCheck() {
      var e;
      const n =
          null === (e = this.nowPlayingItem) || void 0 === e
            ? void 0
            : e.playbackDuration,
        d = n ? n / 1e3 : this.currentPlaybackDuration,
        p = this._currentTime,
        h = Number((d - p).toFixed(3));
      if (h < 1) {
        const e = 1e3 * h;
        He.debug("delayed CDM update in ", e),
          setTimeout(() => {
            var e, n;
            He.debug("applying delayed CDM update"),
              null === (n = this.extension) ||
                void 0 === n ||
                null === (e = n.session) ||
                void 0 === e ||
                e.applyDelayedCdmUpdates();
          }, e),
          this._targetElement.removeEventListener(
            "timeupdate",
            this.delayedCdmUpdateCheck
          );
      }
    }
    loadKeysHandler(e) {
      var n, d;
      null === (d = this.extension) ||
        void 0 === d ||
        null === (n = d.session) ||
        void 0 === n ||
        n.loadKeys(e.keys, e.item);
    }
    beginNewBufferForItem(e, n, d) {
      var p = this;
      return _async_to_generator$U(function* () {
        if (
          (He.debug("creating new MseBuffer for item", n.mediaItem.title, e),
          p._buffer && (He.debug("stopping old buffer"), p._buffer.stop()),
          (p._buffer = new MseBuffer({
            dispatcher: p._dispatcher,
            element: p._targetElement,
            duration: n.mediaItem.playbackDuration / 1e3,
            manifest: n,
          })),
          yield p._playAssetURL(p._buffer.playableUrl, !0),
          !e)
        ) {
          let e = Promise.resolve();
          return (
            (null == d ? void 0 : d.startTime) &&
              (e = p.seekToTime(d.startTime)),
            e.then(() => p._playMedia())
          );
        }
      })();
    }
    setPresentationMode(e) {
      return _async_to_generator$U(function* () {
        return Promise.resolve();
      })();
    }
    loadPreviewImage(e) {
      return _async_to_generator$U(function* () {})();
    }
    constructor(e) {
      var n, d;
      super(e),
        _define_property$1a(this, "currentAudioTrack", void 0),
        _define_property$1a(this, "currentTextTrack", void 0),
        _define_property$1a(this, "textTracks", []),
        _define_property$1a(this, "audioTracks", []),
        _define_property$1a(this, "audio", void 0),
        _define_property$1a(this, "isSeamlessAudioTransitionsEnabled", !1),
        _define_property$1a(this, "delaySeamlessCdmUpdates", !1),
        _define_property$1a(this, "extension", void 0),
        _define_property$1a(this, "mediaPlayerType", "audio"),
        _define_property$1a(this, "manifest", void 0),
        _define_property$1a(this, "nextManifest", void 0);
      const p =
        null !==
          (d = null === (n = e.bag) || void 0 === n ? void 0 : n.features) &&
        void 0 !== d
          ? d
          : {};
      (this.isSeamlessAudioTransitionsEnabled =
        !!p["seamless-audio-transitions"]),
        (this.delaySeamlessCdmUpdates = !!p["delay-seamless-cdm-updates"]),
        (window.audioPlayer = this),
        this._dispatcher.subscribe(Mi, this.onLoadSegmentError);
    }
  }
  function _define_property$19(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  _ts_decorate$s(
    [
      Bind(),
      _ts_metadata$s("design:type", Function),
      _ts_metadata$s("design:paramtypes", [void 0]),
      _ts_metadata$s("design:returntype", void 0),
    ],
    AudioPlayer.prototype,
    "onLoadSegmentError",
    null
  ),
    _ts_decorate$s(
      [
        AsyncDebounce(250),
        _ts_metadata$s("design:type", Function),
        _ts_metadata$s("design:paramtypes", [Number]),
        _ts_metadata$s("design:returntype", Promise),
      ],
      AudioPlayer.prototype,
      "seekToTime",
      null
    ),
    _ts_decorate$s(
      [
        Bind(),
        _ts_metadata$s("design:type", Function),
        _ts_metadata$s("design:paramtypes", []),
        _ts_metadata$s("design:returntype", void 0),
      ],
      AudioPlayer.prototype,
      "onTimeUpdate",
      null
    ),
    _ts_decorate$s(
      [
        Bind(),
        _ts_metadata$s("design:type", Function),
        _ts_metadata$s("design:paramtypes", []),
        _ts_metadata$s("design:returntype", void 0),
      ],
      AudioPlayer.prototype,
      "delayedCdmUpdateCheck",
      null
    ),
    _ts_decorate$s(
      [
        Bind(),
        _ts_metadata$s("design:type", Function),
        _ts_metadata$s("design:paramtypes", [void 0]),
        _ts_metadata$s("design:returntype", void 0),
      ],
      AudioPlayer.prototype,
      "loadKeysHandler",
      null
    );
  class VoidMediaElement extends HTMLElement {
    set volume(e) {
      e !== this._volume &&
        ((this._volume = e),
        this.dispatchMediaEvent("volumechange"),
        (this.muted = 0 === e));
    }
    get volume() {
      return this._volume;
    }
    set playbackRate(e) {
      e !== this._playbackRate &&
        ((this._playbackRate = e), this.dispatchMediaEvent("ratechange"));
    }
    get playbackRate() {
      return this._playbackRate;
    }
    set currentTime(e) {
      e !== this._currentTime &&
        ((this._currentTime = e), this.dispatchMediaEvent("timeupdate"));
    }
    get currentTime() {
      return this._currentTime;
    }
    pause() {
      (this.paused = !0), this.dispatchMediaEvent("pause");
    }
    play() {
      (this.paused = !1), this.dispatchMediaEvent("play");
    }
    dispatchMediaEvent(e) {
      const n = new CustomEvent(e, { detail: { type: e } });
      this.dispatchEvent(n);
    }
    constructor() {
      super(),
        _define_property$19(this, "muted", !1),
        _define_property$19(this, "paused", !0),
        _define_property$19(this, "_playbackRate", 1),
        _define_property$19(this, "_volume", 1),
        _define_property$19(this, "_currentTime", 0);
    }
  }
  function asyncGeneratorStep$T(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$T(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$T(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$T(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$18(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Ki = Date.parse("January 01, 2001 0:00:00 GMT");
  class VoidPlayer extends BasePlayer {
    startTimerProgress() {
      this.timerId ||
        (this.timerId = setInterval(() => {
          var e, n;
          const d =
              null === (e = this._nowPlayingItem) || void 0 === e
                ? void 0
                : e.attributes.elapsedTimeTimestamp,
            p =
              null === (n = this._nowPlayingItem) || void 0 === n
                ? void 0
                : n.attributes.elapsedTime,
            h = 1e3 * d + Ki,
            y = (Date.now() - h) / 1e3;
          let _ = 0;
          var m;
          p > 0 &&
            (_ = Math.ceil(
              Math.min(
                (null === (m = this._nowPlayingItem) || void 0 === m
                  ? void 0
                  : m.attributes.durationInMillis) / 1e3,
                (p + y) * this._targetElement.playbackRate
              )
            ));
          const g = this._targetElement.currentTime + 1;
          this.seekToTime(Math.max(_, g));
        }, 1e3));
    }
    stopTimerProgress() {
      clearInterval(this.timerId), (this.timerId = void 0);
    }
    get currentPlayingDate() {}
    get isPlayingAtLiveEdge() {
      return !1;
    }
    get seekableTimeRanges() {
      return this.currentPlaybackDuration
        ? [{ start: 0, end: this.currentPlaybackDuration }]
        : void 0;
    }
    get supportsPreviewImages() {
      return !1;
    }
    get nowPlayingItem() {
      return this._nowPlayingItem;
    }
    set nowPlayingItem(e) {
      if (e === this.nowPlayingItem) return;
      const n = this._dispatcher;
      n.publish(wt.nowPlayingItemWillChange, { item: e }),
        (this._nowPlayingItem = e),
        e && (e.state = x.playing),
        n.publish(wt.nowPlayingItemDidChange, { item: e }),
        n.publish(wt.playbackDurationDidChange, {
          currentTarget: this._targetElement,
          duration: this.currentPlaybackDuration,
          target: this._targetElement,
          type: "durationchange",
        });
    }
    get _targetElement() {
      return this.element;
    }
    initializeMediaElement() {
      var e = this;
      return _async_to_generator$T(function* () {
        const n = document.createElement("mk-void-media-element");
        (n.id = "apple-music-player"),
          (e.element = n),
          document.body.appendChild(n),
          He.debug("initializedMediaElement", n);
      })();
    }
    removeEventHandlers() {
      super.removeEventHandlers();
    }
    isPlayerSupported() {
      return !0;
    }
    seekToTime(e) {
      var n = this;
      return _async_to_generator$T(function* () {
        n._targetElement.currentTime = e;
      })();
    }
    setPresentationMode(e) {
      return _async_to_generator$T(function* () {
        return Promise.resolve();
      })();
    }
    loadPreviewImage(e) {
      return _async_to_generator$T(function* () {})();
    }
    playItemFromEncryptedSource() {
      return _async_to_generator$T(function* () {
        return Promise.resolve();
      })();
    }
    initializeExtension() {
      return _async_to_generator$T(function* () {})();
    }
    setNextSeamlessItem(e) {
      return _async_to_generator$T(function* () {})();
    }
    constructor(e) {
      super(e),
        _define_property$18(this, "currentAudioTrack", void 0),
        _define_property$18(this, "currentTextTrack", void 0),
        _define_property$18(this, "textTracks", []),
        _define_property$18(this, "audioTracks", []),
        _define_property$18(this, "timerId", void 0),
        _define_property$18(this, "element", void 0),
        _define_property$18(this, "extension", void 0),
        _define_property$18(this, "mediaPlayerType", "void");
      void 0 !== customElements.get("mk-void-media-element") ||
        customElements.define("mk-void-media-element", VoidMediaElement);
    }
  }
  function asyncGeneratorStep$S(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$S(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$S(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$S(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$17(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class EncryptedSession extends KeySession {
    attachMedia(e, n) {
      var d = this;
      return _async_to_generator$S(function* () {
        (d.keySystem = n.keySystem),
          (d._keySystemAccess = n),
          e.addEventListener("encrypted", d.boundHandleSessionCreation, !1);
      })();
    }
    detachMedia(e) {
      e.removeEventListener("encrypted", this.boundHandleSessionCreation);
    }
    createSession(e) {
      var n = this;
      return _async_to_generator$S(function* () {
        He.debug("Encrypted createSession", e);
        const d = n._keySystemAccess;
        if (!d) return;
        const { initData: p, initDataType: h, target: y } = e;
        var _;
        return (
          n._mediaKeysPromise ||
            (n._mediaKeysPromise = new Promise(
              ((_ = _async_to_generator$S(function* (e, p) {
                const h = yield d.createMediaKeys();
                try {
                  yield y.setMediaKeys(h);
                } catch (q) {
                  n.dispatchKeyError(q), p(q);
                }
                const _ = yield n.loadCertificateBuffer();
                yield h.setServerCertificate(_),
                  (n._mediaKeysServerCertificate = _),
                  e(h);
              })),
              function (e, n) {
                return _.apply(this, arguments);
              })
            )),
          yield n._mediaKeysPromise,
          n._mediaKeysServerCertificate ? n._createSession(y, p, h) : void 0
        );
      })();
    }
    generatePSSH(e) {
      const n = new Uint8Array([
          0, 0, 0, 52, 112, 115, 115, 104, 0, 0, 0, 0, 237, 239, 139, 169, 121,
          214, 74, 206, 163, 200, 39, 220, 213, 29, 33, 237, 0, 0, 0, 20, 8, 1,
          18, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ]),
        d = Ae(e);
      for (let p = 0; p < d.length; p++) n[n.length - 16 + p] = d[p];
      return He.debug("generatePSSH", n), n;
    }
    _createSession(e, n, d) {
      const p = e.mediaKeys.createSession(),
        { item: h } = this;
      if (!h) return;
      this._teardownCurrentSession(), He.debug("creating media key session", p);
      let y;
      if (this.isWidevine && h.isSong) y = this.generatePSSH(this.extID);
      else {
        const e = (function (e) {
            const n = [],
              d = new DataView(e.buffer);
            for (let p = 0; p < e.length; ) {
              const h = d.getUint32(p);
              n.push(new PsshBox(e, p, p + h)), (p += h);
            }
            return n;
          })(new Uint8Array(n)).find((e) => e.isWidevine),
          d = null == e ? void 0 : e.rawBytes,
          h = De(d);
        He.debug("extracted uri", h), (p.extURI = h), (y = n);
      }
      return (
        p.addEventListener("message", this.startLicenseSession),
        (this._currentSession = p),
        p.generateRequest(d, y).catch((e) => {
          if (e.message.match(/generateRequest.*\(75\)/))
            return p.generateRequest(d, y);
          throw e;
        })
      );
    }
    _teardownCurrentSession() {
      this._currentSession &&
        (He.debug("tearing down media key session", this._currentSession),
        this._currentSession.removeEventListener(
          "message",
          this.startLicenseSession
        ),
        (this._currentSession = void 0));
    }
    applyDelayedCdmUpdates() {}
    loadKeys(e, n, d) {
      return _async_to_generator$S(function* () {})();
    }
    clearSessions() {
      return _async_to_generator$S(function* () {})();
    }
    constructor(...e) {
      super(...e),
        _define_property$17(this, "_currentSession", void 0),
        _define_property$17(this, "_keySystemAccess", void 0),
        _define_property$17(this, "_mediaKeysPromise", void 0),
        _define_property$17(this, "_mediaKeysServerCertificate", void 0);
    }
  }
  function asyncGeneratorStep$R(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$R(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$R(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$R(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$16(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class MediaExtensionStub extends Notifications {
    destroy(e) {}
    setMediaItem(e) {}
    initializeKeySystem() {
      var e = this;
      return _async_to_generator$R(function* () {
        e.session = new EncryptedSession();
      })();
    }
    clearSessions() {
      return _async_to_generator$R(function* () {})();
    }
    constructor(e) {
      super(e),
        _define_property$16(this, "audioTracks", []),
        _define_property$16(this, "textTracks", []),
        _define_property$16(this, "session", void 0),
        _define_property$16(this, "extURI", void 0),
        _define_property$16(this, "hasMediaKeySupport", void 0),
        _define_property$16(this, "hasMediaSession", void 0),
        _define_property$16(this, "initiated", void 0),
        _define_property$16(this, "isFairplay", void 0),
        (this.extURI = ""),
        (this.hasMediaKeySupport = !0),
        (this.initiated = !0),
        (this.isFairplay = !0),
        (this.hasMediaKeySupport = !0),
        (this.hasMediaSession = !0);
    }
  }
  function asyncGeneratorStep$Q(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$Q(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$Q(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$Q(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$15(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class PlayerStub {
    get hasMediaElement() {
      return !0;
    }
    get isEngagedInPlayback() {
      return !this.paused;
    }
    get playbackRate() {
      return this._playbackRate;
    }
    set playbackRate(e) {
      (this._playbackRate = e),
        this._dispatcher.publish(
          wt.playbackRateDidChange,
          new Event("ratechange")
        );
    }
    get volume() {
      return this._volume;
    }
    set volume(e) {
      (this._volume = e),
        this._dispatcher.publish(
          wt.playbackVolumeDidChange,
          new Event("volumeChange")
        );
    }
    destroy() {}
    dispatch() {}
    exitFullscreen() {
      return _async_to_generator$Q(function* () {})();
    }
    loadPreviewImage(e) {
      return _async_to_generator$Q(function* () {})();
    }
    initialize() {
      return _async_to_generator$Q(function* () {})();
    }
    isPaused() {
      return this.paused;
    }
    calculateTime(e) {
      return e;
    }
    clearNextManifest() {}
    mute() {}
    newSeeker() {
      return new PlayerSeeker(this);
    }
    pause(e) {
      return _async_to_generator$Q(function* () {})();
    }
    play() {
      return _async_to_generator$Q(function* () {})();
    }
    playItemFromEncryptedSource(e, n, d) {
      return _async_to_generator$Q(function* () {})();
    }
    playItemFromUnencryptedSource(e, n, d) {
      return _async_to_generator$Q(function* () {})();
    }
    preload() {
      return _async_to_generator$Q(function* () {})();
    }
    prepareToPlay(e, n, d) {
      return _async_to_generator$Q(function* () {})();
    }
    seekToTime(e) {
      return _async_to_generator$Q(function* () {})();
    }
    requestFullscreen() {
      return _async_to_generator$Q(function* () {})();
    }
    setPlaybackState(e, n) {}
    setPresentationMode(e) {
      return _async_to_generator$Q(function* () {})();
    }
    showPlaybackTargetPicker() {}
    stop(e) {
      return _async_to_generator$Q(function* () {})();
    }
    stopMediaAndCleanup() {
      return _async_to_generator$Q(function* () {})();
    }
    supportsPictureInPicture() {
      return !1;
    }
    tsidChanged() {}
    setNextSeamlessItem(e) {
      return _async_to_generator$Q(function* () {})();
    }
    constructor(n) {
      _define_property$15(this, "bitrate", e.PlaybackBitrate.STANDARD),
        _define_property$15(this, "audioTracks", []),
        _define_property$15(this, "currentBufferedProgress", 0),
        _define_property$15(this, "currentPlaybackDuration", 0),
        _define_property$15(this, "currentPlaybackProgress", 0),
        _define_property$15(this, "currentPlaybackTime", 0),
        _define_property$15(this, "currentPlaybackTimeRemaining", 0),
        _define_property$15(this, "currentPlayingDate", void 0),
        _define_property$15(this, "isPlayingAtLiveEdge", !1),
        _define_property$15(this, "isPlaying", !1),
        _define_property$15(this, "isPrimaryPlayer", !0),
        _define_property$15(this, "isReady", !1),
        _define_property$15(this, "nowPlayingItem", void 0),
        _define_property$15(this, "paused", !1),
        _define_property$15(this, "playbackState", e.PlaybackStates.none),
        _define_property$15(this, "playbackTargetAvailable", !1),
        _define_property$15(this, "playbackTargetIsWireless", !1),
        _define_property$15(this, "previewOnly", !1),
        _define_property$15(this, "supportsPreviewImages", !1),
        _define_property$15(this, "textTracks", []),
        _define_property$15(this, "extension", new MediaExtensionStub([])),
        _define_property$15(this, "hasAuthorization", !0),
        _define_property$15(this, "windowHandlers", void 0),
        _define_property$15(this, "isDestroyed", !1),
        _define_property$15(this, "services", void 0),
        _define_property$15(this, "_dispatcher", void 0),
        _define_property$15(this, "_volume", 1),
        _define_property$15(this, "_playbackRate", 1),
        _define_property$15(this, "currentAudioTrack", void 0),
        _define_property$15(this, "currentTextTrack", void 0),
        _define_property$15(this, "seekableTimeRanges", void 0),
        (this.services = n.services),
        (this._dispatcher = n.services.dispatcher),
        (this.windowHandlers = new WindowHandlers(this, n.services.runtime));
    }
  }
  class VideoMediaExtension extends MediaExtension {
    destroy(e) {
      var n;
      null === (n = this._session) || void 0 === n || n.stopLicenseSession(),
        super.destroy(e);
    }
  }
  const Gi = BooleanDevFlag.register("mk-send-manifest-headers");
  function asyncGeneratorStep$P(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$P(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$P(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$P(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$14(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Vi = [
    "https://play.itunes.apple.com/",
    "https://linear.tv.apple.com/",
    "https://play-edge.itunes.apple.com",
  ];
  const qi = new (class {
    fetchManifest(e) {
      var n = this;
      return _async_to_generator$P(function* () {
        return (
          He.info("fetching manifest at", e),
          shouldLoadManifestOnce() ? n.fetchForCache(e) : n.fetchOnly(e)
        );
      })();
    }
    getManifest(e) {
      return this.cache.get(e);
    }
    clear(e) {
      e ? this.cache.delete(e) : this.cache.clear();
    }
    fetchForCache(e) {
      var n = this;
      return _async_to_generator$P(function* () {
        const d = (function (e) {
            const n = {};
            Vi.some((n) => e.startsWith(n)) &&
              hi.musicUserToken &&
              (!Gi.configured || Gi.enabled) &&
              ((n["media-user-token"] = hi.musicUserToken),
              (n.Authorization = "Bearer " + hi.developerToken));
            return n;
          })(e),
          p = yield n.fetch(e, { headers: new Headers(d) });
        let h = yield p.text();
        var y;
        h = ((e, n) => {
          He.info("converting manifest URIs to absolute paths");
          const d = new URL(e);
          let p = n.replace(/URI="([^"]*)"/g, function (e, n) {
            return `URI="${new URL(n, d).href}"`;
          });
          return (
            (p = p.replace(
              /^(#EXT-X-STREAM-INF:[^\n]*\n)(.*$)/gim,
              function (e, n, p) {
                return `${n}${new URL(p, d).href}`;
              }
            )),
            p
          );
        })(e, h);
        const _ = {
          url: e,
          content: h,
          contentType:
            null !== (y = p.headers.get("content-type")) && void 0 !== y
              ? y
              : void 0,
        };
        return n.cache.set(e, _), _;
      })();
    }
    fetchOnly(e) {
      var n = this;
      return _async_to_generator$P(function* () {
        const d = yield n.fetch(e),
          p = yield d.text();
        var h;
        return {
          url: e,
          content: p,
          contentType:
            null !== (h = d.headers.get("content-type")) && void 0 !== h
              ? h
              : void 0,
        };
      })();
    }
    constructor(e = {}) {
      var n, d;
      _define_property$14(this, "cache", void 0),
        _define_property$14(this, "fetch", void 0),
        (this.fetch =
          null !== (n = e.fetch) && void 0 !== n ? n : fetch.bind(globalThis)),
        (this.cache = null !== (d = e.cache) && void 0 !== d ? d : new Map());
    }
  })();
  function asyncGeneratorStep$O(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$O(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$O(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$O(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _ts_decorate$r(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$r(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const { mediaPlaybackError: Hi } = wt,
    { playbackLicenseError: Wi, playbackSessionError: Yi } = at;
  class NativeSafariVideoPlayer extends VideoPlayer {
    get currentPlayingDate() {}
    get isPlayingAtLiveEdge() {
      return !1;
    }
    get seekableTimeRanges() {
      return this.currentPlaybackDuration
        ? [{ start: 0, end: this.currentPlaybackDuration }]
        : void 0;
    }
    get supportsPreviewImages() {
      return !1;
    }
    initializeExtension() {
      var e = this;
      return _async_to_generator$O(function* () {
        if (!e.video)
          return void He.warn(
            "NativeSafariVideoPlayer.initializeExtension No video element, not initializing extension"
          );
        const n = new VideoMediaExtension(
          e.video,
          'video/mp4;codecs="avc1.42E01E"'
        );
        (e.extension = n),
          yield n.initializeKeySystem(),
          n.addEventListener(Wi, e.onPlaybackLicenseError),
          n.addEventListener(Yi, e.onPlaybackSessionError);
      })();
    }
    destroy() {
      He.debug("native-safari-video-player.destroy");
      const { extension: e, video: n } = this;
      this._blobUrl &&
        (URL.revokeObjectURL(this._blobUrl), (this._blobUrl = void 0)),
        e &&
          n &&
          (e.removeEventListener(Wi, this.onPlaybackLicenseError),
          e.removeEventListener(Yi, this.onPlaybackSessionError),
          n.removeEventListener("loadedmetadata", this.onMetadataLoaded),
          super.destroy());
    }
    loadPreviewImage(e) {
      return _async_to_generator$O(function* () {})();
    }
    playHlsStream(e, n, d = {}) {
      var p = this;
      return _async_to_generator$O(function* () {
        He.debug("native-safari-video-player.playHlsStream", e);
        const { video: h } = p;
        if (!h) {
          const e = "NativeSafariVideoPlayer.playHlsStream(): No video element";
          throw (He.error(e), new Error(e));
        }
        p.setupTrackManagers();
        const y = p.startPlaybackSequence(),
          _ = (
            p._shouldLoadManifestsOnce
              ? p.playByBlob(e, h, d)
              : p.playBySource(e, h, d)
          ).then(() => y);
        var m;
        n && (null === (m = p.extension) || void 0 === m || m.setMediaItem(n));
        return h.addEventListener("loadedmetadata", p.onMetadataLoaded), _;
      })();
    }
    onPlaybackSessionError(e) {
      this._dispatcher.publish(
        Hi,
        new MKError(MKError.Reason.MEDIA_SESSION, e)
      );
    }
    onMetadataLoaded() {
      var e = this;
      return _async_to_generator$O(function* () {
        He.debug("native-safari-video-player.onMetadataLoaded");
        const { nowPlayingItem: n } = e;
        n && (n.state = x.ready),
          yield e._playMedia(),
          e.finishPlaybackSequence();
      })();
    }
    seekToTime(e) {
      var n = this;
      return _async_to_generator$O(function* () {
        He.debug("native-safari-video-player: media element seek to", e),
          (n._targetElement.currentTime = e);
      })();
    }
    playByBlob(e, n, d = {}) {
      var p = this;
      return _async_to_generator$O(function* () {
        He.debug("native-safari-video-player: playing video by blob");
        let h = qi.getManifest(e);
        if (
          !h &&
          (He.debug("native-safari-video-player: fetching manifest"),
          (h = yield qi.fetchManifest(e)),
          !h)
        )
          throw (
            (He.error("No manifest for " + e),
            new MKError(
              MKError.Reason.CONTENT_UNAVAILABLE,
              "Failed to load manifest"
            ))
          );
        He.debug("native-safari-video-player: loaded manifest", !!h),
          qi.clear(e);
        const y = h.contentType,
          _ = h.content.replace(/^#EXT-X-SESSION-DATA-ITUNES:.*$/gm, ""),
          m = new Blob([_], { type: y });
        (e = URL.createObjectURL(m)), (p._blobUrl = e);
        const g = document.createElement("source");
        g.setAttribute("src", e),
          y && g.setAttribute("type", y),
          He.debug("native-safari-video-player: blob url", e),
          void 0 !== d.startTime && (n.currentTime = d.startTime),
          n.appendChild(g);
      })();
    }
    playBySource(e, n, d = {}) {
      return _async_to_generator$O(function* () {
        He.debug("native-safari-video-player: playing video by source"),
          void 0 !== d.startTime && (e += "#t=" + d.startTime),
          (n.src = e);
      })();
    }
    constructor(...e) {
      var n, d, p;
      super(...e),
        (p = void 0),
        (d = "_blobUrl") in (n = this)
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p);
    }
  }
  _ts_decorate$r(
    [
      Bind(),
      _ts_metadata$r("design:type", Function),
      _ts_metadata$r("design:paramtypes", [void 0]),
      _ts_metadata$r("design:returntype", void 0),
    ],
    NativeSafariVideoPlayer.prototype,
    "onPlaybackSessionError",
    null
  ),
    _ts_decorate$r(
      [
        Bind(),
        _ts_metadata$r("design:type", Function),
        _ts_metadata$r("design:paramtypes", []),
        _ts_metadata$r("design:returntype", Promise),
      ],
      NativeSafariVideoPlayer.prototype,
      "onMetadataLoaded",
      null
    ),
    _ts_decorate$r(
      [
        AsyncDebounce(250),
        _ts_metadata$r("design:type", Function),
        _ts_metadata$r("design:paramtypes", [Number]),
        _ts_metadata$r("design:returntype", Promise),
      ],
      NativeSafariVideoPlayer.prototype,
      "seekToTime",
      null
    );
  const zi = He.createChild("tracks");
  function _define_property$12(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$B(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$12(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$p(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_decorate$q(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$q(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const {
    audioTracksSwitched: Qi,
    audioTracksUpdated: Ji,
    inlineStylesParsed: Xi,
    textTracksSwitched: Zi,
    textTracksUpdated: ea,
  } = at;
  class HlsJsTracks extends Notifications {
    get isDestroyed() {
      return this._isDestroyed;
    }
    get audioTracks() {
      return this._audioTracks;
    }
    get textTracks() {
      return this._textTracks;
    }
    set audioTrack(e) {
      this.session &&
        e &&
        void 0 !== e.id &&
        (this.session.audioSelectedPersistentID = e.id);
    }
    set textTrack(e) {
      var n;
      this.session.subtitleSelectedPersistentID =
        null !== (n = null == e ? void 0 : e.id) && void 0 !== n ? n : -1;
    }
    selectForcedTrack() {
      const { session: e } = this;
      if (!(null == e ? void 0 : e.audioTracks)) return;
      const n = e.audioTracks.filter(
          (n) => n.persistentID === e.audioSelectedPersistentID
        ),
        d = n && n.length && n[0];
      if (!d) return;
      const p = e.subtitleMediaOptions.filter(
          (e) =>
            0 === e.MediaSelectionOptionsDisplaysNonForcedSubtitles &&
            e.MediaSelectionOptionsExtendedLanguageTag === d.lang
        ),
        h = null == p ? void 0 : p[0];
      let y;
      return (
        h
          ? (zi.debug(
              "hlsjsTracks: found forced track for " +
                h.MediaSelectionOptionsExtendedLanguageTag
            ),
            (e.subtitleSelectedPersistentID =
              h.MediaSelectionOptionsPersistentID),
            (y = this.normalizeTextTrack(h)))
          : (e.subtitleSelectedPersistentID = -1),
        y
      );
    }
    audioTracksUpdated(e, n) {
      const d = (
        (n &&
          n.audioMediaSelectionGroup &&
          n.audioMediaSelectionGroup.MediaSelectionGroupOptions) ||
        []
      ).map(this.normalizeAudioTrack, this);
      (this._audioTracks = d), this.dispatchEvent(Ji, d);
    }
    handleAudioTrackSwitched() {
      this.dispatchEvent(Qi, {
        selectedId: this.session.audioSelectedPersistentID,
      });
    }
    handleInlineStylesParsed(e, n) {
      this.dispatchEvent(Xi, n);
    }
    handleManifestLoaded(e, n) {
      this.audioTracksUpdated(e, n), this.subtitleTracksUpdated(e, n);
    }
    handleSessionDataComplete(e, n) {
      var d;
      null == n ||
        null === (d = n.itemList) ||
        void 0 === d ||
        d.forEach((e) => {
          if ("_hls.localized-rendition-names" === e["DATA-ID"] && e.VALUE)
            try {
              (this._localizedRenditionNames = JSON.parse(e.VALUE)),
                this._audioTracks.forEach((e) => {
                  var n;
                  const d =
                    null === (n = this._localizedRenditionNames) || void 0 === n
                      ? void 0
                      : n[e.label];
                  d && (e.localizedRenditionNames = d);
                }),
                this.dispatchEvent(Ji, this._audioTracks);
            } catch (Yt) {
              return void zi.error(
                "Failed to parse _hls.localized-rendition-names",
                Yt
              );
            }
        });
    }
    handleSubtitleTrackSwitch(e, n) {
      this.dispatchEvent(Zi, n);
    }
    subtitleTracksUpdated(e, n) {
      const d =
          (n &&
            n.subtitleMediaSelectionGroup &&
            n.subtitleMediaSelectionGroup.MediaSelectionGroupOptions) ||
          [],
        p = [];
      d.forEach((e) => {
        0 !== e.MediaSelectionOptionsDisplaysNonForcedSubtitles &&
          p.push(this.normalizeTextTrack(e));
      }),
        (this._textTracks = p),
        this.dispatchEvent(ea, p);
    }
    normalizeAudioTrack(e) {
      const n = e.MediaSelectionOptionsTaggedMediaCharacteristics,
        d = (null != n ? n : []).includes(
          "public.accessibility.describes-video"
        )
          ? "description"
          : "main";
      return _object_spread_props$p(
        _object_spread$B({}, this.normalizeSelectionOption(e)),
        { enabled: !1, kind: d, characteristics: n }
      );
    }
    normalizeTextTrack(e) {
      var n;
      let d;
      return (
        (d =
          (null === (n = e.MediaSelectionOptionsTaggedMediaCharacteristics) ||
          void 0 === n
            ? void 0
            : n.includes("public.accessibility.describes-music-and-sound")) ||
          "clcp" === e.MediaSelectionOptionsMediaType
            ? "captions"
            : "subtitles"),
        _object_spread_props$p(
          _object_spread$B({}, this.normalizeSelectionOption(e)),
          { mode: "disabled", kind: d }
        )
      );
    }
    normalizeSelectionOption(e) {
      return {
        id: e.MediaSelectionOptionsPersistentID,
        label: e.MediaSelectionOptionsName,
        language: e.MediaSelectionOptionsExtendedLanguageTag,
      };
    }
    destroy() {
      this._isDestroyed = !0;
      const {
        MANIFEST_LOADED: e,
        AUDIO_TRACK_SWITCHED: n,
        SUBTITLE_TRACK_SWITCH: d,
        INLINE_STYLES_PARSED: p,
        SESSION_DATA_COMPLETE: h,
      } = window.Hls.Events;
      this.session.off(e, this.handleManifestLoaded),
        this.session.off(n, this.handleAudioTrackSwitched),
        this.session.off(d, this.handleSubtitleTrackSwitch),
        this.session.off(p, this.handleInlineStylesParsed),
        this.session.off(h, this.handleSessionDataComplete);
    }
    constructor(e) {
      super([Qi, Ji, Xi, Zi, ea]),
        _define_property$12(this, "session", void 0),
        _define_property$12(this, "_audioTracks", void 0),
        _define_property$12(this, "_textTracks", void 0),
        _define_property$12(this, "_localizedRenditionNames", void 0),
        _define_property$12(this, "_isDestroyed", void 0),
        (this.session = e),
        (this._audioTracks = []),
        (this._textTracks = []),
        (this._isDestroyed = !1);
      const {
        MANIFEST_LOADED: n,
        AUDIO_TRACK_SWITCHED: d,
        SUBTITLE_TRACK_SWITCH: p,
        INLINE_STYLES_PARSED: h,
        SESSION_DATA_COMPLETE: y,
      } = window.Hls.Events;
      this.session.on(n, this.handleManifestLoaded),
        this.session.on(d, this.handleAudioTrackSwitched),
        this.session.on(p, this.handleSubtitleTrackSwitch),
        this.session.on(h, this.handleInlineStylesParsed),
        this.session.on(y, this.handleSessionDataComplete);
    }
  }
  function _define_property$11(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  _ts_decorate$q(
    [
      Bind(),
      _ts_metadata$q("design:type", Function),
      _ts_metadata$q("design:paramtypes", []),
      _ts_metadata$q("design:returntype", void 0),
    ],
    HlsJsTracks.prototype,
    "handleAudioTrackSwitched",
    null
  ),
    _ts_decorate$q(
      [
        Bind(),
        _ts_metadata$q("design:type", Function),
        _ts_metadata$q("design:paramtypes", [void 0, void 0]),
        _ts_metadata$q("design:returntype", void 0),
      ],
      HlsJsTracks.prototype,
      "handleInlineStylesParsed",
      null
    ),
    _ts_decorate$q(
      [
        Bind(),
        _ts_metadata$q("design:type", Function),
        _ts_metadata$q("design:paramtypes", [void 0, void 0]),
        _ts_metadata$q("design:returntype", void 0),
      ],
      HlsJsTracks.prototype,
      "handleManifestLoaded",
      null
    ),
    _ts_decorate$q(
      [
        Bind(),
        _ts_metadata$q("design:type", Function),
        _ts_metadata$q("design:paramtypes", [void 0, void 0]),
        _ts_metadata$q("design:returntype", void 0),
      ],
      HlsJsTracks.prototype,
      "handleSessionDataComplete",
      null
    ),
    _ts_decorate$q(
      [
        Bind(),
        _ts_metadata$q("design:type", Function),
        _ts_metadata$q("design:paramtypes", [void 0, void 0]),
        _ts_metadata$q("design:returntype", void 0),
      ],
      HlsJsTracks.prototype,
      "handleSubtitleTrackSwitch",
      null
    );
  class HlsJsPreviewImageLoader {
    loadPreviewImage(e) {
      return (
        this.lastPosition === e ||
          ((this.lastPosition = e),
          (this.lastPromise = new Promise((n, d) => {
            this.hls.loadImageIframeData$(e).subscribe((e) => {
              const { data: d } = e,
                p = new Blob([d], { type: "image/jpeg" });
              n(p);
            });
          }))),
        this.lastPromise
      );
    }
    constructor(e) {
      _define_property$11(this, "hls", void 0),
        _define_property$11(this, "lastPosition", void 0),
        _define_property$11(this, "lastPromise", void 0),
        (this.hls = e);
    }
  }
  function asyncGeneratorStep$N(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$N(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$N(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$N(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$10(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$p(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$p(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const ta = {
    bufferStalledError: "bufferStalledError",
    keySystemGenericError: "keySystemGenericError",
  };
  var ra;
  !(function (e) {
    (e.Seek = "Seek"),
      (e.HighBuffer = "HighBuffer"),
      (e.LowBuffer = "LowBuffer");
  })(ra || (ra = {}));
  const na = new Set([
      MKError.Reason.DEVICE_LIMIT,
      MKError.Reason.GEO_BLOCK,
      MKError.Reason.WIDEVINE_CDM_EXPIRED,
    ]),
    ia = {};
  (ia[tt.FAIRPLAY] = "fairplaystreaming"),
    (ia[tt.PLAYREADY] = "playready"),
    (ia[tt.WIDEVINE] = "widevine");
  const aa = BooleanDevFlag.get("mk-block-report-cdn-server"),
    oa = { nightly: !0, carry: !0 },
    sa = JsonDevFlag.register("mk-hlsjs-config-overrides");
  class HlsJsVideoPlayer extends VideoPlayer {
    get shouldDispatchErrors() {
      return !this.userInitiated || this._playbackDidStart;
    }
    get supportsPreviewImages() {
      var e, n;
      return (
        !this.services.runtime.isMobile &&
        (null === (n = this._hls) ||
        void 0 === n ||
        null === (e = n.iframeVariants) ||
        void 0 === e
          ? void 0
          : e.some((e) => "mjpg" === e.imageCodec))
      );
    }
    get currentPlayingDate() {
      var e;
      return null === (e = this._hls) || void 0 === e ? void 0 : e.playingDate;
    }
    get isPlayingAtLiveEdge() {
      var e;
      const n = this._hls;
      return (
        !(
          !n ||
          !(null === (e = this.nowPlayingItem) || void 0 === e
            ? void 0
            : e.isLinearStream)
        ) && !!n.isPlayingAtLive
      );
    }
    get seekableTimeRanges() {
      const e = this._hls;
      return e
        ? e.seekableTimeRanges
        : this.currentPlaybackDuration
          ? [{ start: 0, end: this.currentPlaybackDuration }]
          : void 0;
    }
    initializeExtension() {
      var e = this;
      return _async_to_generator$N(function* () {
        e._keySystem = yield findKeySystemPreference(e.services.runtime);
        try {
          var n;
          if (!rt.urls.hls) throw new Error("bag.urls.hls is not configured");
          yield Promise.all([
            loadScript(rt.urls.hls),
            null === (n = e._rtcTracker) || void 0 === n
              ? void 0
              : n.loadScript(),
          ]);
        } catch (Yt) {
          throw (
            (He.error(
              "hlsjs-video-player failed to load script " + rt.urls.hls,
              Yt
            ),
            Yt)
          );
        }
      })();
    }
    destroy() {
      var e;
      if (
        (He.debug("hlsjs-video-player.destroy"),
        null === (e = this._hlsJsTracks) || void 0 === e || e.destroy(),
        this._hls)
      ) {
        const {
            ERROR: e,
            INTERNAL_ERROR: n,
            MANIFEST_PARSED: d,
            KEY_REQUEST_STARTED: p,
            LICENSE_CHALLENGE_CREATED: h,
            LEVEL_SWITCHED: y,
            UNRESOLVED_URI_LOADING: _,
          } = window.Hls.Events,
          m = this._hls;
        m.stopLoad(),
          m.detachMedia(),
          m.off(e, this.handleHlsError),
          m.off(n, this.handleHlsError),
          m.off(d, this.handleManifestParsed),
          m.off(p, this.handleKeyRequestStarted),
          m.off(h, this.handleLicenseChallengeCreated),
          m.off(y, this.handleLevelSwitched),
          this._shouldLoadManifestsOnce &&
            m.off(_, this.handleUnresolvedUriLoading),
          m.destroy(),
          (window.hlsSession = void 0);
      }
      super.destroy(), asAsync(this._license.stop());
    }
    playHlsStream(e, n, d = {}) {
      var p = this;
      return _async_to_generator$N(function* () {
        He.debug("hlsjs-video-player.playHlsStream", e, n);
        const { _keySystem: h } = p;
        if (!h) return;
        let y, _;
        (p._unrecoverableError = void 0), p.createHlsPlayer();
        const hasKey = (e, n) => {
          var d;
          return (
            void 0 !==
            (null == n || null === (d = n.keyURLs) || void 0 === d
              ? void 0
              : d[e])
          );
        };
        h === tt.WIDEVINE &&
          hasKey("widevine-cert-url", n) &&
          ((y = "WIDEVINE_SOFTWARE"),
          (_ = {
            initDataTypes: ["cenc", "keyids"],
            distinctiveIdentifier: "optional",
            persistentState: "required",
          }));
        const m = {
            subs: "accepts-css",
            platformInfo: {
              requiresCDMAttachOnStart: h !== tt.NONE,
              maxSecurityLevel: y,
              keySystemConfig: _,
            },
            appData: { serviceName: rt.app.name },
          },
          { _rtcTracker: g, _hls: b } = p;
        if (g) {
          const e = g.prepareReportingAgent(n);
          void 0 !== e && (m.appData.reportingAgent = e);
        }
        He.debug("RTC: loadSource with load options", m);
        const P = p.startPlaybackSequence();
        return (
          p._shouldLoadManifestsOnce &&
            ((e = e.replace("https://", "manifest://")),
            He.info("Manifest already loaded, passing url to HLSJS", e)),
          b.loadSource(e, m, d.startTime),
          b.attachMedia(p.video),
          n &&
            ((p._licenseServerUrl = n.keyURLs["hls-key-server-url"]),
            h === tt.FAIRPLAY && hasKey("hls-key-cert-url", n)
              ? b.setProtectionData({
                  fairplaystreaming: {
                    serverCertUrl: n.keyURLs["hls-key-cert-url"],
                  },
                })
              : hasKey("widevine-cert-url", n) &&
                b.setProtectionData({
                  widevine: { serverCertUrl: n.keyURLs["widevine-cert-url"] },
                })),
          P
        );
      })();
    }
    createHlsPlayer() {
      const { _keySystem: e } = this,
        { Hls: n } = window,
        d = le.get(),
        { os: p } = this.services.runtime,
        h = {
          clearMediaKeysOnPromise: !1,
          customTextTrackCueRenderer: !0,
          debug: !!d,
          debugLevel: d,
          enableIFramePreloading: !1,
          enablePerformanceLogging: !!d,
          enablePlayReadyKeySystem: !0,
          enableQueryParamsForITunes: !this._shouldLoadManifestsOnce,
          enableRtcReporting: void 0 !== this._rtcTracker,
          keySystemPreference: ia[e],
          useMediaKeySystemAccessFilter: !0,
          nativeControlsEnabled: p.isAndroid,
          enableContentSteering: !0,
          allowFastSwitchUp: !0,
        };
      ((e) => {
        const { Hls: n } = window;
        if (n && aa) {
          const d = deepClone(n.DefaultConfig.fragLoadPolicy);
          (d.default.reportCDNServer = !1),
            (d.customURL.reportCDNServer = !1),
            (e.fragLoadPolicy = d);
        }
      })(h),
        ((e) => {
          const n = ae.value;
          if (!n) return;
          var d;
          const p =
            null !== (d = determineCdnPathPrefix()) && void 0 !== d ? d : "";
          n.socketurl &&
            isAppleHostname(n.socketurl) &&
            oa[p.split(".")[0]] &&
            ((e.socketurl = n.socketurl),
            (e.socketid = n.socketid),
            (e.log = n.log));
        })(h),
        ((e) => {
          const n = sa.value;
          n && "object" == typeof n && Object.assign(e, n);
        })(h);
      const y = new n(h),
        {
          ERROR: _,
          INTERNAL_ERROR: m,
          MANIFEST_PARSED: g,
          KEY_REQUEST_STARTED: b,
          LICENSE_CHALLENGE_CREATED: P,
          LEVEL_SWITCHED: S,
          UNRESOLVED_URI_LOADING: T,
        } = n.Events;
      y.on(_, this.handleHlsError),
        y.on(m, this.handleHlsError),
        y.on(g, this.handleManifestParsed),
        y.on(b, this.handleKeyRequestStarted),
        y.on(P, this.handleLicenseChallengeCreated),
        y.on(S, this.handleLevelSwitched),
        this._shouldLoadManifestsOnce &&
          y.on(T, this.handleUnresolvedUriLoading),
        (this._hls = y),
        (window.hlsSession = y),
        (this._hlsJsTracks = new HlsJsTracks(this._hls)),
        this.setupTrackManagers(this._hlsJsTracks),
        (this._hlsPreviewImageLoader = new HlsJsPreviewImageLoader(this._hls));
    }
    handleUnresolvedUriLoading(e, n) {
      var d = this;
      return _async_to_generator$N(function* () {
        const e = d._hls,
          p = n.uri,
          h = p.replace("manifest://", "https://");
        var y;
        He.debug("handleUnresolvedUriLoading for uri ", p);
        const _ =
          null !== (y = qi.getManifest(h)) && void 0 !== y
            ? y
            : yield qi.fetchManifest(h);
        _
          ? (qi.clear(h),
            e.off(
              window.Hls.Events.UNRESOLVED_URI_LOADING,
              d.handleUnresolvedUriLoading
            ),
            e.handleResolvedUri(p, { url: h, status: 200, data: _.content }))
          : He.error("No cached manifest for " + h);
      })();
    }
    handleLevelSwitched(e, n) {
      var d, p;
      const { level: h } = n;
      if (!h) return;
      const y =
        null === (d = this._levels) || void 0 === d
          ? void 0
          : d.find((e) => e.persistentId === h);
      if (
        !y ||
        (null === (p = this._currentLevel) || void 0 === p
          ? void 0
          : p.persistentId) === (null == y ? void 0 : y.persistentId)
      )
        return;
      this._currentLevel = y;
      const _ =
        void 0 !== y.audioGroupId
          ? this._channelsByGroup[y.audioGroupId]
          : void 0;
      this._dispatcher.publish(kt.hlsLevelUpdated, { level: y, channels: _ });
    }
    handleHlsError(e, n) {
      var d;
      if (
        (He.warn("HLS.js error", JSON.stringify(n)), this._unrecoverableError)
      )
        return;
      let p = new MKError(MKError.Reason.UNSUPPORTED_ERROR, n.reason);
      p.data = n;
      const { bufferStalledError: h, keySystemGenericError: y } = ta;
      if (n.details === y) return void this._dispatcher.publish(y, p);
      let _ = !1;
      var m;
      n.details === h &&
        "Seek" === n.stallType &&
        -12909 ===
          (null === (d = n.response) || void 0 === d ? void 0 : d.code) &&
        ((p = new MKError(MKError.Reason.BUFFER_STALLED_ERROR, n.stallType)),
        (p.data = {
          stallType: n.stallType,
          code: null === (m = n.response) || void 0 === m ? void 0 : m.code,
        }),
        (_ = !0));
      if (
        ("output-restricted" === n.reason &&
          (p = new MKError(MKError.Reason.OUTPUT_RESTRICTED, n.reason)),
        n.fatal)
      ) {
        if ((this._hls.destroy(), !this.shouldDispatchErrors && !_)) throw p;
        this._dispatcher.publish(wt.mediaPlaybackError, p);
      }
    }
    handleManifestParsed(e, n) {
      var d = this;
      return _async_to_generator$N(function* () {
        var e, p;
        let h;
        He.debug("handleManifestParsed", n),
          (d._levels = null !== (e = n.levels) && void 0 !== e ? e : []),
          (d.nowPlayingItem.state = x.ready),
          (d._channelsByGroup = (
            null !== (p = n.audioTracks) && void 0 !== p ? p : []
          ).reduce((e, n) => ((e[n.groupId] = n.channels), e), {}));
        try {
          yield d._playMedia();
        } catch (Yt) {
          throw (
            (He.warn("error from media element, possibly non-fatal", Yt), Yt)
          );
        } finally {
          h = yield d.finishPlaybackSequence();
        }
        return h;
      })();
    }
    handleKeyRequestStarted(e, n) {
      He.debug("hlsjs-video.handleKeyRequestStarted"),
        this._hls.generateKeyRequest(n.keyuri, {});
    }
    handleLicenseChallengeCreated(n, d) {
      var p = this;
      return _async_to_generator$N(function* () {
        const {
          _licenseServerUrl: n,
          nowPlayingItem: h,
          _keySystem: y,
          userInitiated: _,
        } = p;
        try {
          var m;
          const e = yield null === (m = p._license) || void 0 === m
              ? void 0
              : m.start(n, h, d, y, _),
            g = { statusCode: e.status };
          (null == e ? void 0 : e.license) &&
            (y === tt.FAIRPLAY
              ? (g.ckc = Ae(e.license))
              : (g.license = Ae(e.license)));
          const b = e["renew-after"];
          b && (g.renewalDate = new Date(Date.now() + 1e3 * b)),
            p._hls.setLicenseResponse(d.keyuri, g);
        } catch (q) {
          if (p._unrecoverableError) return;
          const h = q.data,
            y = {};
          void 0 !== (null == h ? void 0 : h.status) &&
            (y.statusCode = +h.status),
            He.warn("Passing license response error to Hls.js", y),
            p._hls.setLicenseResponse(d.keyuri, y),
            MKError.isMKError(q) &&
              na.has(q.reason) &&
              ((p._unrecoverableError = q),
              p.resetDeferredPlay(),
              yield p.stop({
                endReasonType: e.PlayActivityEndReasonType.FAILED_TO_LOAD,
                userInitiated: _,
              })),
            p.onPlaybackLicenseError(q);
        }
      })();
    }
    seekToTime(e) {
      var n = this;
      return _async_to_generator$N(function* () {
        n._hls
          ? (He.debug("hlsjs-video: hls seekTo", e), (n._hls.seekTo = e))
          : (He.debug("hlsjs-video: media element seek to", e),
            (n._targetElement.currentTime = e));
      })();
    }
    loadPreviewImage(e) {
      var n = this;
      return _async_to_generator$N(function* () {
        var d;
        return null === (d = n._hlsPreviewImageLoader) || void 0 === d
          ? void 0
          : d.loadPreviewImage(e);
      })();
    }
    constructor(e) {
      var n;
      super(e),
        _define_property$10(this, "_hls", void 0),
        _define_property$10(this, "_hlsPreviewImageLoader", void 0),
        _define_property$10(this, "_hlsJsTracks", void 0),
        _define_property$10(this, "_keySystem", void 0),
        _define_property$10(this, "_license", void 0),
        _define_property$10(this, "_rtcTracker", void 0),
        _define_property$10(this, "_levels", void 0),
        _define_property$10(this, "_channelsByGroup", {}),
        _define_property$10(this, "_currentLevel", void 0),
        _define_property$10(this, "_licenseServerUrl", void 0),
        _define_property$10(this, "_unrecoverableError", void 0),
        (this._rtcTracker =
          null == e || null === (n = e.playbackServices) || void 0 === n
            ? void 0
            : n.getRTCStreamingTracker()),
        (this._license = new License());
    }
  }
  var ca;
  _ts_decorate$p(
    [
      Bind(),
      _ts_metadata$p("design:type", Function),
      _ts_metadata$p("design:paramtypes", [
        String,
        "undefined" == typeof HlsUnresolvedUriData
          ? Object
          : HlsUnresolvedUriData,
      ]),
      _ts_metadata$p("design:returntype", Promise),
    ],
    HlsJsVideoPlayer.prototype,
    "handleUnresolvedUriLoading",
    null
  ),
    _ts_decorate$p(
      [
        Bind(),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [void 0, void 0]),
        _ts_metadata$p("design:returntype", void 0),
      ],
      HlsJsVideoPlayer.prototype,
      "handleLevelSwitched",
      null
    ),
    _ts_decorate$p(
      [
        Bind(),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [void 0, void 0]),
        _ts_metadata$p("design:returntype", void 0),
      ],
      HlsJsVideoPlayer.prototype,
      "handleHlsError",
      null
    ),
    _ts_decorate$p(
      [
        Bind(),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [void 0, void 0]),
        _ts_metadata$p("design:returntype", Promise),
      ],
      HlsJsVideoPlayer.prototype,
      "handleManifestParsed",
      null
    ),
    _ts_decorate$p(
      [
        Bind(),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [void 0, void 0]),
        _ts_metadata$p("design:returntype", void 0),
      ],
      HlsJsVideoPlayer.prototype,
      "handleKeyRequestStarted",
      null
    ),
    _ts_decorate$p(
      [
        Bind(),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [void 0, void 0]),
        _ts_metadata$p("design:returntype", Promise),
      ],
      HlsJsVideoPlayer.prototype,
      "handleLicenseChallengeCreated",
      null
    ),
    _ts_decorate$p(
      [
        AsyncDebounce(250),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [Number]),
        _ts_metadata$p("design:returntype", Promise),
      ],
      HlsJsVideoPlayer.prototype,
      "seekToTime",
      null
    ),
    _ts_decorate$p(
      [
        ((ca = 250),
        (e, n, d) => {
          const p = (function (e, n) {
            let d,
              p,
              h = 0;
            const resetState = () => {
              clearTimeout(p), (p = 0), (d = void 0);
            };
            return function (...y) {
              const _ = this;
              return new Promise(function (m, g) {
                const b = Date.now();
                b - h < n
                  ? (d && (d.resolve(void 0), resetState()),
                    (d = { resolve: m, reject: g, args: y }),
                    (p = setTimeout(
                      () => {
                        e.apply(_, d.args).then(d.resolve).catch(d.reject),
                          resetState();
                      },
                      n - (b - h + 1)
                    )))
                  : (resetState(), (h = b), e.apply(_, y).then(m).catch(g));
              });
            };
          })(d.value, ca);
          d.value = p;
        }),
        _ts_metadata$p("design:type", Function),
        _ts_metadata$p("design:paramtypes", [Number]),
        _ts_metadata$p("design:returntype", Promise),
      ],
      HlsJsVideoPlayer.prototype,
      "loadPreviewImage",
      null
    ),
    (e.version = "3.2418.3");
  const la = e.version.split("."),
    da = la[0],
    ua = la[la.length - 1];
  var pa, ha;
  (la[0] = "3"),
    (la[la.length - 1] = ua + "-prerelease"),
    (la[0] = da),
    (la[la.length - 1] = ua),
    (e.version = la.join(".")),
    (e.PlaybackActions = void 0),
    ((pa = e.PlaybackActions || (e.PlaybackActions = {})).REPEAT = "REPEAT"),
    (pa.SHUFFLE = "SHUFFLE"),
    (pa.AUTOPLAY = "AUTOPLAY"),
    (e.PlaybackMode = void 0),
    ((ha = e.PlaybackMode || (e.PlaybackMode = {}))[(ha.PREVIEW_ONLY = 0)] =
      "PREVIEW_ONLY"),
    (ha[(ha.MIXED_CONTENT = 1)] = "MIXED_CONTENT"),
    (ha[(ha.FULL_PLAYBACK_ONLY = 2)] = "FULL_PLAYBACK_ONLY"),
    (ha[(ha.SHAREPLAY_PARTICIPANT = 3)] = "SHAREPLAY_PARTICIPANT");
  const ya = {
      configured: "musickitconfigured",
      loaded: "musickitloaded",
      audioTrackAdded: wt.audioTrackAdded,
      audioTrackChanged: wt.audioTrackChanged,
      audioTrackRemoved: wt.audioTrackRemoved,
      authorizationStatusDidChange: Ke.authorizationStatusDidChange,
      authorizationStatusWillChange: Ke.authorizationStatusWillChange,
      bufferedProgressDidChange: wt.bufferedProgressDidChange,
      capabilitiesChanged: "capabilitiesChanged",
      autoplayEnabledDidChange: "autoplayEnabledDidChange",
      drmUnsupported: wt.drmUnsupported,
      eligibleForSubscribeView: Ke.eligibleForSubscribeView,
      forcedTextTrackChanged: wt.forcedTextTrackChanged,
      mediaCanPlay: wt.mediaCanPlay,
      mediaElementCreated: wt.mediaElementCreated,
      mediaItemStateDidChange: R.mediaItemStateDidChange,
      mediaItemStateWillChange: R.mediaItemStateWillChange,
      mediaPlaybackError: wt.mediaPlaybackError,
      mediaSkipAvailable: "mediaSkipAvailable",
      mediaRollEntered: "mediaRollEntered",
      mediaUpNext: "mediaUpNext",
      metadataDidChange: wt.metadataDidChange,
      needsGDPRDidChange: "needsGDPRDidChange",
      nowPlayingItemDidChange: wt.nowPlayingItemDidChange,
      nowPlayingItemWillChange: wt.nowPlayingItemWillChange,
      playInitiated: "playInitiated",
      playbackBitrateDidChange: wt.playbackBitrateDidChange,
      playbackDurationDidChange: wt.playbackDurationDidChange,
      playbackProgressDidChange: wt.playbackProgressDidChange,
      playbackRateDidChange: wt.playbackRateDidChange,
      playbackStateDidChange: wt.playbackStateDidChange,
      playbackStateWillChange: wt.playbackStateWillChange,
      playbackTargetAvailableDidChange: wt.playbackTargetAvailableDidChange,
      playbackTargetIsWirelessDidChange: wt.playbackTargetIsWirelessDidChange,
      playbackTimeDidChange: wt.playbackTimeDidChange,
      playbackVolumeDidChange: wt.playbackVolumeDidChange,
      playerTypeDidChange: wt.playerTypeDidChange,
      presentationModeDidChange: wt.presentationModeDidChange,
      primaryPlayerDidChange: wt.primaryPlayerDidChange,
      queueIsReady: "queueIsReady",
      queueItemsDidChange: "queueItemsDidChange",
      queueItemForStartPosition: "queueItemForStartPosition",
      queuePositionDidChange: "queuePositionDidChange",
      shuffleModeDidChange: "shuffleModeDidChange",
      repeatModeDidChange: "repeatModeDidChange",
      storefrontCountryCodeDidChange: Ke.storefrontCountryCodeDidChange,
      storefrontIdentifierDidChange: Ke.storefrontIdentifierDidChange,
      textTrackAdded: wt.textTrackAdded,
      textTrackChanged: wt.textTrackChanged,
      textTrackRemoved: wt.textTrackRemoved,
      timedMetadataDidChange: wt.timedMetadataDidChange,
      userTokenDidChange: Ke.userTokenDidChange,
      webComponentsLoaded: "musickitwebcomponentsloaded",
    },
    _a = "sharePlay.playbackStateChanged",
    fa = "sharePlay.volumeChanged",
    ma = "sharePlay.nextItem",
    va = "sharePlay.previousItem",
    ga = "sharePlay.shuffleModeChanged",
    ba = "sharePlay.repeatModeChanged",
    Pa = "sharePlay.autoPlayChanged",
    Sa = "sharePlay.progressChanged",
    Ta = "sharePlay.mediaStateUpdate";
  function asyncGeneratorStep$M(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$$(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$o(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class SpanWatcher {
    startMonitor() {
      this.dispatcher.unsubscribe(
        ya.playbackTimeDidChange,
        this.handleTimeChange
      ),
        this.dispatcher.subscribe(
          ya.playbackTimeDidChange,
          this.handleTimeChange
        );
    }
    stopMonitor() {
      this.dispatcher.unsubscribe(
        ya.playbackTimeDidChange,
        this.handleTimeChange
      );
    }
    handleTimeChange(e, { currentPlaybackTime: n }) {
      var d,
        p = this;
      return ((d = function* () {
        !Number.isFinite(n) || n < p.start || n > p.stop
          ? (p.inWatchSpan = !1)
          : p.inWatchSpan ||
            (p.allowMultiple || p.stopMonitor(),
            (p.inWatchSpan = !0),
            yield p.callback(n, p));
      }),
      function () {
        var e = this,
          n = arguments;
        return new Promise(function (p, h) {
          var y = d.apply(e, n);
          function _next(e) {
            asyncGeneratorStep$M(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$M(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    constructor(e, n, d, p, h = !1) {
      _define_property$$(this, "dispatcher", void 0),
        _define_property$$(this, "callback", void 0),
        _define_property$$(this, "start", void 0),
        _define_property$$(this, "stop", void 0),
        _define_property$$(this, "allowMultiple", void 0),
        _define_property$$(this, "inWatchSpan", void 0),
        (this.dispatcher = e),
        (this.callback = n),
        (this.start = d),
        (this.stop = p),
        (this.allowMultiple = h),
        (this.inWatchSpan = !1);
    }
  }
  function _define_property$_(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$n(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$o("design:type", Function),
      _ts_metadata$o("design:paramtypes", [void 0, void 0]),
      _ts_metadata$o("design:returntype", Promise),
    ],
    SpanWatcher.prototype,
    "handleTimeChange",
    null
  );
  class PlaybackMonitor {
    activate() {
      (this.isActive = !0), this.startMonitor();
    }
    deactivate() {
      (this.isActive = !1), this.clearMonitor();
    }
    clearMonitor() {
      this.isMonitoring &&
        (this.watchers.forEach((e) => e.stopMonitor()),
        (this.isMonitoring = !1));
    }
    shouldMonitor() {
      return this.isActive;
    }
    startMonitor() {
      this.shouldMonitor() &&
        (this.watchers.forEach((e) => e.startMonitor()),
        (this.isMonitoring = !0));
    }
    handleMediaItemChange() {
      this.isActive &&
        (this.clearMonitor(), this.shouldMonitor() && this.startMonitor());
    }
    constructor(e) {
      _define_property$_(this, "isActive", !1),
        _define_property$_(this, "isMonitoring", !1),
        _define_property$_(this, "apiManager", void 0),
        _define_property$_(this, "dispatcher", void 0),
        _define_property$_(this, "playbackController", void 0),
        _define_property$_(this, "watchers", []),
        (this.handlePlaybackThreshold =
          this.handlePlaybackThreshold.bind(this)),
        (this.playbackController = e.controller),
        (this.dispatcher = e.services.dispatcher),
        this.dispatcher.subscribe(
          ya.nowPlayingItemDidChange,
          this.handleMediaItemChange
        ),
        (this.apiManager = e.services.apiManager);
    }
  }
  function asyncGeneratorStep$L(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$n("design:type", Function),
      _ts_metadata$n("design:paramtypes", []),
      _ts_metadata$n("design:returntype", void 0),
    ],
    PlaybackMonitor.prototype,
    "handleMediaItemChange",
    null
  );
  class RollMonitor extends PlaybackMonitor {
    handlePlaybackThreshold(e, n) {
      var d,
        p = this;
      return ((d = function* () {
        if (!p.rollMap.has(n)) return;
        const e = p.rollMap.get(n);
        p.dispatcher.publish(ya.mediaRollEntered, e), p.rollMap.delete(n);
      }),
      function () {
        var e = this,
          n = arguments;
        return new Promise(function (p, h) {
          var y = d.apply(e, n);
          function _next(e) {
            asyncGeneratorStep$L(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$L(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    shouldMonitor() {
      if (!super.shouldMonitor()) return !1;
      return this.getRollMetadata().length > 0;
    }
    startMonitor() {
      this.setupWatchers(this.getRollMetadata()), super.startMonitor();
    }
    getRollMetadata() {
      const e = this.playbackController.nowPlayingItem;
      return void 0 === e
        ? []
        : (function (e, n = ["pre-roll", "mid-roll", "post-roll"]) {
            if (void 0 === e.hlsMetadata) return [];
            const d = [];
            return (
              n.forEach((n) => {
                const p = parseInt(e.hlsMetadata[n + ".count"], 10);
                if (!isNaN(p))
                  for (let h = 0; h < p; h++) {
                    const p = `${n}.${h}`,
                      y = {
                        index: h,
                        type: n,
                        skippable: "true" === e.hlsMetadata[p + ".skippable"],
                        "adam-id": e.hlsMetadata[p + ".adam-id"],
                        start: Math.round(
                          parseFloat(e.hlsMetadata[p + ".start"])
                        ),
                        duration: Math.round(
                          parseFloat(e.hlsMetadata[p + ".duration"])
                        ),
                      },
                      _ = p + ".dynamic-slot.data-set-id";
                    void 0 !== e.hlsMetadata[_] &&
                      (y["dynamic-id"] = e.hlsMetadata[_]),
                      d.push(y);
                  }
              }),
              d
            );
          })(e, ["pre-roll", "post-roll"]);
    }
    setupWatchers(e) {
      const n = [];
      e.forEach((e) => {
        const { start: d, duration: p } = e,
          h = new SpanWatcher(
            this.dispatcher,
            this.handlePlaybackThreshold,
            d,
            d + p
          );
        n.push(h), this.rollMap.set(h, e);
      }),
        (this.watchers = n);
    }
    constructor(e) {
      var n, d, p;
      super(e),
        (n = this),
        (d = "rollMap"),
        (p = new Map()),
        d in n
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p);
    }
  }
  function asyncGeneratorStep$K(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  class SkipAvailable extends PlaybackMonitor {
    handlePlaybackThreshold(e, n) {
      var d,
        p = this;
      return ((d = function* () {
        if (!p.skipMap.has(n)) return;
        const e = p.skipMap.get(n);
        p.dispatcher.publish(ya.mediaSkipAvailable, e);
      }),
      function () {
        var e = this,
          n = arguments;
        return new Promise(function (p, h) {
          var y = d.apply(e, n);
          function _next(e) {
            asyncGeneratorStep$K(y, p, h, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$K(y, p, h, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      })();
    }
    shouldMonitor() {
      if (!super.shouldMonitor()) return !1;
      return this.getNowPlayingMetadata().length > 0;
    }
    startMonitor() {
      this.setupWatchers(this.getNowPlayingMetadata()), super.startMonitor();
    }
    getNowPlayingMetadata() {
      const e = this.playbackController.nowPlayingItem;
      return void 0 === e
        ? []
        : (function (e) {
            const n = parseInt(e.hlsMetadata["skip.count"], 10),
              d = [];
            if (isNaN(n) || 0 === n) return d;
            for (let p = 0; p < n; p++) {
              const n = {
                start: parseFloat(e.hlsMetadata[`skip.${p}.start`]),
                duration: parseFloat(e.hlsMetadata[`skip.${p}.duration`]),
                target: parseFloat(e.hlsMetadata[`skip.${p}.target`]),
                label: e.hlsMetadata[`skip.${p}.label`],
              };
              void 0 !== e.hlsMetadata[`skip.${p}.promo.enabled`] &&
                (n.promo = {
                  enabled: "true" === e.hlsMetadata[`skip.${p}.promo.enabled`],
                  image: e.hlsMetadata[`skip.${p}.promo.image`],
                  "image-height": parseInt(
                    e.hlsMetadata[`skip.${p}.promo.image-height`],
                    10
                  ),
                  "image-width": parseInt(
                    e.hlsMetadata[`skip.${p}.promo.image-width`],
                    10
                  ),
                  genre: e.hlsMetadata[`skip.${p}.promo.genre`],
                  "release-year": parseInt(
                    e.hlsMetadata[`skip.${p}.promo.release-year`],
                    10
                  ),
                  "rating-display-name":
                    e.hlsMetadata[`skip.${p}.promo.rating-display-name`],
                  "rating-system":
                    e.hlsMetadata[`skip.${p}.promo.rating-system`],
                  "canonical-id": e.hlsMetadata[`skip.${p}.promo.canonical-id`],
                  title: e.hlsMetadata[`skip.${p}.promo.title`],
                  "rating-tag": e.hlsMetadata[`skip.${p}.promo.rating-tag`],
                  "rating-rank": e.hlsMetadata[`skip.${p}.promo.rating-rank`],
                  "up-next": {
                    "is-added":
                      "true" ===
                      e.hlsMetadata[`skip.${p}.promo.up-next.is-added`],
                    "add-label":
                      e.hlsMetadata[`skip.${p}.promo.up-next.add-label`],
                    "added-label":
                      e.hlsMetadata[`skip.${p}.promo.up-next.added-label`],
                  },
                  runtime: parseInt(
                    e.hlsMetadata[`skip.${p}.promo.runtime`],
                    10
                  ),
                }),
                d.push(n);
            }
            return d;
          })(e);
    }
    setupWatchers(e) {
      const n = [];
      e.forEach((e) => {
        const { start: d, target: p, duration: h, promo: y } = e,
          _ = new SpanWatcher(
            this.dispatcher,
            this.handlePlaybackThreshold,
            d,
            y ? p : d + h,
            !0
          );
        n.push(_), this.skipMap.set(_, e);
      }),
        (this.watchers = n);
    }
    constructor(e) {
      var n, d, p;
      super(e),
        (n = this),
        (d = "skipMap"),
        (p = new Map()),
        d in n
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p);
    }
  }
  function asyncGeneratorStep$J(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$X(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const hasContentCompletionThresholdData = (e) =>
      !isNaN(getUpNextStart(e)) && !isNaN(getWatchedTime(e)),
    getUpNextStart = (e) => parseFloat(e.hlsMetadata["up-next.start"]),
    getWatchedTime = (e) => parseFloat(e.hlsMetadata["watched.time"]),
    ka =
      ((Ea = function* (e, n) {
        if (e.isUTS && e.assetURL)
          try {
            const d = generateAssetUrl(e, n),
              p = yield qi.fetchManifest(d);
            e.hlsMetadata = (function (e) {
              for (var n = 1; n < arguments.length; n++) {
                var d = null != arguments[n] ? arguments[n] : {},
                  p = Object.keys(d);
                "function" == typeof Object.getOwnPropertySymbols &&
                  (p = p.concat(
                    Object.getOwnPropertySymbols(d).filter(function (e) {
                      return Object.getOwnPropertyDescriptor(d, e).enumerable;
                    })
                  )),
                  p.forEach(function (n) {
                    _define_property$X(e, n, d[n]);
                  });
              }
              return e;
            })(
              {},
              e.hlsMetadata,
              (function (e, n = {}) {
                const d =
                    /^(?:#EXT-X-SESSION-DATA:?)DATA-ID="([^"]+)".+VALUE="([^"]+)".*$/,
                  p = {};
                for (const h of e.split("\n")) {
                  const e = h.match(d);
                  if (e) {
                    let d = e[1];
                    e[1].startsWith("com.apple.hls.") &&
                      !1 !== n.stripPrefix &&
                      (d = e[1].slice("com.apple.hls.".length));
                    const h = e[2];
                    p[d] = h;
                  }
                }
                return p;
              })(p.content)
            );
          } catch (q) {
            Ye.error(q.message, q);
          }
      }),
      (wa = function () {
        var e = this,
          n = arguments;
        return new Promise(function (d, p) {
          var h = Ea.apply(e, n);
          function _next(e) {
            asyncGeneratorStep$J(h, d, p, _next, _throw, "next", e);
          }
          function _throw(e) {
            asyncGeneratorStep$J(h, d, p, _next, _throw, "throw", e);
          }
          _next(void 0);
        });
      }),
      function (e, n) {
        return wa.apply(this, arguments);
      });
  var Ea, wa;
  function asyncGeneratorStep$I(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _ts_metadata$m(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class UpNextMonitor extends PlaybackMonitor {
    handlePlaybackThreshold() {
      var e = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$I(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$I(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        e.dispatcher.publish(ya.mediaUpNext);
      })();
    }
    shouldMonitor() {
      if (!super.shouldMonitor()) return !1;
      const e = this.playbackController.nowPlayingItem;
      return void 0 !== e && hasContentCompletionThresholdData(e);
    }
    startMonitor() {
      this.setupWatchers(), super.startMonitor();
    }
    setupWatchers() {
      const e = this.playbackController.nowPlayingItem;
      e &&
        hasContentCompletionThresholdData(e) &&
        (this.watchers = [
          new SpanWatcher(
            this.dispatcher,
            this.handlePlaybackThreshold,
            Math.round(this.getStartTime(e)),
            Number.POSITIVE_INFINITY
          ),
        ]);
    }
    getStartTime(e) {
      const n = getUpNextStart(e);
      return isNaN(n) ? getWatchedTime(e) : n;
    }
    constructor(e) {
      super(e);
    }
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$m("design:type", Function),
      _ts_metadata$m("design:paramtypes", []),
      _ts_metadata$m("design:returntype", Promise),
    ],
    UpNextMonitor.prototype,
    "handlePlaybackThreshold",
    null
  );
  const Oa = getHlsJsCdnConfig(),
    $a = {
      app: {},
      autoplay: {
        maxQueueSizeForAutoplay: 50,
        maxQueueSizeInRequest: 10,
        maxUpcomingTracksToMaintain: 10,
      },
      features: {
        xtrick: !0,
        isWeb: !0,
        bookmarking: !1,
        "seamless-audio-transitions": !0,
        "enhanced-hls": !1,
      },
      urls: {
        hls: Oa.hls,
        rtc: Oa.rtc,
        mediaApi: "https://amp-api.music.apple.com/v1",
        webPlayback: `https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa/webPlayback`,
      },
    },
    Ia = JsonDevFlag.register("mk-offers-key-urls").get();
  function asyncGeneratorStep$H(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$H(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$H(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$H(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$W(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$o(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  let Ra;
  $a.urls.hlsOffersKeyUrls = Ia || {
    "hls-key-cert-url": "https://s.mzstatic.com/skdtool_2021_certbundle.bin",
    "hls-key-server-url":
      "https://play.itunes.apple.com/WebObjects/MZPlay.woa/podcast/hls/license/streaming/start",
    "widevine-cert-url":
      "https://play.itunes.apple.com/WebObjects/MZPlay.woa/wa/widevineCert",
  };
  class Store {
    get authorizationStatus() {
      return this.storekit.authorizationStatus;
    }
    get cid() {
      return this.storekit.cid;
    }
    get developerToken() {
      return this.storekit.developerToken;
    }
    get hasAuthorized() {
      return this._hasAuthorized;
    }
    get isAuthorized() {
      return this.storekit.hasAuthorized;
    }
    get isRestricted() {
      return this.storekit.authorizationStatus === xe.RESTRICTED;
    }
    get metricsClientId() {
      return this._metricsClientId;
    }
    set metricsClientId(e) {
      this._metricsClientId = e;
    }
    get musicUserToken() {
      return this.storekit.userToken;
    }
    set musicUserToken(e) {
      this.storekit.userToken = e;
    }
    updateUserTokenFromStorage() {
      return this.storekit.updateUserTokenFromStorage();
    }
    set dynamicMusicUserToken(e) {
      this.storekit.dynamicUserToken = e;
    }
    get needsGDPR() {
      Ye.error(
        "needsGDPR has been deprecated. Plesae migrate to shouldDisplayPrivacyLink()"
      );
    }
    get realm() {
      return this.storekit.realm;
    }
    set requestUserToken(e) {
      (this._providedRequestUserToken = !0),
        (this.storekit.requestUserToken = e);
    }
    get restrictedEnabled() {
      return this.storekit.restrictedEnabled;
    }
    set restrictedEnabled(e) {
      this.storekit.overrideRestrictEnabled(e);
    }
    get storefrontCountryCode() {
      var e;
      return this.isAuthorized
        ? this.storekit.storefrontCountryCode
        : null !== (e = this._defaultStorefrontCountryCode) && void 0 !== e
          ? e
          : this.storekit.storefrontCountryCode;
    }
    get storefrontId() {
      return this._apiStorefrontId || this.storekit.storefrontCountryCode;
    }
    set storefrontId(e) {
      e && (e = e.toLowerCase()),
        e !== this._apiStorefrontId &&
          ((this._apiStorefrontId = e),
          this._dispatcher.publish(kt.apiStorefrontChanged, {
            storefrontId: e,
          }));
    }
    get subscribeURL() {
      return this.storekit.deeplinkURL({ p: "subscribe" });
    }
    get subscribeFamilyURL() {
      return this.storekit.deeplinkURL({ p: "subscribe-family" });
    }
    get subscribeIndividualURL() {
      return this.storekit.deeplinkURL({ p: "subscribe-individual" });
    }
    get subscribeStudentURL() {
      return this.storekit.deeplinkURL({ p: "subscribe-student" });
    }
    get userToken() {
      return this.musicUserToken;
    }
    authorize() {
      var e = this;
      return _async_to_generator$H(function* () {
        if (e.storekit.userTokenIsValid) return e.storekit.userToken;
        let n;
        try {
          n = yield e.storekit.requestUserToken();
        } catch (q) {
          try {
            yield e.unauthorize();
          } catch (Yt) {}
          throw new MKError(MKError.Reason.AUTHORIZATION_ERROR, "Unauthorized");
        }
        return (
          e._providedRequestUserToken && (e.storekit.userToken = n),
          e.storekit.userTokenIsValid
            ? (yield e.storekit.requestStorefrontCountryCode().catch(
                (function () {
                  var n = _async_to_generator$H(function* (n) {
                    return yield e.unauthorize(), Promise.reject(n);
                  });
                  return function (e) {
                    return n.apply(this, arguments);
                  };
                })()
              ),
              n)
            : void 0
        );
      })();
    }
    shouldDisplayPrivacyLink(e) {
      var n = this;
      return _async_to_generator$H(function* () {
        return n.storekit.shouldDisplayPrivacyLink(e);
      })();
    }
    unauthorize() {
      var e = this;
      return _async_to_generator$H(function* () {
        return e.storekit.revokeUserToken();
      })();
    }
    constructor(n, d = {}) {
      _define_property$W(this, "precache", void 0),
        _define_property$W(this, "storekit", void 0),
        _define_property$W(this, "_apiStorefrontId", void 0),
        _define_property$W(this, "_defaultStorefrontCountryCode", void 0),
        _define_property$W(this, "_dispatcher", void 0),
        _define_property$W(this, "_hasAuthorized", !1),
        _define_property$W(this, "_metricsClientId", void 0),
        _define_property$W(this, "_providedRequestUserToken", !1),
        (this._dispatcher = d.services.dispatcher),
        "precache" in d && (this.precache = d.precache),
        d.storefrontId && (this.storefrontId = d.storefrontId),
        (this._defaultStorefrontCountryCode = d.storefrontCountryCode),
        ("affiliateToken" in d || "campaignToken" in d) &&
          (d.linkParameters = _object_spread_props$o(
            (function (e) {
              for (var n = 1; n < arguments.length; n++) {
                var d = null != arguments[n] ? arguments[n] : {},
                  p = Object.keys(d);
                "function" == typeof Object.getOwnPropertySymbols &&
                  (p = p.concat(
                    Object.getOwnPropertySymbols(d).filter(function (e) {
                      return Object.getOwnPropertyDescriptor(d, e).enumerable;
                    })
                  )),
                  p.forEach(function (n) {
                    _define_property$W(e, n, d[n]);
                  });
              }
              return e;
            })({}, d.linkParameters || {}),
            { at: d.affiliateToken, ct: d.campaignToken }
          )),
        (this.storekit = new StoreKit(n, {
          apiBase: $a.urls.mediaApi,
          authenticateMethod: $a.features["legacy-authenticate-method"]
            ? "POST"
            : "GET",
          deeplink: d.linkParameters,
          disableAuthBridge: d.disableAuthBridge,
          iconURL: $a.app.icon,
          meParameters: d.meParameters,
          persist: d.persist,
          realm: d.realm || e.SKRealm.MUSIC,
          disableLogoutURL: d.disableLogoutURL,
        })),
        this.storekit.addEventListener(ya.authorizationStatusDidChange, (e) => {
          const { authorizationStatus: n } = e;
          this._hasAuthorized = [xe.AUTHORIZED, xe.RESTRICTED].includes(n);
        });
    }
  }
  function formattedSeconds(e) {
    return {
      hours: Math.floor(e / 3600),
      minutes: Math.floor((e % 3600) / 60),
    };
  }
  function asyncGeneratorStep$G(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$G(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$G(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$G(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function hasAuthorization(e) {
    return (
      void 0 === e && (e = Ra && Ra.storekit),
      void 0 !== e && e.hasAuthorized && e.userTokenIsValid
    );
  }
  function hasMusicSubscription(e) {
    return _hasMusicSubscription.apply(this, arguments);
  }
  function _hasMusicSubscription() {
    return (_hasMusicSubscription = _async_to_generator$G(function* (e) {
      return void 0 === e && (e = Ra && Ra.storekit), e.hasMusicSubscription();
    })).apply(this, arguments);
  }
  function _define_property$V(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$l(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$l(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class MediaSessionManager {
    onCapabilitiesChanged() {
      this._resetHandlers(), this._setMediaSessionHandlers();
    }
    onNowPlayingItemDidChange(e, { item: n }) {
      this._setMediaSessionMetadata(n);
    }
    _setMediaSessionMetadata(e) {
      var n, d;
      this.session &&
        "MediaMetadata" in window &&
        e &&
        (this.session.metadata = new window.MediaMetadata({
          title: e.title,
          artist:
            null !== (d = e.artistName) && void 0 !== d
              ? d
              : null === (n = e.attributes) || void 0 === n
                ? void 0
                : n.showTitle,
          album: e.albumName,
          artwork: e.artwork
            ? [96, 128, 192, 256, 384, 512].map((n) => ({
                src: formatArtworkURL(e.artwork, n, n),
                sizes: `${n}x${n}`,
                type: "image/jpeg",
              }))
            : [],
        }));
    }
    _setMediaSessionHandlers() {
      this.session &&
        (this._resetHandlers(),
        this.session.setActionHandler("play", () => {
          var e;
          return null === (e = this.controller) || void 0 === e
            ? void 0
            : e.play();
        }),
        this.capabilities.canPause
          ? this.session.setActionHandler("pause", () => {
              var e;
              return null === (e = this.controller) || void 0 === e
                ? void 0
                : e.pause();
            })
          : this.session.setActionHandler("pause", () => {
              var e;
              return null === (e = this.controller) || void 0 === e
                ? void 0
                : e.stop();
            }),
        this.capabilities.canSeek &&
          (this.session.setActionHandler("seekforward", () => {
            var e;
            return null === (e = this.controller) || void 0 === e
              ? void 0
              : e.seekForward();
          }),
          this.session.setActionHandler("seekbackward", () => {
            var e;
            return null === (e = this.controller) || void 0 === e
              ? void 0
              : e.seekBackward();
          })),
        this.capabilities.canSkipToNextItem &&
          this.session.setActionHandler("nexttrack", () => {
            var e;
            return null === (e = this.controller) || void 0 === e
              ? void 0
              : e.skipToNextItem();
          }),
        this.capabilities.canSkipToPreviousItem &&
          this.session.setActionHandler("previoustrack", () => {
            var e;
            return null === (e = this.controller) || void 0 === e
              ? void 0
              : e.skipToPreviousItem();
          }));
    }
    _resetHandlers() {
      this.session &&
        (this.session.setActionHandler("play", void 0),
        this.session.setActionHandler("pause", void 0),
        this.session.setActionHandler("seekforward", void 0),
        this.session.setActionHandler("seekbackward", void 0),
        this.session.setActionHandler("nexttrack", void 0),
        this.session.setActionHandler("previoustrack", void 0));
    }
    constructor(e, n) {
      _define_property$V(this, "capabilities", void 0),
        _define_property$V(this, "dispatcher", void 0),
        _define_property$V(this, "controller", void 0),
        _define_property$V(this, "session", void 0),
        (this.capabilities = e),
        (this.dispatcher = n),
        (this.session = navigator.mediaSession),
        this.session &&
          (this.dispatcher.subscribe(
            ya.nowPlayingItemDidChange,
            this.onNowPlayingItemDidChange
          ),
          this.dispatcher.subscribe(
            ya.capabilitiesChanged,
            this.onCapabilitiesChanged
          ),
          this._setMediaSessionHandlers());
    }
  }
  function _define_property$U(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  var Aa;
  _ts_decorate$l(
    [
      Bind(),
      _ts_metadata$l("design:type", Function),
      _ts_metadata$l("design:paramtypes", []),
      _ts_metadata$l("design:returntype", void 0),
    ],
    MediaSessionManager.prototype,
    "onCapabilitiesChanged",
    null
  ),
    _ts_decorate$l(
      [
        Bind(),
        _ts_metadata$l("design:type", Function),
        _ts_metadata$l("design:paramtypes", [void 0, void 0]),
        _ts_metadata$l("design:returntype", void 0),
      ],
      MediaSessionManager.prototype,
      "onNowPlayingItemDidChange",
      null
    ),
    (function (e) {
      (e[(e.PAUSE = 0)] = "PAUSE"),
        (e[(e.EDIT_QUEUE = 1)] = "EDIT_QUEUE"),
        (e[(e.SEEK = 2)] = "SEEK"),
        (e[(e.REPEAT = 3)] = "REPEAT"),
        (e[(e.SHUFFLE = 4)] = "SHUFFLE"),
        (e[(e.SKIP_NEXT = 5)] = "SKIP_NEXT"),
        (e[(e.SKIP_PREVIOUS = 6)] = "SKIP_PREVIOUS"),
        (e[(e.SKIP_TO_ITEM = 7)] = "SKIP_TO_ITEM"),
        (e[(e.AUTOPLAY = 8)] = "AUTOPLAY"),
        (e[(e.VOLUME = 9)] = "VOLUME");
    })(Aa || (Aa = {}));
  class Capabilities {
    set controller(e) {
      this._mediaSession.controller = e;
    }
    updateChecker(e) {
      this._checkCapability !== e &&
        ((this._checkCapability = e),
        this._dispatcher.publish(ya.capabilitiesChanged));
    }
    get canEditPlaybackQueue() {
      return this._checkCapability(1);
    }
    get canPause() {
      return this._checkCapability(0);
    }
    get canSeek() {
      return this._checkCapability(2);
    }
    get canSetRepeatMode() {
      return this._checkCapability(3);
    }
    get canSetShuffleMode() {
      return this._checkCapability(4);
    }
    get canSkipToNextItem() {
      return this._checkCapability(5);
    }
    get canSkipToMediaItem() {
      return this._checkCapability(7);
    }
    get canSkipToPreviousItem() {
      return this._checkCapability(6);
    }
    get canAutoplay() {
      return this._checkCapability(8);
    }
    get canSetVolume() {
      return this._checkCapability(9);
    }
    constructor(e) {
      _define_property$U(this, "_dispatcher", void 0),
        _define_property$U(this, "_checkCapability", void 0),
        _define_property$U(this, "_mediaSession", void 0),
        (this._dispatcher = e),
        (this._checkCapability = (e) => 9 === e),
        (this._mediaSession = new MediaSessionManager(this, e));
    }
  }
  function _define_property$T(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function transform$8(e) {
    return (function (e) {
      for (var n = 1; n < arguments.length; n++) {
        var d = null != arguments[n] ? arguments[n] : {},
          p = Object.keys(d);
        "function" == typeof Object.getOwnPropertySymbols &&
          (p = p.concat(
            Object.getOwnPropertySymbols(d).filter(function (e) {
              return Object.getOwnPropertyDescriptor(d, e).enumerable;
            })
          )),
          p.forEach(function (n) {
            _define_property$T(e, n, d[n]);
          });
      }
      return e;
    })(
      { attributes: {} },
      transform$a(
        {
          id: "metadata.itemId",
          type: "metadata.itemType",
          "attributes.contentRating"() {
            var n;
            if (
              1 ===
              (null == e || null === (n = e.metadata) || void 0 === n
                ? void 0
                : n.isExplicit)
            )
              return "explicit";
          },
          "attributes.playParams"() {
            var n, d, p;
            return (
              0 !==
                (null == e || null === (n = e.metadata) || void 0 === n
                  ? void 0
                  : n.isPlayable) && {
                id:
                  null == e || null === (d = e.metadata) || void 0 === d
                    ? void 0
                    : d.itemId,
                kind:
                  null == e || null === (p = e.metadata) || void 0 === p
                    ? void 0
                    : p.itemType,
              }
            );
          },
          "container.id": "metadata.containerId",
          "container.name": "metadata.containerName",
          "container.type": "metadata.containerType",
        },
        e
      )
    );
  }
  function _define_property$S(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$x(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$S(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$n(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const Ca = {
    condition: () => !0,
    toOptions: (e, n, d) => [
      _object_spread_props$n(_object_spread$x({}, e), { context: d }),
    ],
  };
  function _define_property$R(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$w(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$R(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$m(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const Ma = {
      condition: (e) => {
        var n;
        return (
          "stations" === e.type &&
          (null === (n = e.attributes) || void 0 === n ? void 0 : n.isLive)
        );
      },
      toOptions: (e, n, d) => [
        _object_spread_props$m(_object_spread$w({}, e), {
          context: d,
          container: {
            attributes: e.attributes,
            id: e.id,
            type: e.type,
            name: null == d ? void 0 : d.featureName,
          },
        }),
      ],
    },
    hasRelationship = (e) => (n) => {
      var d, p;
      return !!(null === (p = n.relationships) ||
      void 0 === p ||
      null === (d = p[e]) ||
      void 0 === d
        ? void 0
        : d.data);
    },
    typeIs =
      (...e) =>
      ({ type: n }) =>
        e.includes(n),
    withBagPrefix = (e) => {
      if (void 0 === e || "" === e) return;
      const { prefix: n } = $a;
      return n ? `${n}:${e}` : e;
    };
  function _define_property$Q(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$l(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const getContainerName$1 = (e, n) => {
      var d, p;
      return null !==
        (p =
          null != n
            ? n
            : null == e || null === (d = e.container) || void 0 === d
              ? void 0
              : d.name) && void 0 !== p
        ? p
        : Ot.SONG;
    },
    Da = {
      toOptions: (e, n, d) => {
        const p = _object_spread_props$l(
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$Q(e, n, d[n]);
                });
            }
            return e;
          })({ id: e.id }, n),
          {
            name: withBagPrefix(
              getContainerName$1(e, null == d ? void 0 : d.featureName)
            ),
          }
        );
        return [
          {
            relationships: e.relationships,
            attributes: e.attributes,
            id: e.id,
            type: e.type,
            container: p,
            context: d,
          },
        ];
      },
      condition: typeIs("songs", "library-songs", "music-videos"),
    };
  function _define_property$P(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$u(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$P(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$k(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const parseAssets = ({ type: e, attributes: { assetTokens: n } }) =>
      e.includes("udio")
        ? ((e) => {
            if (void 0 === e) return;
            const [n] = Object.keys(e);
            return e[n];
          })(n)
        : ((e) => {
            if (void 0 === e) return;
            const n = Object.keys(e);
            return e[n[n.length - 1]];
          })(n),
    ja = {
      condition: typeIs(
        "uploaded-audios",
        "uploadedAudio",
        "uploaded-videos",
        "uploadedVideo"
      ),
      toOptions: (e, n, d) => {
        var p, h;
        const y = _object_spread_props$k(_object_spread$u({}, e), {
          context: d,
          attributes: _object_spread_props$k(
            _object_spread$u({}, e.attributes),
            {
              assetUrl: parseAssets(e),
              playParams:
                null !==
                  (h =
                    null == e || null === (p = e.attributes) || void 0 === p
                      ? void 0
                      : p.playParams) && void 0 !== h
                  ? h
                  : { id: e.id, kind: e.type },
            }
          ),
        });
        return (
          void 0 !== n && (y.container = n),
          void 0 !== (null == d ? void 0 : d.featureName) &&
            (y.container = _object_spread_props$k(
              _object_spread$u({}, y.container),
              { name: null == d ? void 0 : d.featureName }
            )),
          [y]
        );
      },
    };
  function _define_property$O(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$j(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const xa = {
    toOptions: (e, n, d) =>
      e.relationships.episodes.data.map((e) =>
        _object_spread_props$j(
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$O(e, n, d[n]);
                });
            }
            return e;
          })({}, e),
          { context: d }
        )
      ),
    condition: hasRelationship("episodes"),
    requiredRelationships: ["episodes"],
  };
  function asyncGeneratorStep$F(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$F(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$F(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$F(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$N(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$s(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$N(e, n, d[n]);
        });
    }
    return e;
  }
  function formatRatingsContentType(e, n) {
    return k(n) && E(n)
      ? e.replace(/^library-/, "")
      : k(n) && !/^library-/.test(e)
        ? "library-" + e
        : e;
  }
  function normalizeAdamId(e) {
    return e.replace(/^a\./, "");
  }
  function makeRequest(e, n, d) {
    return _makeRequest.apply(this, arguments);
  }
  function _makeRequest() {
    return (_makeRequest = _async_to_generator$F(function* (e, n, d, p = {}) {
      let h,
        y = n;
      const _ = d && d.ids;
      p = _object_spread$s({}, p);
      const {
        shouldCacheResults: m = !0,
        returnRawJSONApiRecords: g = !1,
        includePagination: b = e.defaultIncludePaginationMetadata,
        includeResponseMeta: P = !1,
      } = p;
      delete p.shouldCacheResults,
        delete p.returnRawJSONApiRecords,
        delete p.includePagination,
        delete p.includeResponseMeta,
        "string" == typeof _ &&
          ((y = `${n}/${encodeURIComponent(_)}`), d && delete d.ids);
      try {
        (b || P) && (p.useRawResponse = !0), (h = yield e.request(y, d, p));
      } catch (S) {
        return "status" in S
          ? 404 === S.status
            ? Promise.reject(
                new MKError(
                  MKError.Reason.CONTENT_UNAVAILABLE,
                  "The requested content is not available."
                )
              )
            : Promise.reject(MKError.responseError(S))
          : Promise.reject(MKError.internalError(S));
      }
      try {
        const n = h.results || h.data || h;
        if (
          ("object" == typeof h &&
            "results" in h &&
            "meta" in h &&
            (n.meta = h.meta),
          0 === n.length)
        )
          return Promise.reject(
            new MKError(
              MKError.Reason.CONTENT_UNAVAILABLE,
              "The requested content is not available."
            )
          );
        const y = g ? n : e.parseResultData(m, n);
        if (!b && !P) return y;
        if ("results" in h) {
          for (const n in h.results)
            "meta" !== n &&
              (y[n] = paginateResultSet(h.results[n], y[n], e, d, p));
          return y;
        }
        return paginateResultSet(h, y, e, d, p);
      } catch (q) {
        return Promise.reject(MKError.parseError(q));
      }
    })).apply(this, arguments);
  }
  function paginateResultSet(e, n, d, p, h = {}) {
    let y, _;
    h.includePagination = !0;
    const m = _object_spread$s({}, h);
    return (
      delete m.offset,
      e.next &&
        (y = () => makeRequest(d, formatPaginatedUrl(d.url, e.next), p, m)),
      e.previous &&
        (_ = () => makeRequest(d, formatPaginatedUrl(d.url, e.previous), p, m)),
      { data: n, next: y, previous: _, meta: e.meta }
    );
  }
  function mapRequestResult(e, n) {
    return "data" in e ? ((e.data = n(e.data)), e) : n(e);
  }
  function formatPaginatedUrl(e, n) {
    if ("function" != typeof URL)
      throw new Error("formatPaginatedUrl requires an implementation of URL");
    const { pathname: d } = new URL(e),
      p = new RegExp(`^${d}/`);
    return n.replace(p, "");
  }
  const getFeatureName = (e, n) => {
    if (n) return n;
    const d = (function (e = []) {
      return (
        0 !== e.length &&
        e.filter(
          ({ attributes: e }) =>
            !!e &&
            (e.workName ||
              e.movementName ||
              e.movementCount ||
              e.movementNumber)
        ).length > 0
      );
    })(e.relationships.tracks.data);
    return "albums" === e.type || "library-albums" === e.type
      ? d
        ? Ot.ALBUM_CLASSICAL
        : Ot.ALBUM
      : "playlists" === e.type || "library-playlists" === e.type
        ? d
          ? Ot.PLAYLIST_CLASSICAL
          : Ot.PLAYLIST
        : void 0;
  };
  function _define_property$M(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$r(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$M(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$i(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const La = [
      {
        toOptions: (e, n, d) => {
          const p = {
            attributes: e.attributes,
            id: e.id,
            type: e.type,
            name: withBagPrefix(
              getFeatureName(e, null == d ? void 0 : d.featureName)
            ),
          };
          return e.relationships.tracks.data.map((e) => ({
            attributes: e.attributes,
            id: e.id,
            type: e.type,
            container: p,
            context: d,
          }));
        },
        condition: hasRelationship("tracks"),
        requiredRelationships: ["tracks"],
      },
      xa,
      Da,
      Ma,
      ja,
      {
        condition: typeIs("music-movies"),
        toOptions: (e, n, d) => {
          var p, h;
          const y = _object_spread_props$i(_object_spread$r({}, e), {
            context: d,
            attributes: _object_spread_props$i(
              _object_spread$r({}, e.attributes),
              {
                playParams:
                  null !==
                    (h =
                      null == e || null === (p = e.attributes) || void 0 === p
                        ? void 0
                        : p.playParams) && void 0 !== h
                    ? h
                    : { id: e.id, kind: "musicMovie" },
                offers: void 0,
              }
            ),
          });
          return (
            void 0 !== n && (y.container = n),
            void 0 !== (null == d ? void 0 : d.featureName) &&
              (y.container = _object_spread_props$i(
                _object_spread$r({}, y.container),
                { name: null == d ? void 0 : d.featureName }
              )),
            [y]
          );
        },
      },
    ],
    Na = La.reduce((e, n) => {
      const d = n.requiredRelationships;
      return d && e.push(...d), e;
    }, []),
    Ua = new Set(Na),
    isArrayOf = (e, n) => Array.isArray(e) && (0 === e.length || n(e[0])),
    isMediaAPIResource = (e) => e && void 0 !== e.id && void 0 !== e.type,
    isMediaItem = (e) => e && void 0 !== e.id,
    isMPMediaItem = (e) =>
      e &&
      void 0 !== e.contentId &&
      void 0 !== e.metadata &&
      void 0 !== e.metadata.itemId &&
      void 0 !== e.metadata.itemType,
    isQueueItems = (e) => e && e.items && Array.isArray(e.items),
    isQueueLoaded = (e) => e && e.loaded,
    isQueueURLOption = (e) => e && e.url;
  function _define_property$L(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const Ba = Ze.linkChild(new Logger("queue")),
    descriptorToMediaItems = (e) => {
      if (!isQueueItems(e) && !isQueueLoaded(e)) return [];
      const n = isQueueLoaded(e)
        ? loadedDescriptorToMediaItem(e)
        : unloadedDescriptorToMediaItem(e);
      return (
        n.forEach(
          (n) =>
            (n.context = (function (e) {
              for (var n = 1; n < arguments.length; n++) {
                var d = null != arguments[n] ? arguments[n] : {},
                  p = Object.keys(d);
                "function" == typeof Object.getOwnPropertySymbols &&
                  (p = p.concat(
                    Object.getOwnPropertySymbols(d).filter(function (e) {
                      return Object.getOwnPropertyDescriptor(d, e).enumerable;
                    })
                  )),
                  p.forEach(function (n) {
                    _define_property$L(e, n, d[n]);
                  });
              }
              return e;
            })({}, e.context, n.context))
        ),
        n
      );
    },
    unloadedDescriptorToMediaItem = ({ items: e }) =>
      isArrayOf(e, isMPMediaItem)
        ? e.map((e) => new MediaItem(transform$8(e)))
        : isArrayOf(e, isMediaItem)
          ? e.map((e) => new MediaItem(e))
          : [],
    loadedDescriptorToMediaItem = (e) => {
      const n = [],
        { loaded: d, container: p, context: h } = e;
      return void 0 === d
        ? []
        : isArrayOf(d, isDataRecord)
          ? (d.forEach((e) => {
              n.push(...dataRecordToMediaItems(e, p, h));
            }),
            n)
          : isArrayOf(d, isMediaAPIResource)
            ? (d.forEach((e) => {
                n.push(...resourceToMediaItem(e, p, h));
              }),
              n)
            : isDataRecord(d)
              ? dataRecordToMediaItems(d, p, h)
              : isMediaAPIResource(d)
                ? resourceToMediaItem(d, p, h)
                : [];
    },
    dataRecordToMediaItems = (e, n, d = {}) => {
      const { data: p } = e.serialize(!0, void 0, {
        includeRelationships: Ua,
        allowFullDuplicateSerializations: !0,
      });
      return resourceToMediaItem(p, n, d);
    },
    resourceToMediaItem = (e, n, d = {}) => (
      Ba.debug("_resourceToMediaItem", e),
      ((e, n, d = {}) => {
        var p, h, y;
        n =
          null !==
            (h =
              null == n || null === (p = n.serialize) || void 0 === p
                ? void 0
                : p.call(n).data) && void 0 !== h
            ? h
            : n;
        return (
          null !== (y = La.find((p) => p.condition(e, n, d))) && void 0 !== y
            ? y
            : Ca
        )
          .toOptions(e, n, d)
          .map((e) => new MediaItem(e));
      })(e, n, d)
    );
  function _define_property$K(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  class BaseModifiableQueue {
    append(e) {
      Ye.warn("Append is not supported for this type of playback");
    }
    clear() {
      Ye.warn("Clear is not supported for this type of playback");
    }
    insertAt(e, n) {
      Ye.warn("InsertAt is not supported for this type of playback");
    }
    prepend(e, n = !1) {
      Ye.warn("Prepend is not supported for this type of playback");
    }
    constructor() {
      _define_property$K(this, "queue", void 0),
        _define_property$K(this, "canModifyQueue", !1);
    }
  }
  class ModifiableQueue {
    append(e) {
      const n = descriptorToMediaItems(e);
      this.queue.splice(this.queue.appendTargetIndex, 0, n);
    }
    clear() {
      this.queue.length &&
        (this.queue.splice(0, this.queue.length), this.queue.reset());
    }
    insertAt(e, n) {
      const d = descriptorToMediaItems(n);
      this.queue.splice(e, 0, d);
    }
    prepend(e, n = !1) {
      const d = descriptorToMediaItems(e),
        p = this.queue.position + 1;
      n && this.queue.splice(p, this.queue.length), this.queue.splice(p, 0, d);
    }
    constructor(e, n) {
      _define_property$K(this, "queue", void 0),
        _define_property$K(this, "canModifyQueue", !0),
        _define_property$K(this, "_mediaItemPlayback", void 0),
        (this.queue = e),
        (this._mediaItemPlayback = n);
    }
  }
  function _define_property$J(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  var Fa;
  (e.PlayerRepeatMode = void 0),
    ((Fa = e.PlayerRepeatMode || (e.PlayerRepeatMode = {}))[(Fa.none = 0)] =
      "none"),
    (Fa[(Fa.one = 1)] = "one"),
    (Fa[(Fa.all = 2)] = "all");
  class BaseRepeatable {
    get repeatMode() {
      return 0;
    }
    set repeatMode(e) {
      e !== this.repeatMode &&
        Ye.warn("setting repeatMode is not supported in this playback method");
    }
    constructor() {
      _define_property$J(this, "canSetRepeatMode", !1);
    }
  }
  class Repeatable {
    get repeatMode() {
      return this._repeatMode;
    }
    set repeatMode(n) {
      n in e.PlayerRepeatMode &&
        n !== this._repeatMode &&
        ((this._repeatMode = n),
        this.dispatcher.publish(ya.repeatModeDidChange, this._repeatMode));
    }
    constructor(e, n = 0) {
      _define_property$J(this, "canSetRepeatMode", !0),
        _define_property$J(this, "dispatcher", void 0),
        _define_property$J(this, "_repeatMode", void 0),
        (this.dispatcher = e),
        (this._repeatMode = n);
    }
  }
  function _define_property$I(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function asyncGeneratorStep$E(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$E(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$E(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$E(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$H(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  !(function (e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$I(e, n, d[n]);
        });
    }
  })({}, { NEXT_ITEM: "NEXT" }, e.PlayActivityEndReasonType);
  const Ka = [
      "EditorialVideoClip",
      "uploaded-videos",
      "uploadedVideo",
      "musicVideo",
    ],
    Ga = (function () {
      var e = _async_to_generator$E(function* () {});
      return function () {
        return e.apply(this, arguments);
      };
    })();
  class BaseSeekable {
    getSeekSeconds(e) {
      return { BACK: 0, FORWARD: 0 };
    }
    seekBackward(e = Ga) {
      Ye.warn("seekBackward is not supported in this playback method");
    }
    seekForward(e = Ga) {
      Ye.warn("seekForward is not supported in this playback method");
    }
    seekToTime(e, n) {
      return _async_to_generator$E(function* () {
        Ye.warn("seekToTime is not supported in this playback method");
      })();
    }
    constructor(e) {
      _define_property$H(this, "mediaItemPlayback", void 0),
        _define_property$H(this, "canSeek", void 0),
        (this.mediaItemPlayback = e),
        (this.canSeek = !1);
    }
  }
  class Seekable {
    getSeekSeconds(e) {
      return ((e) =>
        (null == e ? void 0 : e.isUTS) ||
        Ka.includes(null == e ? void 0 : e.type)
          ? { FORWARD: 10, BACK: 10 }
          : (null == e ? void 0 : e.isAOD)
            ? { FORWARD: 30, BACK: 30 }
            : { FORWARD: 30, BACK: 15 })(e);
    }
    seekBackward(e = this._seekToBeginning) {
      var n = this;
      return _async_to_generator$E(function* () {
        if (void 0 === n.mediaItemPlayback.nowPlayingItem)
          return void Ye.warn(
            "Cannot seekBackward when nowPlayingItem is not yet set."
          );
        const d =
          n.mediaItemPlayback.currentPlaybackTime -
          n.getSeekSeconds(n.mediaItemPlayback.nowPlayingItem).BACK;
        d < 0 ? yield e.call(n) : yield n.seekToTime(d, Rt.Interval);
      })();
    }
    seekForward(e = this._seekToEnd) {
      var n = this;
      return _async_to_generator$E(function* () {
        if (void 0 === n.mediaItemPlayback.nowPlayingItem)
          return void Ye.warn(
            "Cannot seekForward when nowPlayingItem is not yet set."
          );
        const d =
          n.mediaItemPlayback.currentPlaybackTime +
          n.getSeekSeconds(n.mediaItemPlayback.nowPlayingItem).FORWARD;
        d > n.mediaItemPlayback.currentPlaybackDuration
          ? yield e.call(n)
          : yield n.seekToTime(d, Rt.Interval);
      })();
    }
    seekToTime(e, n = Rt.Manual) {
      var d = this;
      return _async_to_generator$E(function* () {
        if (void 0 === d.mediaItemPlayback.nowPlayingItem)
          return void Ye.warn(
            "Cannot seekToTime when nowPlayingItem is not yet set."
          );
        const p = d.mediaItemPlayback.nowPlayingItem,
          h = d.mediaItemPlayback.currentPlaybackTime,
          y = d.mediaItemPlayback.currentPlayingDate,
          _ = Math.min(
            Math.max(0, e),
            d.mediaItemPlayback.currentPlaybackDuration
          );
        let m;
        if (p.isLinearStream && void 0 !== y) {
          const e = 1e3 * (_ - h);
          m = new Date(y.getTime() + e);
        }
        yield d.mediaItemPlayback.seekToTime(_, n),
          d._dispatcher.publish(kt.playbackSeek, {
            item: p,
            startPosition: h,
            position: _,
            playingDate: m,
            startPlayingDate: y,
            seekReasonType: n,
          });
      })();
    }
    _seekToBeginning() {
      var e = this;
      return _async_to_generator$E(function* () {
        yield e.seekToTime(0, Rt.Interval);
      })();
    }
    _seekToEnd() {
      var e = this;
      return _async_to_generator$E(function* () {
        yield e.seekToTime(
          e.mediaItemPlayback.currentPlaybackDuration,
          Rt.Interval
        );
      })();
    }
    constructor(e, n) {
      _define_property$H(this, "_dispatcher", void 0),
        _define_property$H(this, "mediaItemPlayback", void 0),
        _define_property$H(this, "canSeek", void 0),
        (this._dispatcher = e),
        (this.mediaItemPlayback = n),
        (this.canSeek = !0);
    }
  }
  const shuffleCollection = (e) => {
    const n = [...e],
      { length: d } = n;
    for (let p = 0; p < d; ++p) {
      const e = p + Math.floor(Math.random() * (d - p)),
        h = n[e];
      (n[e] = n[p]), (n[p] = h);
    }
    return n;
  };
  function _define_property$G(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_without_properties$1(e, n) {
    if (null == e) return {};
    var d,
      p,
      h = (function (e, n) {
        if (null == e) return {};
        var d,
          p,
          h = {},
          y = Object.keys(e);
        for (p = 0; p < y.length; p++)
          (d = y[p]), n.indexOf(d) >= 0 || (h[d] = e[d]);
        return h;
      })(e, n);
    if (Object.getOwnPropertySymbols) {
      var y = Object.getOwnPropertySymbols(e);
      for (p = 0; p < y.length; p++)
        (d = y[p]),
          n.indexOf(d) >= 0 ||
            (Object.prototype.propertyIsEnumerable.call(e, d) && (h[d] = e[d]));
    }
    return h;
  }
  const Va = Ze.createChild("queue");
  class QueueItem {
    restrict() {
      return this.item.restrict();
    }
    constructor(e, n) {
      var d;
      _define_property$G(this, "isAutoplay", !1),
        _define_property$G(this, "item", void 0),
        (this.item = e),
        (this.isAutoplay =
          null !== (d = null == n ? void 0 : n.isAutoplay) &&
          void 0 !== d &&
          d);
    }
  }
  function toQueueItems(e, n) {
    return e.map((e) => new QueueItem(e, n));
  }
  function toMediaItems(e) {
    return e.map((e) => e.item);
  }
  const parseQueueURLOption = (e) => {
      if (!isQueueURLOption(e)) return e;
      const { url: n } = e,
        d = _object_without_properties$1(e, ["url"]),
        { contentId: p, kind: h, storefrontId: y } = formattedMediaURL(n);
      return (
        h && (d[h] = p),
        y && (Ra.storefrontId = y),
        Va.debug("parseQueueURLOption", d),
        d
      );
    },
    { queueItemsDidChange: qa, queuePositionDidChange: Ha } = ya;
  class Queue {
    get isEmpty() {
      return 0 === this.length;
    }
    set isRestricted(e) {
      (this._isRestricted = e),
        this._isRestricted &&
          !this.isEmpty &&
          (this.removeQueueItems((e) => e.item.isExplicitItem),
          this.isEmpty &&
            this._dispatcher.publish(
              ya.mediaPlaybackError,
              new MKError(
                MKError.Reason.CONTENT_RESTRICTED,
                "Content restricted"
              )
            ));
    }
    get isRestricted() {
      return this._isRestricted;
    }
    get appendTargetIndex() {
      let e = this.length;
      const n = this._queueItems.findIndex((e) => e.isAutoplay);
      return -1 !== n && this.position < n && (e = n), e;
    }
    get items() {
      return toMediaItems(this._queueItems);
    }
    get autoplayItems() {
      return toMediaItems(this._queueItems.filter((e) => e.isAutoplay));
    }
    get unplayedAutoplayItems() {
      return toMediaItems(this._unplayedQueueItems.filter((e) => e.isAutoplay));
    }
    get userAddedItems() {
      return toMediaItems(this._queueItems.filter((e) => !e.isAutoplay));
    }
    get unplayedUserItems() {
      return toMediaItems(
        this._unplayedQueueItems.filter((e) => !e.isAutoplay)
      );
    }
    get playableItems() {
      return toMediaItems(
        this._queueItems.filter((e) => canPlay(e.item, this.playbackMode))
      );
    }
    get unplayedPlayableItems() {
      return toMediaItems(
        this._unplayedQueueItems.filter((e) =>
          canPlay(e.item, this.playbackMode)
        )
      );
    }
    get length() {
      return this._queueItems.length;
    }
    get nextPlayableItem() {
      if (-1 !== this.nextPlayableItemIndex)
        return this.item(this.nextPlayableItemIndex);
    }
    get nextPlayableItemIndex() {
      return (
        (this._nextPlayableItemIndex = this.findPlayableIndexForward()),
        this._nextPlayableItemIndex
      );
    }
    get position() {
      return this._position;
    }
    set position(e) {
      this._updatePosition(e);
    }
    get isInitiated() {
      return this.position >= 0;
    }
    get previousPlayableItem() {
      if (-1 !== this.previousPlayableItemIndex)
        return this.item(this.previousPlayableItemIndex);
    }
    get previousPlayableItemIndex() {
      return this.findPlayableIndexBackward();
    }
    removeQueueItems(e) {
      for (let n = this.length - 1; n >= 0; n--)
        e(this.queueItem(n), n) && this.spliceQueueItems(n, 1);
    }
    indexForItem(e) {
      return ("string" == typeof e ? this._itemIDs : this.items).indexOf(e);
    }
    item(e) {
      var n;
      return null === (n = this.queueItem(e)) || void 0 === n ? void 0 : n.item;
    }
    get currentItem() {
      return this.item(this.position);
    }
    queueItem(e) {
      var n;
      return null === (n = this._queueItems) || void 0 === n ? void 0 : n[e];
    }
    updateItems(e) {
      (this._queueItems = toQueueItems(e)),
        this._reindex(),
        this._dispatcher.publish(ya.queueItemsDidChange, this.items);
    }
    get currentQueueItem() {
      return this.queueItem(this.position);
    }
    remove(e) {
      if (
        (deprecationWarning("remove", {
          message: "The queue remove function has been deprecated",
        }),
        e === this.position)
      )
        throw new MKError(MKError.Reason.INVALID_ARGUMENTS);
      this.splice(e, 1);
    }
    append(e = []) {
      return this.appendQueueItems(toQueueItems(e));
    }
    appendQueueItems(e = []) {
      return this.spliceQueueItems(this.appendTargetIndex, 0, e);
    }
    splice(e, n, d = []) {
      return toMediaItems(this.spliceQueueItems(e, n, toQueueItems(d)));
    }
    spliceQueueItems(e, n, d = [], p = !0) {
      d = d.filter((e) =>
        isPlayable(null == e ? void 0 : e.item, this.playbackMode)
      );
      const h = this._queueItems.splice(e, n, ...d);
      return (
        this._itemIDs.splice(e, n, ...d.map((e) => e.item.id)),
        p &&
          (this._dispatcher.publish(kt.queueModified, {
            start: e,
            added: toMediaItems(d),
            removed: toMediaItems(h),
          }),
          this._dispatcher.publish(qa, this.items)),
        h
      );
    }
    reset() {
      const e = this.position;
      (this._position = -1),
        this._dispatcher.publish(Ha, {
          oldPosition: e,
          position: this.position,
        });
    }
    _isSameItems(e) {
      if (e.length !== this.length) return !1;
      const n = e.map((e) => e.id).sort(),
        d = [...this._itemIDs].sort();
      let p, h;
      try {
        (p = JSON.stringify(n)), (h = JSON.stringify(d));
      } catch (Yt) {
        return !1;
      }
      return p === h;
    }
    _reindex() {
      this._queueItems &&
        (this._itemIDs = this._queueItems.map((e) => e.item.id));
    }
    _updatePosition(e) {
      if (e === this._position) return;
      const n = this._position;
      this._position = e;
      const d = this.item(e);
      (d && canPlay(d, this.playbackMode)) ||
        (this._position = this.findPlayableIndexForward(e)),
        this._position !== n &&
          this._dispatcher.publish(Ha, {
            oldPosition: n,
            position: this._position,
          });
    }
    findPlayableIndexForward(n = this.position) {
      var d;
      if (this.isEmpty) return -1;
      if (this.isInitiated && !indexInBounds([0, this.position], n)) return -1;
      const p =
        null === (d = this.repeatable) || void 0 === d ? void 0 : d.repeatMode;
      if (n < this.length)
        for (let e = n + 1; e < this.length; e++) {
          if (canPlay(this.item(e), this.playbackMode)) return e;
        }
      if (p === e.PlayerRepeatMode.all)
        for (let e = 0; e <= n; e++) {
          if (canPlay(this.item(e), this.playbackMode)) return e;
        }
      return -1;
    }
    findPlayableIndexBackward(n = this.position) {
      var d;
      if (this.isEmpty) return -1;
      if (!indexInBounds([0, this.position], n)) return -1;
      const p =
        null === (d = this.repeatable) || void 0 === d ? void 0 : d.repeatMode;
      if (n > 0)
        for (let e = n - 1; e >= 0; e--) {
          if (canPlay(this.item(e), this.playbackMode)) return e;
        }
      if (p === e.PlayerRepeatMode.all)
        for (let e = this.length - 1; e >= n; e--) {
          if (canPlay(this.item(e), this.playbackMode)) return e;
        }
      return -1;
    }
    get _unplayedQueueItems() {
      const e = this.position < 0 ? 0 : this.position;
      return this._queueItems.slice(e);
    }
    _getStartItemPosition(e) {
      if (void 0 === e) return -1;
      if (
        ("object" == typeof e && "id" in e && (e = e.id), "string" == typeof e)
      )
        return this.indexForItem(e);
      const n = parseInt("" + e, 10);
      return n >= 0 && n < this.length ? n : -1;
    }
    constructor(n) {
      if (
        (_define_property$G(this, "repeatable", void 0),
        _define_property$G(this, "hasAutoplayStation", !1),
        _define_property$G(this, "playbackMode", e.PlaybackMode.MIXED_CONTENT),
        _define_property$G(this, "_itemIDs", []),
        _define_property$G(this, "_queueItems", []),
        _define_property$G(this, "_isRestricted", !1),
        _define_property$G(this, "_nextPlayableItemIndex", -1),
        _define_property$G(this, "_position", -1),
        _define_property$G(this, "_dispatcher", void 0),
        (this._dispatcher = n.services.dispatcher),
        (this.playbackMode = n.playbackMode),
        !n.descriptor)
      )
        return;
      const d = descriptorToMediaItems(n.descriptor).filter((e) =>
        isPlayable(e, this.playbackMode)
      );
      (this._queueItems = toQueueItems(d)),
        this._reindex(),
        void 0 !== n.descriptor.startWith &&
          (this.position = this._getStartItemPosition(n.descriptor.startWith));
    }
  }
  function isPlayable(n, d) {
    return (
      n.isPlayable ||
      (d !== e.PlaybackMode.FULL_PLAYBACK_ONLY && void 0 !== n.previewURL)
    );
  }
  function canPlay(e, n) {
    return (
      isPlayable(e, n) &&
      !(function (e) {
        return e.isRestricted;
      })(e) &&
      !(function (e) {
        return e.isUnavailable;
      })(e)
    );
  }
  function indexInBounds(e, n) {
    return e[0] <= n && n <= e[1];
  }
  function _define_property$F(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$k(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  var Wa;
  (e.PlayerShuffleMode = void 0),
    ((Wa = e.PlayerShuffleMode || (e.PlayerShuffleMode = {}))[(Wa.off = 0)] =
      "off"),
    (Wa[(Wa.songs = 1)] = "songs");
  const Ya = "Shuffling is not supported in this playback method.";
  class BaseShuffler {
    set shuffle(e) {
      Ye.warn(Ya);
    }
    get shuffleMode() {
      return 0;
    }
    set shuffleMode(e) {
      Ye.warn(Ya);
    }
    checkAndReshuffle(e) {
      Ye.warn(Ya);
    }
    constructor() {
      _define_property$F(this, "canSetShuffleMode", !1),
        _define_property$F(this, "queue", void 0);
    }
  }
  class Shuffler {
    get queue() {
      return this._queue;
    }
    set queue(e) {
      (this._queue = e),
        (this._unshuffledIDs = e.userAddedItems.map((e) => e.id)),
        this.checkAndReshuffle(!1);
    }
    queueModifiedHandler(e, n) {
      if (this._isSpliceFromShuffle)
        return void (this._isSpliceFromShuffle = !1);
      const { start: d, added: p, removed: h } = n;
      if (h.length > 0) {
        const e = h.map((e) => e.id);
        this._unshuffledIDs = this._unshuffledIDs.filter((n) => !e.includes(n));
      }
      p.length > 0 && this._unshuffledIDs.splice(d, 0, ...p.map((e) => e.id));
    }
    set shuffle(e) {
      this.shuffleMode = e ? 1 : 0;
    }
    get shuffleMode() {
      return this.mode;
    }
    set shuffleMode(n) {
      n !== this.shuffleMode &&
        n in e.PlayerShuffleMode &&
        (Ye.debug(`mk: set shuffleMode from ${this.shuffleMode} to ${n}`),
        (this.mode = n),
        1 === this.mode ? this.shuffleQueue() : this.unshuffleQueue(),
        this.controller.nowPlayingItem &&
          (this._queue.position = this._queue.indexForItem(
            this.controller.nowPlayingItem.id
          )),
        this.dispatcher.publish(ya.shuffleModeDidChange, this.shuffleMode));
    }
    checkAndReshuffle(e = !1) {
      1 === this.shuffleMode && this.shuffleQueue(e);
    }
    shuffleQueue(e = !0) {
      const { userAddedItems: n } = this._queue;
      if (n.length <= 1) return n;
      const d = n.slice(0),
        p = this._queue.position > -1 ? d.splice(this._queue.position, 1) : [];
      let h = [];
      do {
        h = shuffleCollection(d);
      } while (d.length > 1 && arrayEquals(h, d));
      const y = [...p, ...h];
      (this._isSpliceFromShuffle = !0),
        this._queue.spliceQueueItems(0, y.length, toQueueItems(y), e);
    }
    unshuffleQueue(e = !0) {
      let n = [];
      const d = this._unshuffledIDs.reduce((e, n, d) => ((e[n] = d), e), {}),
        p = [];
      let h = 0;
      const y = this._queue.item(this._queue.position);
      this._queue.userAddedItems.forEach((e) => {
        const _ = d[e.id];
        void 0 === _ && p.push(e),
          (n[_] = e),
          e.id === (null == y ? void 0 : y.id) && (h = _);
      }),
        (n = n.filter(Boolean));
      const _ = n.concat(p);
      (this._isSpliceFromShuffle = !0),
        this._queue.spliceQueueItems(0, _.length, toQueueItems(_), e),
        (this._queue.position = h);
    }
    constructor(e, { dispatcher: n }) {
      _define_property$F(this, "controller", void 0),
        _define_property$F(this, "canSetShuffleMode", void 0),
        _define_property$F(this, "dispatcher", void 0),
        _define_property$F(this, "mode", void 0),
        _define_property$F(this, "_queue", void 0),
        _define_property$F(this, "_unshuffledIDs", void 0),
        _define_property$F(this, "_isSpliceFromShuffle", void 0),
        (this.controller = e),
        (this.canSetShuffleMode = !0),
        (this.mode = 0),
        (this._unshuffledIDs = []),
        (this._isSpliceFromShuffle = !1),
        (this.dispatcher = n),
        this.dispatcher.subscribe(kt.queueModified, this.queueModifiedHandler),
        (this._queue = e.queue);
    }
  }
  function asyncGeneratorStep$D(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$D(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$D(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$D(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$E(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$o(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$E(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$h(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_metadata$j(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  var za;
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$k("design:type", Function),
      _ts_metadata$k("design:paramtypes", [String, Object]),
      _ts_metadata$k("design:returntype", void 0),
    ],
    Shuffler.prototype,
    "queueModifiedHandler",
    null
  ),
    (function (e) {
      (e.continuous = "continuous"), (e.serial = "serial");
    })(za || (za = {}));
  const { queueItemsDidChange: Qa } = ya;
  class PlaybackController {
    get isDestroyed() {
      return this._isDestroyed;
    }
    updateAutoplay(e, n) {
      this.autoplayEnabled = n;
    }
    constructContext(e, n) {
      let d = e.context;
      var p;
      return (
        void 0 !== e.featureName &&
          void 0 === (null == d ? void 0 : d.featureName) &&
          (Ye.warn("featureName is deprecated, pass it inside context"),
          d || (d = {}),
          (d.featureName = e.featureName)),
        null !== (p = null != d ? d : n) && void 0 !== p ? p : {}
      );
    }
    get context() {
      return this._context;
    }
    get continuous() {
      return this._continuous || this.hasAuthorization;
    }
    set continuous(e) {
      this._continuous = e;
    }
    get autoplayEnabled() {
      return this._autoplayEnabled;
    }
    set autoplayEnabled(e) {
      this._autoplayEnabled = e;
    }
    get previewOnly() {
      return this._mediaItemPlayback.previewOnly;
    }
    get _dispatcher() {
      return this._services.dispatcher;
    }
    get hasAuthorization() {
      return hasAuthorization(this.storekit);
    }
    get isPlaying() {
      return this._mediaItemPlayback.isPlaying;
    }
    get isPrimaryPlayer() {
      return this._mediaItemPlayback.isPrimaryPlayer;
    }
    set isPrimaryPlayer(e) {
      this._mediaItemPlayback.isPrimaryPlayer = e;
    }
    get isReady() {
      return this._mediaItemPlayback.isReady;
    }
    get _mediaItemPlayback() {
      return this._services.mediaItemPlayback;
    }
    get nowPlayingItem() {
      return this._mediaItemPlayback.nowPlayingItem;
    }
    get nowPlayingItemIndex() {
      return this.queue ? this.queue.position : -1;
    }
    get playbackMode() {
      return this._playbackMode;
    }
    set playbackMode(e) {
      (this._playbackMode = e), this.queue && (this.queue.playbackMode = e);
    }
    get queue() {
      return this._queue;
    }
    set queue(e) {
      this._prepareQueue(e),
        (this._queue = e),
        (this._shuffler.queue = this._queue),
        (this._queueModifier.queue = this._queue),
        this._dispatcher.publish(Qa, e.items);
    }
    get repeatMode() {
      return this._repeatable.repeatMode;
    }
    set repeatMode(e) {
      this._repeatable.repeatMode = e;
    }
    get seekSeconds() {
      const { nowPlayingItem: e } = this;
      if (void 0 !== e) return this._seekable.getSeekSeconds(e);
    }
    set shuffle(e) {
      this._shuffler.shuffle = e;
    }
    get shuffleMode() {
      return this._shuffler.shuffleMode;
    }
    set shuffleMode(e) {
      this._shuffler.shuffleMode = e;
    }
    get storekit() {
      return this._storekit;
    }
    set storekit(n) {
      if (n) {
        var d = this;
        n.addEventListener(
          Ke.authorizationStatusWillChange,
          (function () {
            var n = _async_to_generator$D(function* ({
              authorizationStatus: n,
              newAuthorizationStatus: p,
            }) {
              n > xe.DENIED && p < xe.RESTRICTED
                ? yield d.stop({
                    endReasonType:
                      e.PlayActivityEndReasonType.PLAYBACK_SUSPENDED,
                    userInitiated: !1,
                  })
                : yield d.stop({ userInitiated: !1 });
            });
            return function (e) {
              return n.apply(this, arguments);
            };
          })()
        ),
          (this._storekit = n);
      }
    }
    append(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        const d = yield n._dataForQueueOptions(e);
        return n._queueModifier.append(d), n.queue;
      })();
    }
    insertAt(e, n) {
      var d = this;
      return _async_to_generator$D(function* () {
        const p = yield d._dataForQueueOptions(n);
        return d._queueModifier.insertAt(e, p), d.queue;
      })();
    }
    _dataForQueueOptions(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        const d = n.constructContext(e, n.context);
        return _object_spread_props$h(_object_spread$o({}, e), { context: d });
      })();
    }
    clear() {
      var e = this;
      return _async_to_generator$D(function* () {
        return e._queueModifier.clear(), e.queue;
      })();
    }
    changeToMediaAtIndex(e = 0) {
      var n = this;
      return _async_to_generator$D(function* () {
        var d, p, h;
        yield n.stop();
        const y =
            null === (d = n.queue.item(e)) || void 0 === d ? void 0 : d.id,
          _ =
            null === (h = n._mediaItemPlayback) ||
            void 0 === h ||
            null === (p = h.playOptions) ||
            void 0 === p
              ? void 0
              : p.get(y);
        let m = (null == _ ? void 0 : _.startTime) || 0;
        const g = yield n._changeToMediaAtIndex(e, { userInitiated: !0 });
        g &&
          (g.id !== y && (m = 0),
          n._dispatcher.publish(kt.playbackPlay, { item: g, position: m }));
      })();
    }
    changeToMediaItem(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        const d = n.queue.indexForItem(e);
        return -1 === d
          ? Promise.reject(new MKError(MKError.Reason.MEDIA_DESCRIPTOR))
          : n.changeToMediaAtIndex(d);
      })();
    }
    activate() {
      Ye.debug("mk: base controller - activate"),
        this._dispatcher.unsubscribe(
          ya.playbackStateDidChange,
          this.onPlaybackStateDidChange
        ),
        this._dispatcher.subscribe(
          ya.playbackStateDidChange,
          this.onPlaybackStateDidChange
        ),
        this._skipIntro.activate(),
        this._upNext.activate(),
        this._rollMonitor.activate();
    }
    deactivate() {
      var e = this;
      return _async_to_generator$D(function* () {
        yield e.stop(),
          e._dispatcher.unsubscribe(
            ya.playbackStateDidChange,
            e.onPlaybackStateDidChange
          ),
          e._skipIntro.deactivate(),
          e._upNext.deactivate(),
          e._rollMonitor.deactivate();
      })();
    }
    destroy() {
      var e = this;
      return _async_to_generator$D(function* () {
        (e._isDestroyed = !0),
          yield e.deactivate(),
          e._dispatcher.unsubscribe(
            ya.autoplayEnabledDidChange,
            e.updateAutoplay
          );
      })();
    }
    hasCapabilities(e) {
      switch (e) {
        case Aa.SEEK:
          return this._seekable.canSeek;
        case Aa.REPEAT:
          return this._repeatable.canSetRepeatMode;
        case Aa.SHUFFLE:
          return this._shuffler.canSetShuffleMode;
        case Aa.EDIT_QUEUE:
          return this._queueModifier.canModifyQueue;
        case Aa.PAUSE:
        case Aa.SKIP_NEXT:
        case Aa.SKIP_TO_ITEM:
        case Aa.AUTOPLAY:
        case Aa.VOLUME:
          return !0;
        case Aa.SKIP_PREVIOUS:
        default:
          return !1;
      }
    }
    pause(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        return n._mediaItemPlayback.pause(e);
      })();
    }
    play() {
      var e = this;
      return _async_to_generator$D(function* () {
        if (e.nowPlayingItem) return e._mediaItemPlayback.play();
        if (!e._queue || e._queue.isEmpty) return;
        if (e.nowPlayingItemIndex >= 0)
          return e.changeToMediaAtIndex(e.nowPlayingItemIndex);
        const { queue: n } = e;
        return -1 !== n.nextPlayableItemIndex
          ? e.changeToMediaAtIndex(n.nextPlayableItemIndex)
          : void 0;
      })();
    }
    playSingleMediaItem(e, n) {
      var d = this;
      return _async_to_generator$D(function* () {
        yield ka(e, n), d._dispatcher.publish(ya.queueItemsDidChange, [e]);
        const p = yield d._mediaItemPlayback.startMediaItemPlayback(e, !0);
        if (p) {
          var h;
          const e = {
            item: p,
            position:
              null !== (h = d._mediaItemPlayback.currentPlaybackTime) &&
              void 0 !== h
                ? h
                : 0,
            playingDate: d._mediaItemPlayback.currentPlayingDate,
            userInitiated: !0,
          };
          Ye.debug(
            "playSingleMediaItem: Dispatching DispatchTypes.playbackPlay event",
            e
          ),
            d._dispatcher.publish(kt.playbackPlay, e);
        }
      })();
    }
    onPlaybackStateDidChange(n, d) {
      var p = this;
      return _async_to_generator$D(function* () {
        d.state === e.PlaybackStates.ended &&
          (p.continuous || p.repeatMode === e.PlayerRepeatMode.one) &&
          (Ye.debug(
            "controller detected track ended event, moving to next item."
          ),
          p._dispatcher.publish(kt.applicationActivityIntent, {
            endReasonType: e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
            userInitiated: !1,
          }),
          yield p._next());
      })();
    }
    preload() {
      var e = this;
      return _async_to_generator$D(function* () {
        return e._mediaItemPlayback.preload();
      })();
    }
    prepend(e, n) {
      var d = this;
      return _async_to_generator$D(function* () {
        const p = yield d._dataForQueueOptions(e);
        return d._queueModifier.prepend(p, n), d.queue;
      })();
    }
    prepareToPlay(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        return n._mediaItemPlayback.prepareToPlay(e);
      })();
    }
    showPlaybackTargetPicker() {
      this._mediaItemPlayback.showPlaybackTargetPicker();
    }
    seekBackward() {
      var e = this;
      return _async_to_generator$D(function* () {
        return e._seekable.seekBackward();
      })();
    }
    seekForward() {
      var e = this;
      return _async_to_generator$D(function* () {
        return e._seekable.seekForward(e.skipToNextItem.bind(e));
      })();
    }
    skipToNextItem() {
      var e = this;
      return _async_to_generator$D(function* () {
        return e._next({ userInitiated: !0 });
      })();
    }
    skipToPreviousItem() {
      var e = this;
      return _async_to_generator$D(function* () {
        return e._previous({ userInitiated: !0 });
      })();
    }
    getNewSeeker() {
      return this._mediaItemPlayback.getNewSeeker();
    }
    seekToTime(e, n) {
      var d = this;
      return _async_to_generator$D(function* () {
        yield d._seekable.seekToTime(e, n);
      })();
    }
    setQueue(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        return (
          yield n.extractGlobalValues(e),
          yield n._mediaItemPlayback.stop(),
          n.returnQueueForOptions(e)
        );
      })();
    }
    extractGlobalValues(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        (n._context = n.constructContext(e)),
          void 0 !== e.featureName &&
            e.context &&
            (Ye.warn("featureName is deprecated, pass it inside context"),
            (e.context.featureName = e.featureName));
      })();
    }
    stop(e) {
      var n = this;
      return _async_to_generator$D(function* () {
        yield n._mediaItemPlayback.stop(e);
      })();
    }
    _changeToMediaAtIndex(e = 0, n = {}) {
      var d = this;
      return _async_to_generator$D(function* () {
        if (d.queue.isEmpty) return;
        d.queue.position = e;
        const p = d.queue.item(d.queue.position);
        if (!p) return;
        var h;
        const y = yield d._mediaItemPlayback.startMediaItemPlayback(
          p,
          null !== (h = n.userInitiated) && void 0 !== h && h
        );
        if (y || p.state !== x.unsupported) return y;
        yield d.skipToNextItem();
      })();
    }
    _next(n = {}) {
      var d = this;
      return _async_to_generator$D(function* () {
        if (d.queue.isEmpty) return;
        const { userInitiated: p = !1 } = n;
        return d.repeatMode === e.PlayerRepeatMode.one &&
          void 0 !== d.queue.currentItem
          ? (yield d.stop(_object_spread$o({ userInitiated: p }, n)),
            void (yield d.play()))
          : (!p &&
              n.seamlessAudioTransition &&
              (d._dispatcher.publish(
                kt.playbackStop,
                _object_spread$o(
                  {
                    userInitiated: p,
                    endReasonType:
                      e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK,
                  },
                  n
                )
              ),
              (n = {
                userInitiated: n.userInitiated,
                seamlessAudioTransition: !0,
              })),
            d._nextAtIndex(d.queue.nextPlayableItemIndex, n));
      })();
    }
    _nextAtIndex(n, d = {}) {
      var p = this;
      return _async_to_generator$D(function* () {
        if (p.queue.isEmpty) return;
        const { _mediaItemPlayback: h } = p;
        var y;
        const _ = null !== (y = d.userInitiated) && void 0 !== y && y;
        if (n < 0)
          return (
            Ye.debug(
              "controller/index._next no next item available, stopping playback"
            ),
            yield p.stop({
              userInitiated: _,
              seamlessAudioTransition: d.seamlessAudioTransition,
            }),
            void (h.playbackState = e.PlaybackStates.completed)
          );
        const m = p.isPlaying,
          g = h.currentPlaybackTime,
          b = yield p._changeToMediaAtIndex(n, { userInitiated: _ });
        var P;
        return (
          p._notifySkip(m, b, {
            userInitiated: _,
            seamlessAudioTransition:
              null !== (P = d.seamlessAudioTransition) && void 0 !== P && P,
            position: g,
            direction: e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
          }),
          b
        );
      })();
    }
    _previous(n = {}) {
      var d = this;
      return _async_to_generator$D(function* () {
        if (d.queue.isEmpty) return;
        const { userInitiated: p = !1 } = n;
        if (
          d.repeatMode === e.PlayerRepeatMode.one &&
          void 0 !== d.queue.currentItem
        )
          return (
            yield d.stop({
              endReasonType:
                e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,
              userInitiated: p,
            }),
            void (yield d.play())
          );
        const h = d.queue.previousPlayableItemIndex;
        if (
          p &&
          d.repeatMode === e.PlayerRepeatMode.none &&
          void 0 !== d.nowPlayingItem &&
          -1 === h
        )
          return (
            yield d.stop({
              endReasonType:
                e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,
              userInitiated: !0,
            }),
            void (yield d.play())
          );
        if (-1 === h) return;
        const y = d.isPlaying,
          _ = d._mediaItemPlayback.currentPlaybackTime,
          m = yield d._changeToMediaAtIndex(h, { userInitiated: p });
        return (
          d._notifySkip(y, m, {
            userInitiated: p,
            seamlessAudioTransition: !1,
            direction: e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,
            position: _,
          }),
          m
        );
      })();
    }
    _notifySkip(n, d, p) {
      const {
          userInitiated: h,
          direction: y,
          position: _,
          seamlessAudioTransition: m = !1,
        } = p,
        g = this._dispatcher;
      m
        ? (Ye.debug("seamlessAudioTransition transition, PAF play"),
          g.publish(kt.playbackPlay, {
            item: d,
            position: 0,
            endReasonType: e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK,
          }))
        : n
          ? d
            ? g.publish(kt.playbackSkip, {
                item: d,
                userInitiated: h,
                direction: y,
                position: _,
              })
            : g.publish(kt.playbackStop, {
                item: d,
                userInitiated: h,
                position: _,
              })
          : d &&
            g.publish(
              kt.playbackPlay,
              _object_spread$o(
                { item: d, position: 0 },
                h
                  ? {
                      endReasonType:
                        e.PlayActivityEndReasonType
                          .MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM,
                    }
                  : {}
              )
            );
    }
    _prepareQueue(e) {
      Ye.debug("mk: _prepareQueue"),
        this.hasAuthorization &&
          (e.isRestricted = this.storekit.restrictedEnabled || !1),
        (e.repeatable = this._repeatable);
    }
    constructor(e) {
      var n;
      _define_property$E(this, "_context", {}),
        _define_property$E(this, "_continuous", void 0),
        _define_property$E(this, "_autoplayEnabled", void 0),
        _define_property$E(this, "_playerOptions", void 0),
        _define_property$E(this, "_queue", void 0),
        _define_property$E(this, "_storekit", void 0),
        _define_property$E(this, "_queueModifier", void 0),
        _define_property$E(this, "_repeatable", void 0),
        _define_property$E(this, "_shuffler", void 0),
        _define_property$E(this, "_seekable", void 0),
        _define_property$E(this, "_services", void 0),
        _define_property$E(this, "_rollMonitor", void 0),
        _define_property$E(this, "_skipIntro", void 0),
        _define_property$E(this, "_upNext", void 0),
        _define_property$E(this, "_playbackMode", void 0),
        _define_property$E(this, "_isDestroyed", !0),
        (this.onPlaybackStateDidChange =
          this.onPlaybackStateDidChange.bind(this)),
        (this._autoplayEnabled =
          null !== (n = null == e ? void 0 : e.autoplayEnabled) &&
          void 0 !== n &&
          n),
        (this._services = e.services),
        (this._playerOptions = e),
        (this.storekit = e.storekit),
        (this._skipIntro = new SkipAvailable({
          controller: this,
          services: e.services,
        })),
        (this._upNext = new UpNextMonitor({
          controller: this,
          services: e.services,
        })),
        (this._rollMonitor = new RollMonitor({
          controller: this,
          services: e.services,
        })),
        (this._queueModifier = new BaseModifiableQueue()),
        (this._shuffler = new BaseShuffler()),
        (this._seekable = new BaseSeekable(this._mediaItemPlayback)),
        (this._repeatable = new BaseRepeatable()),
        this._dispatcher.subscribe(
          ya.autoplayEnabledDidChange,
          this.updateAutoplay
        ),
        (this._playbackMode = e.playbackMode);
    }
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$j("design:type", Function),
      _ts_metadata$j("design:paramtypes", [String, Boolean]),
      _ts_metadata$j("design:returntype", void 0),
    ],
    PlaybackController.prototype,
    "updateAutoplay",
    null
  );
  function rejectOnLast() {
    return Promise.reject(
      "The last middleware in the stack should not call next"
    );
  }
  function processMiddleware(e, ...n) {
    return e.length
      ? (function createNextFunction([e, ...n]) {
          return (...d) => e(createNextFunction(n), ...d);
        })([...e, rejectOnLast])(...n)
      : Promise.reject(
          "processMiddleware requires at mimimum one middleware function"
        );
  }
  function parameterizeString(e, n) {
    return (function (e) {
      try {
        return (function recursiveTokenizeParameterizedString(e, n = []) {
          if (e.startsWith("{{")) {
            const d = e.indexOf("}}");
            if (-1 === d) throw new Error("UNCLOSED_PARAMETER");
            const p = { type: 1, value: e.slice(2, d) };
            return d + 2 < e.length
              ? recursiveTokenizeParameterizedString(e.slice(d + 2), [...n, p])
              : [...n, p];
          }
          {
            const d = e.indexOf("{{");
            return -1 === d
              ? [...n, { type: 0, value: e }]
              : recursiveTokenizeParameterizedString(e.slice(d), [
                  ...n,
                  { type: 0, value: e.slice(0, d) },
                ]);
          }
        })(e);
      } catch (q) {
        if ("UNCLOSED_PARAMETER" === q.message)
          throw new Error(`Unclosed parameter in path: "${e}"`);
        throw q;
      }
    })(e)
      .map((e) => {
        switch (e.type) {
          case 1:
            return e.value in n
              ? encodeURIComponent("" + n[e.value])
              : `{{${e.value}}}`;
          case 0:
          default:
            return e.value;
        }
      })
      .join("");
  }
  var Ja;
  function _define_property$D(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$g(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function constructUrlMiddleware(e, n) {
    let d = n.url;
    return (
      d || (d = joinURLPath(n.baseUrl, n.path)),
      n.urlParameters && (d = parameterizeString(d, n.urlParameters)),
      n.queryParameters && (d = addQueryParamsToURL(d, n.queryParameters)),
      e(
        _object_spread_props$g(
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$D(e, n, d[n]);
                });
            }
            return e;
          })({}, n),
          { url: d }
        )
      )
    );
  }
  function asyncGeneratorStep$C(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$C(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$C(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$C(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function unwrapJSONFromResponse(e) {
    return _unwrapJSONFromResponse.apply(this, arguments);
  }
  function _unwrapJSONFromResponse() {
    return (_unwrapJSONFromResponse = _async_to_generator$C(function* (e) {
      try {
        return yield e.json();
      } catch (q) {
        return;
      }
    })).apply(this, arguments);
  }
  function fetchMiddlewareFactory(e) {
    return (
      (n = _async_to_generator$C(function* (n, d) {
        const p = yield e(d.url, d.fetchOptions),
          h = {
            request: d,
            response: p,
            data: yield unwrapJSONFromResponse(p),
          };
        if (!p.ok) throw MKError.responseError(p);
        return h;
      })),
      function (e, d) {
        return n.apply(this, arguments);
      }
    );
    var n;
  }
  !(function (e) {
    (e[(e.Static = 0)] = "Static"), (e[(e.Parameter = 1)] = "Parameter");
  })(Ja || (Ja = {}));
  const Xa = fetchMiddlewareFactory(
    "undefined" != typeof fetch
      ? fetch
      : () => {
          throw new Error("window.fetch is not defined");
        }
  );
  function _define_property$C(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$m(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$C(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$f(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  var Za;
  !(function (e) {
    (e.Replace = "REPLACE"), (e.Merge = "MERGE");
  })(Za || (Za = {}));
  const eo = ["url"];
  class APISession {
    get config() {
      return this._config;
    }
    request(e, n = {}, d = {}) {
      var p;
      return processMiddleware(
        this.middlewareStack,
        _object_spread_props$f(
          _object_spread$m({}, this.config.defaultOptions, d),
          {
            baseUrl: this.config.url,
            path: e,
            fetchOptions: mergeFetchOptions(
              null === (p = this.config.defaultOptions) || void 0 === p
                ? void 0
                : p.fetchOptions,
              d.fetchOptions
            ),
            queryParameters: _object_spread$m(
              {},
              this.config.defaultQueryParameters,
              n
            ),
            urlParameters: _object_spread$m(
              {},
              this.config.defaultUrlParameters,
              d.urlParameters
            ),
          }
        )
      );
    }
    reconfigure(e, n = "REPLACE") {
      "MERGE" === n && (e = deepmerge(this.config, e)),
        eo.forEach((n) => {
          if (void 0 === e[n])
            throw new Error(
              `Session requires a valid SessionConfig, missing "${n}"`
            );
        }),
        (this._config = e),
        (this.middlewareStack = this.createMiddlewareStack());
    }
    createMiddlewareStack() {
      return Array.isArray(this.config.middleware)
        ? [
            constructUrlMiddleware,
            ...this.config.middleware,
            this.makeFetchMiddleware(),
          ]
        : [constructUrlMiddleware, this.makeFetchMiddleware()];
    }
    makeFetchMiddleware() {
      return "function" == typeof this.config.fetchFunction
        ? fetchMiddlewareFactory(this.config.fetchFunction)
        : Xa;
    }
    constructor(e) {
      _define_property$C(this, "_config", void 0),
        _define_property$C(this, "middlewareStack", void 0),
        this.reconfigure(e);
    }
  }
  function _object_without_properties(e, n) {
    if (null == e) return {};
    var d,
      p,
      h = (function (e, n) {
        if (null == e) return {};
        var d,
          p,
          h = {},
          y = Object.keys(e);
        for (p = 0; p < y.length; p++)
          (d = y[p]), n.indexOf(d) >= 0 || (h[d] = e[d]);
        return h;
      })(e, n);
    if (Object.getOwnPropertySymbols) {
      var y = Object.getOwnPropertySymbols(e);
      for (p = 0; p < y.length; p++)
        (d = y[p]),
          n.indexOf(d) >= 0 ||
            (Object.prototype.propertyIsEnumerable.call(e, d) && (h[d] = e[d]));
    }
    return h;
  }
  const to = {
    music: { url: "https://api.music.apple.com" },
    apps: { url: "https://amp-api.apps.apple.com" },
    books: { url: "https://amp-api.books.apple.com" },
    fitness: { url: "https://amp-api.fitness.apple.com" },
  };
  (to.music = { url: "https://amp-api.music.apple.com" }),
    (to.videos = { url: "https://amp-api.videos.apple.com" }),
    (to.podcasts = { url: "https://amp-api.podcasts.apple.com" });
  class MediaAPIV3 {
    configure(e, n, d = Za.Merge) {
      this.storefrontId = n.storefrontId;
      const p = (function (e) {
        let n = {};
        e.url && (n.url = e.url);
        e.storefrontId &&
          (n.defaultUrlParameters = { storefrontId: e.storefrontId });
        e.mediaUserToken &&
          (n.defaultOptions = {
            fetchOptions: { headers: { "Media-User-Token": e.mediaUserToken } },
          });
        e.developerToken &&
          (n = deepmerge(n, {
            defaultOptions: {
              fetchOptions: {
                headers: { Authorization: "Bearer " + e.developerToken },
              },
            },
          }));
        e.options && (n = deepmerge(n, e.options));
        return n;
      })(n);
      if (this[e]) this[e].session.reconfigure(p, d);
      else {
        var h;
        const n = new APISession(p),
          d = n.request.bind(n);
        d.session = n;
        const y =
          "undefined" != typeof process &&
          "test" ===
            (null === (h = process.env) || void 0 === h ? void 0 : h.NODE_ENV);
        Object.defineProperty(this, e, {
          value: d,
          writable: y,
          enumerable: !0,
        });
      }
    }
    constructor(e) {
      var n, d, p;
      (p = void 0),
        (d = "storefrontId") in (n = this)
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p);
      const { realmConfig: h } = e,
        y = _object_without_properties(e, ["realmConfig"]);
      for (const _ in to) {
        let e = deepmerge(to[_], y);
        const n = null == h ? void 0 : h[_];
        n && (e = deepmerge(e, n)), this.configure(_, e);
      }
    }
  }
  function asyncGeneratorStep$B(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$A(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$i(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class StationTrackLoader {
    activate() {
      this.dispatcher.unsubscribe(
        ya.queuePositionDidChange,
        this.checkLoadMore
      ),
        this.dispatcher.subscribe(
          ya.queuePositionDidChange,
          this.checkLoadMore
        ),
        (this.isActive = !0);
    }
    deactivate() {
      this.dispatcher.unsubscribe(
        ya.queuePositionDidChange,
        this.checkLoadMore
      ),
        (this.isActive = !1);
    }
    start() {
      return this.isActive || this.activate(), this.loadNextTracks();
    }
    checkLoadMore() {
      if (!(this.queue.isEmpty || this.queue.nextPlayableItemIndex >= 0))
        return this.loadNextTracks();
    }
    loadNextTracks() {
      var e = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$B(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$B(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        let n = [];
        const { apiManager: d } = e;
        if ((null == d ? void 0 : d.api) instanceof MediaAPIV3) {
          var p;
          const h = yield d.api.music(
            "v1/me/stations/next-tracks/" + e.station.id,
            void 0,
            { fetchOptions: { method: "POST" } }
          );
          n =
            null == h || null === (p = h.data) || void 0 === p
              ? void 0
              : p.data;
        } else {
          var h;
          const p = {};
          var y;
          $a.features["enhanced-hls"] &&
            (p.extend = { songs: ["extendedAssetUrls"] }),
            (n =
              null !==
                (y = yield null === (h = d.mediaAPI) || void 0 === h
                  ? void 0
                  : h.nextStationTracks(e.station.id, null, {
                      queryParameters: p,
                    })) && void 0 !== y
                ? y
                : []);
        }
        if (0 === n.length)
          throw (
            (Ye.warn("No track data is available for the current station", {
              stationId: e.station.id,
            }),
            new MKError(
              MKError.Reason.CONTENT_UNAVAILABLE,
              "No track data is available for the current station."
            ))
          );
        const _ = descriptorToMediaItems({
          context: e.context,
          loaded: n,
          container: e.station,
        });
        e.queue.splice(e.queue.length, 0, _);
      })();
    }
    constructor(e, n, { dispatcher: d, apiManager: p }, h = {}) {
      _define_property$A(this, "queue", void 0),
        _define_property$A(this, "station", void 0),
        _define_property$A(this, "context", void 0),
        _define_property$A(this, "apiManager", void 0),
        _define_property$A(this, "dispatcher", void 0),
        _define_property$A(this, "isActive", void 0),
        (this.queue = e),
        (this.station = n),
        (this.context = h),
        (this.isActive = !1),
        (this.dispatcher = d),
        (this.apiManager = p);
    }
  }
  var ro, no;
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$i("design:type", Function),
      _ts_metadata$i("design:paramtypes", []),
      _ts_metadata$i("design:returntype", void 0),
    ],
    StationTrackLoader.prototype,
    "checkLoadMore",
    null
  ),
    (function (e) {
      (e.artist = "artist"),
        (e.song = "song"),
        (e.station = "station"),
        (e.radioStation = "radioStation");
    })(ro || (ro = {})),
    (function (e) {
      e.BEATS1 = "beats1";
    })(no || (no = {}));
  const isIdentityQueue = (e) => e && void 0 !== e.identity;
  function asyncGeneratorStep$A(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$A(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$A(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$A(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$z(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$h(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const { queueIsReady: io } = ya;
  class ContinuousPlaybackController extends PlaybackController {
    get continuous() {
      return !0;
    }
    set continuous(e) {
      if (!0 !== e)
        throw new MKError(
          MKError.Reason.UNSUPPORTED_ERROR,
          "Continuous playback cannot be disabled for station queues."
        );
    }
    get context() {
      return (function (e) {
        for (var n = 1; n < arguments.length; n++) {
          var d = null != arguments[n] ? arguments[n] : {},
            p = Object.keys(d);
          "function" == typeof Object.getOwnPropertySymbols &&
            (p = p.concat(
              Object.getOwnPropertySymbols(d).filter(function (e) {
                return Object.getOwnPropertyDescriptor(d, e).enumerable;
              })
            )),
            p.forEach(function (n) {
              _define_property$z(e, n, d[n]);
            });
        }
        return e;
      })({ featureName: Ot.STATION }, this._context);
    }
    get isLive() {
      return this._isLive;
    }
    set isLive(e) {
      e !== this._isLive &&
        ((this._isLive = e), this._dispatcher.publish(ya.capabilitiesChanged));
    }
    get isAlgorithmic() {
      return this._isAlgorithmic;
    }
    set isAlgorithmic(e) {
      e !== this._isAlgorithmic &&
        ((this._isAlgorithmic = e),
        this._dispatcher.publish(ya.capabilitiesChanged));
    }
    changeToMediaItem(e) {
      var n = this;
      return _async_to_generator$A(function* () {
        n.generateMethodNotAvailable("changeToMediaItem");
      })();
    }
    hasCapabilities(e) {
      switch (e) {
        case Aa.PAUSE:
          return !this.isLive;
        case Aa.SKIP_NEXT:
        case Aa.SKIP_PREVIOUS:
          return !this.isLive;
        case Aa.SKIP_TO_ITEM:
        case Aa.AUTOPLAY:
          return !1;
        default:
          return super.hasCapabilities(e);
      }
    }
    pause(e) {
      var n = this,
        _superprop_get_pause = () => super.pause;
      return _async_to_generator$A(function* () {
        if (!n.isLive) return _superprop_get_pause().call(n, e);
        n.generateMethodNotAvailable("pause");
      })();
    }
    skipToPreviousItem() {
      var e = this,
        _superprop_get_skipToPreviousItem = () => super.skipToPreviousItem;
      return _async_to_generator$A(function* () {
        if (!e.isLive) return _superprop_get_skipToPreviousItem().call(e);
        e.generateMethodNotAvailable("skipToPreviousItem");
      })();
    }
    _dataForQueueOptions(e) {
      var n = this,
        _superprop_get__dataForQueueOptions = () => super._dataForQueueOptions;
      return _async_to_generator$A(function* () {
        const d = yield _superprop_get__dataForQueueOptions().call(n, e);
        return n.isAlgorithmic || (d.loaded = n.station), d;
      })();
    }
    returnQueueForOptions(e) {
      var n = this;
      return _async_to_generator$A(function* () {
        var d;
        const p = isIdentityQueue(e)
          ? yield n.loadStationByIdentity(e.identity)
          : yield n.loadStationByStationId(n.generateStationId(e));
        if (void 0 === p)
          return Promise.reject(
            new MKError(
              MKError.Reason.UNSUPPORTED_ERROR,
              "Cannot load requested station"
            )
          );
        (n.station = p),
          (n.isLive =
            isIdentityQueue(e) ||
            !!(null == p ? void 0 : p.isLive) ||
            !!(null == p || null === (d = p.attributes) || void 0 === d
              ? void 0
              : d.isLive)),
          (n.isAlgorithmic = isAlgoStation(p));
        const h = {
          services: {
            runtime: n._services.runtime,
            dispatcher: n._services.dispatcher,
          },
          descriptor: yield n._dataForQueueOptions(e),
          playbackMode: n.playbackMode,
        };
        return (
          (n.queue = new Queue(h)),
          n.isAlgorithmic &&
            ((n.trackLoader = new StationTrackLoader(
              n.queue,
              p,
              { dispatcher: n._dispatcher, apiManager: n._services.apiManager },
              n.context
            )),
            yield n.trackLoader.start()),
          (n._seekable = n.isLive
            ? new BaseSeekable(n._mediaItemPlayback)
            : new Seekable(n._dispatcher, n._mediaItemPlayback)),
          n._dispatcher.publish(io, n.queue.items),
          n.queue
        );
      })();
    }
    getNewSeeker() {
      return this.hasCapabilities(Aa.SEEK)
        ? super.getNewSeeker()
        : new UnsupportedSeeker();
    }
    skipToNextItem() {
      var e = this,
        _superprop_get_skipToNextItem = () => super.skipToNextItem;
      return _async_to_generator$A(function* () {
        if (!e.isLive) return _superprop_get_skipToNextItem().call(e);
        e.generateMethodNotAvailable("skipToNextItem");
      })();
    }
    generateMethodNotAvailable(e) {
      Ye.warn(e + " is not supported for this type of playback");
    }
    generateStationId(e) {
      let n;
      if (isQueueURLOption(e)) {
        const {
          contentId: d,
          kind: p,
          storefrontId: h,
        } = formattedMediaURL(e.url);
        p && (e[p] = d), h && (Ra.storefrontId = h), (n = p);
      }
      const d = e;
      if (d.artist) return "ra." + d.artist;
      if (d.song) return "ra." + d.song;
      if (d.station) return d.station;
      if (d.radioStation) return d.radioStation;
      throw new MKError(
        MKError.Reason.UNSUPPORTED_ERROR,
        n
          ? n + " is not a supported option. Use setQueue instead."
          : "Unsupported options specified for setStationQueue. You may want setQueue instead."
      );
    }
    loadStationByIdentity(e) {
      var n = this;
      return _async_to_generator$A(function* () {
        var d;
        const { apiManager: p } = n._services;
        if ((null == p ? void 0 : p.api) instanceof MediaAPIV3) {
          var h, y;
          const n = yield p.api.music("v1/catalog/{{storefrontId}}/stations", {
            filter: { identity: e },
          });
          return null == n ||
            null === (y = n.data) ||
            void 0 === y ||
            null === (h = y.data) ||
            void 0 === h
            ? void 0
            : h[0];
        }
        const _ = yield null == p || null === (d = p.mediaAPI) || void 0 === d
          ? void 0
          : d.stations(void 0, { filter: { identity: e } });
        return _ && _[0];
      })();
    }
    loadStationByStationId(e) {
      var n = this;
      return _async_to_generator$A(function* () {
        var d;
        const { apiManager: p } = n._services;
        if ((null == p ? void 0 : p.api) instanceof MediaAPIV3) {
          var h, y;
          const n = yield p.api.music(
            "v1/catalog/{{storefrontId}}/stations/" + e
          );
          return null == n ||
            null === (y = n.data) ||
            void 0 === y ||
            null === (h = y.data) ||
            void 0 === h
            ? void 0
            : h[0];
        }
        return null == p || null === (d = p.mediaAPI) || void 0 === d
          ? void 0
          : d.station(e);
      })();
    }
    activate() {
      super.activate(), this.trackLoader && this.trackLoader.activate();
    }
    deactivate() {
      var e = this,
        _superprop_get_deactivate = () => super.deactivate;
      return _async_to_generator$A(function* () {
        yield _superprop_get_deactivate().call(e),
          e.trackLoader && e.trackLoader.deactivate();
      })();
    }
    constructor(e) {
      super(e),
        _define_property$z(this, "type", za.continuous),
        _define_property$z(this, "_isLive", !1),
        _define_property$z(this, "_isAlgorithmic", !1),
        _define_property$z(this, "trackLoader", void 0),
        _define_property$z(this, "station", void 0),
        (this._continuous = !0);
    }
  }
  function asyncGeneratorStep$z(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$y(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$g(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$g(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$h("design:type", Function),
      _ts_metadata$h("design:paramtypes", [void 0 === Aa ? Object : Aa]),
      _ts_metadata$h("design:returntype", Boolean),
    ],
    ContinuousPlaybackController.prototype,
    "hasCapabilities",
    null
  );
  class PercentageWatcher {
    startMonitor() {
      this.dispatcher.unsubscribe(
        ya.playbackDurationDidChange,
        this.updateThreshold
      ),
        this.dispatcher.unsubscribe(
          ya.playbackTimeDidChange,
          this.handleTimeChange
        ),
        this.dispatcher.subscribe(
          ya.playbackDurationDidChange,
          this.updateThreshold
        ),
        this.dispatcher.subscribe(
          ya.playbackTimeDidChange,
          this.handleTimeChange
        );
    }
    stopMonitor() {
      this.dispatcher.unsubscribe(
        ya.playbackDurationDidChange,
        this.updateThreshold
      ),
        this.dispatcher.unsubscribe(
          ya.playbackTimeDidChange,
          this.handleTimeChange
        ),
        (this.threshold = -1);
    }
    handleTimeChange(
      e,
      { currentPlaybackDuration: n, currentPlaybackTime: d }
    ) {
      var p = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$z(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$z(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        p.threshold < 0 && p.updateThreshold(e, { duration: n }),
          d < p.threshold || (p.stopMonitor(), yield p.callback(d, p));
      })();
    }
    updateThreshold(e, { duration: n }) {
      this.threshold = n * this.percentage;
    }
    constructor(e, n, d) {
      _define_property$y(this, "dispatcher", void 0),
        _define_property$y(this, "callback", void 0),
        _define_property$y(this, "percentage", void 0),
        _define_property$y(this, "threshold", void 0),
        (this.dispatcher = e),
        (this.callback = n),
        (this.percentage = d),
        (this.threshold = -1);
    }
  }
  function asyncGeneratorStep$y(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  _ts_decorate$g(
    [
      Bind(),
      _ts_metadata$g("design:type", Function),
      _ts_metadata$g("design:paramtypes", [void 0, void 0]),
      _ts_metadata$g("design:returntype", Promise),
    ],
    PercentageWatcher.prototype,
    "handleTimeChange",
    null
  ),
    _ts_decorate$g(
      [
        Bind(),
        _ts_metadata$g("design:type", Function),
        _ts_metadata$g("design:paramtypes", [void 0, void 0]),
        _ts_metadata$g("design:returntype", void 0),
      ],
      PercentageWatcher.prototype,
      "updateThreshold",
      null
    );
  class Preloader extends PlaybackMonitor {
    handlePlaybackThreshold() {
      var e = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$y(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$y(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        const n = e.getNextPlayableItem();
        n && (yield e.playbackController.prepareToPlay(n, !0));
      })();
    }
    shouldMonitor() {
      if (!super.shouldMonitor()) return !1;
      if (
        !this.playbackController.hasAuthorization ||
        this.playbackController.previewOnly
      )
        return !1;
      const e = this.getNextPlayableItem(),
        n = void 0 !== e;
      return this.isSeamlessAudioTransitionsEnabled
        ? n
        : n && !(null == e ? void 0 : e.isPreparedToPlay);
    }
    getNextPlayableItem() {
      return this.playbackController.queue.nextPlayableItem;
    }
    constructor(e) {
      var n, d, p;
      super(e),
        (p = !1),
        (d = "isSeamlessAudioTransitionsEnabled") in (n = this)
          ? Object.defineProperty(n, d, {
              value: p,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (n[d] = p),
        (this.watchers = [
          new PercentageWatcher(
            this.dispatcher,
            this.handlePlaybackThreshold,
            0.3
          ),
        ]),
        (this.isSeamlessAudioTransitionsEnabled =
          $a.features["seamless-audio-transitions"]);
    }
  }
  function dasherize(e) {
    return e
      .replace(/([A-Z])/g, "-$1")
      .replace(/[-_\s]+/g, "-")
      .toLowerCase();
  }
  function asyncGeneratorStep$x(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$x(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$x(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$x(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$w(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$k(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$w(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$e(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function loadRelationshipData(e, n, d) {
    return _loadRelationshipData.apply(this, arguments);
  }
  function _loadRelationshipData() {
    return (_loadRelationshipData = _async_to_generator$x(function* (
      e,
      n,
      d,
      p = {}
    ) {
      if (void 0 === n) return d;
      void 0 === p.limit && (p.limit = 100),
        void 0 === p.offset && (p.offset = 0);
      const { relationship: h, method: y } = n,
        _ = e[y].bind(e);
      let m;
      return (
        isDataRecord(d)
          ? (void 0 === d[h] && d.setProperty(h, [], "relationships"),
            (m = d[h]))
          : ((d.relationships = d.relationships || {}),
            void 0 === d.relationships[h] &&
              Object.defineProperty(d.relationships, h, {
                value: { data: [] },
                enumerable: !0,
              }),
            (m = d.relationships[h].data)),
        yield ao(_, [d.id, h, p], m),
        d
      );
    })).apply(this, arguments);
  }
  const ao = (function () {
      var e = _async_to_generator$x(function* (e, n, d) {
        const [p, h, y] = n,
          _ = d.length;
        if (_ > 0 && _ < y.limit + y.offset) return d;
        const m = _object_spread$k({}, y);
        let g;
        m.offset = _;
        try {
          g = yield e(p, h, m);
        } catch (Yt) {
          return d;
        }
        return d.push(...g), g.length < m.limit ? d : ao(e, n, d);
      });
      return function (n, d, p) {
        return e.apply(this, arguments);
      };
    })(),
    getNamedQueueOptions = (e, n) => {
      const d = [],
        p = e.namedQueueOptions;
      for (const h in n) Object.keys(p).includes(h) && d.push([h, p[h]]);
      return d;
    },
    oo = (function () {
      var e = _async_to_generator$x(function* (e, n, d) {
        const [p] = d,
          h = n[p];
        if (!Array.isArray(h)) return loadSelectedQueueValue(e, n, d, h);
        const y = new Map();
        h.forEach((e) => {
          const n = e.indexOf("."),
            d = -1 === n ? "" : e.substring(0, n);
          y.has(d) || y.set(d, []);
          const p = y.get(d);
          p && p.push(e);
        });
        const _ = (yield Promise.all(
            [...y.values()].map((p) => loadSelectedQueueValue(e, n, d, p))
          )).reduce((e, n) => {
            var d;
            return (
              (n = null !== (d = n.data) && void 0 !== d ? d : n).forEach(
                (n) => {
                  e.set(n.id, n);
                }
              ),
              e
            );
          }, new Map()),
          m = [];
        return (
          h.forEach((e) => {
            const n = _.get(e);
            n && m.push(n);
          }),
          m
        );
      });
      return function (n, d, p) {
        return e.apply(this, arguments);
      };
    })();
  function loadSelectedQueueValue(e, n, d, p) {
    return _loadSelectedQueueValue.apply(this, arguments);
  }
  function _loadSelectedQueueValue() {
    return (_loadSelectedQueueValue = _async_to_generator$x(
      function* (e, n, d, p) {
        const h = yield e.getAPIForItem(Array.isArray(p) ? p[0] : p);
        return h instanceof MediaAPIV3
          ? loadSelectedQueueValueV3(h, n, d, p)
          : loadSelectedQueueValueV2(h, n, d, p);
      }
    )).apply(this, arguments);
  }
  function loadSelectedQueueValueV2(e, n, d, p) {
    return _loadSelectedQueueValueV2.apply(this, arguments);
  }
  function _loadSelectedQueueValueV2() {
    return (_loadSelectedQueueValueV2 = _async_to_generator$x(
      function* (e, n, d, p) {
        const [, h] = d;
        let y = n.parameters;
        $a.features["enhanced-hls"] &&
          (y = _object_spread_props$e(_object_spread$k({}, y), {
            extend: { songs: ["extendedAssetUrls"] },
          }));
        let _ = yield e[h.apiMethod](p, y);
        return (
          h.loadedQueueTransform && (_ = h.loadedQueueTransform(_)),
          Array.isArray(p) ||
            (yield loadRelationshipData(e, h.relationshipMethod, _)),
          _
        );
      }
    )).apply(this, arguments);
  }
  function loadSelectedQueueValueV3(e, n, d, p) {
    return _loadSelectedQueueValueV3.apply(this, arguments);
  }
  function _loadSelectedQueueValueV3() {
    return (_loadSelectedQueueValueV3 = _async_to_generator$x(
      function* (e, n, d, p) {
        const [h] = d,
          y = Array.isArray(p),
          _ = k(y ? "" + p[0] : "" + p),
          m = /^(?:playlists?|albums?)$/i.test(h);
        let g = dasherize(h);
        g.endsWith("s") || (g += "s");
        let b =
          (_ ? "/v1/me/library" : "/v1/catalog/{{storefrontId}}") + "/" + g;
        y || (b += "/{{id}}");
        const P = {};
        y && (P.ids = p), _ && m && (P.include = "tracks");
        const S = yield e.music(b, P, { urlParameters: { id: p } });
        return y ? S.data.data : S.data.data[0];
      }
    )).apply(this, arguments);
  }
  function asyncGeneratorStep$w(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$w(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$w(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$w(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$v(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$j(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$v(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$d(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_decorate$f(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$f(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const so = ["library-songs", "songs"],
    isAutoplaySupportedForType = (e) => so.includes(e),
    normalizeTypeForAutoplay = (e, n) =>
      (k(e) && !(null != n ? n : "").startsWith("library-") ? "library-" : "") +
      normalizeContentType(n);
  class AutoplayTrackLoader {
    activate() {
      this.isActive ||
        (this.dispatcher.unsubscribe(
          ya.queuePositionDidChange,
          this.onQueueChanged
        ),
        this.dispatcher.subscribe(
          ya.queuePositionDidChange,
          this.onQueueChanged
        ),
        this.dispatcher.unsubscribe(
          ya.repeatModeDidChange,
          this.onRepeatableChanged
        ),
        this.dispatcher.subscribe(
          ya.repeatModeDidChange,
          this.onRepeatableChanged
        ),
        (this.isActive = !0));
    }
    deactivate() {
      this.isActive &&
        (this.dispatcher.unsubscribe(
          ya.queuePositionDidChange,
          this.onQueueChanged
        ),
        this.dispatcher.unsubscribe(
          ya.repeatModeDidChange,
          this.onRepeatableChanged
        ),
        (this.isActive = !1),
        (this.station = void 0),
        (this.queue.hasAutoplayStation = !1));
    }
    start() {
      if (!this.isActive) return this.activate(), this.loadNextTracks();
    }
    stop() {
      this.isActive && (this.deactivate(), this.cleanupQueue());
    }
    onRepeatableChanged() {
      this.repeatable.repeatMode === e.PlayerRepeatMode.none
        ? this.checkLoadMore()
        : this.cleanupQueue();
    }
    onQueueChanged() {
      if (!(this.queue.nextPlayableItemIndex >= 0)) return this.checkLoadMore();
    }
    get api() {
      const e = this.apiManager.mediaAPI;
      var n;
      return null !== (n = null == e ? void 0 : e.v3) && void 0 !== n ? n : e;
    }
    checkLoadMore() {
      var e;
      const n =
          null !== (e = this.queue.unplayedAutoplayItems.length) && void 0 !== e
            ? e
            : 0,
        d = $a.autoplay.maxUpcomingTracksToMaintain;
      if (
        !(
          this.queue.isEmpty ||
          this.queue.unplayedUserItems.length >
            $a.autoplay.maxQueueSizeForAutoplay
        )
      )
        return n < d ? this.loadNextTracks(d - n) : this.loadNextTracks();
    }
    cleanupQueue() {
      this.queue.removeQueueItems(
        (e, n) => !(n <= this.queue.position) && !!e.isAutoplay
      );
    }
    loadNextTracks(n = $a.autoplay.maxUpcomingTracksToMaintain) {
      var d = this;
      return _async_to_generator$w(function* () {
        var p;
        if (d.repeatable.repeatMode !== e.PlayerRepeatMode.none) return;
        let h,
          { station: y } = d;
        if (d.station) {
          try {
            var _;
            (h = yield d.api.music(
              "v1/me/stations/next-tracks/" + d.station.id,
              { limit: n },
              { fetchOptions: { method: "POST" } }
            )),
              (h =
                null == h || null === (_ = h.data) || void 0 === _
                  ? void 0
                  : _.data);
          } catch (Yt) {
            return;
          }
          if (!d.isActive) return;
        } else {
          var m;
          const e = yield d.startStation(n);
          if (!e || !d.isActive) return void (d.queue.hasAutoplayStation = !1);
          (y = d.station = e.station),
            (d.queue.hasAutoplayStation = !0),
            (h = e.tracks),
            (null == e || null === (m = e.tracks) || void 0 === m
              ? void 0
              : m.length) ||
              Ye.warn("No track data is available for the current station", {
                stationId: null == y ? void 0 : y.id,
              });
        }
        const g = descriptorToMediaItems({
          context: _object_spread_props$d(_object_spread$j({}, d.context), {
            featureName: "now_playing",
            reco_id: (
              null === (p = d.context.featureName) || void 0 === p
                ? void 0
                : p.startsWith("listen-now")
            )
              ? void 0
              : d.context.reco_id,
          }),
          loaded: h,
          container: y,
        });
        d.queue.appendQueueItems(toQueueItems(g, { isAutoplay: !0 }));
      })();
    }
    startStation(e) {
      var n = this;
      return _async_to_generator$w(function* () {
        const { userAddedItems: d } = n.queue;
        var p;
        const h =
            null !== (p = d[d.length - 2]) && void 0 !== p
              ? p
              : d[d.length - 1],
          y = null == h ? void 0 : h.container,
          _ = y ? { container: { id: y.id, type: y.type } } : void 0,
          m = n.queue.items
            .slice(-1 * $a.autoplay.maxQueueSizeInRequest)
            .reduce((e, { id: d, type: p }) => {
              const h = normalizeTypeForAutoplay(d, p);
              return (
                isAutoplaySupportedForType(h) &&
                  !n.errorIds.has(d) &&
                  e.push({ id: d, type: h, meta: _ }),
                e
              );
            }, []);
        if (0 === m.length) return;
        const g = { data: m };
        let b;
        try {
          var P;
          (b = yield n.api.music(
            "v1/me/stations/continuous",
            { "limit[results:tracks]": e, with: ["tracks"] },
            {
              fetchOptions: {
                method: "POST",
                body: JSON.stringify(g, void 0, 2),
              },
            }
          )),
            (b =
              null == b || null === (P = b.data) || void 0 === P
                ? void 0
                : P.results);
        } catch (Yt) {
          m.forEach((e) => n.errorIds.add(e.id));
        }
        return b;
      })();
    }
    constructor(e, n, { dispatcher: d, apiManager: p }, h = {}) {
      _define_property$v(this, "queue", void 0),
        _define_property$v(this, "repeatable", void 0),
        _define_property$v(this, "context", void 0),
        _define_property$v(this, "apiManager", void 0),
        _define_property$v(this, "dispatcher", void 0),
        _define_property$v(this, "isActive", void 0),
        _define_property$v(this, "errorIds", void 0),
        _define_property$v(this, "station", void 0),
        (this.queue = e),
        (this.repeatable = n),
        (this.context = h),
        (this.isActive = !1),
        (this.errorIds = new Set()),
        (this.dispatcher = d),
        (this.apiManager = p);
    }
  }
  function asyncGeneratorStep$v(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$v(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$v(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$v(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$u(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$i(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$u(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$c(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_decorate$e(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$e(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  _ts_decorate$f(
    [
      Bind(),
      _ts_metadata$f("design:type", Function),
      _ts_metadata$f("design:paramtypes", []),
      _ts_metadata$f("design:returntype", void 0),
    ],
    AutoplayTrackLoader.prototype,
    "onRepeatableChanged",
    null
  ),
    _ts_decorate$f(
      [
        Bind(),
        _ts_metadata$f("design:type", Function),
        _ts_metadata$f("design:paramtypes", []),
        _ts_metadata$f("design:returntype", void 0),
      ],
      AutoplayTrackLoader.prototype,
      "onQueueChanged",
      null
    ),
    _ts_decorate$f(
      [
        (e, n, d) => {
          const p = d.value,
            h = "_singlePromise_" + n,
            y = "undefined" != typeof Symbol ? Symbol(h) : h;
          return (
            (d.value = function (...e) {
              if (this[y]) return this[y];
              const n = (this[y] = p.apply(this, e)),
                reset = () => {
                  this[y] = void 0;
                };
              return n.then(reset, reset), n;
            }),
            d
          );
        },
        _ts_metadata$f("design:type", Function),
        _ts_metadata$f("design:paramtypes", [Number]),
        _ts_metadata$f("design:returntype", Promise),
      ],
      AutoplayTrackLoader.prototype,
      "loadNextTracks",
      null
    );
  const { queueIsReady: co } = ya;
  var lo, uo;
  !(function (e) {
    (e.album = "album"),
      (e.musicVideo = "musicVideo"),
      (e.playlist = "playlist"),
      (e.song = "song"),
      (e.episode = "episode"),
      (e.podcast = "podcast"),
      (e.uploadedAudio = "uploadedAudio"),
      (e.uploadedVideo = "uploadedVideo");
  })(lo || (lo = {})),
    (function (e) {
      (e.albums = "albums"),
        (e.musicVideos = "musicVideos"),
        (e.playlists = "playlists"),
        (e.songs = "songs"),
        (e.episodes = "episodes"),
        (e.podcasts = "podcasts"),
        (e.uploadedAudio = "uploadedAudios"),
        (e.uploadedVideo = "uploadedVideos");
    })(uo || (uo = {}));
  class SerialPlaybackController extends PlaybackController {
    get autoplayEnabled() {
      return this._autoplayEnabled;
    }
    set autoplayEnabled(e) {
      var n;
      this._autoplayEnabled = e;
      const d = e ? "start" : "stop";
      null === (n = this._autoplayTrackLoader) || void 0 === n || n[d]();
    }
    activate() {
      super.activate(),
        this._preloader.activate(),
        this._dispatcher.subscribe(Ai, this.onSeamlessAudioTransition),
        this._dispatcher.subscribe(
          ya.repeatModeDidChange,
          this.onRepeatModeChange
        );
    }
    deactivate() {
      var e = this,
        _superprop_get_deactivate = () => super.deactivate;
      return _async_to_generator$v(function* () {
        var n;
        yield _superprop_get_deactivate().call(e),
          e._preloader.deactivate(),
          e._dispatcher.unsubscribe(Ai, e.onSeamlessAudioTransition),
          e._dispatcher.unsubscribe(
            ya.repeatModeDidChange,
            e.onRepeatModeChange
          ),
          null === (n = e._autoplayTrackLoader) || void 0 === n || n.stop();
      })();
    }
    onSeamlessAudioTransition(n, d) {
      Ye.debug("controller handling seamless audio transition, PAF stop", d),
        this._next({
          userInitiated: !1,
          seamlessAudioTransition: !0,
          endReasonType: e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK,
          position: d.previous.playbackDuration / 1e3,
          isPlaying: !1,
        });
    }
    hasCapabilities(e) {
      var n, d, p;
      return (
        e === Aa.SKIP_PREVIOUS ||
        (((e !== Aa.REPEAT && e !== Aa.SHUFFLE) ||
          !(null === (d = this.queue) ||
          void 0 === d ||
          null === (n = d.currentQueueItem) ||
          void 0 === n
            ? void 0
            : n.isAutoplay)) &&
          ((e !== Aa.SEEK && e !== Aa.PAUSE) ||
            !(null === (p = this.nowPlayingItem) || void 0 === p
              ? void 0
              : p.isAssetScrubbingDisabled)) &&
          super.hasCapabilities(e))
      );
    }
    onRepeatModeChange() {
      var e;
      this.queue.nextPlayableItem &&
        (Ye.info(
          "SerialPlaybackController: preparing new item after RepeatMode change",
          null === (e = this.queue.nextPlayableItem) || void 0 === e
            ? void 0
            : e.title
        ),
        this.prepareToPlay(this.queue.nextPlayableItem, !0));
    }
    prepareToPlay(n, d = !1) {
      var p = this;
      return _async_to_generator$v(function* () {
        if (
          (Ye.debug("mk: SerialController - prepareToPlay - ", {
            item: n,
            preload: d,
          }),
          n.isPlayable)
        )
          return p._mediaItemPlayback.prepareToPlay(n).catch((n) => {
            const h =
              !d &&
              -1 ===
                [
                  MKError.Reason.DEVICE_LIMIT,
                  MKError.Reason.STREAM_UPSELL,
                ].indexOf(n.reason);
            if (p.continuous && h)
              return (
                p._dispatcher.publish(kt.applicationActivityIntent, {
                  endReasonType:
                    e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
                  userInitiated: !1,
                }),
                p._next()
              );
            throw n;
          });
      })();
    }
    prepend(e, n) {
      var d = this,
        _superprop_get_prepend = () => super.prepend;
      return _async_to_generator$v(function* () {
        const p = yield _superprop_get_prepend().call(d, e, n);
        if (d.shouldTransitionSeamlessly) {
          const e = d.queue,
            n = e.position,
            p = e.item(n + 1);
          Ye.debug("prepend preparing ", p.title),
            yield d._mediaItemPlayback.prepareToPlay(p);
        }
        return p;
      })();
    }
    returnQueueForOptions(e) {
      var n = this;
      return _async_to_generator$v(function* () {
        void 0 !== (e = parseQueueURLOption(e)).startPosition &&
          (deprecationWarning("startPosition", {
            message: "startPosition has been deprecated in favor of startWith",
          }),
          void 0 === e.startWith && (e.startWith = e.startPosition));
        const d = yield n._dataForQueueOptions(e),
          p = {
            services: {
              runtime: n._services.runtime,
              dispatcher: n._services.dispatcher,
              mediaItemPlayback: n._services.mediaItemPlayback,
            },
            descriptor: d,
            playbackMode: n.playbackMode,
          };
        if (
          (void 0 !== e.shuffleMode && (n.shuffleMode = e.shuffleMode),
          (n.queue = new Queue(p)),
          "number" == typeof e.startTime)
        ) {
          const d = n.queue.nextPlayableItem;
          d &&
            n._mediaItemPlayback.playOptions.set(d.id, {
              startTime: e.startTime,
            });
        }
        if (0 === n.queue.length)
          throw (
            (Ye.warn(
              "No item data is available for the current media queue",
              e
            ),
            new MKError(
              MKError.Reason.CONTENT_UNAVAILABLE,
              "No item data is available for the current media queue."
            ))
          );
        return (
          n._autoplayTrackLoader && n._autoplayTrackLoader.deactivate(),
          (n._autoplayTrackLoader = new AutoplayTrackLoader(
            n.queue,
            n._repeatable,
            { dispatcher: n._dispatcher, apiManager: n._services.apiManager },
            n._context
          )),
          n.autoplayEnabled &&
            n.hasCapabilities(Aa.AUTOPLAY) &&
            n._autoplayTrackLoader.start(),
          n._dispatcher.publish(co, n.queue.items),
          n.queue
        );
      })();
    }
    _dataForQueueOptions(e) {
      var n = this,
        _superprop_get__dataForQueueOptions = () => super._dataForQueueOptions;
      return _async_to_generator$v(function* () {
        var d;
        const p = e,
          h = ((e, n) => {
            const d = getNamedQueueOptions(e, n);
            if (d.length > 1)
              throw new MKError(
                MKError.Reason.UNSUPPORTED_ERROR,
                "Queues with multiple media types are not supported."
              );
            if (0 === d.length) return;
            const [p] = d,
              [h, y] = p;
            if (Array.isArray(n[h]) !== y.isPlural)
              throw new MKError(
                MKError.Reason.UNSUPPORTED_ERROR,
                y.isPlural
                  ? `Queue option ${h} must be an array of id values`
                  : `Queue option ${h} must be a single id value`
              );
            return p;
          })(n._services.apiManager.apiService, e);
        if (void 0 === h)
          return _object_spread$i(
            {},
            yield _superprop_get__dataForQueueOptions().call(n, e),
            p
          );
        if (
          ((null === (d = n.storekit) || void 0 === d
            ? void 0
            : d.restrictedEnabled) &&
            (e.parameters = _object_spread_props$c(
              _object_spread$i({}, e.parameters),
              { restrict: "explicit" }
            )),
          ["playlist", "playlists", "library-playlists"].includes(h[0]))
        ) {
          var y;
          const n = (
            null === (y = e.parameters) || void 0 === y ? void 0 : y.extend
          )
            ? e.parameters.extend + ",hasCollaboration"
            : "hasCollaboration";
          e.parameters = _object_spread_props$c(
            _object_spread$i({}, e.parameters),
            { extend: n }
          );
        }
        return (
          (p.loaded = yield oo(n._services.apiManager.apiService, e, h)),
          _object_spread$i(
            {},
            yield _superprop_get__dataForQueueOptions().call(n, e),
            p
          )
        );
      })();
    }
    _changeToMediaAtIndex(e = 0, n = { userInitiated: !1 }) {
      var d = this,
        _superprop_get__changeToMediaAtIndex = () =>
          super._changeToMediaAtIndex;
      return _async_to_generator$v(function* () {
        const p = yield _superprop_get__changeToMediaAtIndex().call(d, e, n),
          h = d.queue.nextPlayableItem;
        return (
          h && d.shouldTransitionSeamlessly && (yield d.prepareToPlay(h)), p
        );
      })();
    }
    _prepareQueue(e) {
      super._prepareQueue(e), this._shuffler.checkAndReshuffle();
    }
    get shouldTransitionSeamlessly() {
      return (
        this._isSeamlessAudioTransitionsEnabled &&
        this.hasAuthorization &&
        !this.previewOnly
      );
    }
    constructor(e) {
      var n;
      super(e),
        _define_property$u(this, "type", za.serial),
        _define_property$u(this, "_preloader", void 0),
        _define_property$u(this, "_isSeamlessAudioTransitionsEnabled", void 0),
        _define_property$u(this, "_autoplayTrackLoader", void 0),
        (this._queue = new Queue(e)),
        (this._repeatable = new Repeatable(this._dispatcher)),
        (this._seekable = new Seekable(
          this._dispatcher,
          this._mediaItemPlayback
        )),
        (this._shuffler = new Shuffler(this, { dispatcher: this._dispatcher })),
        (this._queueModifier = new ModifiableQueue(
          this._queue,
          this._mediaItemPlayback
        )),
        (this._isSeamlessAudioTransitionsEnabled = !!(null == e ||
        null === (n = e.bag) ||
        void 0 === n
          ? void 0
          : n.features["seamless-audio-transitions"]));
      const d = { controller: this, services: e.services };
      this._preloader = new Preloader(d);
    }
  }
  function _define_property$t(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  _ts_decorate$e(
    [
      Bind(),
      _ts_metadata$e("design:type", Function),
      _ts_metadata$e("design:paramtypes", [void 0, void 0]),
      _ts_metadata$e("design:returntype", void 0),
    ],
    SerialPlaybackController.prototype,
    "onSeamlessAudioTransition",
    null
  ),
    _ts_decorate$e(
      [
        Bind(),
        _ts_metadata$e("design:type", Function),
        _ts_metadata$e("design:paramtypes", [void 0 === Aa ? Object : Aa]),
        _ts_metadata$e("design:returntype", Boolean),
      ],
      SerialPlaybackController.prototype,
      "hasCapabilities",
      null
    ),
    _ts_decorate$e(
      [
        Bind(),
        _ts_metadata$e("design:type", Function),
        _ts_metadata$e("design:paramtypes", []),
        _ts_metadata$e("design:returntype", void 0),
      ],
      SerialPlaybackController.prototype,
      "onRepeatModeChange",
      null
    );
  class MKDialog {
    static presentError(e) {
      const n = e.dialog;
      void 0 !== n
        ? MKDialog.serverDialog(n).present()
        : new MKDialog(e.message).present();
    }
    static serverDialog(e) {
      const n = new this(e.message, e.explanation);
      return (
        e.okButtonAction &&
          e.okButtonAction.url &&
          (n._okButtonActionURL = e.okButtonAction.url),
        e.okButtonString && (n._okButtonString = e.okButtonString),
        e.cancelButtonString && (n._cancelButtonString = e.cancelButtonString),
        n
      );
    }
    static clientDialog(e) {
      const n = new this(e.message, e.explanation);
      return (
        e.okButtonAction && (n._okButtonAction = e.okButtonAction),
        e.cancelButtonAction && (n._cancelButtonAction = e.cancelButtonAction),
        e.okButtonString && (n._okButtonString = e.okButtonString),
        e.cancelButtonString && (n._cancelButtonString = e.cancelButtonString),
        n
      );
    }
    get actions() {
      return this.cancelButton
        ? `<div id="mk-dialog-actions">${this.cancelButton}${this.okButton}</div>`
        : `<div id="mk-dialog-actions">${this.okButton}</div>`;
    }
    get cancelButton() {
      if ("string" == typeof this._cancelButtonString)
        return `<button type="button">${this._cancelButtonString}</button>`;
    }
    set cancelButton(e) {
      this._cancelButtonString = e;
    }
    get explanation() {
      return `<p id="mk-dialog-explanation">${this._explanation}</p>`;
    }
    get hasOKButtonAction() {
      return !!this._okButtonActionURL || !!this._okButtonAction;
    }
    get message() {
      return `<h5 id="mk-dialog-title">${this._message}</h5>`;
    }
    get okButton() {
      return this.hasOKButtonAction && this._okButtonActionURL
        ? `<button type="button" data-ok-action-url='${this._okButtonActionURL}'>${this._okButtonString}</button>`
        : `<button type="button">${this._okButtonString}</button>`;
    }
    present() {
      const e = document.createDocumentFragment(),
        n = document.createElement("div");
      (n.id = this.scrimId), e.appendChild(n);
      const d = document.createElement("div");
      (d.id = this.id),
        d.classList.add("mk-dialog"),
        d.setAttribute("role", "alertDialog"),
        d.setAttribute("aria-modal", "true"),
        d.setAttribute("aria-labeledby", "mk-dialog-title"),
        d.setAttribute("aria-describedby", "mk-dialog-explanation");
      let p = `\n      <div id="mk-dialog-body">\n        ${this.message}\n        ${this.explanation}\n      </div>`;
      (p = `\n      ${p}\n      ${this.actions}\n    `),
        (d.innerHTML = p),
        e.appendChild(d),
        document.body.appendChild(e),
        document
          .querySelector(`#${d.id} #mk-dialog-actions *:first-child`)
          .focus(),
        setTimeout(() => {
          document
            .querySelector(`#${d.id} #mk-dialog-actions *:first-child`)
            .addEventListener("click", () => {
              this._cancelButtonAction && this._cancelButtonAction(),
                d.parentElement.removeChild(d),
                n.parentElement.removeChild(n);
            }),
            this.hasOKButtonAction &&
              (this._okButtonActionURL
                ? document
                    .querySelector(`#${d.id} #mk-dialog-actions *:last-child`)
                    .addEventListener("click", (e) => {
                      window.open(e.target.dataset.okActionUrl, "_blank"),
                        d.parentElement.removeChild(d),
                        n.parentElement.removeChild(n);
                    })
                : this._okButtonAction &&
                  document
                    .querySelector(`#${d.id} #mk-dialog-actions *:last-child`)
                    .addEventListener("click", (e) => {
                      this._okButtonAction(),
                        d.parentElement.removeChild(d),
                        n.parentElement.removeChild(n);
                    }));
        });
    }
    _appendStyle(e) {
      const n = document.createElement("style");
      (n.id = this.styleId),
        n.styleSheet ? (n.styleSheet.cssText = e) : (n.innerHTML = e),
        document.body.appendChild(n);
    }
    constructor(e, n = "") {
      _define_property$t(this, "_message", void 0),
        _define_property$t(this, "_explanation", void 0),
        _define_property$t(this, "id", void 0),
        _define_property$t(this, "scrimId", void 0),
        _define_property$t(this, "styleId", void 0),
        _define_property$t(this, "_cancelButtonString", void 0),
        _define_property$t(this, "_cancelButtonAction", void 0),
        _define_property$t(this, "_okButtonAction", void 0),
        _define_property$t(this, "_okButtonActionURL", void 0),
        _define_property$t(this, "_okButtonString", void 0),
        (this._message = e),
        (this._explanation = n),
        (this.id = "musickit-dialog"),
        (this.scrimId = this.id + "-scrim"),
        (this.styleId = this.id + "-style"),
        (this._okButtonString = "OK"),
        [this.id, this.scrimId, this.styleId].forEach((e) => {
          try {
            const n = document.getElementById(e);
            n.parentElement.removeChild(n);
          } catch (Yt) {}
        }),
        this._appendStyle(
          "\n#musickit-dialog {\n  --mk-dialog-background: rgba(255, 255, 255, 1);\n  --mk-dialog-text: rgba(0, 0, 0, 0.95);\n  --mk-dialog-border: rgba(0, 0, 0, 0.07);\n  --mk-dialog-scrim: rgba(255, 255, 255, 0.8);\n  --mk-dialog-primary: rgba(0, 122, 255, 1);\n}\n\n@media (prefers-color-scheme: dark) {\n  #musickit-dialog {\n      --mk-dialog-background: rgba(30, 30, 30, 1);\n      --mk-dialog-text: rgba(255, 255, 255, 0.85);\n      --mk-dialog-border: rgba(255, 255, 255, 0.1);\n      --mk-dialog-scrim: rgba(38, 38, 38, 0.8);\n      --mk-dialog-primary: rgba(8, 132, 255, 1);\n  }\n}\n\n#musickit-dialog-scrim {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.35);\n}\n\n#musickit-dialog * {\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  -ms-touch-action: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  font-family: -apple-system, SF UI Text, Helvetica Neue, Helvetica, sans-serif;\n  font-size: 15px;\n  line-height: 20px;\n}\n\n#musickit-dialog *:focus { outline: 0; }\n\n#musickit-dialog {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  -webkit-justify-content: space-between;\n  -moz-justify-content: space-between;\n  justify-content: space-between;\n  min-width: 277px;\n  max-width: 290px;\n  min-height: 109px;\n  background: var(--mk-dialog-background);\n  box-shadow: 0px 0px 9px rgba(0, 0, 0, 0.18);\n  border-radius: 10px;\n  color: var(--mk-dialog-text);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin-left: -142px;\n  margin-top: -67px;\n  z-index: 9999999999999999999999999;\n}\n\n#musickit-dialog #mk-dialog-body {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  flex-grow: 1;\n  -webkit-justify-content: space-evenly;\n  -moz-justify-content: space-evenly;\n  justify-content: space-evenly;\n  -webkit-align-items: stretch;\n  align-items: stretch;\n  padding: 10px 20px;\n  min-height: 74px;\n  text-align: center;\n}\n\n#musickit-dialog .mk-dialog h5 {\n  font-weight: 500;\n  line-height: 20px;\n  margin: 7px 0 0 0;\n  padding: 0;\n}\n\n#musickit-dialog .mk-dialog p {\n  margin: 0 0 7px 0;\n  padding: 0;\n  paddin-top: 3px;\n  line-height: 18px;\n  font-size: 13px;\n  font-weight: 300;\n}\n\n#musickit-dialog #mk-dialog-actions {\n  border-top: 1px solid var(--mk-dialog-border);\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: row;\n  -moz-flex-direction: colrowumn;\n  flex-direction: row;\n  max-height: 41px;\n  min-height: 34px;\n  -webkit-justify-self: flex-end;\n  -moz-justify-self: flex-end;\n  justify-self: flex-end;\n}\n\n#musickit-dialog #mk-dialog-actions button {\n  flex-grow: 1;\n  border: 0;\n  background: none;\n  color: var(--mk-dialog-primary);\n  padding: 0;\n  margin: 0;\n  min-height: 34px;\n  height: 41px;\n  text-align: center;\n}\n\n#musickit-dialog #mk-dialog-actions *:nth-child(2) {\n  border-left: 1px solid var(--mk-dialog-border);\n  font-weight: 500;\n}\n"
        );
    }
  }
  function _define_property$s(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$h(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$s(e, n, d[n]);
        });
    }
    return e;
  }
  function transformParameters(e, n = 25) {
    if (e) return e.limit && (e.limit = e.limit > n ? n : e.limit), e;
  }
  function transformStoreData(e) {
    const n = _object_spread$h({}, e),
      { href: d } = n;
    return (
      void 0 !== d &&
        (delete n.href,
        (n.attributes = _object_spread$h({}, n.attributes, { href: d }))),
      n
    );
  }
  function transformTrackParameters(e) {
    return e.map((e) =>
      "string" == typeof e
        ? { id: e, type: "songs" }
        : { id: e.id, type: e.type || "songs" }
    );
  }
  function _define_property$r(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const po = ["extend", "include", "l", "platform", "views"];
  class LocalDataStore {
    get hasDataStore() {
      return this.enableDataStore && void 0 !== this._store;
    }
    delete(e, n) {
      this.hasDataStore && this._store.remove(e, n);
    }
    read(e, n, d, p) {
      p || "function" != typeof d || ((p = d), (d = void 0));
      const h = {};
      let y = !1;
      if (
        (d &&
          ((y = Object.keys(d).some((e) => /^(fields|extend)/.test(e))),
          d.views && (h.views = d.views),
          d.include && (h.relationships = d.include)),
        this.hasDataStore && !y)
      ) {
        let p,
          y = [];
        if (
          (d &&
            (y = Object.keys(d).reduce(
              (e, n) => (-1 === po.indexOf(n) && e.push([n, d[n]]), e),
              y
            )),
          (p =
            y && 1 === y.length
              ? this._store.query(y[0][0], y[0][1])
              : this._store.peek(e, n, h)),
          Array.isArray(p))
        ) {
          if (!d && p.length) return p;
        } else if (p) return p;
      }
      if ("function" == typeof p) return p();
    }
    write(e) {
      return this._prepareDataForDataStore(e, (e) => this._store.save(e));
    }
    parse(e) {
      return this._prepareDataForDataStore(e, (e) =>
        this._store.populateDataRecords(e, {})
      );
    }
    _prepareDataForDataStore(e, n) {
      return this.hasDataStore
        ? Array.isArray(e)
          ? n({ data: e })
          : Object.keys(e).reduce((d, p) => {
              const h = e[p];
              return (
                hasOwn(h, "data") && (d[p] = n({ data: h.data })),
                "meta" === p && (d[p] = e[p]),
                d
              );
            }, {})
        : e;
    }
    constructor(e = {}) {
      _define_property$r(this, "_store", void 0),
        _define_property$r(this, "enableDataStore", !1);
      let n = !1;
      e.features &&
        hasOwn(e.features, "api-data-store") &&
        (this.enableDataStore = !!e.features["api-data-store"]),
        e.features &&
          hasOwn(e.features, "disable-data-store-record-reuse") &&
          (n = !!e.features["disable-data-store-record-reuse"]),
        this.enableDataStore &&
          ((this._store =
            e.store || new DataStore({ shouldDisableRecordReuse: n })),
          (this._store.mapping = transformStoreData));
    }
  }
  function asyncGeneratorStep$u(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$u(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$u(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$u(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  const ChunkedIdApi =
      (e, n = 100, d = 1e3) =>
      (p, h, y) => {
        if (void 0 === y || "function" != typeof y.value)
          throw new TypeError(
            `Only methods can be decorated with @ChunkedIdApi, but ${h} is not a method.`
          );
        return {
          configurable: !0,
          get() {
            const p = y.value;
            function chunkedIdApi() {
              return _chunkedIdApi.apply(this, arguments);
            }
            function _chunkedIdApi() {
              return (_chunkedIdApi = _async_to_generator$u(function* (...h) {
                const y = h[e];
                if (y && Array.isArray(y)) {
                  const _ = y[0].length || 20,
                    m = Math.min(n, Math.floor(d / _)),
                    g = Math.ceil(y.length / m);
                  if (g > 1) {
                    const n = h.slice(0, e),
                      d = h.slice(e + 1),
                      _ = [];
                    let b = 0;
                    for (let e = 1; e <= g; e++) {
                      const h = Math.min(e * m, y.length),
                        g = [...n, y.slice(b, h), ...d];
                      _.push(p.apply(this, g)), (b += m);
                    }
                    const P = yield Promise.all(_);
                    return [].concat(...P);
                  }
                }
                return p.apply(this, h);
              })).apply(this, arguments);
            }
            return (
              Object.defineProperty(this, h, {
                value: chunkedIdApi,
                configurable: !0,
                writable: !0,
              }),
              chunkedIdApi
            );
          },
        };
      },
    formatTimezoneOffset = (e = new Date()) => {
      const n = e.getTimezoneOffset(),
        d = Math.floor(Math.abs(n) / 60),
        p = Math.round(Math.abs(n) % 60);
      let h = "+";
      return (
        0 !== n && (h = n > 0 ? "-" : "+"),
        `${h}${leadingZeros(d, 2)}:${leadingZeros(p, 2)}`
      );
    },
    leadingZeros = (e, n = 2) => {
      let d = "" + e;
      for (; d.length < n; ) d = "0" + d;
      return d;
    };
  function asyncGeneratorStep$t(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$t(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$t(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$t(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$q(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread_props$b(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_metadata$d(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class Books extends TokenSession {
    audioBook(e, n, d) {
      return this.resource("audio-books", e, n, d);
    }
    audioBooks(e, n, d) {
      return this.collection("audio-books", e, n, d);
    }
    collection(e, n, d, p) {
      var h = this;
      return _async_to_generator$t(function* () {
        const y = `catalog/${h.storefrontId}/${e}`;
        return n && ((d = d || {}).ids = n), makeRequest(h, y, d, p);
      })();
    }
    parseResultData(e, n) {
      return e ? this._store.write(n) : this._store.parse(n);
    }
    resource(e, n, d, p) {
      var h = this;
      return _async_to_generator$t(function* () {
        if (!(null == p ? void 0 : p.reload)) {
          const p = h._store.read(e, n, d);
          if (p) return p;
        }
        const [y] = yield h.collection(e, n, d, p);
        return y;
      })();
    }
    constructor(e, n, d, p, h = {}, y) {
      super(
        "https://api.books.apple.com/v1",
        e,
        _object_spread_props$b(
          (function (e) {
            for (var n = 1; n < arguments.length; n++) {
              var d = null != arguments[n] ? arguments[n] : {},
                p = Object.keys(d);
              "function" == typeof Object.getOwnPropertySymbols &&
                (p = p.concat(
                  Object.getOwnPropertySymbols(d).filter(function (e) {
                    return Object.getOwnPropertyDescriptor(d, e).enumerable;
                  })
                )),
                p.forEach(function (n) {
                  _define_property$q(e, n, d[n]);
                });
            }
            return e;
          })({}, y),
          { userToken: n, storage: p }
        )
      ),
        _define_property$q(this, "_store", void 0),
        _define_property$q(this, "defaultIncludePaginationMetadata", void 0),
        _define_property$q(this, "storefrontId", Fe.ID),
        d && (this.storefrontId = d),
        (this._store = new LocalDataStore(h)),
        (this.defaultIncludePaginationMetadata =
          h.features && hasOwn(h.features, "api-pagination-metadata"));
    }
  }
  function asyncGeneratorStep$s(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$s(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$s(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$s(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$p(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$f(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$p(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$a(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_metadata$c(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      ChunkedIdApi(1),
      _ts_metadata$d("design:type", Function),
      _ts_metadata$d("design:paramtypes", [
        String,
        Object,
        "undefined" == typeof QueryParameters ? Object : QueryParameters,
        "undefined" == typeof InternalMakeRequestOptions
          ? Object
          : InternalMakeRequestOptions,
      ]),
      _ts_metadata$d("design:returntype", Promise),
    ],
    Books.prototype,
    "collection",
    null
  );
  class Podcasts extends TokenSession {
    catalogResource(e, n, d, p) {
      return this.resource(e, n, d, p);
    }
    catalogResources(e, n, d, p) {
      return this.collection(e, n, d, p);
    }
    catalogResourceRelationship(e, n, d, p, h) {
      return this.collection(`${e}/${n}/${d}`, void 0, p, h);
    }
    search(e, n, d) {
      return this.collection(
        "search",
        void 0,
        _object_spread$f({ term: e, types: "podcasts" }, n),
        d
      );
    }
    artist(e, n, d) {
      return this.catalogResource("artists", e, n, d);
    }
    artists(e, n, d) {
      return this.catalogResources("artists", e, n, d);
    }
    artistRelationship(e, n, d, p) {
      return this.catalogResourceRelationship("artists", e, n, d, p);
    }
    charts(e, n, d) {
      return this.catalogResources(
        "charts",
        void 0,
        _object_spread$f({ types: e }, n),
        d
      );
    }
    podcast(e, n, d) {
      return this.catalogResource(
        "podcasts",
        e,
        _object_spread$f({ include: "episodes" }, n),
        d
      );
    }
    podcasts(e, n, d) {
      var p = this;
      return _async_to_generator$s(function* () {
        return p.catalogResources(
          "podcasts",
          e,
          _object_spread$f({ include: "episodes" }, n),
          d
        );
      })();
    }
    podcastRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$s(function* () {
        return h.catalogResourceRelationship("podcasts", e, n, d, p);
      })();
    }
    episode(e, n, d) {
      var p = this;
      return _async_to_generator$s(function* () {
        return p.resource("podcast-episodes", e, n, d);
      })();
    }
    episodes(e, n, d) {
      var p = this;
      return _async_to_generator$s(function* () {
        return p.catalogResources("podcast-episodes", e, n, d);
      })();
    }
    collection(e, n, d, p) {
      var h = this;
      return _async_to_generator$s(function* () {
        let y;
        if (n) {
          const p = {};
          (p["charts" === e ? "types" : "ids"] = n), (y = Object.assign(p, d));
        } else y = d;
        const _ = `catalog/${h.storefrontId}/${e}`;
        return makeRequest(h, _, y, p);
      })();
    }
    parseResultData(e, n) {
      return e ? this._store.write(n) : this._store.parse(n);
    }
    resource(e, n, d, p) {
      var h = this;
      return _async_to_generator$s(function* () {
        if (!(null == p ? void 0 : p.reload)) {
          const p = h._store.read(e, n, d);
          if (p) return p;
        }
        const [y] = yield h.collection(e, n, d, p);
        return y;
      })();
    }
    constructor(e, n, d = Fe.ID, p, h = {}, y) {
      super(
        "https://amp-api.podcasts.apple.com/v1",
        e,
        _object_spread_props$a(_object_spread$f({}, y), {
          userToken: n,
          storage: p,
        })
      ),
        _define_property$p(this, "_store", void 0),
        _define_property$p(this, "defaultIncludePaginationMetadata", void 0),
        _define_property$p(this, "storefrontId", void 0),
        (this.storefrontId = d),
        (this._store = new LocalDataStore(h)),
        (this.defaultIncludePaginationMetadata =
          h.features && hasOwn(h.features, "api-pagination-metadata"));
    }
  }
  function asyncGeneratorStep$r(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$o(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$e(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$o(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$9(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_metadata$b(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      ChunkedIdApi(1),
      _ts_metadata$c("design:type", Function),
      _ts_metadata$c("design:paramtypes", [
        String,
        Object,
        "undefined" == typeof QueryParameters ? Object : QueryParameters,
        "undefined" == typeof InternalMakeRequestOptions
          ? Object
          : InternalMakeRequestOptions,
      ]),
      _ts_metadata$c("design:returntype", Promise),
    ],
    Podcasts.prototype,
    "collection",
    null
  );
  const ho = new Set(["editorial-items"]);
  class Fitness extends TokenSession {
    workout(e, n, d) {
      return this.resource("workouts", e, n, d);
    }
    contributor(e, n, d) {
      return this.resource("contributors", e, n, d);
    }
    editorialItem(e, n, d) {
      return this.resource("editorial-items", e, n, d);
    }
    modalities(e, n, d) {
      return this.collection("modalities", e, n, d);
    }
    modality(e, n, d) {
      return this.resource("modalities", e, n, d);
    }
    workoutProgram(e, n, d) {
      return this.resource("workout-programs", e, n, d);
    }
    collection(e, n, d, p) {
      let h;
      h = n ? _object_spread$e({ ids: n }, d) : d;
      let y = "catalog";
      ho.has(e) && (y = "editorial");
      return makeRequest(this, `${y}/${this.storefrontId}/${e}`, h, p);
    }
    parseResultData(e, n) {
      return e ? this._store.write(n) : this._store.parse(n);
    }
    resource(e, n, d, p) {
      var h = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$r(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$r(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        const y = h._store.read(e, n, d);
        if (y) return y;
        const [_] = yield h.collection(e, n, d, p);
        return _;
      })();
    }
    constructor(e, n, d = Fe.ID, p, h = {}, y) {
      var _;
      super(
        "https://amp-api.fitness.apple.com/v1",
        e,
        _object_spread_props$9(_object_spread$e({}, y), {
          userToken: n,
          storage: p,
        })
      ),
        _define_property$o(this, "_store", void 0),
        _define_property$o(this, "defaultIncludePaginationMetadata", void 0),
        _define_property$o(this, "storefrontId", Fe.ID),
        (this.storefrontId = d),
        (this._store = new LocalDataStore(h)),
        (this.defaultIncludePaginationMetadata = !!(null == h ||
        null === (_ = h.features) ||
        void 0 === _
          ? void 0
          : _["api-pagination-metadata"]));
    }
  }
  function asyncGeneratorStep$q(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$q(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$q(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$q(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$n(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$d(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$n(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$8(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_metadata$a(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      ChunkedIdApi(1),
      _ts_metadata$b("design:type", Function),
      _ts_metadata$b("design:paramtypes", [
        String,
        Object,
        "undefined" == typeof QueryParameters ? Object : QueryParameters,
        "undefined" == typeof MakeRequestOptions ? Object : MakeRequestOptions,
      ]),
      _ts_metadata$b(
        "design:returntype",
        "undefined" == typeof Promise ? Object : Promise
      ),
    ],
    Fitness.prototype,
    "collection",
    null
  );
  class TVLibrary extends TokenSession {
    genres(e, n) {
      var d = this;
      return _async_to_generator$q(function* () {
        return d.collection(
          "genres",
          _object_spread$d({ types: "tv-episodes,movies" }, e),
          n
        );
      })();
    }
    movies(e, n) {
      var d = this;
      return _async_to_generator$q(function* () {
        return d.collection("movies", e, n);
      })();
    }
    purchases(e, n) {
      var d = this;
      return _async_to_generator$q(function* () {
        return d.collection(
          "",
          _object_spread$d({ types: "tv-episodes,movies" }, e),
          n
        );
      })();
    }
    tvEpisodes(e, n) {
      var d = this;
      return _async_to_generator$q(function* () {
        return d.collection("tv-episodes", e, n);
      })();
    }
    collection(e, n, d) {
      var p = this;
      return _async_to_generator$q(function* () {
        try {
          return yield makeRequest(p, "me/purchases/" + e, n, d);
        } catch (q) {
          if (
            MKError.isMKError(q) &&
            q.reason === MKError.Reason.CONTENT_UNAVAILABLE
          )
            return (null == d ? void 0 : d.includePagination)
              ? { data: [], meta: {} }
              : [];
          throw q;
        }
      })();
    }
    parseResultData(e, n) {
      return e ? this._store.write(n) : this._store.parse(n);
    }
    constructor(e, n, d, p = {}, h) {
      super(
        "https://amp-api.videos.apple.com/v1",
        e,
        _object_spread_props$8(_object_spread$d({}, h), {
          userToken: n,
          storage: d,
        })
      ),
        _define_property$n(this, "_store", void 0),
        _define_property$n(this, "defaultIncludePaginationMetadata", void 0),
        (this._store = new LocalDataStore(p)),
        (this.defaultIncludePaginationMetadata =
          p.features && hasOwn(p.features, "api-pagination-metadata"));
    }
  }
  function asyncGeneratorStep$p(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$p(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$p(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$p(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$m(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$c(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$m(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$7(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      ChunkedIdApi(1),
      _ts_metadata$a("design:type", Function),
      _ts_metadata$a("design:paramtypes", [
        String,
        "undefined" == typeof QueryParameters ? Object : QueryParameters,
        "undefined" == typeof InternalMakeRequestOptions
          ? Object
          : InternalMakeRequestOptions,
      ]),
      _ts_metadata$a("design:returntype", Promise),
    ],
    TVLibrary.prototype,
    "collection",
    null
  );
  const RecommendationUpdate = () => (e, n, d) => {
    if (void 0 === d || "function" != typeof d.value)
      throw new TypeError(
        `Only methods can be decorated with @RecommendationUpdate, but ${n} is not a method.`
      );
    return {
      configurable: !0,
      get() {
        const e = d.value;
        function recommendationUpdate() {
          return _recommendationUpdate.apply(this, arguments);
        }
        function _recommendationUpdate() {
          return (_recommendationUpdate = _async_to_generator$p(function* (
            ...n
          ) {
            const d = yield e.apply(this, n),
              p = new Map(),
              h = [],
              y = new Date();
            if (!d || !Array.isArray(d)) return d;
            if (
              (d.forEach((e, n) => {
                var d;
                const _ = e.id;
                var m;
                const g =
                  null !== (m = e.nextUpdateDate) && void 0 !== m
                    ? m
                    : null === (d = e.attributes) || void 0 === d
                      ? void 0
                      : d.nextUpdateDate;
                if (!_ || !g) return;
                new Date(g) < y && (h.push(_), p.set(_, n));
              }),
              !h.length)
            )
              return d;
            let [_, m, g, ...b] = n;
            g = _object_spread_props$7(_object_spread$c({}, g), { reload: !0 });
            const P = [h, m, g, ...b];
            return (
              (yield e.apply(this, P)).forEach((e) => {
                const n = p.get(e.id);
                void 0 !== n && (d[n] = e);
              }),
              d
            );
          })).apply(this, arguments);
        }
        return (
          Object.defineProperty(this, n, {
            value: recommendationUpdate,
            configurable: !0,
            writable: !0,
          }),
          recommendationUpdate
        );
      },
    };
  };
  function asyncGeneratorStep$o(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$l(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function makeAlbumKey(e) {
    var n;
    return (
      (null === (n = e.artwork) || void 0 === n ? void 0 : n.url) +
      "" +
      e.artistName +
      "" +
      e.name
    );
  }
  class ServerLedger {
    _initData() {
      return {
        lastTimestamp: 0,
        albums: { added: Object.create(null), removed: Object.create(null) },
        playlists: { added: Object.create(null), removed: Object.create(null) },
      };
    }
    _checkTimestamp() {
      const e = this._data.lastTimestamp;
      e &&
        e + 24e5 < Date.now() &&
        ((this._data = this._initData()),
        this._sessionStorage &&
          this._sessionStorage.removeItem(this._storageKey));
    }
    added(e) {
      this.load();
      const n = null == e ? void 0 : e.playlists,
        d = null == e ? void 0 : e.albums;
      return n || d
        ? (n &&
            n.forEach((e) => {
              const n = Date.now();
              (this._data.playlists.added[e] = n),
                (this._data.lastTimestamp = n);
            }),
          d &&
            d.forEach((e) => {
              const n = Date.now();
              (this._data.albums.added[e] = n), (this._data.lastTimestamp = n);
            }),
          this.save(),
          e)
        : e;
    }
    removed(e) {
      this.load();
      const n = null == e ? void 0 : e.playlists;
      return n
        ? (ensureArray(n).forEach((e) => {
            if (0 !== e.indexOf("pl.")) {
              const n = Date.now();
              (this._data.playlists.removed[e] = n),
                (this._data.lastTimestamp = n);
            }
          }),
          this.save(),
          e)
        : e;
    }
    reconcile(e, n, d, p, h) {
      var y = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$o(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$o(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        y._checkTimestamp();
        const h = n.data || n;
        if (!h || !Array.isArray(h) || Array.isArray(d)) return n;
        const _ = y._data.albums.added,
          m = y._data.playlists.removed,
          g = y._data.playlists.added,
          b = [],
          P =
            (p && !p.offset) ||
            (!!d && (void 0 === d.offset || 0 === d.offset));
        let S = !1;
        if ("all" === e || "playlists" === e) {
          for (let e = h.length - 1; e >= 0; e--) {
            var T;
            const n = h[e],
              d =
                null === (T = n.playParams) || void 0 === T
                  ? void 0
                  : T.globalId;
            "library-playlists" === n.type &&
              (m[n.id]
                ? h.splice(e, 1)
                : d && g[d] && (delete g[d], (S = !0), P || h.splice(e, 1)));
          }
          if (P && y._catalogApi) {
            const e = Object.keys(g);
            if (e.length) {
              const n = yield y._catalogApi.playlists(e);
              b.splice(0, 0, ...n);
            }
          }
        }
        if (y._catalogApi && ("all" === e || "albums" === e)) {
          const e = Object.keys(_);
          if (e.length) {
            const n = yield y._catalogApi.albums(e),
              d = Object.create(null);
            n.forEach((n, p) => {
              const h = makeAlbumKey(n);
              d[h] = { catalogId: e[p], album: n };
            });
            for (let e = h.length - 1; e >= 0; e--) {
              var k;
              const n = h[e];
              if (
                (null === (k = n.playParams) || void 0 === k || k.globalId,
                "library-albums" === n.type)
              ) {
                const p = makeAlbumKey(n),
                  y = d[p];
                y &&
                  (delete _[y.catalogId],
                  (S = !0),
                  P ? delete d[p] : h.splice(e, 1));
              }
            }
            if (P) {
              const e = Object.keys(d).map((e) => d[e].album);
              e.length && b.splice(0, 0, ...e);
            }
          }
        }
        if (
          (S && y.save(),
          P &&
            b.length &&
            (b.sort((e, n) => {
              const d =
                y._data.albums.added[e.id] ||
                y._data.playlists.added[e.id] ||
                0;
              return (
                (y._data.albums.added[n.id] ||
                  y._data.playlists.added[n.id] ||
                  0) - d
              );
            }),
            h.splice(0, 0, ...b)),
          !h.length)
        )
          throw new MKError(
            MKError.Reason.CONTENT_UNAVAILABLE,
            "The requested content is not available."
          );
        const E = n.meta;
        return E && void 0 === E.total && (E.total = h.length), n;
      })();
    }
    load() {
      if (!this._sessionStorage) return;
      const e = this._sessionStorage.getItem(this._storageKey);
      if (e)
        try {
          (this._data = JSON.parse(e)),
            (this._data.albums && this._data.playlists) ||
              (this._data = this._initData());
        } catch (Yt) {
          this._data || (this._data = this._initData());
        }
      else this._data = this._initData();
    }
    save() {
      if (!this._sessionStorage) return;
      const e = this._data,
        n =
          0 === Object.keys(e.albums.added).length &&
          0 === Object.keys(e.albums.removed).length &&
          0 === Object.keys(e.playlists.added).length &&
          0 === Object.keys(e.playlists.removed).length;
      try {
        if (n)
          this._sessionStorage.getItem(this._storageKey) &&
            this._sessionStorage.removeItem(this._storageKey);
        else {
          const e = JSON.stringify(this._data);
          this._sessionStorage.setItem(this._storageKey, e);
        }
      } catch (Yt) {}
    }
    constructor(e, n, d) {
      _define_property$l(this, "_storageKey", void 0),
        _define_property$l(this, "_data", this._initData()),
        _define_property$l(this, "_catalogApi", void 0),
        _define_property$l(this, "_sessionStorage", void 0),
        (this._catalogApi = n),
        (this._storageKey = "mk-server-ledger:" + (e || "")),
        (this._sessionStorage = d || getSessionStorage()),
        this.load();
    }
  }
  function asyncGeneratorStep$n(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$n(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$n(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$n(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$k(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$b(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$k(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$6(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_metadata$9(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const yo = "me/library";
  class Library extends TokenSession {
    add(e) {
      var n = this;
      return _async_to_generator$n(function* () {
        const d = transformKeys(e, dasherize),
          p = Date.now();
        if (p - n._last < 1e3)
          return Promise.reject(new MKError(MKError.Reason.QUOTA_EXCEEDED));
        const h = new Headers({
            Authorization: "Bearer " + n.developerToken,
            [ne]: n.userToken,
          }),
          y = Object.keys(d)
            .map((e) => `ids[${e}]=${d[e].join(",")}`)
            .join("&");
        try {
          const e = yield fetch(`${n.url}/${yo}?${y}`, {
            method: "POST",
            headers: h,
          });
          return e.ok
            ? ((n._last = p), n._serverLedger.added(d))
            : Promise.reject(MKError.responseError(e));
        } catch (_) {
          return Promise.reject(MKError.responseError(_));
        }
      })();
    }
    remove(e) {
      var n = this;
      return _async_to_generator$n(function* () {
        if (!n.developerToken || !n.userToken)
          return Promise.reject("Invalid tokens");
        const d = new Headers({
            Authorization: "Bearer " + n.developerToken,
            [ne]: n.userToken,
          }),
          p = transformKeys(e, dasherize),
          h = Object.keys(p)[0],
          y = Object.values(p)[0];
        try {
          const e = yield fetch(`${n.url}/${yo}/${h}/${y}`, {
            method: "DELETE",
            headers: d,
          });
          return e.ok
            ? n._serverLedger.removed(p)
            : Promise.reject(MKError.responseError(e));
        } catch (_) {
          return Promise.reject(MKError.responseError(_));
        }
      })();
    }
    album(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.resource("albums", e, n, d);
      })();
    }
    albumRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$n(function* () {
        return h.collection(`albums/${e}/${n}`, void 0, d, p);
      })();
    }
    albums(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        let h;
        try {
          h = yield p.collection(
            "albums",
            e,
            n,
            _object_spread_props$6(_object_spread$b({}, d), {
              shouldCacheResults: !1,
            })
          );
        } catch (Yt) {
          if (
            !MKError.isMKError(Yt) ||
            Yt.reason !== MKError.Reason.CONTENT_UNAVAILABLE
          )
            throw Yt;
          h = { data: [], meta: {} };
        }
        return p._serverLedger.reconcile("albums", h, e, n, d);
      })();
    }
    artist(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.resource("artists", e, n, d);
      })();
    }
    artistRelationship(e, n = "albums", d, p) {
      var h = this;
      return _async_to_generator$n(function* () {
        return h.collection(`artists/${e}/${n}`, void 0, d, p);
      })();
    }
    artists(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.collection("artists", e, n, d);
      })();
    }
    createPlaylist(e = {}, n) {
      var d = this;
      return _async_to_generator$n(function* () {
        let p;
        const { name: h, description: y, tracks: _ = [] } = e,
          m = {
            attributes: { name: h, description: y },
            relationships: { tracks: { data: transformTrackParameters(_) } },
          },
          g = JSON.stringify(m);
        try {
          p = yield d.request(yo + "/playlists", n, {
            body: g,
            method: "POST",
          });
        } catch (q) {
          return Promise.reject(MKError.responseError(q));
        }
        try {
          const [e] = d._store.write(p);
          return e;
        } catch (q) {
          return Promise.reject(MKError.parseError(q));
        }
      })();
    }
    deletePlaylist(e, n) {
      var d = this;
      return _async_to_generator$n(function* () {
        let p;
        const h = `${yo}/playlists/${e}`;
        try {
          p = yield d.request(h, n, { method: "DELETE" });
        } catch (q) {
          return Promise.reject(MKError.responseError(q));
        }
        d.purgePlaylistFromCaches(e);
      })();
    }
    editPlaylist(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        let h;
        const y = JSON.stringify({ attributes: n });
        try {
          h = yield p.request(`${yo}/playlists/${e}`, d, {
            body: y,
            method: "PATCH",
          });
        } catch (q) {
          return Promise.reject(MKError.responseError(q));
        }
        try {
          const d = n,
            h = "library-playlists";
          return (
            p._store.write({ data: [{ type: h, id: e, attributes: d }] }), n
          );
        } catch (q) {
          return Promise.reject(MKError.parseError(q));
        }
      })();
    }
    updatePlaylistTracklist(e, n) {
      var d = this;
      return _async_to_generator$n(function* () {
        yield d.putPlaylistTracklisting(e, n, "PUT"),
          d.purgePlaylistFromCaches(e);
      })();
    }
    appendTracksToPlaylist(e, n) {
      var d = this;
      return _async_to_generator$n(function* () {
        yield d.putPlaylistTracklisting(e, n, "POST"),
          d.purgePlaylistFromCaches(e);
      })();
    }
    playlistFolder(e, n, d) {
      return this.resource("playlist-folders", e, n, d);
    }
    playlistFolders(e, n, d) {
      return this.collection("playlist-folders", e, n, d);
    }
    playlistFoldersRoot(e, n) {
      return (
        (e = _object_spread_props$6(_object_spread$b({}, e), {
          filter: _object_spread_props$6(
            _object_spread$b({}, null == e ? void 0 : e.filter),
            { identity: "playlistsroot" }
          ),
        })),
        this.playlistFolders(void 0, e, n)
      );
    }
    playlistFolderChildren(e, n, d) {
      const p = `playlist-folders/${e}/children`;
      return this.collection(p, void 0, n, d);
    }
    musicVideo(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.resource("music-videos", e, n, d);
      })();
    }
    musicVideos(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.collection("music-videos", e, n, d);
      })();
    }
    parseResultData(e, n) {
      return e ? this._store.write(n) : this._store.parse(n);
    }
    playlist(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return (
          (n = _object_spread$b({ include: "tracks" }, n)),
          p.resource("playlists", e, n, d)
        );
      })();
    }
    createCatalogPlaylist(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return (
          (d = _object_spread$b({ method: "POST" }, d)),
          p.resource(`playlists/${e}/catalog`, void 0, n, d)
        );
      })();
    }
    playlistRelationship(e, n = "tracks", d, p) {
      var h = this;
      return _async_to_generator$n(function* () {
        return h.collection(`playlists/${e}/${n}`, void 0, d, p);
      })();
    }
    playlists(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        let h;
        try {
          h =
            e && e.length > 0
              ? yield Promise.all(e.map((e) => p.playlist(e, n, d)))
              : yield p.collection(
                  "playlists",
                  e,
                  n,
                  _object_spread_props$6(_object_spread$b({}, d), {
                    shouldCacheResults: !1,
                  })
                );
        } catch (Yt) {
          if (
            !MKError.isMKError(Yt) ||
            Yt.reason !== MKError.Reason.CONTENT_UNAVAILABLE
          )
            throw Yt;
          h = { data: [], meta: {} };
        }
        return p._serverLedger.reconcile("playlists", h, e, n, d);
      })();
    }
    recentlyAdded(e, n) {
      var d = this;
      return _async_to_generator$n(function* () {
        const p = null == e ? void 0 : e.limit;
        let h;
        try {
          h = yield d.collection(
            "recently-added",
            void 0,
            transformParameters(e, p || 10),
            _object_spread_props$6(_object_spread$b({}, n), {
              shouldCacheResults: !1,
            })
          );
        } catch (Yt) {
          if (
            !MKError.isMKError(Yt) ||
            Yt.reason !== MKError.Reason.CONTENT_UNAVAILABLE
          )
            throw Yt;
          h = { data: [], meta: {} };
        }
        return d._serverLedger.reconcile("all", h, void 0, e, n);
      })();
    }
    search(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        n = p._denormalizeLibraryTypes(n);
        const h = _object_spread$b({ term: e, types: "library-albums" }, n);
        return p.collection(
          "search",
          void 0,
          h,
          _object_spread_props$6(_object_spread$b({}, d), {
            shouldCacheResults: !1,
          })
        );
      })();
    }
    song(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.resource("songs", e, n, d);
      })();
    }
    songRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$n(function* () {
        return h.collection(`songs/${e}/${n}`, void 0, d, p);
      })();
    }
    songs(e, n, d) {
      var p = this;
      return _async_to_generator$n(function* () {
        return p.collection("songs", e, n, d);
      })();
    }
    collection(e, n, d, p) {
      var h = this;
      return _async_to_generator$n(function* () {
        !n ||
          n.length ||
          d ||
          ((d = transformParameters(n, 100)), (n = void 0));
        const y = n ? _object_spread$b({ ids: n }, d) : d;
        return makeRequest(h, `${yo}/${e}`, y, p);
      })();
    }
    resource(e, n, d, p) {
      var h = this;
      return _async_to_generator$n(function* () {
        if (!(null == p ? void 0 : p.reload)) {
          const p = h._store.read(e, n, d);
          if (p) return p;
        }
        let y = `${yo}/${e}`;
        n && (y = `${y}/${n}`);
        const [_] = yield makeRequest(h, y, d, p);
        return _;
      })();
    }
    purgePlaylistFromCaches(e) {
      this._store.delete("library-playlists", e),
        this.networkCache.removeItemsMatching(
          this.constructURL(`${yo}/playlists/${e}`, {}),
          !1
        );
    }
    putPlaylistTracklisting(e, n, d = "PUT") {
      var p = this;
      return _async_to_generator$n(function* () {
        const h = transformTrackParameters(n),
          y = JSON.stringify({ data: h });
        try {
          yield p.request(`${yo}/playlists/${e}/tracks`, void 0, {
            body: y,
            method: d,
          });
        } catch (q) {
          return Promise.reject(MKError.responseError(q));
        }
      })();
    }
    _denormalizeLibraryTypes(e = {}, n = "types") {
      let d = e[n];
      return d
        ? ("string" == typeof d && (d = d.split(",")),
          (e[n] = d.map((e) =>
            e.replace(/^(albums|music-videos|playlists|songs)$/, "library-$1")
          )),
          e)
        : e;
    }
    constructor(e, n, d, p = {}, h, y) {
      super(
        e,
        n,
        _object_spread_props$6(_object_spread$b({}, y), { userToken: d })
      ),
        _define_property$k(this, "_last", 0),
        _define_property$k(this, "_store", void 0),
        _define_property$k(this, "defaultIncludePaginationMetadata", void 0),
        _define_property$k(this, "_serverLedger", void 0),
        (this._store = new LocalDataStore(p)),
        (this._serverLedger = new ServerLedger(d, h)),
        (this.defaultIncludePaginationMetadata =
          p.features && hasOwn(p.features, "api-pagination-metadata"));
    }
  }
  function asyncGeneratorStep$m(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$m(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$m(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$m(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$j(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$a(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$j(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$5(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function _ts_decorate$8(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$8(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  var _o, fo;
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      ChunkedIdApi(1),
      _ts_metadata$9("design:type", Function),
      _ts_metadata$9("design:paramtypes", [
        String,
        Object,
        "undefined" == typeof QueryParameters ? Object : QueryParameters,
        "undefined" == typeof MakeRequestOptions ? Object : MakeRequestOptions,
      ]),
      _ts_metadata$9("design:returntype", Promise),
    ],
    Library.prototype,
    "collection",
    null
  ),
    (function (e) {
      (e[(e.Global = 0)] = "Global"),
        (e.Lyrics = "lyrics"),
        (e.Catalog = "catalog"),
        (e.Personalized = "me"),
        (e.Editorial = "editorial"),
        (e.Engagement = "engagement"),
        (e.Social = "social");
    })(_o || (_o = {})),
    (function (e) {
      (e.songs = "songs"),
        (e.albums = "albums"),
        (e.playlists = "playlists"),
        (e.stations = "stations"),
        (e["music-videos"] = "music-videos"),
        (e["library-music-videos"] = "library-music-videos"),
        (e["library-playlists"] = "library-playlists"),
        (e["library-songs"] = "library-songs");
    })(fo || (fo = {}));
  class API extends TokenSession {
    get needsEquivalents() {
      const { userStorefrontId: e } = this;
      return void 0 !== e && "" !== e && e !== this.storefrontId;
    }
    activity(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "activities", e, n, d);
      })();
    }
    activities(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "activities", e, n, d);
      })();
    }
    album(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "albums", e, n, d);
      })();
    }
    albumRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h.collection("catalog", `albums/${e}/${n}`, void 0, d, p);
      })();
    }
    albums(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "albums", e, n, d);
      })();
    }
    appleCurator(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "apple-curators", e, n, d);
      })();
    }
    appleCurators(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "apple-curators", e, n, d);
      })();
    }
    artist(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "artists", e, n, d);
      })();
    }
    artistRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h.collection("catalog", `artists/${e}/${n}`, void 0, d, p);
      })();
    }
    artistView(e, n, d, p) {
      return this.collection("catalog", `artists/${e}/view/${n}`, void 0, d, p);
    }
    artists(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "artists", e, n, d);
      })();
    }
    audioBook(e, n, d) {
      return this.books.audioBook(e, n, d);
    }
    audioBooks(e, n, d) {
      return this.books.audioBooks(e, n, d);
    }
    catalogResources(e, n = {}, d) {
      const p = (function (e) {
        const n = {};
        if (!e) return n;
        for (const d of e) {
          if (!d) continue;
          const { type: e, id: p } = d;
          e in n || (n[e] = []), n[e].push(p);
        }
        return n;
      })(e);
      return (
        (n = _object_spread_props$5(_object_spread$a({}, n), { ids: p })),
        makeRequest(this, "catalog/" + this.storefrontId, n, d)
      );
    }
    changeStation(e, n, d = {}) {
      var p = this;
      return _async_to_generator$m(function* () {
        return yield makeRequest(
          p,
          "me/stations/change-station/" + e,
          n,
          _object_spread_props$5(_object_spread$a({}, d), {
            reload: !0,
            method: "POST",
            shouldCacheResults: !1,
          })
        );
      })();
    }
    charts(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection(
          "catalog",
          "charts",
          e,
          n,
          _object_spread_props$5(_object_spread$a({}, d), {
            returnRawJSONApiRecords: !0,
          })
        );
      })();
    }
    contents(e, n, d) {
      return this.collection("catalog", "contents", e, n, d);
    }
    curator(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "contents", e, n, d);
      })();
    }
    curators(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "contents", e, n, d);
      })();
    }
    curatorRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h.collection("catalog", `curators/${e}/${n}`, void 0, d, p);
      })();
    }
    episode(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p._podcastsAPI.catalogResource("podcast-episodes", e, n, d);
      })();
    }
    episodes(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p._podcastsAPI.catalogResources("podcast-episodes", e, n, d);
      })();
    }
    genre(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "genres", e, n, d);
      })();
    }
    genres(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "genres", e, n, d);
      })();
    }
    grouping(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        !n && isObject(e) && ((n = e), (e = void 0));
        const h = _object_spread$a({}, { platform: "desktop" }, n);
        return p.resource(
          "editorial",
          "groupings",
          e,
          h,
          _object_spread_props$5(_object_spread$a({}, d), {
            shouldCacheResults: !1,
          })
        );
      })();
    }
    groupings(e, n = {}, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = _object_spread$a({}, { platform: "desktop" }, n);
        return p.collection(
          "editorial",
          "groupings",
          e,
          h,
          _object_spread_props$5(_object_spread$a({}, d), {
            shouldCacheResults: !1,
          })
        );
      })();
    }
    lyric(e, n, d) {
      return this.resource(
        "catalog",
        `songs/${e}/lyrics`,
        "",
        n,
        _object_spread$a({ reload: !0 }, d)
      );
    }
    lyricSnippet(e, n, d) {
      return this.collection(
        "lyrics",
        "snippet/songs",
        e,
        n,
        _object_spread_props$5(_object_spread$a({}, d), {
          returnRawJSONApiRecords: !0,
        })
      );
    }
    historyHeavyRotation(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        return d.collection(
          "me",
          "history/heavy-rotation",
          void 0,
          transformParameters(e, 10),
          n
        );
      })();
    }
    multiplex(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = p._store.read("multiplex", e, n);
        return (
          h ||
          ((d = _object_spread$a({ returnRawJSONApiRecords: !0 }, d)),
          makeRequest(p, `editorial/${p.storefrontId}/multiplex/${e}`, n, d))
        );
      })();
    }
    multiroom(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = p._store.read("multirooms", e, n);
        if (h) return h;
        const [y] = yield p.collection(
          "editorial",
          "multirooms/" + e,
          void 0,
          n,
          d
        );
        return y;
      })();
    }
    musicMovie(e, n, d) {
      return this.resource("catalog", "music-movies", e, n, d);
    }
    musicMovies(e, n, d) {
      return this.collection("catalog", "music-movies", e, n, d);
    }
    musicVideo(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "music-videos", e, n, d);
      })();
    }
    musicVideos(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "music-videos", e, n, d);
      })();
    }
    nextStationTracks(e, n, d = {}) {
      var p = this;
      return _async_to_generator$m(function* () {
        var h;
        const y = null !== (h = d.queryParameters) && void 0 !== h ? h : {};
        (null == n ? void 0 : n.clean) && ((y.clean = n.clean), delete n.clean),
          (null == n ? void 0 : n.limit) &&
            ((y.limit = n.limit), delete n.limit);
        return yield makeRequest(
          p,
          "me/stations/next-tracks/" + e,
          n,
          _object_spread_props$5(_object_spread$a({}, d), {
            reload: !0,
            method: "POST",
            queryParameters: y,
            shouldCacheResults: !1,
          })
        );
      })();
    }
    continuousStation(e, n, d = {}) {
      var p = this;
      return _async_to_generator$m(function* () {
        return yield makeRequest(
          p,
          "me/stations/continuous",
          e,
          _object_spread_props$5(_object_spread$a({}, d), {
            reload: !0,
            method: "POST",
            queryParameters: n,
            returnRawJSONApiRecords: !0,
            shouldCacheResults: !1,
          })
        );
      })();
    }
    playlist(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "playlists", e, n, d);
      })();
    }
    playlistRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h.collection("catalog", `playlists/${e}/${n}`, void 0, d, p);
      })();
    }
    playlists(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("catalog", "playlists", e, n, d);
      })();
    }
    podcast(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p._podcastsAPI.catalogResource(
          "podcasts",
          e,
          _object_spread$a({ include: "episodes" }, n),
          d
        );
      })();
    }
    podcastRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h._podcastsAPI.catalogResourceRelationship(
          "podcasts",
          e,
          n,
          d,
          p
        );
      })();
    }
    podcasts(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p._podcastsAPI.catalogResources(
          "podcasts",
          e,
          _object_spread$a({ include: "episodes" }, n),
          d
        );
      })();
    }
    recentPlayed(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        return d.collection(
          "me",
          "recent/played",
          void 0,
          transformParameters(e, 10),
          n
        );
      })();
    }
    recentRadioStations(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        return d.collection(
          "me",
          "recent/radio-stations",
          void 0,
          transformParameters(e, 10),
          n
        );
      })();
    }
    recordLabel(e, n, d) {
      return this.resource("catalog", "record-labels", e, n, d);
    }
    recordLabels(e, n, d) {
      return this.collection("catalog", "record-labels", e, n, d);
    }
    recordLabelView(e, n, d, p) {
      return this.collection(
        "catalog",
        `record-labels/${e}/view/${n}`,
        void 0,
        d,
        p
      );
    }
    personalRecommendation(e, n, d, p = !0) {
      var h = this;
      return _async_to_generator$m(function* () {
        const y = yield h.personalRecommendations(e, n, d, p),
          [_] = y;
        return _;
      })();
    }
    refreshPersonalRecommendation(e, n, d) {
      return (
        (n = _object_spread$a({ timezone: formatTimezoneOffset() }, n)),
        (d = _object_spread_props$5(_object_spread$a({}, d), {
          method: "POST",
          queryParameters: n,
        })),
        this.resource("me", "recommendations", e, void 0, d)
      );
    }
    personalRecommendations(e, n, d = {}, p = !0) {
      var h = this;
      return _async_to_generator$m(function* () {
        const y = formatTimezoneOffset(),
          _ = yield h.collection(
            "me",
            "recommendations",
            e,
            _object_spread$a({ timezone: y }, n),
            _object_spread_props$5(_object_spread$a({}, d), {
              shouldCacheResults: p,
              returnRawJSONApiRecords: !0,
            })
          );
        h._reindexRelationships(_, "recommendations");
        try {
          return mapRequestResult(_, (e) => h.parseResultData(!1, e));
        } catch (q) {
          return Promise.reject(MKError.parseError(q));
        }
      })();
    }
    personalRecommendationView(e, n, d, p = {}) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h.collection(
          "me",
          `recommendations/${e}/view/${n}`,
          void 0,
          d,
          p
        );
      })();
    }
    recommendations(e, n, d = {}) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = formatTimezoneOffset(),
          y = yield p.collection(
            0,
            "recommendations/" + p.storefrontId,
            e,
            _object_spread$a({ timezone: h }, n),
            _object_spread_props$5(_object_spread$a({}, d), {
              shouldCacheResults: !1,
              returnRawJSONApiRecords: !0,
            })
          );
        p._reindexRelationships(y, "recommendations");
        try {
          return mapRequestResult(y, (e) => p.parseResultData(!1, e));
        } catch (q) {
          return Promise.reject(MKError.parseError(q));
        }
      })();
    }
    recommendedFriends(e, n, d = {}) {
      return (
        (d = _object_spread_props$5(_object_spread$a({}, d), {
          method: "POST",
          body: JSON.stringify(
            _object_spread$a({ ids: { socialProfiles: e } }, d.body)
          ),
        })),
        this.collection(
          0,
          "social/recommended-friends",
          void 0,
          n,
          _object_spread_props$5(_object_spread$a({}, d), {
            shouldCacheResults: !1,
            returnRawJSONApiRecords: !0,
          })
        )
      );
    }
    room(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = p._store.read("rooms", e, n);
        if (h && h.hasAttributes("title")) return h;
        const y = yield p.collection("editorial", "rooms/" + e, void 0, n, d),
          [_] = y;
        return _;
      })();
    }
    roomContents(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection("editorial", `rooms/${e}/contents`, void 0, n, d);
      })();
    }
    search(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = _object_spread$a({ term: e }, n);
        return (
          (d = _object_spread_props$5(_object_spread$a({}, d), {
            useRawResponse: !0,
          })),
          p.collection(
            "catalog",
            "search",
            void 0,
            h,
            _object_spread_props$5(_object_spread$a({}, d), {
              shouldCacheResults: !1,
            })
          )
        );
      })();
    }
    searchHints(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const h = _object_spread$a({ term: e }, n),
          y = yield p.collection(
            "catalog",
            "search/hints",
            void 0,
            h,
            _object_spread_props$5(_object_spread$a({}, d), {
              returnRawJSONApiRecords: !0,
            })
          );
        return (
          "topResults" === (null == h ? void 0 : h.with) &&
            "topResults" in y &&
            (y.topResults = p.parseResultData(!0, y.topResults)),
          y
        );
      })();
    }
    searchQuery(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        return (
          (n = _object_spread_props$5(_object_spread$a({}, n), {
            useRawResponse: !0,
          })),
          d.collection(
            "catalog",
            "search/query",
            void 0,
            e,
            _object_spread_props$5(_object_spread$a({}, n), {
              shouldCacheResults: !1,
            })
          )
        );
      })();
    }
    searchSuggestions(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        n = _object_spread$a({ term: e }, n);
        const h = yield p.collection(
          "catalog",
          "search/suggestions",
          void 0,
          n,
          _object_spread_props$5(_object_spread$a({}, d), {
            returnRawJSONApiRecords: !0,
          })
        );
        return (
          Array.isArray(null == h ? void 0 : h.suggestions) &&
            h.suggestions.forEach((e) => {
              "topResults" === e.kind &&
                (e.content = p.parseResultData(!0, [e.content])[0]);
            }),
          h
        );
      })();
    }
    socialBadgingMap(e, n) {
      return this.collection(
        0,
        "social/badging-map",
        void 0,
        e,
        _object_spread_props$5(_object_spread$a({}, n), {
          returnRawJSONApiRecords: !0,
        })
      );
    }
    socialProfile(e, n, d) {
      return this.resource("social", "social-profiles", e, n, d);
    }
    socialProfiles(e, n, d) {
      return this.collection("social", "social-profiles", e, n, d);
    }
    personalSocialProfile(e, n) {
      return this.resource("me", "social-profile", void 0, e, n);
    }
    socialPost(e, n = {}, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        e.startsWith("sa.") ? (n.filter = { post: e }) : (n.ids = e);
        const [h] = yield p.collection("catalog", "contents", "", n, d);
        return h;
      })();
    }
    socialSearch(e, n = {}, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          (n = _object_spread_props$5(_object_spread$a({}, n), { term: e })),
          p.collection("social", "search", void 0, n, d)
        );
      })();
    }
    song(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "songs", e, n, d);
      })();
    }
    songRelationship(e, n, d, p) {
      var h = this;
      return _async_to_generator$m(function* () {
        return h.collection("catalog", `songs/${e}/${n}`, void 0, d, p);
      })();
    }
    songs(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          !n && isObject(e) && ((n = e), (e = void 0)),
          p.collection("catalog", "songs", e, n, d)
        );
      })();
    }
    tastePreferences(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        return d.collection(
          "me",
          "taste/taste-preferences",
          void 0,
          e,
          _object_spread_props$5(_object_spread$a({}, n), {
            shouldCacheResults: !1,
          })
        );
      })();
    }
    saveTastePreferences(e) {
      var n = this;
      return _async_to_generator$m(function* () {
        e = e.map((e) => (e instanceof DataRecord ? e.serialize().data : e));
        const d = {
          method: "POST",
          body: JSON.stringify({ data: e }),
          shouldCacheResults: !0,
        };
        try {
          return yield makeRequest(n, "me/taste/taste-preferences", void 0, d);
        } catch (q) {
          return MKError.isMKError(q) &&
            q.reason === MKError.Reason.CONTENT_UNAVAILABLE
            ? []
            : Promise.reject(MKError.parseError(q));
        }
      })();
    }
    tvEpisode(e, n, d) {
      return this.resource(
        "catalog",
        "tv-episodes",
        e,
        _object_spread$a({ include: "seasons" }, n),
        d
      );
    }
    tvEpisodes(e, n, d) {
      return this.collection(
        "catalog",
        "tv-episodes",
        e,
        _object_spread$a({ include: "seasons" }, n),
        d
      );
    }
    tvSeason(e, n, d) {
      return this.resource(
        "catalog",
        "tv-seasons",
        e,
        _object_spread$a({ include: "episodes" }, n),
        d
      );
    }
    tvSeasons(e, n, d) {
      return this.collection(
        "catalog",
        "tv-seasons",
        e,
        _object_spread$a({ include: "episodes" }, n),
        d
      );
    }
    tvShow(e, n, d) {
      return this.resource("catalog", "tv-shows", e, n, d);
    }
    tvShows(e, n, d) {
      return this.collection("catalog", "tv-shows", e, n, d);
    }
    uploadedAudio(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          (n = _object_spread$a({ include: "curator,artists" }, n)),
          p.resource("catalog", "uploaded-audios", e, n, d)
        );
      })();
    }
    uploadedAudios(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          (n = _object_spread$a({ include: "curator,artists" }, n)),
          p.collection("catalog", "uploaded-audios", e, n, d)
        );
      })();
    }
    uploadedVideo(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          (n = _object_spread$a({ include: "curator,artists" }, n)),
          p.resource("catalog", "uploaded-videos", e, n, d)
        );
      })();
    }
    uploadedVideos(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          (n = _object_spread$a({ include: "curator,artists" }, n)),
          p.collection("catalog", "uploaded-videos", e, n, d)
        );
      })();
    }
    upsellMarketingItems(e, n) {
      return this.collection(
        "engagement",
        "upsell/marketing-items",
        void 0,
        e,
        n
      );
    }
    station(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("catalog", "stations", e, n, d);
      })();
    }
    stations(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return (
          !n && isObject(e) && ((n = e), (e = void 0)),
          p.collection("catalog", "stations", e, n, d)
        );
      })();
    }
    storefront(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource(0, "storefronts", e, n, d);
      })();
    }
    storefronts(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.collection(0, "storefronts", e, n, d);
      })();
    }
    musicSummary(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        return p.resource("me", "music-summaries", e, n, d);
      })();
    }
    musicSummarySearch(e = {}, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        return d.collection("me", "music-summaries/search", void 0, e, n);
      })();
    }
    addToLibrary(e) {
      var n = this;
      return _async_to_generator$m(function* () {
        return n.developerToken && n.userToken && n.library
          ? n.library.add(e)
          : Promise.reject("Invalid tokens");
      })();
    }
    rating(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        const [h] = yield p.ratings(e, n, d);
        return h;
      })();
    }
    ratings(e, n, d) {
      if (!this.developerToken || !this.userToken)
        return Promise.reject("Invalid tokens");
      const [p] = Object.keys(e),
        h = e[p],
        y = Array.isArray(h);
      if (y && 0 === h.length) return Promise.resolve([]);
      let _ = "me/ratings/" + formatRatingsContentType(p, y ? h[0] : h);
      return (
        y
          ? (n = _object_spread_props$5(_object_spread$a({}, n), {
              ids: h.map(normalizeAdamId),
            }))
          : (_ = `${_}/${normalizeAdamId(h)}`),
        makeRequest(
          this,
          _,
          n,
          _object_spread$a(
            { shouldCacheResults: !1, reload: !0, includePagination: !1 },
            d
          )
        )
      );
    }
    putRating(e, n, d) {
      var p = this;
      return _async_to_generator$m(function* () {
        if (!p.developerToken || !p.userToken)
          return Promise.reject("Invalid tokens");
        const [h] = Object.keys(e),
          y = e[h],
          _ = formatRatingsContentType(h, y),
          m = {
            method: "PUT",
            body: JSON.stringify({ type: "rating", attributes: { value: n } }),
            includePagination: !1,
          },
          g = yield makeRequest(
            p,
            `me/ratings/${_}/${normalizeAdamId(y)}`,
            d,
            _object_spread$a({ shouldCacheResults: !1 }, m)
          ),
          [b] = g;
        return b;
      })();
    }
    deleteRating(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        if (!d.developerToken || !d.userToken)
          return Promise.reject("Invalid tokens");
        const [p] = Object.keys(e),
          h = e[p],
          y = formatRatingsContentType(p, h);
        if (Array.isArray(h))
          return Promise.all(h.map((e) => d.deleteRating({ [p]: e }, n))).then(
            () => {}
          );
        yield makeRequest(d, `me/ratings/${y}/${h}`, n, {
          method: "DELETE",
          shouldCacheResults: !1,
          returnRawJSONApiRecords: !0,
        });
        try {
          d._store.delete(y, h);
        } catch (q) {
          return Promise.reject(MKError.parseError(q));
        }
      })();
    }
    equivalent(e, n) {
      var d = this;
      return _async_to_generator$m(function* () {
        let p = `catalog/${d.userStorefrontId}/${e}`,
          h = {};
        switch (e) {
          case "albums":
          case "songs":
            h = { "filter[equivalents]": n };
            break;
          case "artists":
          case "playlists":
            p = `${p}/${n}`;
            break;
          default:
            return Promise.reject(
              new MKError(
                MKError.Reason.INVALID_ARGUMENTS,
                "Invalid equivalent type"
              )
            );
        }
        return d.resource(0, p, "", h);
      })();
    }
    collection(e, n, d, p, h) {
      var y = this;
      return _async_to_generator$m(function* () {
        let _,
          m,
          g = null == h ? void 0 : h.shouldCacheResults;
        switch (
          ((_ = d
            ? _object_spread$a({ ["charts" === n ? "types" : "ids"]: d }, p)
            : p),
          e)
        ) {
          case "catalog":
          case "editorial":
          case "engagement":
          case "social":
          case "lyrics":
            const d = y.storefrontId;
            m = `${e}/${d}/${n}`;
            break;
          case 0:
            m = n;
            break;
          case "me":
            (m = `${e}/${n}`), (g = !1);
        }
        return makeRequest(
          y,
          m,
          _,
          _object_spread_props$5(_object_spread$a({}, h), {
            shouldCacheResults: g,
          })
        );
      })();
    }
    parseResultData(e, n) {
      return e ? this._store.write(n) : this._store.parse(n);
    }
    resource(e, n, d, p, h) {
      var y = this;
      return _async_to_generator$m(function* () {
        if (!(null == h ? void 0 : h.reload)) {
          const e = y._store.read(n, d, p);
          if (e) return e;
        }
        const [_] = yield y.collection(e, n, d, p, h);
        return _;
      })();
    }
    _reindexRelationships(e, n) {
      ("data" in e ? e.data : e).forEach((e) => {
        hasOwn(e, "relationships") &&
          hasOwn(e.relationships, n) &&
          hasOwn(e.relationships[n], "data") &&
          Array.isArray(e.relationships[n].data) &&
          e.relationships[n].data.forEach((e, n) => {
            e.id = `${e.id}-${n}`;
          });
      });
    }
    constructor(e, n, d, p, h, y, _ = {}, m) {
      super(
        e,
        n,
        _object_spread_props$5(_object_spread$a({}, m), {
          userToken: p,
          storage: y,
        })
      ),
        _define_property$j(this, "_store", void 0),
        _define_property$j(this, "v3", void 0),
        _define_property$j(this, "storefrontId", Fe.ID),
        _define_property$j(this, "defaultIncludePaginationMetadata", void 0),
        _define_property$j(this, "resourceRelatives", {
          artists: {
            albums: { include: "tracks" },
            playlists: { include: "tracks" },
            songs: null,
          },
        }),
        _define_property$j(this, "userStorefrontId", void 0),
        _define_property$j(this, "library", void 0),
        _define_property$j(this, "books", void 0),
        _define_property$j(this, "tvLibrary", void 0),
        _define_property$j(this, "_podcastsAPI", void 0),
        _define_property$j(this, "fitness", void 0),
        (this.defaultIncludePaginationMetadata =
          _.features && hasOwn(_.features, "api-pagination-metadata")),
        (this._store = new LocalDataStore(_)),
        d && (this.storefrontId = d.toLowerCase()),
        p && h && (this.userStorefrontId = h.toLowerCase()),
        (this._podcastsAPI = new Podcasts(
          n,
          p,
          d,
          y,
          _,
          _object_spread$a({}, m)
        )),
        (this.fitness = new Fitness(n, p, d, y, _, _object_spread$a({}, m))),
        (this.tvLibrary = new TVLibrary(n, p, y, _, _object_spread$a({}, m))),
        (this.library = new Library(e, n, p, _, this, _object_spread$a({}, m))),
        (this.books = new Books(n, p, d, y, _, _object_spread$a({}, m))),
        (this.v3 = new MediaAPIV3({
          developerToken: n,
          mediaUserToken: p,
          storefrontId: d,
          realmConfig: { music: { url: e.replace(/\/v[0-9]+(\/)?$/, "") } },
        }));
    }
  }
  function asyncGeneratorStep$l(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$l(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$l(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$l(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$i(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  let mo;
  _ts_decorate$8(
    [
      RecommendationUpdate(),
      _ts_metadata$8("design:type", Function),
      _ts_metadata$8("design:paramtypes", [
        Object,
        "undefined" == typeof QueryParameters ? Object : QueryParameters,
        "undefined" == typeof MakeRequestOptions ? Object : MakeRequestOptions,
        void 0,
      ]),
      _ts_metadata$8("design:returntype", Promise),
    ],
    API.prototype,
    "personalRecommendations",
    null
  ),
    _ts_decorate$8(
      [
        RecommendationUpdate(),
        _ts_metadata$8("design:type", Function),
        _ts_metadata$8("design:paramtypes", [
          Object,
          "undefined" == typeof QueryParameters ? Object : QueryParameters,
          "undefined" == typeof MakeRequestOptions
            ? Object
            : MakeRequestOptions,
        ]),
        _ts_metadata$8("design:returntype", Promise),
      ],
      API.prototype,
      "recommendations",
      null
    ),
    _ts_decorate$8(
      [
        ChunkedIdApi(2),
        _ts_metadata$8("design:type", Function),
        _ts_metadata$8("design:paramtypes", [
          void 0 === _o ? Object : _o,
          String,
          Object,
          "undefined" == typeof QueryParameters ? Object : QueryParameters,
          "undefined" == typeof InternalMakeRequestOptions
            ? Object
            : InternalMakeRequestOptions,
        ]),
        _ts_metadata$8("design:returntype", Promise),
      ],
      API.prototype,
      "collection",
      null
    );
  const vo = (function () {
      var e = _async_to_generator$l(function* (e, n = !1) {
        if (mo && !n) {
          if (void 0 === e.storefrontId || e.storefrontId === mo.storefrontId)
            return mo;
          mo.clear();
        }
        return (
          (mo = new MediaAPIService(e.dispatcher)), yield mo.configure(e), mo
        );
      });
      return function (n) {
        return e.apply(this, arguments);
      };
    })(),
    go = {
      album: {
        isPlural: !1,
        apiMethod: "album",
        relationshipMethod: {
          method: "albumRelationship",
          relationship: "tracks",
        },
      },
      albums: { isPlural: !0, apiMethod: "albums" },
      audioBook: { isPlural: !1, apiMethod: "audioBook" },
      audioBooks: { isPlural: !0, apiMethod: "audioBooks" },
      episode: { isPlural: !1, apiMethod: "episode" },
      episodes: { isPlural: !0, apiMethod: "episodes" },
      musicVideo: { isPlural: !1, apiMethod: "musicVideo" },
      musicVideos: { isPlural: !0, apiMethod: "musicVideos" },
      musicMovie: { isPlural: !1, apiMethod: "musicMovie" },
      musicMovies: { isPlural: !0, apiMethod: "musicMovies" },
      podcast: { isPlural: !1, apiMethod: "podcast" },
      podcasts: { isPlural: !0, apiMethod: "podcasts" },
      playlist: {
        isPlural: !1,
        apiMethod: "playlist",
        relationshipMethod: {
          method: "playlistRelationship",
          relationship: "tracks",
        },
      },
      playlists: { isPlural: !0, apiMethod: "playlists" },
      song: { isPlural: !1, apiMethod: "song" },
      songs: { isPlural: !0, apiMethod: "songs" },
      tvEpisode: { isPlural: !1, apiMethod: "tvEpisode" },
      tvEpisodes: { isPlural: !0, apiMethod: "tvEpisodes" },
      uploadedAudio: { isPlural: !1, apiMethod: "uploadedAudio" },
      uploadedAudios: { isPlural: !0, apiMethod: "uploadedAudios" },
      uploadedVideo: { isPlural: !1, apiMethod: "uploadedVideo" },
      uploadedVideos: { isPlural: !0, apiMethod: "uploadedVideos" },
    };
  class MediaAPIService {
    get isConfigured() {
      return void 0 !== this._api;
    }
    get api() {
      if (void 0 === this._api)
        throw new MKError(
          MKError.Reason.CONFIGURATION_ERROR,
          "The API cannot be accessed before it is configured."
        );
      return this._api;
    }
    get storefrontId() {
      return this.store && this.store.storefrontId;
    }
    configure(e) {
      var n = this;
      return _async_to_generator$l(function* () {
        void 0 !== e.store &&
          ((n.store = e.store),
          [
            ya.authorizationStatusDidChange,
            ya.userTokenDidChange,
            ya.storefrontIdentifierDidChange,
            ya.storefrontCountryCodeDidChange,
          ].forEach((e) => {
            n.store.storekit.addEventListener(e, () => n.resetAPI());
          }),
          n._initializeAPI(e));
      })();
    }
    clear() {
      this.api && this.api.clearNetworkCache && this.api.clearNetworkCache();
    }
    getAPIForItem(e) {
      var n = this;
      return _async_to_generator$l(function* () {
        return k(e)
          ? (yield n.store.authorize(), n.api.library || n.api)
          : n.api;
      })();
    }
    resetAPI() {
      var e = this;
      return _async_to_generator$l(function* () {
        e.clear(), e._initializeAPI();
      })();
    }
    _initializeAPI(e) {
      if (void 0 !== (null == e ? void 0 : e.api))
        return void (this._api = e.api);
      const n = (e && e.store) || this.store;
      if (void 0 === n) return;
      const d = $a.features["api-session-storage"]
          ? getSessionStorage()
          : void 0,
        p = (e && e.storefrontId) || n.storefrontId,
        h = new API(
          this.url,
          n.developerToken,
          p,
          n.storekit.userToken,
          n.storekit.storefrontCountryCode,
          d,
          $a,
          null == e ? void 0 : e.sessionOptions
        );
      (this._api = h.v3), (this._api = h);
    }
    _updateStorefrontId(e) {
      var n = this;
      return _async_to_generator$l(function* () {
        (n.api && e === n.api.storefrontId) ||
          (yield n.configure({
            dispatcher: n._dispatcher,
            store: n.store,
            storefrontId: e,
          }));
      })();
    }
    constructor(e) {
      if (
        (_define_property$i(this, "_dispatcher", void 0),
        _define_property$i(this, "namedQueueOptions", void 0),
        _define_property$i(this, "url", void 0),
        _define_property$i(this, "store", void 0),
        _define_property$i(this, "_api", void 0),
        (this._dispatcher = e),
        !$a.urls.mediaApi)
      )
        throw new Error("bag.urls.mediaApi is not configured");
      (this.url = $a.urls.mediaApi), (this.namedQueueOptions = go);
      var n = this;
      this._dispatcher.subscribe(
        kt.apiStorefrontChanged,
        (function () {
          var e = _async_to_generator$l(function* (e, { storefrontId: d }) {
            yield n._updateStorefrontId(d);
          });
          return function (n, d) {
            return e.apply(this, arguments);
          };
        })()
      );
    }
  }
  function asyncGeneratorStep$k(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$k(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$k(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$k(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$h(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function configure$2(e) {
    return _configure$2.apply(this, arguments);
  }
  function _configure$2() {
    return (_configure$2 = _async_to_generator$k(function* (e) {
      const n = new UTSClientService();
      return yield n.configure(e), n;
    })).apply(this, arguments);
  }
  class UTSClientService {
    get isConfigured() {
      return void 0 !== this.api;
    }
    configure(e) {
      var n = this;
      return _async_to_generator$k(function* () {
        n.api = e.api;
      })();
    }
    clear() {}
    getAPIForItem(e) {
      var n = this;
      return _async_to_generator$k(function* () {
        if (void 0 === n.api) throw new Error("UTS has not been configured");
        return n.api;
      })();
    }
    constructor() {
      _define_property$h(this, "api", void 0),
        _define_property$h(this, "namedQueueOptions", {}),
        _define_property$h(this, "url", "");
    }
  }
  var bo;
  !(function (e) {
    (e.MEDIA_API = "media-api"), (e.UTS_CLIENT = "uts-client");
  })(bo || (bo = {}));
  const createMediaAPIServiceDescriptor = (e) => {
    let n;
    var d;
    "api" in e
      ? (n = { api: e.api })
      : (n = null !== (d = e.configureOptions) && void 0 !== d ? d : {});
    return { apiType: "media-api", options: n };
  };
  function asyncGeneratorStep$j(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$g(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$9(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$g(e, n, d[n]);
        });
    }
    return e;
  }
  class APIServiceManager {
    get api() {
      return this.getApiByType(this._defaultAPI);
    }
    get apiService() {
      if (void 0 !== this._defaultAPI)
        return this._apisByType[this._defaultAPI];
      Ye.error("There is no API instance configured");
    }
    get mediaAPI() {
      return this.getApiByType(bo.MEDIA_API);
    }
    get utsClient() {
      return this.getApiByType(bo.UTS_CLIENT);
    }
    getApiByType(e) {
      let n;
      if (
        (void 0 !== e && (n = this._apisByType[e]),
        void 0 === n || void 0 === n.api)
      )
        throw new MKError(
          MKError.Reason.CONFIGURATION_ERROR,
          "There is no API instance configured for the requested type: " + e
        );
      return n.api;
    }
    set defaultApiType(e) {
      this._defaultAPI = e;
    }
    registerAPIService(e) {
      var n = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$j(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$j(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        const { apiType: d, options: p } = e,
          h = { store: n.store, dispatcher: n._dispatcher };
        void 0 === n._defaultAPI && (n._defaultAPI = d),
          d === bo.MEDIA_API
            ? (n._apisByType[d] = yield vo.call(n, _object_spread$9({}, p, h)))
            : d === bo.UTS_CLIENT &&
              (n._apisByType[d] = yield configure$2.call(
                n,
                _object_spread$9({}, p, h)
              ));
      })();
    }
    constructor(e, n) {
      _define_property$g(this, "store", void 0),
        _define_property$g(this, "_dispatcher", void 0),
        _define_property$g(this, "_apisByType", void 0),
        _define_property$g(this, "_defaultAPI", void 0),
        (this.store = e),
        (this._dispatcher = n),
        (this._apisByType = {});
    }
  }
  const Po = {};
  function adaptAddEventListener(e, n, d, p = {}) {
    const { once: h } = p,
      y = (function (e, n) {
        const d = getCallbacksForName(e),
          wrappedCallback = (e, d) => {
            n(d);
          };
        return d.push([n, wrappedCallback]), wrappedCallback;
      })(n, d);
    !0 === h ? e.subscribeOnce(n, y) : e.subscribe(n, y);
  }
  function getCallbacksForName(e) {
    let n = Po[e];
    return n || ((n = []), (Po[e] = n)), n;
  }
  function asyncGeneratorStep$i(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$i(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$i(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$i(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$f(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  const So = Ye.createChild("rtc");
  class RTCStreamingTracker {
    get isConfigured() {
      return void 0 !== this.instance;
    }
    configure(e) {
      var n = this;
      return _async_to_generator$i(function* () {
        n.instance = e.instance;
      })();
    }
    handleEvent(e, n, d) {}
    loadScript() {
      return _async_to_generator$i(function* () {
        if (!$a.urls.rtc) throw new Error("bag.urls.rtc is not configured");
        yield loadScript($a.urls.rtc);
      })();
    }
    prepareReportingAgent(e) {
      this.clearReportingAgent();
      const {
        Sender: n,
        ClientName: d,
        ServiceName: p,
        ApplicationName: h,
        ReportingStoreBag: y,
        DeviceName: _,
      } = window.rtc.RTCReportingAgentConfigKeys;
      e = null != e ? e : this.instance.nowPlayingItem;
      const m = (function (e) {
        for (var n = 1; n < arguments.length; n++) {
          var d = null != arguments[n] ? arguments[n] : {},
            p = Object.keys(d);
          "function" == typeof Object.getOwnPropertySymbols &&
            (p = p.concat(
              Object.getOwnPropertySymbols(d).filter(function (e) {
                return Object.getOwnPropertyDescriptor(d, e).enumerable;
              })
            )),
            p.forEach(function (n) {
              _define_property$f(e, n, d[n]);
            });
        }
        return e;
      })(
        {
          firmwareVersion: this.generateBrowserVersion(),
          model: this.options.browserName,
        },
        this.getMediaIdentifiers(e)
      );
      void 0 === this._storeBag && (this._storeBag = this.generateStoreBag());
      const g = {
        [n]: "HLSJS",
        [d]: this.options.clientName,
        [p]: this.options.serviceName,
        [h]: this.options.applicationName,
        [y]: this._storeBag,
        [_]: this.options.osVersion,
        userInfoDict: m,
      };
      return (
        So.debug("RTC: creating reporting agent with config", g),
        (this.reportingAgent = new window.rtc.RTCReportingAgent(g)),
        So.debug("RTC: created reporting agent", this.reportingAgent),
        this.reportingAgent
      );
    }
    cleanup() {
      var e = this;
      return _async_to_generator$i(function* () {
        e.clearReportingAgent();
      })();
    }
    getMediaIdentifiers(e) {
      const n = null == e ? void 0 : e.defaultPlayable;
      if (n) {
        var d;
        const e = {};
        return (
          void 0 !==
            (null === (d = n.mediaMetrics) || void 0 === d
              ? void 0
              : d.MediaIdentifier) &&
            (e.MediaIdentifier = n.mediaMetrics.MediaIdentifier),
          void 0 !== n.channelId && (e.ContentProvider = n.channelId),
          e
        );
      }
      return "musicVideo" === (null == e ? void 0 : e.type)
        ? { MediaIdentifier: "adamid=" + e.id }
        : (null == e ? void 0 : e.isLiveVideoStation)
          ? { MediaIdentifier: "raid=" + e.id }
          : void 0;
    }
    clearReportingAgent() {
      void 0 !== this.reportingAgent &&
        (this.reportingAgent.destroy(),
        So.debug("RTC: called destroy on reporting agent", this.reportingAgent),
        (this.reportingAgent = void 0));
    }
    generateBrowserVersion() {
      return this.options.browserMajorVersion
        ? `${this.options.browserMajorVersion}.${this.options.browserMinorVersion || 0}`
        : "unknown";
    }
    generateStoreBag() {
      var e;
      const {
          storeBagURL: n,
          clientName: d,
          applicationName: p,
          serviceName: h,
          browserName: y,
        } = this.options,
        _ = {
          iTunesAppVersion: `${`${$a.app.name}-${$a.app.build}`}/${null === (e = this.instance) || void 0 === e ? void 0 : e.version}`,
        },
        m = new window.rtc.RTCStorebag.RTCReportingStoreBag(n, d, h, p, y, _);
      return So.debug("RTC: created store bag", m), m;
    }
    constructor(e) {
      _define_property$f(this, "options", void 0),
        _define_property$f(this, "reportingAgent", void 0),
        _define_property$f(this, "instance", void 0),
        _define_property$f(this, "currentMediaItem", void 0),
        _define_property$f(this, "_storeBag", void 0),
        _define_property$f(this, "requestedEvents", []),
        (this.options = e);
    }
  }
  function asyncGeneratorStep$h(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$e(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$7(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$7(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class PlayActivityService {
    cleanup() {
      this.trackers.forEach((e) => {
        var n;
        return null === (n = e.cleanup) || void 0 === n ? void 0 : n.call(e);
      }),
        this.clearIntention(),
        this.teardownListeners(),
        this.registeredEvents.clear();
    }
    configure(e) {
      var n = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$h(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$h(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        n.cleanup(),
          (n.registeredEvents = (function (e) {
            const n = [];
            for (const d of e) n.push(...d.requestedEvents);
            return new Set(n);
          })(n.trackers)),
          n.setupListeners();
        try {
          yield Promise.all(n.trackers.map((n) => n.configure(e)));
        } catch (Yt) {
          Ye.error("Error configuring a play activity service", Yt);
        }
      })();
    }
    getTrackerByType(e) {
      return this.trackers.find((n) => n instanceof e);
    }
    handleEvent(e, n = {}) {
      const d = this.addIntention(e, n);
      e === kt.playerActivate &&
        (d.flush = "boolean" == typeof n.isPlaying ? !n.isPlaying : void 0);
      for (const p of this.trackers) p.handleEvent(e, d, n.item);
    }
    addIntention(e, n) {
      if (![kt.playbackPause, kt.playbackStop].includes(e)) return n;
      const d = (function (e) {
        for (var n = 1; n < arguments.length; n++) {
          var d = null != arguments[n] ? arguments[n] : {},
            p = Object.keys(d);
          "function" == typeof Object.getOwnPropertySymbols &&
            (p = p.concat(
              Object.getOwnPropertySymbols(d).filter(function (e) {
                return Object.getOwnPropertyDescriptor(d, e).enumerable;
              })
            )),
            p.forEach(function (n) {
              _define_property$e(e, n, d[n]);
            });
        }
        return e;
      })({}, this.lastUserIntent, this.lastApplicationIntent, n);
      return this.clearIntention(), d;
    }
    clearIntention() {
      (this.lastUserIntent = void 0), (this.lastApplicationIntent = void 0);
    }
    recordApplicationIntent(e, n) {
      this.lastApplicationIntent = n;
    }
    recordUserIntent(e, n) {
      this.lastUserIntent = n;
    }
    setupListeners() {
      this.registeredEvents.forEach((e) => {
        this.dispatcher.subscribe(e, this.handleEvent);
      }),
        this.dispatcher.subscribe(kt.userActivityIntent, this.recordUserIntent),
        this.dispatcher.subscribe(
          kt.applicationActivityIntent,
          this.recordApplicationIntent
        );
    }
    teardownListeners() {
      this.registeredEvents.forEach((e) => {
        this.dispatcher.unsubscribe(e, this.handleEvent);
      }),
        this.dispatcher.unsubscribe(
          kt.userActivityIntent,
          this.recordUserIntent
        ),
        this.dispatcher.unsubscribe(
          kt.applicationActivityIntent,
          this.recordApplicationIntent
        );
    }
    constructor(e, n) {
      _define_property$e(this, "dispatcher", void 0),
        _define_property$e(this, "trackers", void 0),
        _define_property$e(this, "registeredEvents", void 0),
        _define_property$e(this, "lastUserIntent", void 0),
        _define_property$e(this, "lastApplicationIntent", void 0),
        _define_property$e(this, "isConfigured", void 0),
        (this.dispatcher = e),
        (this.trackers = n),
        (this.registeredEvents = new Set()),
        (this.isConfigured = !0);
    }
  }
  function asyncGeneratorStep$g(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$g(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$g(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$g(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  _ts_decorate$7(
    [
      Bind(),
      _ts_metadata$7("design:type", Function),
      _ts_metadata$7("design:paramtypes", [String, Object]),
      _ts_metadata$7("design:returntype", void 0),
    ],
    PlayActivityService.prototype,
    "handleEvent",
    null
  ),
    _ts_decorate$7(
      [
        Bind(),
        _ts_metadata$7("design:type", Function),
        _ts_metadata$7("design:paramtypes", [
          String,
          "undefined" == typeof ActivityIntention ? Object : ActivityIntention,
        ]),
        _ts_metadata$7("design:returntype", void 0),
      ],
      PlayActivityService.prototype,
      "recordApplicationIntent",
      null
    ),
    _ts_decorate$7(
      [
        Bind(),
        _ts_metadata$7("design:type", Function),
        _ts_metadata$7("design:paramtypes", [
          String,
          "undefined" == typeof ActivityIntention ? Object : ActivityIntention,
        ]),
        _ts_metadata$7("design:returntype", void 0),
      ],
      PlayActivityService.prototype,
      "recordUserIntent",
      null
    );
  const To = BooleanDevFlag.register("mk-force-safari-hlsjs");
  function useNativeSafariPlayback() {
    return !To.enabled;
  }
  function requiresHlsJs(e) {
    return _requiresHlsJs.apply(this, arguments);
  }
  function _requiresHlsJs() {
    return (_requiresHlsJs = _async_to_generator$g(function* (e) {
      const n = null != e ? e : yield findKeySystemPreference(),
        d = !useNativeSafariPlayback();
      return n !== tt.FAIRPLAY || d;
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$f(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$f(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$f(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$f(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$d(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$6(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$d(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$4(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  function fetchRadioStationAssets(e, n, d) {
    return _fetchRadioStationAssets.apply(this, arguments);
  }
  function _fetchRadioStationAssets() {
    return (_fetchRadioStationAssets = _async_to_generator$f(
      function* (e, n, d) {
        const p = new Headers({
            Authorization: "Bearer " + n,
            Accept: "application/json",
            "Content-Type": "application/json",
            "X-Apple-Music-User-Token": "" + d,
          }),
          h = urlEncodeParameters(
            _object_spread_props$4(_object_spread$6({}, e.playParams), {
              keyFormat: "web",
            })
          ),
          y = `${$a.urls.mediaApi}/play/assets?${h}`,
          _ = yield fetch(y, { method: "GET", headers: p });
        if (500 === _.status) {
          const n = new MKError(MKError.Reason.SERVER_ERROR);
          throw ((n.data = e), n);
        }
        if (403 === _.status) {
          let n;
          try {
            var m;
            (n = yield _.json()),
              (n =
                null == n || null === (m = n.errors) || void 0 === m
                  ? void 0
                  : m[0]);
          } catch (Yt) {}
          const d =
            "40303" === (null == n ? void 0 : n.code)
              ? MKError.Reason.SUBSCRIPTION_ERROR
              : MKError.Reason.ACCESS_DENIED;
          var g;
          const p = new MKError(
            d,
            null !== (g = null == n ? void 0 : n.title) && void 0 !== g
              ? g
              : null == n
                ? void 0
                : n.detail
          );
          throw ((p.data = e), p);
        }
        if (!_.ok) {
          const n = new MKError(MKError.Reason.CONTENT_UNAVAILABLE);
          throw ((n.data = e), n);
        }
        const b = (yield _.json()).results;
        return (
          Ye.debug(`media-item: loaded data from ${y}: ${JSON.stringify(b)}`), b
        );
      }
    )).apply(this, arguments);
  }
  function asyncGeneratorStep$e(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$e(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$e(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$e(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function prepareMediaAPIItem(e, n, d) {
    return _prepareMediaAPIItem.apply(this, arguments);
  }
  function _prepareMediaAPIItem() {
    return (_prepareMediaAPIItem = _async_to_generator$e(function* (e, n, d) {
      if (void 0 === d)
        return Promise.reject(
          new MKError(
            MKError.Reason.AUTHORIZATION_ERROR,
            "Unable to prepare media item for play: missing MusicUserToken."
          )
        );
      e.hasOffersHlsUrl
        ? yield prepareWithHLSOffers(e)
        : e.isLiveVideoStation
          ? yield prepareLiveVideoStation(e, n, d)
          : e.isLiveRadioStation
            ? yield prepareLiveRadioStation(e, n, d)
            : e.isRadioEpisode
              ? yield prepareRadioStationEpisode(e, n, d)
              : yield prepareItemWithMZPlay(e, n, d);
    })).apply(this, arguments);
  }
  function prepareWithHLSOffers(e) {
    return _prepareWithHLSOffers.apply(this, arguments);
  }
  function _prepareWithHLSOffers() {
    return (_prepareWithHLSOffers = _async_to_generator$e(function* (e) {
      var n, d;
      const p = $a.urls.hlsOffersKeyUrls;
      if (!p)
        throw new MKError(MKError.Reason.CONTENT_UNSUPPORTED, "HLS OFFERS");
      var h;
      e.updateWithLoadedKeys(p),
        e.updateWithLoadedAssets(
          void 0,
          null !==
            (h =
              null === (n = e.attributes) || void 0 === n
                ? void 0
                : n.assetUrl) && void 0 !== h
            ? h
            : null === (d = e.attributes.offers) || void 0 === d
              ? void 0
              : d[0].hlsUrl
        ),
        yield fetchMasterManifestUrl(e, e.assetURL);
    })).apply(this, arguments);
  }
  function prepareRadioStationEpisode(e, n, d) {
    return _prepareRadioStationEpisode.apply(this, arguments);
  }
  function _prepareRadioStationEpisode() {
    return (_prepareRadioStationEpisode = _async_to_generator$e(
      function* (e, n, d) {
        const p = yield fetchRadioStationAssets(e, n, d);
        if (void 0 === p.assets || 0 === p.assets.length)
          throw new MKError(
            MKError.Reason.CONTENT_UNAVAILABLE,
            "Missing RadioStation assets"
          );
        const h = p.assets[0];
        p.assets.length > 1 &&
          Ye.warn("RadioStation endpoint returned multiple assets"),
          Object.assign(e, {
            assetURL: h.url,
            keyURLs: {
              "hls-key-cert-url": h.fairPlayKeyCertificateUrl,
              "hls-key-server-url": h.keyServerUrl,
              "widevine-cert-url": h.widevineKeyCertificateUrl,
            },
          });
      }
    )).apply(this, arguments);
  }
  function prepareLiveVideoStation(e, n, d) {
    return _prepareLiveVideoStation.apply(this, arguments);
  }
  function _prepareLiveVideoStation() {
    return (_prepareLiveVideoStation = _async_to_generator$e(
      function* (e, n, d) {
        const p = yield fetchRadioStationAssets(e, n, d);
        if (void 0 === p.assets || 0 === p.assets.length)
          throw new MKError(
            MKError.Reason.CONTENT_UNAVAILABLE,
            "Missing RadioStation assets"
          );
        const h = p.assets[0];
        p.assets.length > 1 &&
          Ye.warn("RadioStation endpoint returned multiple assets"),
          filterUnavailableLiveRadioUrls(h, e),
          Object.assign(e, {
            assetURL: h.url,
            keyURLs: {
              "hls-key-cert-url": h.fairPlayKeyCertificateUrl,
              "hls-key-server-url": h.keyServerUrl,
              "widevine-cert-url": h.widevineKeyCertificateUrl,
            },
          });
      }
    )).apply(this, arguments);
  }
  function prepareLiveRadioStation(e, n, d) {
    return _prepareLiveRadioStation.apply(this, arguments);
  }
  function _prepareLiveRadioStation() {
    return (_prepareLiveRadioStation = _async_to_generator$e(
      function* (e, n, d) {
        if (
          !$a.features["playready-live-radio"] &&
          ct === tt.PLAYREADY &&
          "video" !== e.attributes.mediaKind &&
          !$a.features["mse-live-radio"]
        )
          throw new MKError(MKError.Reason.CONTENT_UNSUPPORTED, "LIVE_RADIO");
        const p = (yield fetchRadioStationAssets(e, n, d)).assets[0];
        e.updateWithLoadedKeys({
          "hls-key-cert-url": p.fairPlayKeyCertificateUrl,
          "hls-key-server-url": p.keyServerUrl,
          "widevine-cert-url": p.widevineKeyCertificateUrl,
        }),
          yield fetchMasterManifestUrl(e, p.url);
      }
    )).apply(this, arguments);
  }
  function fetchMasterManifestUrl(e, n) {
    return _fetchMasterManifestUrl.apply(this, arguments);
  }
  function _fetchMasterManifestUrl() {
    return (_fetchMasterManifestUrl = _async_to_generator$e(function* (e, n) {
      let d;
      try {
        d = yield fetch(n);
      } catch (Yt) {
        throw makeContentUnavailableError(e);
      }
      extractAssetsFromMasterManifest(yield d.text(), n, e);
    })).apply(this, arguments);
  }
  function extractAssetsFromMasterManifest(e, n, d) {
    const p = /^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+),CODECS="(.*)"\s*\n(.*$)/gim;
    let h;
    for (; (h = p.exec(e)); ) {
      let [e, p, y, _] = h;
      /^http(s)?:\/\//.test(_) ||
        (_ = joinURLPath([...splitURLPath(n).slice(0, -1), _])),
        d.assets.push({ bandwidth: Number(p), codec: y, URL: _ });
    }
  }
  function filterUnavailableLiveRadioUrls(e, n) {
    const d = new URL(e.url);
    if (!d.host.endsWith(".apple.com") && !d.host.endsWith(".applemusic.com"))
      throw makeContentUnavailableError(n);
  }
  function makeContentUnavailableError(e) {
    const n = new MKError(MKError.Reason.CONTENT_UNAVAILABLE);
    return (n.data = e), n;
  }
  function prepareItemWithMZPlay(e, n, d) {
    return _prepareItemWithMZPlay.apply(this, arguments);
  }
  function _prepareItemWithMZPlay() {
    return (_prepareItemWithMZPlay = _async_to_generator$e(function* (e, n, d) {
      var p;
      if (
        (Ye.debug("mk: loadWithMZPlay", e.playParams),
        "podcast-episodes" === e.type)
      )
        return void (e.assetURL = e.attributes.assetUrl);
      if (!(yield hasMusicSubscription())) return;
      const h = null === (p = e.playParams) || void 0 === p ? void 0 : p.id,
        y = new Headers({
          Authorization: "Bearer " + n,
          Accept: "application/json",
          "Content-Type": "application/json",
          "X-Apple-Music-User-Token": "" + d,
        });
      let _ = { salableAdamId: h };
      if (e.isCloudItem) {
        (_ = {}),
          e.playParams.purchasedId &&
            (_.purchaseAdamId = e.playParams.purchasedId),
          e.playParams.catalogId &&
            (_.subscriptionAdamId = e.playParams.catalogId);
        const n = /^a\.(\d+)$/;
        n.test(h)
          ? (_.subscriptionAdamId = h.replace(n, "$1"))
          : k(h) && (_.universalLibraryId = h);
      }
      if (!$a.urls.webPlayback)
        throw new Error("bag.urls.webPlayback is not configured");
      const m = yield fetch($a.urls.webPlayback, {
          method: "POST",
          body: JSON.stringify(_),
          headers: y,
        }),
        g = yield m.text(),
        b = JSON.parse(g);
      if (!b || !b.songList) {
        const n = MKError.serverError(b, MKError.Reason.UNSUPPORTED_ERROR);
        return (
          e.updateFromLoadError(n),
          Ye.debug("mk: prepareItemWithMZPlay - rejecting with error", n),
          Promise.reject(n)
        );
      }
      const [P] = b.songList;
      e.updateWithMZPlayData(P);
    })).apply(this, arguments);
  }
  function asyncGeneratorStep$d(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$d(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$d(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$d(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function prepareToPlayMediaItem(e, n) {
    return _prepareToPlayMediaItem.apply(this, arguments);
  }
  function _prepareToPlayMediaItem() {
    return (_prepareToPlayMediaItem = _async_to_generator$d(function* (e, n) {
      if (n.isPreparedToPlay) Ye.warn("media-item: item is prepared to play");
      else {
        if (
          (Ye.debug("media-item: item.prepareToPlay playParams", n.playParams),
          (n.state = x.loading),
          n.isUTS)
        )
          return Promise.reject(
            new MKError(
              MKError.Reason.UNSUPPORTED_ERROR,
              "Item was not prepared to play"
            )
          );
        {
          const { developerToken: d, userToken: p } = e.store;
          yield prepareMediaAPIItem(n, d, p);
        }
      }
    })).apply(this, arguments);
  }
  function _shouldPlayPreview() {
    return (_shouldPlayPreview = _async_to_generator$d(function* (e, n) {
      return (
        !!e.previewURL &&
        (!!n ||
          (!e.playRawAssetURL &&
            (!(yield hasMusicSubscription()) ||
              !hasAuthorization() ||
              !e.isPlayable ||
              !supportsDrm())))
      );
    })).apply(this, arguments);
  }
  function _prepareForEncryptedPlayback() {
    return (_prepareForEncryptedPlayback = _async_to_generator$d(
      function* (e, n, d) {
        if (
          (Ye.debug("prepareForEncryptedPlayback"),
          !n.isUTS && !hasAuthorization())
        )
          return Promise.reject(
            new MKError(
              MKError.Reason.AUTHORIZATION_ERROR,
              "Unable to prepare for playback."
            )
          );
        try {
          yield prepareToPlayMediaItem(e, n);
        } catch (q) {
          if (q.reason === MKError.Reason.AUTHORIZATION_ERROR)
            yield e.store.storekit.revokeUserToken();
          else if (q.reason === MKError.Reason.TOKEN_EXPIRED)
            try {
              return (
                yield e.store.storekit.renewUserToken(),
                yield prepareToPlayMediaItem(e, n),
                (n.playbackData = _playbackDataForItem(n, d)),
                n
              );
            } catch (Yt) {}
          if (q) return Promise.reject(q);
        }
        return (n.playbackData = _playbackDataForItem(n, d)), n;
      }
    )).apply(this, arguments);
  }
  function _playbackDataForItem(n, d) {
    if ((Ye.debug("mk: _playbackDataForItem", n), n.isCloudUpload))
      return n.assets[0];
    if ("musicVideo" !== n.type && !n.isLiveVideoStation) {
      if (!n.isLiveRadioStation) {
        const [e] = n.assets.filter((e) => {
          if (!("flavor" in e)) return !1;
          const n = new RegExp(
            `\\d{1,2}\\:(c${(null === (p = window.WebKitMediaKeys) || void 0 === p ? void 0 : p.isTypeSupported(dt + ".1_0", ot.AVC1)) ? "bc" : "tr"}p)(\\d{2,3})`,
            "i"
          );
          var p;
          const h = n.test(e.flavor);
          var y;
          const _ = null !== (y = e.flavor.match(n)) && void 0 !== y ? y : [];
          return h && parseInt(_[2], 10) <= d.bitrate;
        });
        return e;
      }
      {
        var p;
        const h = n.assets.reduce((e, n) => {
            const d = n.bandwidth;
            return e[d] || (e[d] = []), e[d].push(n), e;
          }, {}),
          y = Object.keys(h).sort((e, n) => parseInt(e, 10) - parseInt(n, 10)),
          _ = d.bitrate === e.PlaybackBitrate.STANDARD ? y[0] : y[y.length - 1];
        (null == h || null === (p = h[_]) || void 0 === p
          ? void 0
          : p[0].URL) && (n.assetURL = h[_][0].URL);
      }
    }
  }
  function _define_property$c(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$6(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$6(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class ID3MetadataTrackManager {
    get activeMetadata() {
      return this._activeMetadata;
    }
    get activeCues() {
      var e;
      const n =
        null === (e = this.metadataTrack) || void 0 === e
          ? void 0
          : e.activeCues;
      return null != n ? Array.from(n) : [];
    }
    get isDestroyed() {
      return this._isDestroyed;
    }
    get tracks() {
      return void 0 !== this.metadataTrack ? [this.metadataTrack] : [];
    }
    get currentTrack() {
      return this.metadataTrack;
    }
    attach(e) {
      if (void 0 !== this.mediaElement && this.mediaElement !== e)
        throw new Error(
          "MetadaTrackManager is already attached to a different HTMLMediaElement."
        );
      this.mediaElement !== e &&
        ((this.mediaElement = e),
        this.mediaElement.addEventListener(
          "loadedmetadata",
          this.registerMetadataTrack
        ),
        this.mediaElement.addEventListener(
          "loadeddata",
          this.registerMetadataTrack
        ));
    }
    detach() {
      void 0 !== this.mediaElement &&
        (this.mediaElement.removeEventListener(
          "loadedmetadata",
          this.registerMetadataTrack
        ),
        this.mediaElement.removeEventListener(
          "loadeddata",
          this.registerMetadataTrack
        ),
        (this.mediaElement = void 0)),
        void 0 !== this.metadataTrack &&
          (this.metadataTrack.removeEventListener(
            "cuechange",
            this.onCueChange
          ),
          (this.metadataTrack = void 0));
    }
    registerMetadataTrack(e) {
      if (void 0 !== this.mediaElement)
        for (let d = 0; d < this.mediaElement.textTracks.length; d++) {
          const e = this.mediaElement.textTracks[d];
          if ("metadata" === e.kind) {
            var n;
            if (void 0 === this.metadataTrack)
              (this.metadataTrack = e),
                this.metadataTrack.addEventListener(
                  "cuechange",
                  this.onCueChange
                );
            else
              zi.warning(
                `Skipping registering metadata TextTrack with id "${null !== (n = e.id) && void 0 !== n ? n : "unknown"}"`
              );
            break;
          }
        }
    }
    onCueChange(e) {
      if (
        (zi.debug("Processing metadata cues"),
        void 0 === this.activeCues || this.activeCues.length <= 0)
      ) {
        var n;
        if (void 0 !== this.activeMetadata)
          null === (n = this.onchange) || void 0 === n || n.call(this);
        this._activeMetadata = void 0;
      } else {
        const e = (function (e) {
          const n = {};
          for (const y of e) {
            if (
              null == (h = y) ||
              "string" != typeof h.id ||
              void 0 === h.value ||
              "string" != typeof h.value.key ||
              void 0 === (null == y ? void 0 : y.value)
            )
              continue;
            const e = y.value;
            switch (e.key) {
              case "TALB":
                n.album = e.data;
                break;
              case "TIT2":
                n.title = e.data;
                break;
              case "TPE1":
                n.performer = e.data;
                break;
              case "WXXX":
                var d, p;
                if (
                  ((n.links = null !== (d = n.links) && void 0 !== d ? d : []),
                  !n.links.some(({ url: n }) => n === e.data))
                )
                  n.links.push({
                    description:
                      null !== (p = e.description) && void 0 !== p ? p : "",
                    url: e.data,
                  });
                break;
              case "PRIV": {
                const d = e.owner || e.info;
                "com.apple.radio.ping.jingle" === d &&
                  (n.blob = parsePingBlob(e.data)),
                  "com.apple.radio.adamid" === d &&
                    (n.storefrontAdamIds = parseStorefrontAdamIds(e.data));
                break;
              }
            }
          }
          var h;
          return new TimedMetadata(n);
        })(this.activeCues);
        var d;
        if (void 0 === this.activeMetadata || !e.equals(this.activeMetadata))
          zi.debug("Track TimedMetadata changed", e),
            (this._activeMetadata = e),
            null === (d = this.onchange) || void 0 === d || d.call(this, e);
      }
    }
    saveTrack() {}
    restoreSelectedTrack() {}
    destroy() {
      (this._isDestroyed = !0), (this.onchange = void 0), this.detach();
    }
    constructor(e) {
      _define_property$c(this, "_isDestroyed", !1),
        _define_property$c(this, "mediaElement", void 0),
        _define_property$c(this, "metadataTrack", void 0),
        _define_property$c(this, "_activeMetadata", void 0),
        _define_property$c(this, "onchange", void 0),
        (this.onchange = null == e ? void 0 : e.onchange),
        void 0 !== (null == e ? void 0 : e.element) && this.attach(e.element);
    }
  }
  function asyncGeneratorStep$c(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$c(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$c(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$c(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$b(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$5(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$5(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  _ts_decorate$6(
    [
      Bind(),
      _ts_metadata$6("design:type", Function),
      _ts_metadata$6("design:paramtypes", [Object]),
      _ts_metadata$6("design:returntype", void 0),
    ],
    ID3MetadataTrackManager.prototype,
    "registerMetadataTrack",
    null
  ),
    _ts_decorate$6(
      [
        Bind(),
        _ts_metadata$6("design:type", Function),
        _ts_metadata$6("design:paramtypes", [Object]),
        _ts_metadata$6("design:returntype", void 0),
      ],
      ID3MetadataTrackManager.prototype,
      "onCueChange",
      null
    );
  const ko = { keySystemGenericError: "keySystemGenericError" },
    Eo = new Set([MKError.Reason.DEVICE_LIMIT, MKError.Reason.GEO_BLOCK]),
    wo = {};
  (wo[tt.FAIRPLAY] = "fairplaystreaming"),
    (wo[tt.PLAYREADY] = "playready"),
    (wo[tt.WIDEVINE] = "widevine");
  const Oo = He.createChild("hlsjs-audio"),
    $o = JsonDevFlag.register("mk-hlsjs-config-overrides");
  class HlsJsAudioPlayer extends BasePlayer {
    loadPreviewImage() {
      return _async_to_generator$c(function* () {})();
    }
    get _targetElement() {
      return this.mediaElement;
    }
    setNextSeamlessItem(e) {
      return _async_to_generator$c(function* () {})();
    }
    setPresentationMode(e) {
      return _async_to_generator$c(function* () {
        return Promise.resolve();
      })();
    }
    get shouldDispatchErrors() {
      return !this.userInitiated || this._playbackDidStart;
    }
    get currentPlayingDate() {
      var e;
      return null === (e = this.hls) || void 0 === e ? void 0 : e.playingDate;
    }
    get isPlayingAtLiveEdge() {
      var e;
      const n = this.hls;
      return (
        !(
          !n ||
          !(null === (e = this.nowPlayingItem) || void 0 === e
            ? void 0
            : e.isLinearStream)
        ) && !!n.isPlayingAtLive
      );
    }
    playItemFromEncryptedSource(n, d = !1, p = {}) {
      var h = this;
      return _async_to_generator$c(function* () {
        h.playbackState !== e.PlaybackStates.stopped
          ? ((n.playbackType = e.PlaybackType.encryptedFull),
            (h.nowPlayingItem = n),
            (n.state = x.loading),
            (h.userInitiated = d),
            yield h.playHlsStream(n.assetURL, n, p))
          : Oo.debug(
              "hlsjsAudioPlayer.playItemFromEncryptedSource aborting playback because player is stopped"
            );
      })();
    }
    isPlayerSupported() {
      return !0;
    }
    initializeMediaElement() {
      var e = this;
      return _async_to_generator$c(function* () {
        const n = nextAvailableAudioElement();
        (n.autoplay = !1),
          (n.id = "apple-music-player"),
          (n.controls = !1),
          (n.muted = !1),
          (n.playbackRate = 1),
          (n.preload = "metadata"),
          (n.volume = 1),
          (e.mediaElement = n),
          document.body.appendChild(n),
          e.id3MetadataManager.attach(n),
          Oo.debug("initializedMediaElement", n);
      })();
    }
    get seekableTimeRanges() {
      const e = this.hls;
      return e
        ? e.seekableTimeRanges
        : this.currentPlaybackDuration
          ? [{ start: 0, end: this.currentPlaybackDuration }]
          : void 0;
    }
    initializeExtension() {
      var e = this;
      return _async_to_generator$c(function* () {
        e._keySystem = yield findKeySystemPreference();
        try {
          var n;
          if (!rt.urls.hls) throw new Error("bag.urls.hls is not configured");
          yield Promise.all([
            loadScript(rt.urls.hls),
            null === (n = e._rtcTracker) || void 0 === n
              ? void 0
              : n.loadScript(),
          ]);
        } catch (Yt) {
          throw (
            (Oo.error(
              "hlsjs-audio-player failed to load script " + rt.urls.hls,
              Yt
            ),
            Yt)
          );
        }
      })();
    }
    _stopMediaElement() {
      var e = this,
        _superprop_get__stopMediaElement = () => super._stopMediaElement;
      return _async_to_generator$c(function* () {
        yield _superprop_get__stopMediaElement().call(e), e.destroy();
      })();
    }
    destroy() {
      if ((Oo.debug("hlsjs-audio-player.destroy"), this.hls)) {
        const {
            ERROR: e,
            INTERNAL_ERROR: n,
            MANIFEST_PARSED: d,
            KEY_REQUEST_STARTED: p,
            LICENSE_CHALLENGE_CREATED: h,
            LEVEL_SWITCHED: y,
          } = window.Hls.Events,
          _ = this.hls;
        _.stopLoad(),
          _.detachMedia(),
          _.off(e, this.handleHlsError),
          _.off(n, this.handleHlsError),
          _.off(d, this.handleManifestParsed),
          _.off(p, this.handleKeyRequestStarted),
          _.off(h, this.handleLicenseChallengeCreated),
          _.off(y, this.handleLevelSwitched),
          _.destroy();
      }
      this.id3MetadataManager.destroy(),
        super.destroy(),
        asAsync(this._license.stop());
    }
    playHlsStream(e, n, d = {}) {
      var p = this;
      return _async_to_generator$c(function* () {
        const { _keySystem: h } = p;
        if (!h) return;
        let y, _;
        (p._unrecoverableError = void 0),
          p.createHlsPlayer(),
          h === tt.WIDEVINE &&
            ((y = "WIDEVINE_SOFTWARE"),
            (_ = {
              initDataTypes: ["cenc", "keyids"],
              distinctiveIdentifier: "optional",
              persistentState: "required",
            }));
        const m = {
            subs: "accepts-css",
            platformInfo: {
              requiresCDMAttachOnStart: h !== tt.NONE,
              maxSecurityLevel: y,
              keySystemConfig: _,
            },
            appData: { serviceName: rt.app.name },
          },
          { _rtcTracker: g, hls: b } = p;
        if (g) {
          const e = g.prepareReportingAgent(n);
          void 0 !== e && (m.appData.reportingAgent = e);
        }
        Oo.debug("RTC: loadSource with load options", m);
        const P = p.startPlaybackSequence();
        return (
          Oo.info("Manifest already loaded, passing url to HLSJS", e),
          b.loadSource(e, m, d.startTime),
          b.attachMedia(p.mediaElement),
          n &&
            ((p._licenseServerUrl = n.keyURLs["hls-key-server-url"]),
            h === tt.FAIRPLAY
              ? b.setProtectionData({
                  fairplaystreaming: {
                    serverCertUrl: n.keyURLs["hls-key-cert-url"],
                  },
                })
              : b.setProtectionData({
                  widevine: { serverCertUrl: n.keyURLs["widevine-cert-url"] },
                })),
          P
        );
      })();
    }
    createHlsPlayer() {
      const { _keySystem: e } = this,
        { os: n } = this.services.runtime,
        { Hls: d } = window,
        p = le.get(),
        h = {
          clearMediaKeysOnPromise: !1,
          debug: !!p,
          debugLevel: p,
          enablePerformanceLogging: !!p,
          enablePlayReadyKeySystem: !0,
          enableRtcReporting: void 0 !== this._rtcTracker,
          keySystemPreference: wo[e],
          useMediaKeySystemAccessFilter: !0,
          nativeControlsEnabled: n.isAndroid,
          enableID3Cues: !0,
        };
      ((e) => {
        const n = ae.value;
        n &&
          n.socketurl &&
          isAppleHostname(n.socketurl) &&
          "carry-" === determineCdnBasePrefix() &&
          ((e.socketurl = n.socketurl),
          (e.socketid = n.socketid),
          (e.log = n.log));
      })(h),
        ((e) => {
          const n = $o.value;
          n && "object" == typeof n && Object.assign(e, n);
        })(h);
      const y = new d(h),
        {
          ERROR: _,
          INTERNAL_ERROR: m,
          MANIFEST_PARSED: g,
          KEY_REQUEST_STARTED: b,
          LICENSE_CHALLENGE_CREATED: P,
          LEVEL_SWITCHED: S,
        } = d.Events;
      y.on(_, this.handleHlsError),
        y.on(m, this.handleHlsError),
        y.on(g, this.handleManifestParsed),
        y.on(b, this.handleKeyRequestStarted),
        y.on(P, this.handleLicenseChallengeCreated),
        y.on(S, this.handleLevelSwitched),
        (this.hls = y);
    }
    handleLevelSwitched(e, n) {
      var d, p;
      const { level: h } = n;
      if (!h) return;
      const y =
        null === (d = this._levels) || void 0 === d
          ? void 0
          : d.find((e) => e.persistentId === h);
      if (
        !y ||
        (null === (p = this._currentLevel) || void 0 === p
          ? void 0
          : p.persistentId) === (null == y ? void 0 : y.persistentId)
      )
        return;
      this._currentLevel = y;
      const _ =
        void 0 !== y.audioGroupId
          ? this._channelsByGroup[y.audioGroupId]
          : void 0;
      this._dispatcher.publish(kt.hlsLevelUpdated, { level: y, channels: _ });
    }
    handleHlsError(e, n) {
      if (
        (Oo.warn("HLS.js error", JSON.stringify(n)), this._unrecoverableError)
      )
        return;
      let d = new MKError(MKError.Reason.UNSUPPORTED_ERROR, n.reason);
      d.data = n;
      const { keySystemGenericError: p } = ko;
      if (n.details !== p) {
        if (
          ("output-restricted" === n.reason &&
            (d = new MKError(MKError.Reason.OUTPUT_RESTRICTED, n.reason)),
          n.fatal)
        ) {
          if ((this.hls.destroy(), !this.shouldDispatchErrors)) throw d;
          this._dispatcher.publish(wt.mediaPlaybackError, d);
        }
      } else this._dispatcher.publish(p, d);
    }
    handleManifestParsed(e, n) {
      var d = this;
      return _async_to_generator$c(function* () {
        var e, p;
        let h;
        Oo.debug("handleManifestParsed", n),
          (d._levels = null !== (e = n.levels) && void 0 !== e ? e : []),
          (d.nowPlayingItem.state = x.ready),
          (d._channelsByGroup = (
            null !== (p = n.audioTracks) && void 0 !== p ? p : []
          ).reduce((e, n) => ((e[n.groupId] = n.channels), e), {}));
        try {
          yield d._playMedia();
        } catch (Yt) {
          throw (
            (Oo.warn("error from media element, possibly non-fatal", Yt), Yt)
          );
        } finally {
          h = yield d.finishPlaybackSequence();
        }
        return h;
      })();
    }
    handleKeyRequestStarted(e, n) {
      Oo.debug("hlsjs-video.handleKeyRequestStarted"),
        this.hls.generateKeyRequest(n.keyuri, {});
    }
    handleLicenseChallengeCreated(n, d) {
      var p = this;
      return _async_to_generator$c(function* () {
        const {
          _licenseServerUrl: n,
          nowPlayingItem: h,
          _keySystem: y,
          userInitiated: _,
        } = p;
        try {
          var m;
          const e = yield null === (m = p._license) || void 0 === m
              ? void 0
              : m.start(n, h, d, y, _),
            g = { statusCode: e.status };
          (null == e ? void 0 : e.license) &&
            (y === tt.FAIRPLAY
              ? (g.ckc = Ae(e.license))
              : (g.license = Ae(e.license)));
          const b = e["renew-after"];
          b && (g.renewalDate = new Date(Date.now() + 1e3 * b)),
            p.hls.setLicenseResponse(d.keyuri, g);
        } catch (Yt) {
          if (p._unrecoverableError) return;
          const h = Yt.data,
            y = {};
          void 0 !== (null == h ? void 0 : h.status) &&
            (y.statusCode = +h.status),
            Oo.warn("Passing license response error to Hls.js", y),
            p.hls.setLicenseResponse(d.keyuri, y),
            Eo.has(Yt.name) &&
              ((p._unrecoverableError = Yt),
              p.resetDeferredPlay(),
              yield p.stop({
                endReasonType: e.PlayActivityEndReasonType.FAILED_TO_LOAD,
                userInitiated: _,
              })),
            p.onPlaybackLicenseError(Yt);
        }
      })();
    }
    onPlaybackLicenseError(e) {
      this.resetDeferredPlay(),
        this._dispatcher.publish(at.playbackLicenseError, e);
    }
    seekToTime(e) {
      var n = this;
      return _async_to_generator$c(function* () {
        n.hls
          ? (Oo.debug("hlsjs-video: hls seekTo", e), (n.hls.seekTo = e))
          : (Oo.debug("hlsjs-video: media element seek to", e),
            (n._targetElement.currentTime = e));
      })();
    }
    constructor(e) {
      var n;
      super(e),
        _define_property$b(this, "currentAudioTrack", void 0),
        _define_property$b(this, "currentTextTrack", void 0),
        _define_property$b(this, "textTracks", []),
        _define_property$b(this, "audioTracks", []),
        _define_property$b(this, "userInitiated", !1),
        _define_property$b(this, "mediaElement", void 0),
        _define_property$b(this, "mediaPlayerType", "hlsjs-audio"),
        _define_property$b(this, "hls", void 0),
        _define_property$b(this, "supportsPreviewImages", !1),
        _define_property$b(this, "extension", void 0),
        _define_property$b(this, "_keySystem", void 0),
        _define_property$b(this, "_license", void 0),
        _define_property$b(this, "_rtcTracker", void 0),
        _define_property$b(this, "_levels", void 0),
        _define_property$b(this, "_channelsByGroup", {}),
        _define_property$b(this, "_currentLevel", void 0),
        _define_property$b(this, "_licenseServerUrl", void 0),
        _define_property$b(this, "_unrecoverableError", void 0),
        _define_property$b(this, "id3MetadataManager", void 0),
        (this._rtcTracker =
          null == e || null === (n = e.playbackServices) || void 0 === n
            ? void 0
            : n.getRTCStreamingTracker()),
        (this._license = new License()),
        (this.id3MetadataManager = new ID3MetadataTrackManager({
          onchange: (e) => {
            var n;
            Oo.debug("Dispatching bufferTimedMetadataDidChange", e),
              null === (n = this._dispatcher) ||
                void 0 === n ||
                n.publish(Ci, e);
          },
        }));
    }
  }
  function asyncGeneratorStep$b(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$b(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$b(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$b(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$a(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  _ts_decorate$5(
    [
      Bind(),
      _ts_metadata$5("design:type", Function),
      _ts_metadata$5("design:paramtypes", [void 0, void 0]),
      _ts_metadata$5("design:returntype", void 0),
    ],
    HlsJsAudioPlayer.prototype,
    "handleLevelSwitched",
    null
  ),
    _ts_decorate$5(
      [
        Bind(),
        _ts_metadata$5("design:type", Function),
        _ts_metadata$5("design:paramtypes", [void 0, void 0]),
        _ts_metadata$5("design:returntype", void 0),
      ],
      HlsJsAudioPlayer.prototype,
      "handleHlsError",
      null
    ),
    _ts_decorate$5(
      [
        Bind(),
        _ts_metadata$5("design:type", Function),
        _ts_metadata$5("design:paramtypes", [void 0, void 0]),
        _ts_metadata$5("design:returntype", Promise),
      ],
      HlsJsAudioPlayer.prototype,
      "handleManifestParsed",
      null
    ),
    _ts_decorate$5(
      [
        Bind(),
        _ts_metadata$5("design:type", Function),
        _ts_metadata$5("design:paramtypes", [void 0, void 0]),
        _ts_metadata$5("design:returntype", void 0),
      ],
      HlsJsAudioPlayer.prototype,
      "handleKeyRequestStarted",
      null
    ),
    _ts_decorate$5(
      [
        Bind(),
        _ts_metadata$5("design:type", Function),
        _ts_metadata$5("design:paramtypes", [void 0, void 0]),
        _ts_metadata$5("design:returntype", Promise),
      ],
      HlsJsAudioPlayer.prototype,
      "handleLicenseChallengeCreated",
      null
    ),
    _ts_decorate$5(
      [
        Bind(),
        _ts_metadata$5("design:type", Function),
        _ts_metadata$5("design:paramtypes", [
          "undefined" == typeof Error ? Object : Error,
        ]),
        _ts_metadata$5("design:returntype", void 0),
      ],
      HlsJsAudioPlayer.prototype,
      "onPlaybackLicenseError",
      null
    ),
    _ts_decorate$5(
      [
        AsyncDebounce(250),
        _ts_metadata$5("design:type", Function),
        _ts_metadata$5("design:paramtypes", [Number]),
        _ts_metadata$5("design:returntype", Promise),
      ],
      HlsJsAudioPlayer.prototype,
      "seekToTime",
      null
    );
  const Io = BooleanDevFlag.register("mk-force-native-safari-video-player"),
    Ro = BooleanDevFlag.register("mk-force-hlsjs-video-player"),
    Ao = BooleanDevFlag.register("mk-force-hls-audio-player"),
    Co = He.createChild("factory");
  function contentRequiresHLSjs(e) {
    return _contentRequiresHLSjs.apply(this, arguments);
  }
  function _contentRequiresHLSjs() {
    return (_contentRequiresHLSjs = _async_to_generator$b(function* (e) {
      var n, d, p;
      return (
        !!(
          e.isLiveVideoStation ||
          e.isLinearStream ||
          (null === (p = e.defaultPlayable) ||
          void 0 === p ||
          null === (d = p.assets) ||
          void 0 === d ||
          null === (n = d.fpsKeyServerUrl) ||
          void 0 === n
            ? void 0
            : n.startsWith("https://linear.tv.apple.com"))
        ) || !(!e.hasOffersHlsUrl && !e.isRadioEpisode)
      );
    })).apply(this, arguments);
  }
  class Factory {
    get isDestroyed() {
      return this._isDestroyed;
    }
    getPlayerForMediaItem(e) {
      var n = this;
      return _async_to_generator$b(function* () {
        let d;
        if (
          (Co.debug("Factory.getPlayerForMediaItem", e),
          (function (e) {
            return null != e && !isVideo(e);
          })(e))
        ) {
          const p = n.playersByType.get("audio");
          if (!e.hasOffersHlsUrl && p && !p.isDestroyed)
            return Co.debug("Returning pooled AudioPlayer"), p;
          (d = yield n.createAudioPlayer(e, n.playerOptions)),
            "audio" === d.mediaPlayerType && n.playersByType.set("audio", d);
        } else
          isVideo(e) && (d = yield n.createVideoPlayer(e, n.playerOptions));
        if (void 0 === d)
          throw new Error(
            "Unable to create player for MediaItem: " +
              (null == e ? void 0 : e.id)
          );
        return (
          Co.debug("Initializing player: " + d.constructor.name),
          yield d.initialize(),
          d
        );
      })();
    }
    createAudioPlayer(e, n) {
      var d = this;
      return _async_to_generator$b(function* () {
        if (Ao.enabled)
          return (
            Co.debug(
              "Creating HLSAudioPlayer with mkForceHlsjsAudioPlayer enabled"
            ),
            new HlsJsAudioPlayer(n)
          );
        if (yield contentRequiresHLSjs(e))
          return (
            Co.debug("Creating HlsJsAudioPlayer required for content item"),
            new HlsJsAudioPlayer(n)
          );
        const { os: p } = d.runtime;
        return p.isIOS || p.isIPadOS
          ? (Co.debug("Creating native AudioPlayer for iOS platform"),
            new AudioPlayer(n))
          : (Co.debug("Creating AudioPlayer as a fall through"),
            new AudioPlayer(n));
      })();
    }
    createVideoPlayer(e, n) {
      var d = this;
      return _async_to_generator$b(function* () {
        if ((Co.debug("Creating VideoPlayer"), Io.enabled))
          return (
            Co.debug(
              "Creating NativeSafariVideoPlayer with mkForceSafariNativeVideoPlayer enabled"
            ),
            new NativeSafariVideoPlayer(n)
          );
        if (Ro.enabled)
          return (
            Co.debug(
              "Creating HlsJsVideoPlayer with mkForceHlsjsVideoPlayer enabled"
            ),
            new HlsJsVideoPlayer(n)
          );
        if (yield contentRequiresHLSjs(e))
          return (
            Co.debug("Creating HlsJsVideoPlayer required for content item"),
            new HlsJsVideoPlayer(n)
          );
        const { os: p } = d.runtime;
        return p.isIOS || p.isIPadOS
          ? (Co.debug("Creating NativeSafariVideoPlayer for iOS platform"),
            new NativeSafariVideoPlayer(n))
          : (Co.debug("Creating HLSjsVideoPlayer as a fall through"),
            new HlsJsVideoPlayer(n));
      })();
    }
    destroy() {
      this._isDestroyed = !0;
      for (const e of this.playersByType.values()) e.destroy();
      this.playersByType.clear();
    }
    constructor(e) {
      _define_property$a(this, "runtime", void 0),
        _define_property$a(this, "playerOptions", void 0),
        _define_property$a(this, "playersByType", void 0),
        _define_property$a(this, "_isDestroyed", !1),
        (this.playersByType = new Map()),
        (this.playerOptions = e),
        (this.runtime = e.services.runtime);
    }
  }
  function asyncGeneratorStep$a(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$a(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$a(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$a(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$9(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate$4(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$4(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  const { playbackLicenseError: Mo } = at,
    { keySystemGenericError: Do } = ta,
    jo = BooleanDevFlag.register("mk-play-radio-station-episodes");
  const xo = (function () {
    var e = _async_to_generator$a(function* (e, n) {
      var d, p;
      if (
        null === (p = e.container) ||
        void 0 === p ||
        null === (d = p.attributes) ||
        void 0 === d
          ? void 0
          : d.requiresSubscription
      ) {
        if (!(yield n())) {
          const n = new MKError(MKError.Reason.SUBSCRIPTION_ERROR);
          throw ((n.data = e), n);
        }
      }
    });
    return function (n, d) {
      return e.apply(this, arguments);
    };
  })();
  let Lo = !1;
  class MediaItemPlayback {
    get isDestroyed() {
      return this._isDestroyed;
    }
    get currentPlaybackTime() {
      return this._currentPlayer.currentPlaybackTime;
    }
    get currentPlaybackTimeRemaining() {
      return this._currentPlayer.currentPlaybackTimeRemaining;
    }
    get currentPlayingDate() {
      return this._currentPlayer.currentPlayingDate;
    }
    get isPlayingAtLiveEdge() {
      return this._currentPlayer.isPlayingAtLiveEdge;
    }
    get seekableTimeRanges() {
      return this._currentPlayer.seekableTimeRanges;
    }
    get audioTracks() {
      return this._currentPlayer.audioTracks;
    }
    get currentAudioTrack() {
      return this._currentPlayer.currentAudioTrack;
    }
    set currentAudioTrack(e) {
      this._currentPlayer.currentAudioTrack = e;
    }
    get currentPlaybackDuration() {
      return this._currentPlayer.currentPlaybackDuration;
    }
    get currentBufferedProgress() {
      return this._currentPlayer.currentBufferedProgress;
    }
    get currentPlaybackProgress() {
      return this._currentPlayer.currentPlaybackProgress;
    }
    get currentTextTrack() {
      return this._currentPlayer.currentTextTrack;
    }
    set currentTextTrack(e) {
      this._currentPlayer.currentTextTrack = e;
    }
    get previewOnly() {
      return this._previewOnly;
    }
    set previewOnly(e) {
      this._previewOnly = e;
    }
    get isPlaying() {
      return this._currentPlayer.isPlaying;
    }
    get isPrimaryPlayer() {
      return this._currentPlayer.isPrimaryPlayer;
    }
    set isPrimaryPlayer(e) {
      this._currentPlayer.isPrimaryPlayer = e;
    }
    get isReady() {
      return this._currentPlayer.isReady;
    }
    get nowPlayingItem() {
      return this._currentPlayer.nowPlayingItem;
    }
    get playbackRate() {
      return this._currentPlayer.playbackRate;
    }
    set playbackRate(e) {
      this._updatePlayerState("playbackRate", e);
    }
    get playbackState() {
      return this._currentPlayer.playbackState;
    }
    set playbackState(e) {
      this._currentPlayer.setPlaybackState(e, this.nowPlayingItem);
    }
    get playbackTargetAvailable() {
      return this._currentPlayer.playbackTargetAvailable;
    }
    get playbackTargetIsWireless() {
      return this._currentPlayer.playbackTargetIsWireless;
    }
    get supportsPreviewImages() {
      return this._currentPlayer.supportsPreviewImages;
    }
    get textTracks() {
      return this._currentPlayer.textTracks;
    }
    get volume() {
      return this._currentPlayer.volume;
    }
    set volume(e) {
      var n;
      this._currentPlayer.isDestroyed &&
        (null === (n = this._dispatcher) ||
          void 0 === n ||
          n.publish(wt.playbackVolumeDidChange, {}));
      this._updatePlayerState("volume", e);
    }
    clearNextManifest() {
      this._currentPlayer.clearNextManifest();
    }
    destroy() {
      var e, n;
      (this._isDestroyed = !0),
        this._playerFactory.destroy(),
        null === (e = this._dispatcher) ||
          void 0 === e ||
          e.unsubscribe(Mo, this.onPlaybackLicenseError),
        null === (n = this._dispatcher) ||
          void 0 === n ||
          n.unsubscribe(Do, this.onKeySystemGenericError);
    }
    exitFullscreen() {
      return this._currentPlayer.exitFullscreen();
    }
    loadPreviewImage(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        return n._currentPlayer.loadPreviewImage(e);
      })();
    }
    getNewSeeker() {
      return this._currentPlayer.newSeeker();
    }
    mute() {
      (this._volumeAtMute = this.volume), (this.volume = 0);
    }
    pause(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        return n._currentPlayer.pause(e);
      })();
    }
    play() {
      var e = this;
      return _async_to_generator$a(function* () {
        return e._currentPlayer.play();
      })();
    }
    preload() {
      var e = this;
      return _async_to_generator$a(function* () {
        return e._currentPlayer.preload();
      })();
    }
    prepareToPlay(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        var d;
        Ze.debug("invoking prepareToPlay for ", e.title);
        const p = yield n.prepareForEncryptedPlayback(e, {
            bitrate: n._bitrateCalculator.bitrate,
          }),
          h =
            null === (d = n._currentPlayback) || void 0 === d ? void 0 : d.item,
          y = rt.features["seamless-audio-transitions"],
          _ = "song" === (null == h ? void 0 : h.type) && "song" === e.type,
          m = !e.playRawAssetURL;
        return (
          y &&
            _ &&
            m &&
            (Ze.debug(`setting ${e.title} for seamless audio transition`),
            yield n._currentPlayer.setNextSeamlessItem(e)),
          p
        );
      })();
    }
    requestFullscreen(e) {
      return this._currentPlayer.requestFullscreen(e);
    }
    showPlaybackTargetPicker() {
      this._currentPlayer.showPlaybackTargetPicker();
    }
    seekToTime(e, n = Rt.Manual) {
      var d = this;
      return _async_to_generator$a(function* () {
        yield d._currentPlayer.seekToTime(e, n);
      })();
    }
    setPresentationMode(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        return n._currentPlayer.setPresentationMode(e);
      })();
    }
    startMediaItemPlayback(e, n = !1) {
      var d = this;
      return _async_to_generator$a(function* () {
        var p;
        Ze.debug("MediaItemPlayback: startMediaItemPlayback", e),
          e.resetState(),
          (function (e, n) {
            if (e.isRadioEpisode && !jo.enabled) {
              Ze.warn("Radio Station Episodes are not supported");
              const n = new MKError(
                MKError.Reason.CONTENT_UNSUPPORTED,
                "Radio Station Episodes are not supported"
              );
              throw ((n.data = { item: e }), n);
            }
          })(e, d.services.runtime),
          ((e, n) => {
            const { os: d } = n;
            if (e.isLinearStream && ("ios" === d.name || "ipados" === d.name)) {
              Ze.warn("Cannot play linear stream on iOS or iPad");
              const n = new MKError(
                MKError.Reason.CONTENT_UNSUPPORTED,
                "IOS LINEAR"
              );
              throw ((n.data = { item: e }), n);
            }
          })(e, d.services.runtime),
          ((e, n) => {
            const { isMSESupported: d } = n;
            if (e.hasOffersHlsUrl && !d) {
              Ze.warn("MSE is not supported");
              const n = new MKError(
                MKError.Reason.CONTENT_UNSUPPORTED,
                "MSE Unsupported on Device"
              );
              throw ((n.data = { item: e }), n);
            }
          })(e, d.services.runtime),
          yield xo(e, d.hasMusicSubscription);
        const h = yield d._getPlayerForMediaItem(e);
        if (
          (yield d.setCurrentPlayer(h),
          !(null === (p = d._currentPlayer) || void 0 === p
            ? void 0
            : p.hasMediaElement))
        )
          return (
            Ze.warn(
              `MediaItemPlayback: Could not play media of type ${e.type}, marking item as unsupported and skipping.`
            ),
            void e.notSupported()
          );
        try {
          const { dispatcher: p } = d.services;
          e.beginMonitoringStateDidChange((e) =>
            p.publish(R.mediaItemStateDidChange, e)
          ),
            e.beginMonitoringStateWillChange((e) =>
              p.publish(R.mediaItemStateWillChange, e)
            );
          const h = d.playOptions.get(e.id);
          h && d.playOptions.delete(e.id);
          const y = yield d._playAccordingToPlaybackType(e, n, h);
          return (d._currentPlayback = { item: e, userInitiated: n }), y;
        } catch (q) {
          throw (e.updateFromLoadError(q), Ze.error(q.message, q), q);
        }
      })();
    }
    _playAccordingToPlaybackType(e, n, d) {
      var p = this;
      return _async_to_generator$a(function* () {
        return (yield (function (e, n) {
          return _shouldPlayPreview.apply(this, arguments);
        })(e, p._previewOnly))
          ? p._playPreview(e, n)
          : (function (e) {
                return !!e.rawAssetUrl;
              })(e)
            ? p._playRawAsset(e, n, d)
            : isBroadcastRadio(e)
              ? p._playBroadcastRadio(e, n)
              : (((e) => {
                  if (!supportsDrm()) {
                    const n = new MKError(
                      MKError.Reason.CONTENT_UNSUPPORTED,
                      "NO DRM"
                    );
                    throw (
                      ((n.data = { item: e }), Ze.warn("No DRM detected"), n)
                    );
                  }
                })(e),
                p._playEncryptedFull(e, n, d));
      })();
    }
    _playEncryptedFull(e, n, d) {
      var p = this;
      return _async_to_generator$a(function* () {
        if (
          (Ze.debug("MediaItemPlayback: play encrypted full", e),
          !e || !e.isPlayable)
        )
          return Promise.reject(
            new MKError(MKError.Reason.MEDIA_PLAYBACK, "Not Playable")
          );
        const h = p._currentPlayer;
        try {
          yield p.prepareForEncryptedPlayback(e, {
            bitrate: p._bitrateCalculator.bitrate,
          });
        } catch (q) {
          return (
            Ze.error("prepareForEncryptedPlayback Error: userInitiated " + n),
            h.destroy(),
            n ? Promise.reject(q) : void h.dispatch(wt.mediaPlaybackError, q)
          );
        }
        return (
          yield (function (e) {
            return new Promise((n, d) => {
              const { ageGatePolicy: p } = e;
              if (!p || !p.age || !p.frequencyInMinutes)
                return (
                  Ye.debug("No ageGatePolicy. Resolving handleAgeGate()"),
                  n(void 0)
                );
              const h = getLocalStorage(),
                y = null == h ? void 0 : h.ageGatePolicyAge,
                _ = null == h ? void 0 : h.ageGatePolicyExpiration;
              if (
                y &&
                _ &&
                parseInt(_, 10) > Date.now() &&
                parseInt(y, 10) >= p.age
              )
                return n(void 0);
              MKDialog.clientDialog({
                okButtonString: "Yes",
                okButtonAction: () => (
                  null == h || h.setItem("ageGatePolicyAge", p.age.toString()),
                  null == h ||
                    h.setItem(
                      "ageGatePolicyExpiration",
                      (Date.now() + 60 * p.frequencyInMinutes * 1e3).toString()
                    ),
                  n(void 0)
                ),
                cancelButtonString: "No",
                cancelButtonAction: () =>
                  d(new MKError("AGE_GATE", "Age Gate Declined")),
                explanation: `This content may not be appropriate for ages younger than ${p.age}.`,
                message: `Are you ${p.age} or older?`,
              }).present();
            });
          })(e),
          Ze.debug("About to play item as encrypted", e),
          yield h.playItemFromEncryptedSource(e, n, d),
          e
        );
      })();
    }
    _playBroadcastRadio(n, d) {
      var p = this;
      return _async_to_generator$a(function* () {
        if (
          (Ze.debug("MediaItemPlayback: play broadcast radio", n),
          !rt.features["broadcast-radio"])
        ) {
          const e = new MKError(MKError.Reason.CONTENT_UNAVAILABLE);
          throw ((e.data = n), e);
        }
        const h = p._currentPlayer,
          y = h.isPaused() && !d,
          _ = yield fetchRadioStationAssets(
            n,
            hi.developerToken,
            hi.musicUserToken
          ),
          m = _.assets[0];
        return (
          (n.playbackType = e.PlaybackType.unencryptedFull),
          (n.trackInfo = _["track-info"]),
          (h.nowPlayingItem = n),
          yield h.playItemFromUnencryptedSource(m.url, y),
          n
        );
      })();
    }
    _playRawAsset(n, d, p) {
      var h = this;
      return _async_to_generator$a(function* () {
        Ze.debug("MediaItemPlayback: play raw asset", n);
        const y = h._currentPlayer,
          _ = y.isPaused() && !d;
        return (
          (n.playbackType = e.PlaybackType.unencryptedFull),
          (y.nowPlayingItem = n),
          yield y.playItemFromUnencryptedSource(n.rawAssetUrl, _, p),
          n
        );
      })();
    }
    _playPreview(n, d) {
      var p = this;
      return _async_to_generator$a(function* () {
        Ze.debug("MediaItemPlayback: play preview", n);
        const h = p._currentPlayer,
          y = h.isPaused() && !d;
        return (
          supportsDrm() || h.dispatch(wt.drmUnsupported, { item: n }),
          (n.playbackType = e.PlaybackType.preview),
          (h.nowPlayingItem = n),
          yield h.playItemFromUnencryptedSource(n.previewURL, y),
          n
        );
      })();
    }
    stop(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        yield n._currentPlayer.stop(e);
      })();
    }
    unmute() {
      this.volume > 0 ||
        ((this.volume = this._volumeAtMute || 1),
        (this._volumeAtMute = void 0));
    }
    _getPlayerForMediaItem(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        Ze.trace("MediaItemPlayback._getPlayerForMediaItem", e);
        const d = yield n._playerFactory.getPlayerForMediaItem(e);
        return (
          Ze.trace("Applying default player state", d, n.playerState),
          Object.assign(d, n.playerState),
          d
        );
      })();
    }
    setCurrentPlayer(e) {
      var n = this;
      return _async_to_generator$a(function* () {
        var d;
        n._currentPlayer !== e &&
          (Ze.debug("MediaItemPlayback: setting currentPlayer", e),
          yield n._currentPlayer.stop(),
          (n._currentPlayer = e),
          null === (d = n._dispatcher) ||
            void 0 === d ||
            d.publish(wt.playerTypeDidChange, { player: e }));
      })();
    }
    getCurrentPlayer() {
      return this._currentPlayer;
    }
    onKeySystemGenericError(e, n) {
      var d = this;
      return _async_to_generator$a(function* () {
        var e;
        Lo
          ? null === (e = d._dispatcher) ||
            void 0 === e ||
            e.publish(wt.mediaPlaybackError, n)
          : ((Lo = !0),
            Ze.warn("Retrying playback after keysystemGenericError"),
            yield d.restartPlayback());
      })();
    }
    onPlaybackLicenseError(e, n) {
      var d = this;
      return _async_to_generator$a(function* () {
        var e;
        n.reason === MKError.Reason.PLAYREADY_CBC_ENCRYPTION_ERROR
          ? (Ze.warn(
              "MediaItemPlayback: PLAYREADY_CBC_ENCRYPTION_ERROR...retrying with different key system"
            ),
            yield d.restartPlayback())
          : null === (e = d._dispatcher) ||
            void 0 === e ||
            e.publish(wt.mediaPlaybackError, n);
      })();
    }
    restartPlayback() {
      var e = this;
      return _async_to_generator$a(function* () {
        yield e.stop();
        const { _currentPlayback: n } = e;
        if (n) {
          const { item: d, userInitiated: p } = n;
          d.resetState(), yield e.startMediaItemPlayback(d, p);
        }
      })();
    }
    _updatePlayerState(e, n) {
      (this.playerState[e] = n), (this._currentPlayer[e] = n);
    }
    constructor(e) {
      _define_property$9(this, "playerState", { playbackRate: 1, volume: 1 }),
        _define_property$9(this, "playOptions", new Map()),
        _define_property$9(this, "hasMusicSubscription", void 0),
        _define_property$9(this, "prepareForEncryptedPlayback", void 0),
        _define_property$9(this, "_currentPlayer", void 0),
        _define_property$9(this, "services", void 0),
        _define_property$9(this, "_dispatcher", void 0),
        _define_property$9(this, "_playerFactory", void 0),
        _define_property$9(this, "_previewOnly", !1),
        _define_property$9(this, "_volumeAtMute", void 0),
        _define_property$9(this, "_currentPlayback", void 0),
        _define_property$9(this, "_bitrateCalculator", void 0),
        _define_property$9(this, "_isDestroyed", !1);
      const { playbackServices: n } = e;
      var d, p;
      (this.hasMusicSubscription = n.hasMusicSubscription),
        (this.prepareForEncryptedPlayback = n.prepareForEncryptedPlayback),
        (d = e.tokens),
        (hi = d),
        e.bag && ((p = e.bag), Object.assign(rt, p)),
        (this.services = e.services),
        (this._dispatcher = e.services.dispatcher),
        (this._bitrateCalculator = e.services.bitrateCalculator),
        (this._playerFactory = new Factory(e)),
        (this._currentPlayer = new PlayerStub(e)),
        this._dispatcher.subscribe(Mo, this.onPlaybackLicenseError),
        this._dispatcher.subscribe(Do, this.onKeySystemGenericError);
    }
  }
  function asyncGeneratorStep$9(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$9(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$9(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$9(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$8(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$5(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$8(e, n, d[n]);
        });
    }
    return e;
  }
  function _ts_decorate$3(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata$3(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  _ts_decorate$4(
    [
      Bind(),
      _ts_metadata$4("design:type", Function),
      _ts_metadata$4("design:paramtypes", [void 0, void 0]),
      _ts_metadata$4("design:returntype", Promise),
    ],
    MediaItemPlayback.prototype,
    "onKeySystemGenericError",
    null
  ),
    _ts_decorate$4(
      [
        Bind(),
        _ts_metadata$4("design:type", Function),
        _ts_metadata$4("design:paramtypes", [void 0, void 0]),
        _ts_metadata$4("design:returntype", Promise),
      ],
      MediaItemPlayback.prototype,
      "onPlaybackLicenseError",
      null
    );
  const No = [
      MKError.Reason.CONTENT_EQUIVALENT,
      MKError.Reason.CONTENT_RESTRICTED,
      MKError.Reason.CONTENT_UNAVAILABLE,
      MKError.Reason.CONTENT_UNSUPPORTED,
      MKError.Reason.SERVER_ERROR,
      MKError.Reason.SUBSCRIPTION_ERROR,
      MKError.Reason.UNSUPPORTED_ERROR,
      MKError.Reason.USER_INTERACTION_REQUIRED,
    ],
    Uo = JsonDevFlag.register("mk-bag-features-overrides");
  class MKInstance {
    get developerToken() {
      return Ra.developerToken;
    }
    get api() {
      return this._services.apiManager.api;
    }
    get audioTracks() {
      return this._mediaItemPlayback.audioTracks;
    }
    get authorizationStatus() {
      return Ra.authorizationStatus;
    }
    get bitrate() {
      return this._services.bitrateCalculator.bitrate;
    }
    set bitrate(e) {
      this._services.bitrateCalculator.bitrate = e;
    }
    get browserSupportsPictureInPicture() {
      return detectPictureInPictureSupport();
    }
    get browserSupportsVideoDrm() {
      return supportsDrm();
    }
    get cid() {
      return (
        (this.realm === e.SKRealm.TV || this.sourceType !== qt.MUSICKIT) &&
        Ra.cid
      );
    }
    get continuous() {
      return this._playbackController.continuous;
    }
    set continuous(e) {
      this._playbackController.continuous = e;
    }
    get autoplayEnabled() {
      return this._autoplayEnabled;
    }
    set autoplayEnabled(n) {
      this.realm !== e.SKRealm.MUSIC && (n = !1),
        n !== this.autoplayEnabled &&
          ((this._autoplayEnabled = n),
          this._services.dispatcher.publish(
            ya.autoplayEnabledDidChange,
            this.autoplayEnabled
          ));
    }
    get currentAudioTrack() {
      return this._mediaItemPlayback.currentAudioTrack;
    }
    set currentAudioTrack(e) {
      this._mediaItemPlayback.currentAudioTrack = e;
    }
    get currentPlaybackDuration() {
      return this._mediaItemPlayback.currentPlaybackDuration;
    }
    get currentPlaybackProgress() {
      return this._mediaItemPlayback.currentPlaybackProgress;
    }
    get currentPlaybackTime() {
      return this._mediaItemPlayback.currentPlaybackTime;
    }
    get currentPlayingDate() {
      return this._mediaItemPlayback.currentPlayingDate;
    }
    get isPlayingAtLiveEdge() {
      return this._mediaItemPlayback.isPlayingAtLiveEdge;
    }
    get seekableTimeRanges() {
      return this._mediaItemPlayback.seekableTimeRanges;
    }
    get currentPlaybackTimeRemaining() {
      return this._mediaItemPlayback.currentPlaybackTimeRemaining;
    }
    get currentTextTrack() {
      return this._mediaItemPlayback.currentTextTrack;
    }
    set currentTextTrack(e) {
      this._mediaItemPlayback.currentTextTrack = e;
    }
    get isAuthorized() {
      return Ra.isAuthorized;
    }
    get isPlaying() {
      return this._playbackController.isPlaying;
    }
    get isRestricted() {
      return Ra.isRestricted;
    }
    get metricsClientId() {
      return Ra.metricsClientId;
    }
    set metricsClientId(e) {
      Ra.metricsClientId = e;
    }
    get musicUserToken() {
      return Ra.musicUserToken;
    }
    set musicUserToken(e) {
      (e && Ra.musicUserToken === e) || (Ra.musicUserToken = e);
    }
    updateUserTokenFromStorage() {
      return Ra.updateUserTokenFromStorage();
    }
    get needsGDPR() {
      return Ra.needsGDPR;
    }
    get nowPlayingItem() {
      return this._mediaItemPlayback.nowPlayingItem;
    }
    get nowPlayingItemIndex() {
      return this._playbackController.nowPlayingItemIndex;
    }
    get playbackMode() {
      return this._playbackMode;
    }
    set playbackMode(n) {
      if (-1 === Object.values(e.PlaybackMode).indexOf(n)) return;
      const d = n === e.PlaybackMode.PREVIEW_ONLY,
        p = this._services.mediaItemPlayback;
      p && (p.previewOnly = d),
        this._playbackMode !== n &&
          ((this._playbackController.playbackMode = n),
          (this._playbackMode = n));
    }
    get playbackRate() {
      return this._mediaItemPlayback.playbackRate;
    }
    set playbackRate(e) {
      this._mediaItemPlayback.playbackRate = e;
    }
    get playbackState() {
      return this._mediaItemPlayback.playbackState;
    }
    get playbackTargetAvailable() {
      return this._mediaItemPlayback.playbackTargetAvailable;
    }
    get playbackTargetIsWireless() {
      return this._mediaItemPlayback.playbackTargetIsWireless;
    }
    get previewOnly() {
      return this.playbackMode === e.PlaybackMode.PREVIEW_ONLY;
    }
    set previewOnly(n) {
      this.playbackMode = n
        ? e.PlaybackMode.PREVIEW_ONLY
        : e.PlaybackMode.MIXED_CONTENT;
    }
    get queue() {
      return this._playbackController.queue;
    }
    get queueIsEmpty() {
      return this._playbackController.queue.isEmpty;
    }
    get realm() {
      return Ra.realm;
    }
    get repeatMode() {
      return this._playbackController.repeatMode;
    }
    set repeatMode(e) {
      this._playbackController.repeatMode = e;
    }
    set requestUserToken(e) {
      Ra.requestUserToken = e;
    }
    get restrictedEnabled() {
      return Ra.restrictedEnabled;
    }
    set restrictedEnabled(e) {
      Ra.restrictedEnabled = e;
    }
    get supportsPreviewImages() {
      return this._mediaItemPlayback.supportsPreviewImages;
    }
    get seekSeconds() {
      return this._playbackController.seekSeconds;
    }
    get services() {
      return this._services;
    }
    set shuffle(e) {
      this._playbackController.shuffle = e;
    }
    get shuffleMode() {
      return this._playbackController.shuffleMode;
    }
    set shuffleMode(e) {
      this._playbackController.shuffleMode = e;
    }
    get storefrontCountryCode() {
      return Ra.storefrontCountryCode;
    }
    get subscribeURL() {
      return Ra.subscribeURL;
    }
    get subscribeFamilyURL() {
      return Ra.subscribeFamilyURL;
    }
    get subscribeIndividualURL() {
      return Ra.subscribeIndividualURL;
    }
    get subscribeStudentURL() {
      return Ra.subscribeStudentURL;
    }
    get textTracks() {
      return this._mediaItemPlayback.textTracks;
    }
    get videoContainerElement() {
      return this.context.videoContainerElement;
    }
    set videoContainerElement(e) {
      this.context.videoContainerElement = e;
    }
    get volume() {
      return this._mediaItemPlayback.volume;
    }
    set volume(e) {
      this._mediaItemPlayback.volume = e;
    }
    get storefrontId() {
      return Ra.storefrontId;
    }
    set storefrontId(e) {
      Ra.storefrontId = e;
    }
    get _mediaItemPlayback() {
      return this._services.mediaItemPlayback;
    }
    get _playbackController() {
      if (void 0 !== this._playbackControllerInternal)
        return this._playbackControllerInternal;
      Ze.debug("setting _playbackController");
      const e = this._getPlaybackControllerByType(za.serial);
      return (this._playbackController = e), e;
    }
    set _playbackController(e) {
      (this._playbackControllerInternal = e),
        (this._playbackControllerInternal.autoplayEnabled =
          this._autoplayEnabled),
        this._playbackControllerInternal.activate(),
        this.capabilities.updateChecker(
          this._playbackControllerInternal.hasCapabilities
        ),
        (this.capabilities.controller = this._playbackControllerInternal);
    }
    addEventListener(e, n, d = {}) {
      adaptAddEventListener(this._services.dispatcher, e, n, d);
    }
    authorize() {
      var e = this;
      return _async_to_generator$9(function* () {
        return e.deferPlayback(), Ra.authorize();
      })();
    }
    canAuthorize() {
      return supportsDrm() && !this.isAuthorized;
    }
    canUnauthorize() {
      return supportsDrm() && this.isAuthorized;
    }
    changeToMediaAtIndex(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        n._isPlaybackSupported() &&
          (yield n._validateAuthorization(),
          n._signalChangeItemIntent(),
          yield n._playbackController.changeToMediaAtIndex(e));
      })();
    }
    changeToMediaItem(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        Ze.debug("instance.changeToMediaItem", e),
          n._isPlaybackSupported() &&
            (yield n._validateAuthorization(),
            n._signalChangeItemIntent(),
            yield n._playbackController.changeToMediaItem(e));
      })();
    }
    changeUserStorefront(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        n.storefrontId = e;
      })();
    }
    cleanup() {
      var n = this;
      return _async_to_generator$9(function* () {
        var d;
        null === (d = n._services.mediaItemPlayback) ||
          void 0 === d ||
          d.destroy(),
          n._signalIntent({
            endReasonType: e.PlayActivityEndReasonType.EXITED_APPLICATION,
          });
        const p = Object.keys(n._playbackControllers).map((e) =>
          n._playbackControllers[e].destroy()
        );
        try {
          yield Promise.all(p);
        } catch (Yt) {
          Ze.error("Error cleaning up controller", Yt);
        }
        n._services.dispatcher.clear();
      })();
    }
    configure(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        return (n._whenConfigured = n._configure(e)), n._whenConfigured;
      })();
    }
    _configure(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        yield Ra.storekit.whenAuthCompleted;
        const d = e.map(
          n._services.apiManager.registerAPIService,
          n._services.apiManager
        );
        yield Promise.all(d),
          yield n._configurePlayActivity(),
          n._initializeExternalEventPublishing();
      })();
    }
    deferPlayback() {
      Ze.debug("deferPlayback", this._playbackControllerInternal),
        deferPlayback();
    }
    getApiByType(e) {
      var n;
      return null === (n = this._services.apiManager) || void 0 === n
        ? void 0
        : n.getApiByType(e);
    }
    me() {
      return _async_to_generator$9(function* () {
        try {
          return yield Ra.storekit.me();
        } catch (Yt) {
          return Promise.reject(
            new MKError(MKError.Reason.AUTHORIZATION_ERROR, "Unauthorized")
          );
        }
      })();
    }
    musicSubscriptionOffers() {
      return Ra.storekit.musicSubscriptionOffers(this.storefrontId);
    }
    musicSubcriptionOffers() {
      return (
        deprecationWarning("musicSubcriptionOffers", {
          message:
            "musicSubcriptionOffers has been deprecated, use musicSubscriptionOffers instead",
        }),
        this.musicSubscriptionOffers()
      );
    }
    hasMusicSubscription() {
      return hasMusicSubscription(Ra.storekit);
    }
    mute() {
      return this._mediaItemPlayback.mute();
    }
    pause(n) {
      var d = this;
      return _async_to_generator$9(function* () {
        if (d._isPlaybackSupported()) {
          try {
            d._signalIntent({
              endReasonType:
                e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED,
            }),
              yield d._playbackController.pause(n);
          } catch (q) {
            d._handlePlaybackError(q);
          }
          return Promise.resolve();
        }
      })();
    }
    play() {
      var e = this;
      return _async_to_generator$9(function* () {
        if ((Ze.debug("instance.play()"), e._isPlaybackSupported())) {
          yield e._validateAuthorization();
          try {
            yield e._playbackController.play();
          } catch (q) {
            e._handlePlaybackError(q);
          }
          return Promise.resolve();
        }
      })();
    }
    playMediaItem(e, n) {
      var d = this;
      return _async_to_generator$9(function* () {
        var p, h;
        if (
          (Ze.debug("mk: playMediaItem", e),
          (null == n ? void 0 : n.bingeWatching) || d.deferPlayback(),
          (n = _object_spread$5({}, n)),
          (null == e ? void 0 : e.playEvent) && !hasOwn(n, "startTime"))
        ) {
          const { playEvent: d } = e;
          d.isDone ||
            void 0 === d.playCursorInSeconds ||
            (n.startTime = d.playCursorInSeconds);
        }
        d.services.dispatcher.publish(ya.playInitiated, {
          item: e,
          timestamp:
            null !==
              (h =
                null === (p = n.meta) || void 0 === p
                  ? void 0
                  : p.initiatedTimestamp) && void 0 !== h
              ? h
              : Date.now(),
        });
        try {
          n && d._mediaItemPlayback.playOptions.set(e.id, n);
          const p = yield d._playbackController.playSingleMediaItem(e, n);
          return d.services.dispatcher.publish(ya.capabilitiesChanged), p;
        } catch (q) {
          Ze.error("mk:playMediaItem error", q), d._handlePlaybackError(q);
        }
      })();
    }
    removeEventListener(e, n) {
      !(function (e, n, d) {
        const p = getCallbacksForName(n);
        let h;
        for (let y = p.length - 1; y >= 0; y--) {
          const [e, n] = p[y];
          if (e === d) {
            (h = n), p.splice(y, 1);
            break;
          }
        }
        h && e.unsubscribe(n, h);
      })(this._services.dispatcher, e, n);
    }
    shouldDisplayPrivacyLink(e) {
      return _async_to_generator$9(function* () {
        return Ra.shouldDisplayPrivacyLink(e);
      })();
    }
    exitFullscreen() {
      return this._mediaItemPlayback.exitFullscreen();
    }
    requestFullscreen(e) {
      return this._mediaItemPlayback.requestFullscreen(e);
    }
    loadPreviewImage(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        return n._mediaItemPlayback.loadPreviewImage(e);
      })();
    }
    getNewSeeker() {
      return this._playbackController.getNewSeeker();
    }
    seekToTime(e, n = Rt.Manual) {
      var d = this;
      return _async_to_generator$9(function* () {
        if (d._isPlaybackSupported()) {
          yield d._validateAuthorization();
          try {
            yield d._playbackController.seekToTime(e, n);
          } catch (q) {
            d._handlePlaybackError(q);
          }
          return Promise.resolve();
        }
      })();
    }
    setPresentationMode(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        return n._mediaItemPlayback.setPresentationMode(e);
      })();
    }
    skipToNextItem() {
      var n = this;
      return _async_to_generator$9(function* () {
        if (n._isPlaybackSupported()) {
          yield n._validateAuthorization(),
            n._signalIntent({
              endReasonType: e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
              direction: e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
            });
          try {
            yield n._playbackController.skipToNextItem();
          } catch (q) {
            n._handlePlaybackError(q);
          }
        }
      })();
    }
    skipToPreviousItem() {
      var n = this;
      return _async_to_generator$9(function* () {
        if (n._isPlaybackSupported()) {
          yield n._validateAuthorization(),
            n._signalIntent({
              endReasonType:
                e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,
              direction: e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,
            });
          try {
            yield n._playbackController.skipToPreviousItem();
          } catch (q) {
            n._handlePlaybackError(q);
          }
        }
      })();
    }
    seekForward() {
      var n = this;
      return _async_to_generator$9(function* () {
        if (n._isPlaybackSupported()) {
          yield n._validateAuthorization();
          try {
            n._signalIntent({
              endReasonType: e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
              direction: e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,
            }),
              yield n._playbackController.seekForward();
          } catch (q) {
            n._handlePlaybackError(q);
          }
        }
      })();
    }
    seekBackward() {
      var e = this;
      return _async_to_generator$9(function* () {
        if (e._isPlaybackSupported()) {
          yield e._validateAuthorization();
          try {
            yield e._playbackController.seekBackward();
          } catch (q) {
            e._handlePlaybackError(q);
          }
        }
      })();
    }
    showPlaybackTargetPicker() {
      this._playbackController.showPlaybackTargetPicker();
    }
    stop(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        if (n._isPlaybackSupported()) {
          var d;
          n._signalIntent({
            endReasonType: null == e ? void 0 : e.endReasonType,
            userInitiated:
              null === (d = null == e ? void 0 : e.userInitiated) ||
              void 0 === d ||
              d,
          });
          try {
            yield n._playbackController.stop(e);
          } catch (q) {
            n._handlePlaybackError(q);
          }
        }
      })();
    }
    resetSubscribeViewEligibility() {
      Ra.storekit.resetSubscribeViewEligibility();
    }
    unauthorize() {
      return _async_to_generator$9(function* () {
        return Ra.unauthorize();
      })();
    }
    unmute() {
      return this._mediaItemPlayback.unmute();
    }
    _createPlayerControllerOptions() {
      return {
        tokens: Ra,
        bag: $a,
        playbackServices: {
          getRTCStreamingTracker: () => {
            var e;
            return null === (e = this._services.playActivity) || void 0 === e
              ? void 0
              : e.getTrackerByType(RTCStreamingTracker);
          },
          hasMusicSubscription: hasMusicSubscription,
          prepareForEncryptedPlayback: (e, n) =>
            (function (e, n, d) {
              return _prepareForEncryptedPlayback.apply(this, arguments);
            })(this._services.apiManager, e, n),
          requiresHlsJs: requiresHlsJs,
        },
        services: this._services,
        context: this.context,
        autoplayEnabled: this.autoplayEnabled,
        privateEnabled: this.privateEnabled,
        siriInitiated: this.siriInitiated,
        storekit: null == Ra ? void 0 : Ra.storekit,
        playbackMode: this.playbackMode,
      };
    }
    _getPlaybackControllerByType(e) {
      const n = this._playbackControllers[e];
      if (n) return n;
      let d;
      switch (e) {
        case za.serial:
          d = new SerialPlaybackController(
            this._createPlayerControllerOptions()
          );
          break;
        case za.continuous:
          d = new ContinuousPlaybackController(
            this._createPlayerControllerOptions()
          );
          break;
        default:
          throw new MKError(
            MKError.Reason.UNSUPPORTED_ERROR,
            "Unsupported controller requested: " + e
          );
      }
      return (this._playbackControllers[e] = d), d;
    }
    _handlePlaybackError(e) {
      if (
        (Ze.error("mediaPlaybackError", e),
        MKError.isMKError(e) && No.includes(e.reason))
      )
        throw e;
      this._playbackErrorDialog &&
        !this._services.runtime.isNodeEnvironment &&
        MKDialog.presentError(e);
    }
    _initializeInternalEventHandling() {
      Ra.storekit.addEventListener(ya.userTokenDidChange, () => {
        this._whenConfigured &&
          this._whenConfigured
            .then(() => this._configurePlayActivity().catch())
            .catch();
      });
      const n = this._services.dispatcher;
      n.subscribe(ya.mediaPlaybackError, (e, n) =>
        this._handlePlaybackError(n)
      ),
        n.subscribe(ya.playbackStateDidChange, (n, d) => {
          d.state === e.PlaybackStates.paused &&
            (Ze.debug(
              "mk: playbackStateDidChange callback - calling storekit.presentSubscribeViewForEligibleUsers"
            ),
            Ra.storekit.presentSubscribeViewForEligibleUsers(
              { state: d.state, item: this.nowPlayingItem },
              !1
            ));
        }),
        n.subscribe(Ci, (e, d) => {
          d.blob &&
            (Ze.debug('Dispatching TimedMetadata "ping" blob', d),
            n.publish(kt.timedMetadata, {
              item: this.nowPlayingItem,
              position: this.currentPlaybackTime,
              playingDate: this.currentPlayingDate,
              storefrontId: this.storefrontId.toUpperCase(),
              metadata: d,
            }));
        });
    }
    _initializeExternalEventPublishing() {
      [
        ya.authorizationStatusDidChange,
        ya.needsGDPRDidChange,
        ya.storefrontCountryCodeDidChange,
        ya.storefrontIdentifierDidChange,
        ya.userTokenDidChange,
        ya.eligibleForSubscribeView,
      ].forEach((e) => {
        Ra.storekit.addEventListener(e, (n) =>
          this._services.dispatcher.publish(e, n)
        );
      }),
        this._services.dispatcher.subscribe(Ci, (e, n) => {
          Ze.debug("Dispatching TimedMetadata change", n),
            this._services.dispatcher.publish(ya.timedMetadataDidChange, n);
        });
    }
    configureLogger(e) {
      var n;
      Ze.level === Je &&
        (!0 === e.debug
          ? setRootLoggingLevel(pe.DEBUG)
          : void 0 !== e.logLevel && setRootLoggingLevel(e.logLevel)),
        void 0 !== e.logHandler &&
          ((n = e.logHandler), (Ze.handlers.external = new CallbackHandler(n)));
    }
    _configurePlayActivity() {
      var e = this;
      return _async_to_generator$9(function* () {
        void 0 !== e._services.playActivity &&
          (yield e._services.playActivity.configure({
            instance: e,
            services: e._services,
          }));
      })();
    }
    _isPlaybackSupported() {
      return (
        !this._services.runtime.isNodeEnvironment ||
        (Ze.warn("Media playback is not supported in Node environments."), !1)
      );
    }
    _updatePlaybackController(e) {
      var n = this;
      return _async_to_generator$9(function* () {
        Ze.debug("mk: _updatePlaybackController", e),
          n._playbackControllerInternal !== e &&
            (n._playbackControllerInternal &&
              (yield n._playbackControllerInternal.deactivate()),
            (n._playbackController = e));
      })();
    }
    _signalChangeItemIntent() {
      this._signalIntent({
        endReasonType:
          e.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM,
      });
    }
    _signalIntent(e) {
      this.services.dispatcher.publish(
        kt.userActivityIntent,
        _object_spread$5({ userInitiated: !0 }, e)
      );
    }
    _validateAuthorization(n = !1) {
      var d = this;
      return _async_to_generator$9(function* () {
        (n || d.playbackMode === e.PlaybackMode.FULL_PLAYBACK_ONLY) &&
          ((void 0 !== d._playbackControllerInternal &&
            d._playbackControllerInternal.isReady &&
            d._playbackControllerInternal.isPlaying) ||
            (yield d.authorize()));
      })();
    }
    constructor(n) {
      _define_property$8(this, "app", void 0),
        _define_property$8(this, "capabilities", void 0),
        _define_property$8(this, "context", void 0),
        _define_property$8(this, "_autoplayEnabled", !1),
        _define_property$8(this, "id", void 0),
        _define_property$8(this, "prefix", void 0),
        _define_property$8(this, "privateEnabled", !1),
        _define_property$8(this, "siriInitiated", !1),
        _define_property$8(this, "sourceType", qt.MUSICKIT),
        _define_property$8(this, "version", e.version),
        _define_property$8(this, "playbackActions", void 0),
        _define_property$8(this, "guid", void 0),
        _define_property$8(this, "_bag", $a),
        _define_property$8(this, "_playbackControllers", {}),
        _define_property$8(this, "_playbackControllerInternal", void 0),
        _define_property$8(this, "_services", void 0),
        _define_property$8(this, "_playbackErrorDialog", !0),
        _define_property$8(this, "_playbackMode", e.PlaybackMode.MIXED_CONTENT),
        _define_property$8(this, "_whenConfigured", void 0);
      const { developerToken: d } = n;
      if ("string" != typeof d || "" === d.trim())
        throw new MKError(
          MKError.Reason.CONFIGURATION_ERROR,
          "Missing or empty developer token"
        );
      Object.assign(
        $a.features,
        (function (e = []) {
          const n = {};
          return (
            e.forEach((e) => {
              "-" === e.charAt(0)
                ? ((e = e.substr(1)), (n[e] = !1))
                : (n[e] = !0);
            }),
            n
          );
        })(n.features)
      );
      const p = Uo.get();
      p &&
        (Ze.warn("Overriding bag.features with", p),
        ($a.features = _object_spread$5({}, $a.features, p))),
        "autoplay" in n && Object.assign($a.autoplay, n.autoplay),
        (this.context = {});
      const h = n.services;
      (this.capabilities = new Capabilities(h.dispatcher)),
        "playbackActions" in n && (this.playbackActions = n.playbackActions),
        "guid" in n && (this.guid = n.guid);
      const y = new TimingAccuracy(!!$a.features["player-accurate-timing"]),
        _ = new BitrateCalculator(h.dispatcher, n.bitrate);
      (this._services = {
        runtime: h.runtime,
        dispatcher: h.dispatcher,
        timing: y,
        bitrateCalculator: _,
      }),
        void 0 !== n.playActivityAPI &&
          (this._services.playActivity = new PlayActivityService(
            h.dispatcher,
            n.playActivityAPI
          )),
        (n.services = this._services),
        this.configureLogger(n),
        ($a.app = n.app || {}),
        ($a.store = new DataStore({
          filter: getFilterFromFlags(n.storeFilterTypes || []),
          shouldDisableRecordReuse:
            !!$a.features["disable-data-store-record-reuse"],
        })),
        Object.assign($a.urls, n.urls || {});
      const m = (function (e, n) {
        return (Ra = new Store(e, n)), Ra;
      })(d, n);
      this._services.apiManager = new APIServiceManager(m, h.dispatcher);
      const g = new MediaItemPlayback(this._createPlayerControllerOptions());
      if (
        ((this._services.mediaItemPlayback = g),
        n.sourceType && (this.sourceType = n.sourceType),
        this._initializeInternalEventHandling(),
        n.bitrate && (this.bitrate = n.bitrate),
        "prefix" in n &&
          /^(?:web|preview)$/.test(n.prefix || "") &&
          (this.prefix = $a.prefix = n.prefix),
        n.suppressErrorDialog &&
          (this._playbackErrorDialog = !n.suppressErrorDialog),
        void 0 !== n.playbackMode && (this.playbackMode = n.playbackMode),
        "privateEnabled" in n && (this.privateEnabled = n.privateEnabled || !1),
        "siriInitiated" in n && (this.siriInitiated = n.siriInitiated || !1),
        (this.id = generateUUID()),
        Ze.info("MusicKit JS Version: " + this.version),
        Ze.info("InstanceId", this.id),
        Ze.debug("Link Parameters", n.linkParameters),
        $a.app && Ze.debug("App", $a.app),
        n.userToken)
      ) {
        const { userToken: e } = n;
        "function" == typeof e
          ? (Ra.dynamicMusicUserToken = e)
          : (this.musicUserToken = e);
      }
    }
  }
  function asyncGeneratorStep$8(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$8(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$8(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$8(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function dispatchDocumentEvent(e) {
    if (detectNodeEnvironment()) return;
    const n = new Event(e, { bubbles: !0, cancelable: !0 });
    setTimeout(() => document.dispatchEvent(n));
  }
  function _loadWebComponents() {
    return (_loadWebComponents = _async_to_generator$8(function* () {
      var e;
      if (detectNodeEnvironment()) return;
      const n = findScript("musickit.js");
      if (
        "" !==
        (null == n || null === (e = n.dataset) || void 0 === e
          ? void 0
          : e.webComponents)
      )
        return;
      const d = "noModule" in n,
        p = `components/musickit-components/musickit-components${d ? ".esm" : ""}.js`,
        h = "https:" + cdnBaseURL(p) + p,
        y = {};
      d && (y.type = "module"),
        n.hasAttribute("async") && (y.async = ""),
        n.hasAttribute("defer") && (y.defer = ""),
        yield loadScript(h, y),
        dispatchDocumentEvent(ya.webComponentsLoaded);
    })).apply(this, arguments);
  }
  _ts_decorate$3(
    [
      AsyncDebounce(250, { isImmediate: !0 }),
      _ts_metadata$3("design:type", Function),
      _ts_metadata$3("design:paramtypes", [
        "undefined" == typeof ActivityNotificationOptions
          ? Object
          : ActivityNotificationOptions,
      ]),
      _ts_metadata$3("design:returntype", Promise),
    ],
    MKInstance.prototype,
    "pause",
    null
  ),
    _ts_decorate$3(
      [
        AsyncDebounce(250, { isImmediate: !0 }),
        _ts_metadata$3("design:type", Function),
        _ts_metadata$3("design:paramtypes", []),
        _ts_metadata$3("design:returntype", Promise),
      ],
      MKInstance.prototype,
      "play",
      null
    ),
    _ts_decorate$3(
      [
        SerialAsync("skip"),
        _ts_metadata$3("design:type", Function),
        _ts_metadata$3("design:paramtypes", []),
        _ts_metadata$3("design:returntype", Promise),
      ],
      MKInstance.prototype,
      "skipToNextItem",
      null
    ),
    _ts_decorate$3(
      [
        SerialAsync("skip"),
        _ts_metadata$3("design:type", Function),
        _ts_metadata$3("design:paramtypes", []),
        _ts_metadata$3("design:returntype", Promise),
      ],
      MKInstance.prototype,
      "skipToPreviousItem",
      null
    ),
    _ts_decorate$3(
      [
        SerialAsync("seek"),
        _ts_metadata$3("design:type", Function),
        _ts_metadata$3("design:paramtypes", []),
        _ts_metadata$3("design:returntype", Promise),
      ],
      MKInstance.prototype,
      "seekForward",
      null
    ),
    _ts_decorate$3(
      [
        SerialAsync("seek"),
        _ts_metadata$3("design:type", Function),
        _ts_metadata$3("design:paramtypes", []),
        _ts_metadata$3("design:returntype", Promise),
      ],
      MKInstance.prototype,
      "seekBackward",
      null
    );
  class PubSub {
    publish(e, n) {
      const d = this.getSubscribersForType(e);
      void 0 !== d &&
        d.forEach((d) => {
          d(e, n);
        });
    }
    subscribe(e, n) {
      this.getSubscribersForType(e, !0).push(n);
    }
    subscribeOnce(e, n) {
      const onceCallback = (e, d) => {
        this.unsubscribe(e, onceCallback), n(e, d);
      };
      this.subscribe(e, onceCallback);
    }
    unsubscribe(e, n) {
      const d = this.getSubscribersForType(e);
      if (void 0 !== d)
        for (const p in d)
          if (d[p] === n) {
            delete d[p];
            break;
          }
    }
    clear(e) {
      void 0 === e ? (this.events = {}) : delete this.events[e];
    }
    getSubscribersForType(e, n = !1) {
      return (
        !this.events.hasOwnProperty(e) && n && (this.events[e] = []),
        this.events[e]
      );
    }
    constructor() {
      var e, n, d;
      (d = {}),
        (n = "events") in (e = this)
          ? Object.defineProperty(e, n, {
              value: d,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            })
          : (e[n] = d);
    }
  }
  function asyncGeneratorStep$7(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$7(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$7(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$7(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$6(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$4(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$6(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$3(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const Bo = "undefined" != typeof window && "undefined" != typeof document;
  let Fo = !1;
  const Ko = [];
  function cleanupInstances() {
    return _cleanupInstances.apply(this, arguments);
  }
  function _cleanupInstances() {
    return (_cleanupInstances = _async_to_generator$7(function* () {
      const e = Ko.map((e) => e.cleanup());
      yield Promise.all(e), Ko.splice(0, Ko.length);
    })).apply(this, arguments);
  }
  function configure$1(e) {
    return _configure$1.apply(this, arguments);
  }
  function _configure$1() {
    return (_configure$1 = _async_to_generator$7(function* (
      e,
      n = MKInstance,
      d
    ) {
      if (!e)
        throw new MKError(
          MKError.Reason.INVALID_ARGUMENTS,
          "configuration required"
        );
      const p = {};
      e.mergeQueryParams &&
        Bo &&
        window.location &&
        (p.linkParameters = _object_spread$4(
          {},
          e.linkParameters || {},
          parseQueryParams(window.location.href)
        ));
      const h = _object_spread$4(
        {
          runtime: yield RuntimeEnvironment.detect(),
          dispatcher: new PubSub(),
        },
        null == e ? void 0 : e.services
      );
      yield findKeySystemPreference(h.runtime);
      const y = new n(
        _object_spread_props$3(_object_spread$4({}, e, p), { services: h })
      );
      return (
        Fo || (yield cleanupInstances()),
        d && (yield d(y)),
        Ko.push(y),
        dispatchDocumentEvent(ya.configured),
        y
      );
    })).apply(this, arguments);
  }
  function getInstances() {
    return Ko;
  }
  function getInstance(e) {
    if (0 !== Ko.length)
      return void 0 === e ? Ko[Ko.length - 1] : Ko.find((n) => n.id === e);
  }
  Bo &&
    (asAsync(
      (function () {
        return _loadWebComponents.apply(this, arguments);
      })()
    ),
    dispatchDocumentEvent(ya.loaded));
  const Go = [
    "uploadedVideo",
    "uploadedAudio",
    "uploaded-videos",
    "uploaded-audios",
  ];
  function asyncGeneratorStep$6(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$6(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$6(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$6(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$5(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$3(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$5(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$2(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const Vo = Ye.createChild("paf"),
    asCode = (n) => {
      switch (typeof n) {
        case "string":
          return n;
        case "undefined":
          return "undefined";
        default:
          return "PlayActivityEndReasonType." + e.PlayActivityEndReasonType[n];
      }
    };
  class MPAFTracker {
    get requestedEvents() {
      return Array.from(this.dispatchTable.keys());
    }
    get isConfigured() {
      return void 0 !== this.instance;
    }
    get activityTracker() {
      if (void 0 === this._activityTracker)
        throw new MKError(
          MKError.Reason.CONFIGURATION_ERROR,
          "Play Activity service was called before configuration."
        );
      return this._activityTracker;
    }
    configure(e) {
      var n = this;
      return _async_to_generator$6(function* () {
        var d, p, h;
        (n.instance = e.instance),
          (n.services = e.services),
          (n._activityTracker =
            ((d = e.instance),
            (p = e.services.runtime),
            new PlayActivity(
              d.developerToken,
              d.musicUserToken,
              d.storefrontCountryCode,
              {
                app: {
                  build: $a.app.build,
                  name: null !== (h = $a.app.name) && void 0 !== h ? h : "",
                  version: $a.app.version,
                },
                fetch: !p.isNodeEnvironment && fetch.bind(globalThis),
                isQA: qo.enabled,
                logInfo: Vo.enabled,
                sourceType: d.sourceType,
                guid: d.guid,
                userIsSubscribed: () =>
                  !(
                    !d.isAuthorized ||
                    !Ra.storekit._getIsActiveSubscription.getCachedValue()
                  ),
              }
            )));
      })();
    }
    handleEvent(e, n, d) {
      if (!this.shouldTrackPlayActivity(e, d)) return;
      const p = this.dispatchTable.get(e);
      void 0 !== p && "function" == typeof this[p] && this[p](d, n);
    }
    activate(e, n = {}) {
      return this.activityTracker.activate(n.flush);
    }
    exit(e, n = {}) {
      return (
        Vo.debug("PAF debug", `client.exit(${n.position})`),
        this.activityTracker.exit(n.position)
      );
    }
    pause(e, n = {}) {
      return "number" == typeof n.endReasonType
        ? (Vo.debug(
            "PAF debug",
            `client.stop(${n.position}, ${n.endReasonType})`
          ),
          this.activityTracker.stop(n.position, n.endReasonType))
        : (Vo.debug("PAF debug", `client.pause(${n.position})`),
          this.activityTracker.pause(n.position));
    }
    play(e, n = {}) {
      const d = generateItemDescriptorForPAF(kt.playbackPlay, this.instance, e);
      isLiveRadioKind(e, "video") &&
        (this.musicLiveVideoStartTime = Date.now()),
        Vo.debug(
          "PAF debug",
          `client.play(${JSON.stringify(d)}, ${n.position})`
        ),
        this.activityTracker.play(d, n.position),
        (this.playReported = !0);
    }
    scrub(e, n = {}) {
      return (
        Vo.debug(
          "PAF debug",
          `client.scrub(${n.position}, ${asCode(n.endReasonType)})`
        ),
        this.activityTracker.scrub(n.position, n.endReasonType)
      );
    }
    seek(n, d = {}) {
      var p = this;
      return _async_to_generator$6(function* () {
        yield p.scrub(n, {
          position: d.startPosition,
          endReasonType: e.PlayActivityEndReasonType.SCRUB_BEGIN,
        }),
          yield p.scrub(n, {
            position: d.position,
            endReasonType: e.PlayActivityEndReasonType.SCRUB_END,
          });
      })();
    }
    skip(e, n = {}) {
      var d = this;
      return _async_to_generator$6(function* () {
        const p = generateItemDescriptorForPAF(kt.playbackSkip, d.instance, e);
        Vo.debug(
          "PAF debug",
          `client.skip(${JSON.stringify(p)}, ${asCode(n.direction)}, ${n.position})`
        );
        try {
          yield d.activityTracker.skip(p, n.direction, n.position);
        } catch (Yt) {
          if (
            "A play stop() method was called without a previous play() descriptor" !==
            Yt.message
          )
            return Promise.reject(Yt);
          yield d.play(e, n);
        }
      })();
    }
    stop(n, d = {}) {
      var p;
      (isLiveRadioKind(n, "video")
        ? ((d.position = (Date.now() - this.musicLiveVideoStartTime) / 1e3),
          (this.musicLiveVideoStartTime = 0))
        : (null == n ? void 0 : n.isLiveRadioStation) &&
          d.position &&
          (d.position = d.position - (d.startPosition || 0)),
      null == n ? void 0 : n.isLiveRadioStation) &&
        (d.endReasonType =
          null !== (p = d.endReasonType) && void 0 !== p
            ? p
            : e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED);
      return (
        Vo.debug(
          "PAF debug",
          `client.stop(${d.position}, ${asCode(d.endReasonType)})`
        ),
        this.activityTracker.stop(d.position, d.endReasonType)
      );
    }
    timedMetadata(e, n) {
      var d = this;
      return _async_to_generator$6(function* () {
        var p, h;
        if (
          void 0 === e ||
          void 0 === n ||
          void 0 === n.position ||
          void 0 ===
            (null === (p = n.metadata) || void 0 === p ? void 0 : p.blob)
        )
          return;
        if (!e.isRadioEpisode)
          return void Vo.debug(
            `Ignoring TimedMetadata ping at ${n.position}, not a Radio Episode`
          );
        const y = null === (h = n.metadata) || void 0 === h ? void 0 : h.blob,
          _ = d.activityTracker.timedMetadata;
        Vo.debug("Storing TimedMetadata ping at " + n.position),
          d.activityTracker.setTimedMetadata(y, n.position),
          d.playReported || void 0 === y
            ? ((void 0 !== y && void 0 === _) || !compareUint8Array(y, _)) &&
              (Vo.debug("Sending TimedMetadata ping at " + n.position),
              d.activityTracker.pingTimedMetadata(n.position, y))
            : Vo.debug("Play not reported, skipping TimeMetadata ping");
      })();
    }
    shouldTrackPlayActivity(n, d) {
      const p = hasAuthorization(),
        h = !d || d.playbackType !== e.PlaybackType.preview,
        y = this.alwaysSendForActivityType(n),
        _ = !d || (d && this.mediaRequiresPlayActivity(d));
      return !(!p || !h || (!y && !_));
    }
    alwaysSendForActivityType(e) {
      return e === kt.playerActivate || e === kt.playerExit;
    }
    mediaRequiresPlayActivity(e) {
      return (
        (void 0 !== (n = e.type) && Go.includes(n)) ||
        -1 !==
          ["musicMovie", "musicVideo", "song", "radioStation"].indexOf(e.type)
      );
      var n;
    }
    constructor() {
      _define_property$5(this, "instance", void 0),
        _define_property$5(this, "services", void 0),
        _define_property$5(this, "_activityTracker", void 0),
        _define_property$5(this, "playReported", !1),
        _define_property$5(this, "musicLiveVideoStartTime", 0),
        _define_property$5(
          this,
          "dispatchTable",
          new Map([
            [kt.playbackPlay, "play"],
            [kt.playbackPause, "pause"],
            [kt.playbackScrub, "scrub"],
            [kt.playbackSeek, "seek"],
            [kt.playbackSkip, "skip"],
            [kt.playbackStop, "stop"],
            [kt.playerActivate, "activate"],
            [kt.playerExit, "exit"],
            [kt.timedMetadata, "timedMetadata"],
          ])
        );
    }
  }
  function generateItemDescriptorForPAF(n, d, p) {
    const h = _object_spread_props$2(
      _object_spread$3(
        {},
        (function (n, d, p) {
          if (
            void 0 === (null == p ? void 0 : p.playbackActions) ||
            void 0 === d
          )
            return {};
          const h = {
              [e.PlayerRepeatMode.all]: Lt.REPEAT_ALL,
              [e.PlayerRepeatMode.none]: Lt.REPEAT_OFF,
              [e.PlayerRepeatMode.one]: Lt.REPEAT_ONE,
            },
            y = {
              [e.PlayerShuffleMode.off]: Nt.SHUFFLE_OFF,
              [e.PlayerShuffleMode.songs]: Nt.SHUFFLE_ON,
            };
          return {
            playMode() {
              let n = Lt.REPEAT_UNKNOWN,
                d = Nt.SHUFFLE_UNKNOWN,
                _ = Ut.AUTO_UNKNOWN;
              const { playbackActions: m } = p;
              var g;
              return (
                m &&
                  (m.includes(e.PlaybackActions.REPEAT) &&
                    (n = h[p.repeatMode]),
                  m.includes(e.PlaybackActions.SHUFFLE) &&
                    (d = y[p.shuffleMode]),
                  m.includes(e.PlaybackActions.AUTOPLAY) &&
                    (_ = p.autoplayEnabled
                      ? (g = p.queue).hasAutoplayStation &&
                        g.items.some((e) => {
                          const { id: n, type: d, container: p } = e;
                          if (p && "stations" === p.type && p.name === Ot.RADIO)
                            return !1;
                          const h = normalizeTypeForAutoplay(n, d);
                          return isAutoplaySupportedForType(h);
                        })
                        ? Ut.AUTO_ON
                        : Ut.AUTO_ON_CONTENT_UNSUPPORTED
                      : Ut.AUTO_OFF)),
                { repeatPlayMode: n, shufflePlayMode: d, autoplayMode: _ }
              );
            },
          };
        })(0, p, d),
        (function (e, n) {
          var d;
          if (!typeRequiresItem(e)) return {};
          if (void 0 === n) return {};
          const p =
            null === (d = n.attributes) || void 0 === d ? void 0 : d.mediaKind;
          return _object_spread$3(
            {},
            void 0 !== p ? { mediaType: p } : {},
            n.playParams
          );
        })(n, p),
        (function (e, n) {
          if (!typeRequiresItem(e) || void 0 === n) return {};
          const { context: d = {} } = n;
          return { recoData: d.reco_id };
        })(n, p),
        (function (e, n) {
          if (!typeRequiresItem(e) || void 0 === n) return {};
          const d = n.playbackDuration;
          if (!d) return {};
          return { duration: d / 1e3 };
        })(n, p),
        (function (e, n) {
          var d, p, h, y;
          const _ = (function (e, n) {
              var d;
              return (
                (itemIsRequired(e, n) &&
                  (null == n || null === (d = n.container) || void 0 === d
                    ? void 0
                    : d.name)) ||
                null
              );
            })(e, n),
            m = itemIsRequired(e, n)
              ? _object_spread$3(
                  {},
                  null == n ? void 0 : n.container,
                  null == n ||
                    null === (p = n.container) ||
                    void 0 === p ||
                    null === (d = p.attributes) ||
                    void 0 === d
                    ? void 0
                    : d.playParams,
                  (null == n ||
                  null === (y = n.container) ||
                  void 0 === y ||
                  null === (h = y.attributes) ||
                  void 0 === h
                    ? void 0
                    : h.hasCollaboration) && { isCollaborative: !0 }
                )
              : null;
          if (null === _ && null === m) return;
          return {
            container: cleanContainer(
              _object_spread$3({}, m, null !== _ ? { name: _ } : {})
            ),
          };
        })(n, p)
      ),
      { trackInfo: null == p ? void 0 : p.trackInfo }
    );
    return Vo.trace("PAF descriptor", h), h;
  }
  const qo = BooleanDevFlag.register("mk-use-paf-qa-endpoint");
  const typeRequiresItem = (e) =>
      [kt.playbackPlay, kt.playbackSkip].includes(e),
    itemIsRequired = (e, n) => void 0 !== n && typeRequiresItem(e);
  function cleanContainer(e) {
    const n = _object_spread$3({}, e);
    return delete n.attributes, n;
  }
  function asyncGeneratorStep$5(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$5(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$5(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$5(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$4(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread$2(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property$4(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props$1(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  const Ho = Ye.createChild("lyrics");
  class LyricsTracker {
    get requestedEvents() {
      return Array.from(this.dispatchTable.keys());
    }
    get activityTracker() {
      if (void 0 === this.instance || void 0 === this.services)
        throw new MKError(
          MKError.Reason.CONFIGURATION_ERROR,
          "Lyrics Play Activity service was called before configuration."
        );
      var e, n, d;
      return (
        void 0 === this._activityTracker &&
          (this._activityTracker =
            ((e = this.instance),
            (n = this.services.runtime),
            new LyricsPlayActivity(
              e.developerToken,
              e.musicUserToken,
              e.storefrontCountryCode,
              {
                app: {
                  build: $a.app.build,
                  name: null !== (d = $a.app.name) && void 0 !== d ? d : "",
                  version: $a.app.version,
                },
                fetch: !n.isNodeEnvironment && fetch.bind(globalThis),
                logInfo: Ho.level <= pe.INFO,
                sourceType: e.sourceType,
                isQA: Wo.enabled,
                userIsSubscribed: () =>
                  e.isAuthorized &&
                  Ra.storekit._getIsActiveSubscription.getCachedValue(),
              }
            ))),
        this._activityTracker
      );
    }
    get isConfigured() {
      return void 0 !== this.instance;
    }
    static configure(e) {
      var n = this;
      return _async_to_generator$5(function* () {
        const d = new n();
        return d.configure(e), d;
      })();
    }
    configure(e) {
      var n = this;
      return _async_to_generator$5(function* () {
        (n.instance = e.instance), (n.services = e.services);
      })();
    }
    handleEvent(e, n, d) {
      const p = this.dispatchTable.get(e);
      void 0 !== p && "function" == typeof this[p] && this[p](d, n);
    }
    lyricsPlay(e, n) {
      var d = this;
      return _async_to_generator$5(function* () {
        const p = null == n ? void 0 : n.lyrics;
        if (void 0 === p)
          throw new MKError(
            MKError.Reason.MEDIA_DESCRIPTOR,
            "Key lyrics is missing from descriptor provided to lyricsPlay"
          );
        if (void 0 === e)
          throw new MKError(
            MKError.Reason.MEDIA_DESCRIPTOR,
            "Cannot display lyrics without a MediaItem"
          );
        d.activityTracker.play(
          (function (e, n, d) {
            var p, h, y, _;
            return _object_spread_props$1(
              _object_spread$2(
                {
                  id: n.id,
                  duration: 0,
                  eventType: Ft.LYRIC_DISPLAY,
                  container: _object_spread$2(
                    {},
                    n.container,
                    null === (h = n.container) ||
                      void 0 === h ||
                      null === (p = h.attributes) ||
                      void 0 === p
                      ? void 0
                      : p.playParams
                  ),
                },
                n.playParams
              ),
              {
                lyricDescriptor: {
                  id: null !== (_ = d.id) && void 0 !== _ ? _ : n.id,
                  displayType: d.displayType,
                  language: d.language,
                },
                trackInfo: n.trackInfo,
                recoData:
                  null === (y = n.attributes) || void 0 === y
                    ? void 0
                    : y.reco_id,
              }
            );
          })(kt.lyricsPlay, e, p)
        );
      })();
    }
    lyricsStop(e, n) {
      var d = this;
      return _async_to_generator$5(function* () {
        d.activityTracker.stop();
      })();
    }
    exit(e, n) {
      var d = this;
      return _async_to_generator$5(function* () {
        d.activityTracker.exit();
      })();
    }
    constructor() {
      _define_property$4(
        this,
        "dispatchTable",
        new Map([
          [kt.lyricsPlay, "lyricsPlay"],
          [kt.lyricsStop, "lyricsStop"],
          [kt.playerExit, "exit"],
        ])
      ),
        _define_property$4(this, "instance", void 0),
        _define_property$4(this, "services", void 0),
        _define_property$4(this, "_activityTracker", void 0);
    }
  }
  const Wo = BooleanDevFlag.register("mk-use-paf-qa-endpoint");
  const SharePlayGuard = (e) => (n, d, p) => {
    const h = p.value;
    return (
      (p.value = function (...n) {
        if (!this.isInSharePlay) return h.apply(this, n);
        e && this.services.dispatcher.publish(e);
      }),
      p
    );
  };
  function asyncGeneratorStep$4(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$4(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$4(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$4(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _ts_metadata$2(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  class MusicKitInstance extends MKInstance {
    addToLibrary(e, n) {
      var d = this;
      return _async_to_generator$4(function* () {
        yield d.authorize(),
          n || (n = /[a-z]{2}\.[a-z0-9\-]+/i.test(e) ? "playlists" : "albums");
        const p = {};
        let h;
        return (p[n] = [e]), (h = d.api.addToLibrary(p)), h;
      })();
    }
    changeToMediaItem(e) {
      var n = this,
        _superprop_get_changeToMediaItem = () => super.changeToMediaItem;
      return _async_to_generator$4(function* () {
        return (
          n._checkNeedsEquivalent(),
          _superprop_get_changeToMediaItem().call(n, e)
        );
      })();
    }
    play() {
      var e = this,
        _superprop_get_play = () => super.play;
      return _async_to_generator$4(function* () {
        return e._checkNeedsEquivalent(), _superprop_get_play().call(e);
      })();
    }
    playMediaItem(e, n) {
      var d = this,
        _superprop_get_playMediaItem = () => super.playMediaItem;
      return _async_to_generator$4(function* () {
        if (d._isPlaybackSupported())
          return (
            d._checkNeedsEquivalent(),
            _superprop_get_playMediaItem().call(d, e, n)
          );
      })();
    }
    _isStationQueueOptions(e) {
      return !(
        !((e) =>
          !!e &&
          (!!isIdentityQueue(e) ||
            !!isQueueURLOption(e) ||
            Object.keys(ro).some((n) => void 0 !== e[n])))(
          (e = parseQueueURLOption(e))
        ) ||
        ((e) => {
          if (!e) return !1;
          if (isQueueURLOption(e)) return !0;
          if (isQueueItems(e)) return !0;
          return Object.keys(lo)
            .concat(Object.keys(uo))
            .some((n) => void 0 !== e[n]);
        })(e)
      );
    }
    setStationQueue(e) {
      var n = this,
        _superprop_get__validateAuthorization = () =>
          super._validateAuthorization;
      return _async_to_generator$4(function* () {
        if (!n._isPlaybackSupported())
          return void Ze.warn("Playback is not supported");
        n._signalChangeItemIntent(),
          n.deferPlayback(),
          yield n._updatePlaybackController(
            n._getPlaybackControllerByType(za.continuous)
          ),
          yield _superprop_get__validateAuthorization().call(n, !0),
          (e = parseQueueURLOption(e));
        const d = n._playbackController.setQueue(e);
        return (
          void 0 !== e.autoplay &&
            (deprecationWarning("autoplay", {
              message: "autoplay has been deprecated, use startPlaying instead",
            }),
            void 0 === e.startPlaying && (e.startPlaying = e.autoplay)),
          e.startPlaying && (yield n.play()),
          d
        );
      })();
    }
    setQueue(e) {
      var n = this;
      return _async_to_generator$4(function* () {
        if (
          (Ze.debug("instance.setQueue()", e),
          n._checkNeedsEquivalent(),
          !n._isPlaybackSupported())
        )
          return void Ze.warn("Playback is not supported");
        if (n._isStationQueueOptions(e))
          return (
            Ze.warn(
              "setQueue options contained a station queue request. Changing to setStationQueue mode."
            ),
            n.setStationQueue(e)
          );
        n._signalChangeItemIntent(),
          n.deferPlayback(),
          yield n._updatePlaybackController(
            n._getPlaybackControllerByType(za.serial)
          );
        const d = yield n._playbackController.setQueue(e);
        return (
          void 0 !== e.repeatMode &&
            (n._playbackController.repeatMode = e.repeatMode),
          void 0 !== e.autoplay &&
            (deprecationWarning("autoplay", {
              message: "autoplay has been deprecated, use startPlaying instead",
            }),
            void 0 === e.startPlaying && (e.startPlaying = e.autoplay)),
          e.startPlaying && (yield n.play()),
          d
        );
      })();
    }
    _checkNeedsEquivalent() {
      var n;
      const d =
        null === (n = this.api) || void 0 === n ? void 0 : n.needsEquivalents;
      if (this.realm === e.SKRealm.MUSIC && !this.previewOnly && !0 === d)
        throw new MKError(MKError.Reason.CONTENT_EQUIVALENT);
    }
    playNext(e, n = !1) {
      var d = this;
      return _async_to_generator$4(function* () {
        if (d._isPlaybackSupported())
          return d._playbackController.queue
            ? (d.deferPlayback(), d._playbackController.prepend(e, n))
            : d.setQueue(e);
        Ze.warn("Playback is not supported");
      })();
    }
    playLater(e) {
      var n = this;
      return _async_to_generator$4(function* () {
        if (n._isPlaybackSupported())
          return n._playbackController.queue
            ? (n.deferPlayback(), n._playbackController.append(e))
            : n.setQueue(e);
        Ze.warn("Playback is not supported");
      })();
    }
    playAt(e, n) {
      var d = this;
      return _async_to_generator$4(function* () {
        if (d._isPlaybackSupported())
          return d._playbackController.queue
            ? (d.deferPlayback(), d._playbackController.insertAt(e, n))
            : d.setQueue(n);
        Ze.warn("Playback is not supported");
      })();
    }
    clearQueue() {
      var e = this;
      return _async_to_generator$4(function* () {
        return (
          e._mediaItemPlayback.clearNextManifest(),
          e._playbackController.clear()
        );
      })();
    }
    lyricsStart(e) {
      this.services.dispatcher.publish(kt.lyricsPlay, {
        item: this.nowPlayingItem,
        lyrics: e,
      });
    }
    lyricsStop() {
      this.services.dispatcher.publish(kt.lyricsStop);
    }
  }
  function _define_property$3(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_metadata$1(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      SharePlayGuard(),
      _ts_metadata$2("design:type", Function),
      _ts_metadata$2("design:paramtypes", [
        Number,
        "undefined" == typeof SerialQueueOptions ? Object : SerialQueueOptions,
      ]),
      _ts_metadata$2("design:returntype", Promise),
    ],
    MusicKitInstance.prototype,
    "playAt",
    null
  );
  class SharePlaySession {
    updateState(e) {
      const { displayName: n, members: d, mediaState: p } = e;
      n && (this.displayName = n),
        d && (this.participantCount = d.length),
        this.didCapabilitiesChange(
          p.capabilities,
          this.mediaState.capabilities
        ) && this.dispatcher.publish(ya.capabilitiesChanged),
        (this.mediaState = (function (e) {
          for (var n = 1; n < arguments.length; n++) {
            var d = null != arguments[n] ? arguments[n] : {},
              p = Object.keys(d);
            "function" == typeof Object.getOwnPropertySymbols &&
              (p = p.concat(
                Object.getOwnPropertySymbols(d).filter(function (e) {
                  return Object.getOwnPropertyDescriptor(d, e).enumerable;
                })
              )),
              p.forEach(function (n) {
                _define_property$3(e, n, d[n]);
              });
          }
          return e;
        })({}, this.mediaState, p)),
        this.dispatcher.publish(Ta, this.mediaState);
    }
    shouldUpdate(e, n) {
      return this.mediaState[e] !== n;
    }
    didCapabilitiesChange(e, n) {
      for (const d in e) if (e[d] !== n[d]) return !0;
      return !1;
    }
    checkCapability(e) {
      const { capabilities: n } = this.mediaState;
      switch (e) {
        case Aa.AUTOPLAY:
          return n.autoPlayControl;
        case Aa.REPEAT:
          return n.repeatControl;
        case Aa.SHUFFLE:
          return n.shuffleControl;
        case Aa.VOLUME:
          return n.volumeControl;
        case Aa.SEEK:
        case Aa.EDIT_QUEUE:
        case Aa.PAUSE:
        case Aa.SKIP_NEXT:
        case Aa.SKIP_PREVIOUS:
        case Aa.SKIP_TO_ITEM:
          return !0;
        default:
          return !1;
      }
    }
    get lastKnownElapsedTime() {
      const { queue: e, currentPlayingIndex: n } = this.mediaState,
        d = e[n];
      return Math.round(null == d ? void 0 : d.attributes.elapsedTime) || 0;
    }
    constructor(n, d) {
      _define_property$3(this, "id", void 0),
        _define_property$3(this, "displayName", void 0),
        _define_property$3(this, "participantCount", 0),
        _define_property$3(this, "dispatcher", void 0),
        _define_property$3(this, "mediaState", {
          autoPlay: !1,
          capabilities: {
            autoPlayControl: !0,
            repeatControl: !0,
            shuffleControl: !0,
            volumeControl: !0,
          },
          playbackState: e.PlaybackStates.none,
          volume: 1,
          queue: [],
          shuffleMode: e.PlayerShuffleMode.off,
          repeatMode: e.PlayerRepeatMode.none,
          currentPlayingIndex: 0,
        });
      const { id: p, displayName: h } = n;
      (this.id = p), (this.displayName = h), (this.dispatcher = d);
    }
  }
  function asyncGeneratorStep$3(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$3(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$3(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$3(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function _define_property$2(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _ts_decorate(e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    return y > 3 && _ && Object.defineProperty(n, d, _), _;
  }
  function _ts_metadata(e, n) {
    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
      return Reflect.metadata(e, n);
  }
  !(function (e, n, d, p) {
    var h,
      y = arguments.length,
      _ =
        y < 3
          ? n
          : null === p
            ? (p = Object.getOwnPropertyDescriptor(n, d))
            : p;
    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
      _ = Reflect.decorate(e, n, d, p);
    else
      for (var m = e.length - 1; m >= 0; m--)
        (h = e[m]) && (_ = (y < 3 ? h(_) : y > 3 ? h(n, d, _) : h(n, d)) || _);
    y > 3 && _ && Object.defineProperty(n, d, _);
  })(
    [
      Bind(),
      _ts_metadata$1("design:type", Function),
      _ts_metadata$1("design:paramtypes", [void 0 === Aa ? Object : Aa]),
      _ts_metadata$1("design:returntype", void 0),
    ],
    SharePlaySession.prototype,
    "checkCapability",
    null
  );
  class SharePlayInstance extends MusicKitInstance {
    get sharePlay() {
      return this._sharePlay;
    }
    get isInSharePlay() {
      return this.playbackMode === e.PlaybackMode.SHAREPLAY_PARTICIPANT;
    }
    startSharePlay(n) {
      var d = this;
      return _async_to_generator$3(function* () {
        var p;
        if (void 0 !== d.sharePlay) return d.sharePlay;
        d.savePlaybackState();
        const h = new SharePlaySession(n, d.services.dispatcher);
        return (
          d.services.dispatcher.subscribe(Ta, d.onMediaStateUpdate),
          (d._voidPlayer = new VoidPlayer(d._createPlayerControllerOptions())),
          (d.playbackMode = e.PlaybackMode.SHAREPLAY_PARTICIPANT),
          (d._sharePlay = h),
          d.capabilities.updateChecker(h.checkCapability),
          yield d._voidPlayer.initialize(),
          yield d._mediaItemPlayback.setCurrentPlayer(d._voidPlayer),
          null === (p = d.services.playActivity) || void 0 === p || p.cleanup(),
          h
        );
      })();
    }
    endSharePlay() {
      var e = this;
      return _async_to_generator$3(function* () {
        e.isInSharePlay &&
          (e.updateQueue([], 0),
          (e._sharePlay = void 0),
          e.services.dispatcher.unsubscribe(Ta, e.onMediaStateUpdate),
          e.capabilities.updateChecker(e._playbackController.hasCapabilities),
          e._configurePlayActivity(),
          e.restorePlaybackState());
      })();
    }
    get shuffleMode() {
      return this.isInSharePlay
        ? this._shuffleMode
        : this._playbackController.shuffleMode;
    }
    set shuffleMode(e) {
      var n;
      this.isInSharePlay
        ? e !== this._shuffleMode &&
          ((this._shuffleMode = e),
          this.services.dispatcher.publish(ya.shuffleModeDidChange, e),
          (null === (n = this.sharePlay) || void 0 === n
            ? void 0
            : n.shouldUpdate("shuffleMode", e)) &&
            this.services.dispatcher.publish(ga, e))
        : (this._playbackController.shuffleMode = e);
    }
    get repeatMode() {
      return super.repeatMode;
    }
    set repeatMode(e) {
      var n;
      (super.repeatMode = e),
        (null === (n = this.sharePlay) || void 0 === n
          ? void 0
          : n.shouldUpdate("repeatMode", this.repeatMode)) &&
          this.services.dispatcher.publish(ba, { repeatMode: this.repeatMode });
    }
    get autoplayEnabled() {
      return super.autoplayEnabled;
    }
    set autoplayEnabled(e) {
      var n;
      this.capabilities.canAutoplay
        ? ((super.autoplayEnabled = e),
          (null === (n = this.sharePlay) || void 0 === n
            ? void 0
            : n.shouldUpdate("autoPlay", this.autoplayEnabled)) &&
            this.services.dispatcher.publish(Pa, {
              autoPlay: this.autoplayEnabled,
            }))
        : Ze.warn("Setting autoplay is not supported in this playback method");
    }
    get volume() {
      return super.volume;
    }
    set volume(e) {
      var n;
      this.capabilities.canSetVolume
        ? ((super.volume = e),
          (null === (n = this.sharePlay) || void 0 === n
            ? void 0
            : n.shouldUpdate("volume", this.volume)) &&
            this.services.dispatcher.publish(fa, {
              playbackState: this.volume,
            }))
        : Ze.warn("Setting volume is not supported in this playback method");
    }
    play() {
      var e = this,
        _superprop_get_play = () => super.play;
      return _async_to_generator$3(function* () {
        var n, d;
        yield _superprop_get_play().call(e),
          (null === (n = e.sharePlay) || void 0 === n
            ? void 0
            : n.shouldUpdate("playbackState", e.playbackState)) &&
            e.services.dispatcher.publish(_a, {
              playbackState: e.playbackState,
            }),
          null === (d = e._voidPlayer) ||
            void 0 === d ||
            d.startTimerProgress();
      })();
    }
    pause(e) {
      var n = this,
        _superprop_get_pause = () => super.pause;
      return _async_to_generator$3(function* () {
        var d, p;
        yield _superprop_get_pause().call(n, e),
          (null === (d = n.sharePlay) || void 0 === d
            ? void 0
            : d.shouldUpdate("playbackState", n.playbackState)) &&
            n.services.dispatcher.publish(_a, {
              playbackState: n.playbackState,
            }),
          null === (p = n._voidPlayer) || void 0 === p || p.stopTimerProgress();
      })();
    }
    seekToTime(e, n = Rt.Manual) {
      var d = this,
        _superprop_get_seekToTime = () => super.seekToTime;
      return _async_to_generator$3(function* () {
        var p;
        yield _superprop_get_seekToTime().call(d, e, n),
          (null === (p = d.sharePlay) || void 0 === p
            ? void 0
            : p.lastKnownElapsedTime) !== d.currentPlaybackTime &&
            d.services.dispatcher.publish(Sa, {
              elapsedTime: d.currentPlaybackTime,
            });
      })();
    }
    skipToNextItem() {
      var e = this,
        _superprop_get_skipToNextItem = () => super.skipToNextItem;
      return _async_to_generator$3(function* () {
        return _superprop_get_skipToNextItem().call(e);
      })();
    }
    skipToPreviousItem() {
      var e = this,
        _superprop_get_skipToPreviousItem = () => super.skipToPreviousItem;
      return _async_to_generator$3(function* () {
        return _superprop_get_skipToPreviousItem().call(e);
      })();
    }
    playMediaItem(e, n) {
      var d = this,
        _superprop_get_playMediaItem = () => super.playMediaItem;
      return _async_to_generator$3(function* () {
        return _superprop_get_playMediaItem().call(d, e, n);
      })();
    }
    setStationQueue(e) {
      var n = this,
        _superprop_get_setStationQueue = () => super.setStationQueue;
      return _async_to_generator$3(function* () {
        return _superprop_get_setStationQueue().call(n, e);
      })();
    }
    setQueue(e) {
      var n = this,
        _superprop_get_setQueue = () => super.setQueue;
      return _async_to_generator$3(function* () {
        return _superprop_get_setQueue().call(n, e);
      })();
    }
    _checkNeedsEquivalent() {
      super._checkNeedsEquivalent();
    }
    playNext(e, n = !1) {
      var d = this,
        _superprop_get_playNext = () => super.playNext;
      return _async_to_generator$3(function* () {
        return _superprop_get_playNext().call(d, e, n);
      })();
    }
    playLater(e) {
      var n = this,
        _superprop_get_playLater = () => super.playLater;
      return _async_to_generator$3(function* () {
        return _superprop_get_playLater().call(n, e);
      })();
    }
    playAt(e, n) {
      var d = this,
        _superprop_get_playAt = () => super.playAt;
      return _async_to_generator$3(function* () {
        return _superprop_get_playAt().call(d, e, n);
      })();
    }
    updateQueue(n, d) {
      const p = n.map((e) => new MediaItem(e)),
        h = p[d];
      h && (h.playbackType = e.PlaybackType.encryptedFull),
        this._voidPlayer && (this._voidPlayer.nowPlayingItem = h),
        this.queue.updateItems(p),
        (this.queue.position = d);
    }
    onMediaStateUpdate(
      n,
      {
        autoPlay: d,
        currentPlayingIndex: p,
        queue: h,
        playbackState: y,
        shuffleMode: _,
        repeatMode: m,
        volume: g,
      }
    ) {
      var b = this;
      return _async_to_generator$3(function* () {
        var n, P;
        b.updateQueue(h, p || 0),
          y === e.PlaybackStates.paused
            ? yield b.pause()
            : y === e.PlaybackStates.playing && (yield b.play()),
          (b.autoplayEnabled = d),
          (b.repeatMode = m),
          (b.shuffleMode = _),
          (b.volume = g),
          (b.playbackRate =
            (null === (n = b.nowPlayingItem) || void 0 === n
              ? void 0
              : n.attributes.playbackRate) || 1),
          b.seekToTime(
            (null === (P = b.sharePlay) || void 0 === P
              ? void 0
              : P.lastKnownElapsedTime) || 0
          );
      })();
    }
    savePlaybackState() {
      const {
        playbackMode: e,
        repeatMode: n,
        shuffleMode: d,
        volume: p,
        autoplayEnabled: h,
      } = this;
      this._previousPlaybackState = {
        autoplayEnabled: h,
        playbackMode: e,
        repeatMode: n,
        shuffleMode: d,
        volume: p,
      };
    }
    restorePlaybackState() {
      const {
        autoplayEnabled: e,
        playbackMode: n,
        repeatMode: d,
        shuffleMode: p,
        volume: h,
      } = this._previousPlaybackState;
      (this.autoplayEnabled = e),
        (this.playbackMode = n),
        (this.repeatMode = d),
        (this.shuffleMode = p),
        (this.volume = h);
    }
    constructor(...n) {
      super(...n),
        _define_property$2(this, "_sharePlay", void 0),
        _define_property$2(this, "_shuffleMode", e.PlayerShuffleMode.off),
        _define_property$2(this, "_voidPlayer", void 0),
        _define_property$2(this, "_previousPlaybackState", {
          playbackMode: e.PlaybackMode.MIXED_CONTENT,
          volume: 1,
          autoplayEnabled: !1,
          repeatMode: e.PlayerRepeatMode.none,
          shuffleMode: e.PlayerShuffleMode.off,
        });
    }
  }
  function asyncGeneratorStep$2(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _define_property$1(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  _ts_decorate(
    [
      SharePlayGuard(ma),
      _ts_metadata("design:type", Function),
      _ts_metadata("design:paramtypes", []),
      _ts_metadata("design:returntype", Promise),
    ],
    SharePlayInstance.prototype,
    "skipToNextItem",
    null
  ),
    _ts_decorate(
      [
        SharePlayGuard(va),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", []),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "skipToPreviousItem",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [
          void 0 === MediaItem ? Object : MediaItem,
          "undefined" == typeof PlayOptions ? Object : PlayOptions,
        ]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "playMediaItem",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [
          "undefined" == typeof StationQueueOptions
            ? Object
            : StationQueueOptions,
        ]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "setStationQueue",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [Object]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "setQueue",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", []),
        _ts_metadata("design:returntype", void 0),
      ],
      SharePlayInstance.prototype,
      "_checkNeedsEquivalent",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [
          "undefined" == typeof SerialQueueOptions
            ? Object
            : SerialQueueOptions,
          void 0,
        ]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "playNext",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [
          "undefined" == typeof SerialQueueOptions
            ? Object
            : SerialQueueOptions,
        ]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "playLater",
      null
    ),
    _ts_decorate(
      [
        SharePlayGuard(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [
          Number,
          "undefined" == typeof SerialQueueOptions
            ? Object
            : SerialQueueOptions,
        ]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "playAt",
      null
    ),
    _ts_decorate(
      [
        Bind(),
        _ts_metadata("design:type", Function),
        _ts_metadata("design:paramtypes", [void 0, void 0]),
        _ts_metadata("design:returntype", Promise),
      ],
      SharePlayInstance.prototype,
      "onMediaStateUpdate",
      null
    );
  const Yo = Ye.createChild("ctp");
  class ClickToPlayTracker {
    get active() {
      return void 0 !== this.rtcTracker;
    }
    get isConfigured() {
      return this._isConfigured;
    }
    configure(e) {
      var n = this;
      return (function (e) {
        return function () {
          var n = this,
            d = arguments;
          return new Promise(function (p, h) {
            var y = e.apply(n, d);
            function _next(e) {
              asyncGeneratorStep$2(y, p, h, _next, _throw, "next", e);
            }
            function _throw(e) {
              asyncGeneratorStep$2(y, p, h, _next, _throw, "throw", e);
            }
            _next(void 0);
          });
        };
      })(function* () {
        var d;
        (n.instance = e.instance),
          (n.rtcTracker =
            null === (d = e.services.playActivity) || void 0 === d
              ? void 0
              : d.getTrackerByType(RTCStreamingTracker)),
          (n._isConfigured = !0);
      })();
    }
    handleEvent(e, n, d) {
      e === ya.playInitiated
        ? (Yo.debug("ClickToPlayTracker.handleEvent", e, n),
          this.registerPlay(n.item, n.timestamp))
        : e === ya.mediaCanPlay &&
          (Yo.debug("ClickToPlayTracker.handleEvent", e, n),
          this.trackPlay(this.instance.nowPlayingItem, n.timestamp));
    }
    registerPlay(e, n) {
      if (this.active && void 0 !== e) {
        if (void 0 !== n)
          return (
            void 0 !== this.tracking &&
              Yo.warn(
                `Replacing item ${this.tracking.item.id} with item ${e.id}`
              ),
            Yo.debug(`Registering ${e.id} initiated at ${n}`),
            (this.tracking = { item: e, initiatedTimestamp: n }),
            this.tracking
          );
        Yo.warn(
          `registerPlay timestamp value for item ${e.id} is missing, discarding`
        );
      } else Yo.debug("Not registring play: inactive");
    }
    trackPlay(e, n) {
      if (!this.active || void 0 === e)
        return void Yo.debug("Not tracking play: inactive");
      if (void 0 === this.tracking)
        return void Yo.warn(
          "ClickToPlayTracker.trackPlay called without a registered tracking item"
        );
      const d = null != n ? n : Date.now(),
        p = this.tracking.initiatedTimestamp,
        h = d - p;
      if (
        (Yo.debug(
          `trackPlay: item=${e.id}, initiated=${p}, started=${d}, timestampDiff=${h}`
        ),
        p > d)
      )
        return void Yo.warn(
          "Initiated timestamp is not before started timestamp, ignoring"
        );
      const y = this.getReportingAgent(e);
      if (void 0 !== y)
        return (
          Yo.info(`Reporting playback success after ${h}ms`),
          y.issueReportingEvent(ClickToPlayTracker.EVENT_ID, {
            event: "playbackStartup",
            playbackStartupResult: "success",
            tapToFirstFrame: h,
            PlayType: e.isLinearStream ? "LIVE" : "VOD",
          }),
          (this.tracking = void 0),
          { item: e, initiatedTimestamp: p, playbackTimestamp: d }
        );
      Yo.warn(`No reporting agent for ${e.id}, discarding`);
    }
    getReportingAgent(e) {
      var n;
      if (void 0 === this.rtcTracker)
        return void Yo.warn(
          "Could not get RTCReportingAgent from RTCStreamingTracker service"
        );
      const d = this.rtcTracker.getMediaIdentifiers(e),
        p =
          null === (n = this.rtcTracker.reportingAgent) || void 0 === n
            ? void 0
            : n.SessionInfo;
      if (void 0 === d || void 0 === p) return;
      if (
        Object.entries(d).every(function ([e, n]) {
          return p[e] === n;
        })
      )
        return this.rtcTracker.reportingAgent;
      Yo.warn("RTCReportingAgent is not associated with item " + e.id);
    }
    constructor() {
      _define_property$1(this, "_isConfigured", !1),
        _define_property$1(this, "tracking", void 0),
        _define_property$1(this, "instance", void 0),
        _define_property$1(this, "rtcTracker", void 0),
        _define_property$1(this, "requestedEvents", [
          ya.playInitiated,
          ya.mediaCanPlay,
        ]);
    }
  }
  function _define_property(e, n, d) {
    return (
      n in e
        ? Object.defineProperty(e, n, {
            value: d,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (e[n] = d),
      e
    );
  }
  function _object_spread(e) {
    for (var n = 1; n < arguments.length; n++) {
      var d = null != arguments[n] ? arguments[n] : {},
        p = Object.keys(d);
      "function" == typeof Object.getOwnPropertySymbols &&
        (p = p.concat(
          Object.getOwnPropertySymbols(d).filter(function (e) {
            return Object.getOwnPropertyDescriptor(d, e).enumerable;
          })
        )),
        p.forEach(function (n) {
          _define_property(e, n, d[n]);
        });
    }
    return e;
  }
  function _object_spread_props(e, n) {
    return (
      (n = null != n ? n : {}),
      Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
        : (function (e, n) {
            var d = Object.keys(e);
            if (Object.getOwnPropertySymbols) {
              var p = Object.getOwnPropertySymbols(e);
              n &&
                (p = p.filter(function (n) {
                  return Object.getOwnPropertyDescriptor(e, n).enumerable;
                })),
                d.push.apply(d, p);
            }
            return d;
          })(Object(n)).forEach(function (d) {
            Object.defineProperty(e, d, Object.getOwnPropertyDescriptor(n, d));
          }),
      e
    );
  }
  _define_property$1(ClickToPlayTracker, "EVENT_ID", 4101);
  const zo = _object_spread(
    {
      info: function () {
        var n, d, p, h;
        const y = {};
        y.version = e.version;
        const _ = getHlsJsCdnConfig();
        var m;
        (y.hlsJSVersion =
          null !==
            (m =
              null === (n = /\/hls\.js\/([^/]+)\/hls\.js\//i.exec(_.hls)) ||
              void 0 === n
                ? void 0
                : n[1]) && void 0 !== m
            ? m
            : "missing"),
          (y.hlsJSURL = _.hls),
          (y.rtcJSURL = _.rtc);
        const g = getInstance();
        y.instanceId = null == g ? void 0 : g.id;
        const b = null == g ? void 0 : g.services.runtime;
        var P, S, T, k, E, w;
        return (
          (y.runtime =
            void 0 === b
              ? void 0
              : {
                  browser: `${b.browser.name} ${b.browser.version}`,
                  engine: `${b.engine.name} ${b.engine.version}`,
                  os: `${b.os.name} ${b.os.version}`,
                  mobile: b.isMobile,
                  keysystems: b.availableKeySystems,
                }),
          (y.controller =
            null !==
              (P =
                null == g ||
                null === (d = g._playbackController) ||
                void 0 === d
                  ? void 0
                  : d.constructor.name) && void 0 !== P
              ? P
              : "none"),
          (y.player =
            null !==
              (S =
                null == g ||
                null === (h = g._mediaItemPlayback) ||
                void 0 === h ||
                null === (p = h.getCurrentPlayer()) ||
                void 0 === p
                  ? void 0
                  : p.constructor.name) && void 0 !== S
              ? S
              : "none"),
          (y.nowPlayingItem =
            void 0 === (null == g ? void 0 : g.nowPlayingItem)
              ? void 0
              : {
                  id: g.nowPlayingItem.id,
                  type: g.nowPlayingItem.type,
                  contentType:
                    null !== (T = g.nowPlayingItem.contentType) && void 0 !== T
                      ? T
                      : "unknown",
                  title: g.nowPlayingItem.title,
                  assets:
                    null !==
                      (E =
                        null !== (k = g.nowPlayingItem.playables) &&
                        void 0 !== k
                          ? k
                          : g.nowPlayingItem.assets) && void 0 !== E
                      ? E
                      : [],
                  keys: g.nowPlayingItem.keyURLs,
                }),
          (y.isPlaying =
            null !== (w = null == g ? void 0 : g.isPlaying) &&
            void 0 !== w &&
            w),
          (y.devFlags = Object.entries(O).reduce(function (e, [n, d]) {
            return _object_spread_props(_object_spread({}, e), {
              [n]: d.value,
            });
          }, {})),
          y
        );
      },
    },
    O
  );
  function asyncGeneratorStep$1(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator$1(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep$1(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep$1(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function loadLinksData() {
    return _loadLinksData.apply(this, arguments);
  }
  function _loadLinksData() {
    return (_loadLinksData = _async_to_generator$1(function* () {
      const e = [
        {
          feature: "album-song",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/albums?/(?:[^/]+/)?(?<album>\\d+)$",
          requiredQueryParams: { i: "(?<identifier>\\d+)" },
          mediaAPI: { resources: ["songs"] },
        },
        {
          feature: "albums",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/albums?/(?:[^/]+/)?(?<identifier>\\d+)$",
          mediaAPI: { resources: ["albums"] },
        },
        {
          feature: "algo-stations",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/stations?/(?:[^/]+/)?(?<identifier>(?:ra|st).\\d+)",
          mediaAPI: { resources: ["stations"] },
        },
        {
          feature: "artist-default-playable-content",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/artists?/(?:[^/]+/)?(?<identifier>\\d+)$",
          mediaAPI: { resources: ["artists", "default-playable-content"] },
        },
        {
          feature: "genre-stations",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/genre-stations?",
          mediaAPI: {
            resources: ["stations"],
            parameterMapping: {
              genres: "filter[genres]",
              eras: "filter[eras]",
              tags: "filter[tags]",
              moods: "filter[moods]",
            },
          },
        },
        {
          feature: "library-albums",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/library/albums?/(?:[^/]+/)?(?<identifier>(?:l).[a-zA-Z0-9-]+)$",
          mediaAPI: { resources: ["albums"] },
        },
        {
          feature: "library-album-song",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/library/albums?/(?:[^/]+/)?(?<album>(?:l).[a-zA-Z0-9-]+)$",
          requiredQueryParams: { i: "(?<identifier>i\\.[a-zA-Z0-9-]+)" },
          mediaAPI: { resources: ["songs"] },
        },
        {
          feature: "library-playlists",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/library/playlists?/(?:[^/]+/)?(?<identifier>(?:p).[a-zA-Z0-9-]+)$",
          mediaAPI: { resources: ["playlists"] },
        },
        {
          feature: "music-videos",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/music-videos?/(?:[^/]+/)?(?<identifier>\\d+)$",
          mediaAPI: { resources: ["musicVideos"] },
        },
        {
          feature: "personal-general-radio",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/stations?/me$",
          mediaAPI: {
            resources: ["stations"],
            parameters: { "filter[identity]": "personal" },
          },
        },
        {
          feature: "personal-mixes",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/(?:personal-)?mix/(?:[^/]+/)?(?<identifier>mx.(?:\\d{1,2}|rp-\\d{4}))$",
          mediaAPI: { resources: ["playlists"] },
        },
        {
          feature: "playlists",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/playlists?/(?:[^/]+/)?(?<identifier>(?:pl).[a-zA-Z0-9-]+)$",
          mediaAPI: { resources: ["playlists"] },
        },
        {
          feature: "song",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/songs?/(?:[^/]+/)?(?<identifier>\\d+)$",
          mediaAPI: { resources: ["songs"] },
        },
        {
          feature: "steering-request",
          regex:
            "http(?:s)?://(?<realm>itunes|music).apple.com/me/stations?/change-station/?$",
          mediaAPI: { resources: ["stations"] },
        },
      ].map(
        (e) => (
          (e.regex = new RegExp(e.regex)),
          e.requiredQueryParams &&
            (e.requiredQueryParams = Object.keys(e.requiredQueryParams).reduce(
              (n, d) => ((n[d] = new RegExp(e.requiredQueryParams[d])), n),
              {}
            )),
          e
        )
      );
      return Promise.resolve(e);
    })).apply(this, arguments);
  }
  function meetsLinkRequirements(e, n, d = {}) {
    const [p] = e.split(/\?|\#|\&/),
      h = n.regex.test(p);
    return h && n.requiredQueryParams
      ? Object.keys(n.requiredQueryParams).every((e) => {
          const p = d[e];
          return n.requiredQueryParams[e].test(p);
        })
      : h;
  }
  function filterLinks(e) {
    return _filterLinks.apply(this, arguments);
  }
  function _filterLinks() {
    return (_filterLinks = _async_to_generator$1(function* (e) {
      const n = yield loadLinksData(),
        d = parseQueryParams(e);
      return n.reduce((n, p) => {
        if (meetsLinkRequirements(e, p, d)) {
          if (n.length > 0)
            if (p.requiredQueryParams)
              n = n.filter((e) => e.requiredQueryParams);
            else if (n.some((e) => e.requiredQueryParams)) return n;
          p.requiredQueryParams
            ? (p.mediaAPI.parameters = Object.keys(
                p.requiredQueryParams
              ).reduce((e, n) => ((e[n] = d[n]), e), {}))
            : p.mediaAPI.parameterMapping &&
              (p.mediaAPI.parameters = transform$a(
                p.mediaAPI.parameterMapping,
                d,
                !0
              )),
            n.push(p);
        }
        return n;
      }, []);
    })).apply(this, arguments);
  }
  function _resolveCanonical() {
    return (_resolveCanonical = _async_to_generator$1(function* (e) {
      return {
        results: { links: yield filterLinks(e) },
        meta: { originalUrl: e, originalQueryParams: parseQueryParams(e) },
      };
    })).apply(this, arguments);
  }
  function asyncGeneratorStep(e, n, d, p, h, y, _) {
    try {
      var m = e[y](_),
        g = m.value;
    } catch (q) {
      return void d(q);
    }
    m.done ? n(g) : Promise.resolve(g).then(p, h);
  }
  function _async_to_generator(e) {
    return function () {
      var n = this,
        d = arguments;
      return new Promise(function (p, h) {
        var y = e.apply(n, d);
        function _next(e) {
          asyncGeneratorStep(y, p, h, _next, _throw, "next", e);
        }
        function _throw(e) {
          asyncGeneratorStep(y, p, h, _next, _throw, "throw", e);
        }
        _next(void 0);
      });
    };
  }
  function configure(e) {
    return _configure.apply(this, arguments);
  }
  function _configure() {
    return (_configure = _async_to_generator(function* (e) {
      Ze.linkChild(Ye),
        Ze.linkChild(He),
        Ze.linkChild(be),
        Ze.linkChild(We),
        (e.playActivityAPI = [new MPAFTracker(), new LyricsTracker()]);
      let n = MusicKitInstance;
      void 0 !== e.rtcOptions &&
        (e.playActivityAPI = [
          ...e.playActivityAPI,
          new RTCStreamingTracker(e.rtcOptions),
          new ClickToPlayTracker(),
        ]),
        (n = SharePlayInstance);
      return yield configure$1(
        e,
        n,
        (function () {
          var n = _async_to_generator(function* (n) {
            const { apiOptions: d } = e;
            let p = { apiType: bo.MEDIA_API, options: {} };
            d && (p = createMediaAPIServiceDescriptor({ configureOptions: d })),
              yield n.configure([p]),
              e.declarativeMarkup &&
                "undefined" != typeof console &&
                console.warn &&
                console.warn(
                  "The declarativeMarkup configuration option has been removed in MusicKit JS V3"
                );
          });
          return function (e) {
            return n.apply(this, arguments);
          };
        })()
      );
    })).apply(this, arguments);
  }
  if (Bo) {
    const e = (function () {
        function meta(e) {
          if (detectNodeEnvironment()) return;
          const n = document.head.querySelector(`meta[name=${e}]`);
          return (null == n ? void 0 : n.content) || void 0;
        }
        const e = meta("apple-music-developer-token") || meta("JWT"),
          n = meta("apple-music-app-build") || meta("version"),
          d = meta("apple-music-app-name"),
          p = meta("apple-music-app-version");
        let h;
        return (
          (e || n || d || p) &&
            ((h = {}),
            e && (h.developerToken = e),
            (n || d || p) &&
              ((h.app = {}),
              n && (h.app.build = n),
              d && (h.app.name = d),
              p && (h.app.version = p))),
          h
        );
      })(),
      n = /interactive|complete|loaded/.test(document.readyState);
    e &&
      e.developerToken &&
      0 === getInstances().length &&
      (n
        ? asAsync(configure(e))
        : document.addEventListener("DOMContentLoaded", () => configure(e)));
  }
  (e.Events = ya),
    (e.MKError = MKError),
    (e.MediaItem = MediaItem),
    (e.VideoTypes = {
      movie: !0,
      musicVideo: !0,
      musicMovie: !0,
      trailer: !0,
      tvEpisode: !0,
      uploadedVideo: !0,
      "uploaded-videos": !0,
      "music-videos": !0,
      "music-movies": !0,
      "tv-episodes": !0,
      Bonus: !0,
      Extra: !0,
      Episode: !0,
      Movie: !0,
      Preview: !0,
      Promotional: !0,
      Season: !0,
      Show: !0,
      Vod: !0,
      EditorialVideoClip: !0,
      RealityVideo: !0,
      SportingEvent: !0,
      LiveService: !0,
    }),
    (e.__dev = zo),
    (e.__log = et),
    (e.configure = configure),
    (e.enableMultipleInstances = function () {
      Fo = !0;
    }),
    (e.formatArtworkURL = formatArtworkURL),
    (e.formatMediaTime = function (e, n = ":") {
      const { hours: d, minutes: p } = formattedSeconds(e);
      e = Math.floor((e % 3600) % 60);
      const h = [];
      return (
        d
          ? (h.push("" + d), h.push(p < 10 ? "0" + p : "" + p))
          : h.push("" + p),
        h.push(e < 10 ? "0" + e : "" + e),
        h.join(n)
      );
    }),
    (e.formattedMediaURL = formattedMediaURL),
    (e.formattedMilliseconds = function (e) {
      return formattedSeconds(e / 1e3);
    }),
    (e.formattedSeconds = formattedSeconds),
    (e.generateEmbedCode = function (e, n = { height: "450", width: "660" }) {
      if (!p.test(e)) throw new Error("Invalid content url");
      var d;
      let _ = null !== (d = n.height) && void 0 !== d ? d : "450";
      var m;
      let g = null !== (m = n.width) && void 0 !== m ? m : "660";
      const { kind: b, isUTS: P } = formattedMediaURL(e),
        S = "post" === b || "musicVideo" === b || P;
      "song" === b || "episode" === b
        ? (_ = "175")
        : S && (_ = "" + Math.round(0.5625 * parseInt(g, 10))),
        (_ = ("" + _).replace(/(\d+)px/i, "$1")),
        (g = ("" + g).replace(/^(\d+)(?!px)%?$/i, "$1px"));
      const T =
        (S ? "width:" + g : "width:100%;" + (g ? "max-width:" + g : "")) +
        ";overflow:hidden;border-radius:10px;";
      let k = "https://embed.music.apple.com";
      return (
        ["podcast", "episode"].includes(null != b ? b : "") &&
          !P &&
          (k = "https://embed.podcasts.apple.com"),
        `<iframe ${[`allow="${y.join("; ")}"`, 'frameborder="0"', _ ? `height="${_}"` : "", `style="${T}"`, `sandbox="${h.join(" ")}"`, `src="${e.replace(p, k)}"`].join(" ")}></iframe>`
      );
    }),
    (e.getHlsJsCdnConfig = getHlsJsCdnConfig),
    (e.getInstance = getInstance),
    (e.getInstances = getInstances),
    (e.getPlayerType = function (e) {
      var n, d;
      return (null == e ? void 0 : e.isUTS) ||
        J.includes(null == e ? void 0 : e.type)
        ? "video"
        : null !==
              (d =
                null == e || null === (n = e.attributes) || void 0 === n
                  ? void 0
                  : n.mediaKind) && void 0 !== d
          ? d
          : "audio";
    }),
    (e.prepareMediaAPIItem = prepareMediaAPIItem),
    (e.resolveCanonical = function (e) {
      return _resolveCanonical.apply(this, arguments);
    }),
    Object.defineProperty(e, "__esModule", { value: !0 });
});
